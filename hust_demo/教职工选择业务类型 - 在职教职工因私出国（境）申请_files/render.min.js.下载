registerNamespace("InfoPlus.Dynamics.Parser");InfoPlus.Dynamics.Parser.Expression=(function(){var g={trace:function c(){},yy:{},symbols_:{error:2,expressions:3,expression:4,EOF:5,"||":6,"&&":7,"!":8,">":9,"<":10,"==":11,">=":12,"<=":13,"!=":14,"+":15,"-":16,"*":17,"/":18,"%":19,literal:20,parenthesis:21,references:22,functionCall:23,PARENTHESIS:24,CLOSE_PARENTHESIS:25,string:26,number:27,bool:28,NUMBER:29,STRING:30,BOOL:31,DOLLAR:32,ID:33,attributes:34,attribute:35,method:36,index:37,property:38,DOT:39,params:40,COMMA:41,BRACKET:42,CLOSE_BRACKET:43,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",6:"||",7:"&&",8:"!",9:">",10:"<",11:"==",12:">=",13:"<=",14:"!=",15:"+",16:"-",17:"*",18:"/",19:"%",24:"PARENTHESIS",25:"CLOSE_PARENTHESIS",29:"NUMBER",30:"STRING",31:"BOOL",32:"DOLLAR",33:"ID",39:"DOT",41:"COMMA",42:"BRACKET",43:"CLOSE_BRACKET"},productions_:[0,[3,2],[4,3],[4,3],[4,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1],[4,1],[4,1],[4,2],[21,3],[20,1],[20,1],[20,1],[27,1],[27,2],[26,1],[28,1],[22,3],[22,2],[34,1],[34,2],[35,1],[35,1],[35,1],[36,2],[23,4],[23,3],[40,1],[40,3],[38,2],[37,3]],performAction:function b(h,k,l,o,n,j,m){var i=j.length-1;switch(n){case 1:return j[i-1];break;case 2:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 3:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 4:this.$={type:"expression",expression:[j[i]],operator:"not"};break;case 5:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 6:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 7:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 8:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 9:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 10:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 11:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 12:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 13:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 14:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 15:this.$={type:"expression",expression:[j[i-2],j[i]],operator:j[i-1]};break;case 16:this.$=j[i];break;case 17:this.$=j[i];break;case 18:this.$=j[i];break;case 19:this.$={type:"functionCall",id:j[i].id,args:j[i].args};break;case 20:this.$={type:"expression",expression:[j[i]],operator:"minus"};break;case 21:this.$={type:"expression",expression:[j[i-1]],operator:"parenthesis"};break;case 22:this.$={type:"string",value:j[i]};break;case 23:this.$={type:"number",value:j[i]};break;case 24:this.$={type:"bool",value:j[i]};break;case 25:this.$=j[i];break;case 26:this.$="-"+j[i];break;case 27:this.$=j[i];break;case 28:this.$=j[i];break;case 29:this.$={type:"references",id:j[i-1],path:j[i]};break;case 30:this.$={type:"references",id:j[i]};break;case 31:this.$=[j[i]];break;case 32:this.$=[].concat(j[i-1],j[i]);break;case 33:this.$={type:"method",id:j[i].id,args:j[i].args};break;case 34:this.$={type:"index",id:j[i]};break;case 35:this.$={type:"property",id:j[i]};break;case 36:this.$=j[i];break;case 37:this.$={id:j[i-3],args:j[i-1]};break;case 38:this.$={id:j[i-2],args:undefined};break;case 39:this.$=[j[i]];break;case 40:this.$=[].concat(j[i-2],j[i]);break;case 41:this.$=j[i];break;case 42:this.$=j[i-1];break}},table:[{3:1,4:2,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{1:[3]},{5:[1,18],6:[1,19],7:[1,20],9:[1,21],10:[1,22],11:[1,23],12:[1,24],13:[1,25],14:[1,26],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31]},{4:32,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{5:[2,16],6:[2,16],7:[2,16],9:[2,16],10:[2,16],11:[2,16],12:[2,16],13:[2,16],14:[2,16],15:[2,16],16:[2,16],17:[2,16],18:[2,16],19:[2,16],25:[2,16],41:[2,16],43:[2,16]},{5:[2,17],6:[2,17],7:[2,17],9:[2,17],10:[2,17],11:[2,17],12:[2,17],13:[2,17],14:[2,17],15:[2,17],16:[2,17],17:[2,17],18:[2,17],19:[2,17],25:[2,17],41:[2,17],43:[2,17]},{5:[2,18],6:[2,18],7:[2,18],9:[2,18],10:[2,18],11:[2,18],12:[2,18],13:[2,18],14:[2,18],15:[2,18],16:[2,18],17:[2,18],18:[2,18],19:[2,18],25:[2,18],41:[2,18],43:[2,18]},{5:[2,19],6:[2,19],7:[2,19],9:[2,19],10:[2,19],11:[2,19],12:[2,19],13:[2,19],14:[2,19],15:[2,19],16:[2,19],17:[2,19],18:[2,19],19:[2,19],25:[2,19],41:[2,19],43:[2,19]},{21:33,24:[1,12],29:[1,34]},{5:[2,22],6:[2,22],7:[2,22],9:[2,22],10:[2,22],11:[2,22],12:[2,22],13:[2,22],14:[2,22],15:[2,22],16:[2,22],17:[2,22],18:[2,22],19:[2,22],25:[2,22],41:[2,22],43:[2,22]},{5:[2,23],6:[2,23],7:[2,23],9:[2,23],10:[2,23],11:[2,23],12:[2,23],13:[2,23],14:[2,23],15:[2,23],16:[2,23],17:[2,23],18:[2,23],19:[2,23],25:[2,23],41:[2,23],43:[2,23]},{5:[2,24],6:[2,24],7:[2,24],9:[2,24],10:[2,24],11:[2,24],12:[2,24],13:[2,24],14:[2,24],15:[2,24],16:[2,24],17:[2,24],18:[2,24],19:[2,24],25:[2,24],41:[2,24],43:[2,24]},{4:35,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{33:[1,36]},{24:[1,37]},{5:[2,27],6:[2,27],7:[2,27],9:[2,27],10:[2,27],11:[2,27],12:[2,27],13:[2,27],14:[2,27],15:[2,27],16:[2,27],17:[2,27],18:[2,27],19:[2,27],25:[2,27],41:[2,27],43:[2,27]},{5:[2,25],6:[2,25],7:[2,25],9:[2,25],10:[2,25],11:[2,25],12:[2,25],13:[2,25],14:[2,25],15:[2,25],16:[2,25],17:[2,25],18:[2,25],19:[2,25],25:[2,25],41:[2,25],43:[2,25]},{5:[2,28],6:[2,28],7:[2,28],9:[2,28],10:[2,28],11:[2,28],12:[2,28],13:[2,28],14:[2,28],15:[2,28],16:[2,28],17:[2,28],18:[2,28],19:[2,28],25:[2,28],41:[2,28],43:[2,28]},{1:[2,1]},{4:38,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:39,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:40,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:41,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:42,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:43,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:44,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:45,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:46,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:47,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:48,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:49,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{4:50,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{5:[2,4],6:[2,4],7:[2,4],9:[2,4],10:[2,4],11:[2,4],12:[2,4],13:[2,4],14:[2,4],15:[2,4],16:[2,4],17:[2,4],18:[2,4],19:[2,4],25:[2,4],41:[2,4],43:[2,4]},{5:[2,20],6:[2,20],7:[2,20],9:[2,20],10:[2,20],11:[2,20],12:[2,20],13:[2,20],14:[2,20],15:[2,20],16:[2,20],17:[2,20],18:[2,20],19:[2,20],25:[2,20],41:[2,20],43:[2,20]},{5:[2,26],6:[2,26],7:[2,26],9:[2,26],10:[2,26],11:[2,26],12:[2,26],13:[2,26],14:[2,26],15:[2,26],16:[2,26],17:[2,26],18:[2,26],19:[2,26],25:[2,26],41:[2,26],43:[2,26]},{6:[1,19],7:[1,20],9:[1,21],10:[1,22],11:[1,23],12:[1,24],13:[1,25],14:[1,26],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],25:[1,51]},{5:[2,30],6:[2,30],7:[2,30],9:[2,30],10:[2,30],11:[2,30],12:[2,30],13:[2,30],14:[2,30],15:[2,30],16:[2,30],17:[2,30],18:[2,30],19:[2,30],25:[2,30],34:52,35:53,36:54,37:55,38:56,39:[1,57],41:[2,30],42:[1,58],43:[2,30]},{4:61,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],25:[1,60],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14],40:59},{5:[2,2],6:[2,2],7:[2,2],9:[1,21],10:[1,22],11:[1,23],12:[1,24],13:[1,25],14:[1,26],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],25:[2,2],41:[2,2],43:[2,2]},{5:[2,3],6:[2,3],7:[2,3],9:[1,21],10:[1,22],11:[1,23],12:[1,24],13:[1,25],14:[1,26],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],25:[2,3],41:[2,3],43:[2,3]},{5:[2,5],6:[2,5],7:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],25:[2,5],41:[2,5],43:[2,5]},{5:[2,6],6:[2,6],7:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],25:[2,6],41:[2,6],43:[2,6]},{5:[2,7],6:[2,7],7:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],25:[2,7],41:[2,7],43:[2,7]},{5:[2,8],6:[2,8],7:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],25:[2,8],41:[2,8],43:[2,8]},{5:[2,9],6:[2,9],7:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],25:[2,9],41:[2,9],43:[2,9]},{5:[2,10],6:[2,10],7:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],25:[2,10],41:[2,10],43:[2,10]},{5:[2,11],6:[2,11],7:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],17:[1,29],18:[1,30],19:[1,31],25:[2,11],41:[2,11],43:[2,11]},{5:[2,12],6:[2,12],7:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],17:[1,29],18:[1,30],19:[1,31],25:[2,12],41:[2,12],43:[2,12]},{5:[2,13],6:[2,13],7:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],17:[2,13],18:[2,13],19:[2,13],25:[2,13],41:[2,13],43:[2,13]},{5:[2,14],6:[2,14],7:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],17:[2,14],18:[2,14],19:[2,14],25:[2,14],41:[2,14],43:[2,14]},{5:[2,15],6:[2,15],7:[2,15],9:[2,15],10:[2,15],11:[2,15],12:[2,15],13:[2,15],14:[2,15],15:[2,15],16:[2,15],17:[2,15],18:[2,15],19:[2,15],25:[2,15],41:[2,15],43:[2,15]},{5:[2,21],6:[2,21],7:[2,21],9:[2,21],10:[2,21],11:[2,21],12:[2,21],13:[2,21],14:[2,21],15:[2,21],16:[2,21],17:[2,21],18:[2,21],19:[2,21],25:[2,21],41:[2,21],43:[2,21]},{5:[2,29],6:[2,29],7:[2,29],9:[2,29],10:[2,29],11:[2,29],12:[2,29],13:[2,29],14:[2,29],15:[2,29],16:[2,29],17:[2,29],18:[2,29],19:[2,29],25:[2,29],35:62,36:54,37:55,38:56,39:[1,57],41:[2,29],42:[1,58],43:[2,29]},{5:[2,31],6:[2,31],7:[2,31],9:[2,31],10:[2,31],11:[2,31],12:[2,31],13:[2,31],14:[2,31],15:[2,31],16:[2,31],17:[2,31],18:[2,31],19:[2,31],25:[2,31],39:[2,31],41:[2,31],42:[2,31],43:[2,31]},{5:[2,33],6:[2,33],7:[2,33],9:[2,33],10:[2,33],11:[2,33],12:[2,33],13:[2,33],14:[2,33],15:[2,33],16:[2,33],17:[2,33],18:[2,33],19:[2,33],25:[2,33],39:[2,33],41:[2,33],42:[2,33],43:[2,33]},{5:[2,34],6:[2,34],7:[2,34],9:[2,34],10:[2,34],11:[2,34],12:[2,34],13:[2,34],14:[2,34],15:[2,34],16:[2,34],17:[2,34],18:[2,34],19:[2,34],25:[2,34],39:[2,34],41:[2,34],42:[2,34],43:[2,34]},{5:[2,35],6:[2,35],7:[2,35],9:[2,35],10:[2,35],11:[2,35],12:[2,35],13:[2,35],14:[2,35],15:[2,35],16:[2,35],17:[2,35],18:[2,35],19:[2,35],25:[2,35],39:[2,35],41:[2,35],42:[2,35],43:[2,35]},{23:63,33:[1,64]},{4:65,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{25:[1,66],41:[1,67]},{5:[2,38],6:[2,38],7:[2,38],9:[2,38],10:[2,38],11:[2,38],12:[2,38],13:[2,38],14:[2,38],15:[2,38],16:[2,38],17:[2,38],18:[2,38],19:[2,38],25:[2,38],39:[2,38],41:[2,38],42:[2,38],43:[2,38]},{6:[1,19],7:[1,20],9:[1,21],10:[1,22],11:[1,23],12:[1,24],13:[1,25],14:[1,26],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],25:[2,39],41:[2,39]},{5:[2,32],6:[2,32],7:[2,32],9:[2,32],10:[2,32],11:[2,32],12:[2,32],13:[2,32],14:[2,32],15:[2,32],16:[2,32],17:[2,32],18:[2,32],19:[2,32],25:[2,32],39:[2,32],41:[2,32],42:[2,32],43:[2,32]},{5:[2,36],6:[2,36],7:[2,36],9:[2,36],10:[2,36],11:[2,36],12:[2,36],13:[2,36],14:[2,36],15:[2,36],16:[2,36],17:[2,36],18:[2,36],19:[2,36],25:[2,36],39:[2,36],41:[2,36],42:[2,36],43:[2,36]},{5:[2,41],6:[2,41],7:[2,41],9:[2,41],10:[2,41],11:[2,41],12:[2,41],13:[2,41],14:[2,41],15:[2,41],16:[2,41],17:[2,41],18:[2,41],19:[2,41],24:[1,37],25:[2,41],39:[2,41],41:[2,41],42:[2,41],43:[2,41]},{6:[1,19],7:[1,20],9:[1,21],10:[1,22],11:[1,23],12:[1,24],13:[1,25],14:[1,26],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],43:[1,68]},{5:[2,37],6:[2,37],7:[2,37],9:[2,37],10:[2,37],11:[2,37],12:[2,37],13:[2,37],14:[2,37],15:[2,37],16:[2,37],17:[2,37],18:[2,37],19:[2,37],25:[2,37],39:[2,37],41:[2,37],42:[2,37],43:[2,37]},{4:69,8:[1,3],16:[1,8],20:4,21:5,22:6,23:7,24:[1,12],26:9,27:10,28:11,29:[1,16],30:[1,15],31:[1,17],32:[1,13],33:[1,14]},{5:[2,42],6:[2,42],7:[2,42],9:[2,42],10:[2,42],11:[2,42],12:[2,42],13:[2,42],14:[2,42],15:[2,42],16:[2,42],17:[2,42],18:[2,42],19:[2,42],25:[2,42],39:[2,42],41:[2,42],42:[2,42],43:[2,42]},{6:[1,19],7:[1,20],9:[1,21],10:[1,22],11:[1,23],12:[1,24],13:[1,25],14:[1,26],15:[1,27],16:[1,28],17:[1,29],18:[1,30],19:[1,31],25:[2,40],41:[2,40]}],defaultActions:{18:[2,1]},parseError:function d(i,h){throw new Error(i)},parse:function f(s){var z=this,n=[0],I=[null],u=[],J=this.table,i="",t=0,G=0,k=0,q=2,w=1;this.lexer.setInput(s);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;this.yy.parser=this;if(typeof this.lexer.yylloc=="undefined"){this.lexer.yylloc={}}var j=this.lexer.yylloc;u.push(j);var l=this.lexer.options&&this.lexer.options.ranges;if(typeof this.yy.parseError==="function"){this.parseError=this.yy.parseError}function y(p){n.length=n.length-2*p;I.length=I.length-p;u.length=u.length-p}function x(){var p;p=z.lexer.lex()||1;if(typeof p!=="number"){p=z.symbols_[p]||p}return p}var F,B,m,E,K,v,D={},A,H,h,o;while(true){m=n[n.length-1];if(this.defaultActions[m]){E=this.defaultActions[m]}else{if(F===null||typeof F=="undefined"){F=x()}E=J[m]&&J[m][F]}if(typeof E==="undefined"||!E.length||!E[0]){var C="";if(!k){o=[];for(A in J[m]){if(this.terminals_[A]&&A>2){o.push("'"+this.terminals_[A]+"'")}}if(this.lexer.showPosition){C="Parse error on line "+(t+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+o.join(", ")+", got '"+(this.terminals_[F]||F)+"'"}else{C="Parse error on line "+(t+1)+": Unexpected "+(F==1?"end of input":"'"+(this.terminals_[F]||F)+"'")}this.parseError(C,{text:this.lexer.match,token:this.terminals_[F]||F,line:this.lexer.yylineno,loc:j,expected:o})}}if(E[0] instanceof Array&&E.length>1){throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+F)}switch(E[0]){case 1:n.push(F);I.push(this.lexer.yytext);u.push(this.lexer.yylloc);n.push(E[1]);F=null;if(!B){G=this.lexer.yyleng;i=this.lexer.yytext;t=this.lexer.yylineno;j=this.lexer.yylloc;if(k>0){k--}}else{F=B;B=null}break;case 2:H=this.productions_[E[1]][1];D.$=I[I.length-H];D._$={first_line:u[u.length-(H||1)].first_line,last_line:u[u.length-1].last_line,first_column:u[u.length-(H||1)].first_column,last_column:u[u.length-1].last_column};if(l){D._$.range=[u[u.length-(H||1)].range[0],u[u.length-1].range[1]]}v=this.performAction.call(D,i,G,t,this.yy,E[1],I,u);if(typeof v!=="undefined"){return v}if(H){n=n.slice(0,-1*H*2);I=I.slice(0,-1*H);u=u.slice(0,-1*H)}n.push(this.productions_[E[1]][0]);I.push(D.$);u.push(D._$);h=J[n[n.length-2]][n[n.length-1]];n.push(h);break;case 3:return true}}return true}};var a=(function(){var k=({EOF:1,parseError:function m(p,o){if(this.yy.parser){this.yy.parser.parseError(p,o)}else{throw new Error(p)}},setInput:function(o){this._input=o;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges){this.yylloc.range=[0,0]}this.offset=0;return this},input:function(){var p=this._input[0];this.yytext+=p;this.yyleng++;this.offset++;this.match+=p;this.matched+=p;var o=p.match(/(?:\r\n?|\n).*/g);if(o){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}if(this.options.ranges){this.yylloc.range[1]++}this._input=this._input.slice(1);return p},unput:function(q){var o=q.length;var p=q.split(/(?:\r\n?|\n)/g);this._input=q+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-o-1);this.offset-=o;var t=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(p.length-1){this.yylineno-=p.length-1}var s=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:p?(p.length===t.length?this.yylloc.first_column:0)+t[t.length-p.length].length-p[0].length:this.yylloc.first_column-o};if(this.options.ranges){this.yylloc.range=[s[0],s[0]+this.yyleng-o]}return this},more:function(){this._more=true;return this},less:function(o){this.unput(this.match.slice(o))},pastInput:function(){var o=this.matched.substr(0,this.matched.length-this.match.length);return(o.length>20?"...":"")+o.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var o=this.match;if(o.length<20){o+=this._input.substr(0,20-o.length)}return(o.substr(0,20)+(o.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var o=this.pastInput();var p=new Array(o.length+1).join("-");return o+this.upcomingInput()+"\n"+p+"^"},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var u,s,p,r,q,o;if(!this._more){this.yytext="";this.match=""}var v=this._currentRules();for(var t=0;t<v.length;t++){p=this._input.match(this.rules[v[t]]);if(p&&(!s||p[0].length>s[0].length)){s=p;r=t;if(!this.options.flex){break}}}if(s){o=s[0].match(/(?:\r\n?|\n).*/g);if(o){this.yylineno+=o.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:o?o[o.length-1].length-o[o.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+s[0].length};this.yytext+=s[0];this.match+=s[0];this.matches=s;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng]}this._more=false;this._input=this._input.slice(s[0].length);this.matched+=s[0];u=this.performAction.call(this,this.yy,this,v[r],this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input){this.done=false}if(u){return u}else{return}}if(this._input===""){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function h(){var o=this.next();if(typeof o!=="undefined"){return o}else{return this.lex()}},begin:function i(o){this.conditionStack.push(o)},popState:function n(){return this.conditionStack.pop()},_currentRules:function l(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function i(o){this.begin(o)}});k.options={};k.performAction=function j(s,p,r,o){var q=o;switch(r){case 0:this.begin("ref");break;case 1:this.begin("fb");return 33;break;case 2:break;case 3:return 29;break;case 4:return p.yytext;break;case 5:return p.yytext;break;case 6:return p.yytext;break;case 7:return p.yytext;break;case 8:return p.yytext;break;case 9:return p.yytext;break;case 10:return p.yytext;break;case 11:return p.yytext;break;case 12:return p.yytext;break;case 13:return"EQUAL";break;case 14:return 31;break;case 15:return 31;break;case 16:return 31;break;case 17:p.yytext=p.yytext.substr(1,p.yyleng-2).replace(/\\'/g,"'");return 30;break;case 18:p.yytext=p.yytext.substr(1,p.yyleng-2).replace(/\\"/g,'"');return 30;break;case 19:return 32;break;case 20:return 33;break;case 21:return 39;break;case 22:return 41;break;case 23:this.begin("b");return 42;break;case 24:this.popState();return 43;break;case 25:this.begin("func");return 24;break;case 26:return 24;break;case 27:return 25;break;case 28:this.begin("p");return 24;break;case 29:this.popState();return 25;break;case 30:this.popState();this.popState();return 25;break;case 31:this.popState();break;case 32:this.popState();break;case 33:this.popState();return 5;break;case 34:return 5;break}};k.rules=[/^(?:[.]*?(?=\$))/,/^(?:[a-zA-Z][a-zA-Z_]*?(?=\())/,/^(?:\s+)/,/^(?:[0-9]+(\.[0-9]+)?\b)/,/^(?:[%\+\-\*/])/,/^(?:<=)/,/^(?:>=)/,/^(?:[><])/,/^(?:==)/,/^(?:\|\|)/,/^(?:&&)/,/^(?:!=)/,/^(?:!)/,/^(?:=)/,/^(?:null\b)/,/^(?:false\b)/,/^(?:true\b)/,/^(?:'(\\'|[^\'])*')/,/^(?:"(\\"|[^\"])*")/,/^(?:\$(?=[a-zA-Z_]))/,/^(?:[_a-zA-Z][a-zA-Z0-9_]*)/,/^(?:\.)/,/^(?:,[ ]*)/,/^(?:\[)/,/^(?:\])/,/^(?:\()/,/^(?:\()/,/^(?:\))/,/^(?:\()/,/^(?:\))/,/^(?:\))/,/^(?:\s+)/,/^(?:(?=.))/,/^(?:$)/,/^(?:$)/];k.conditions={ref:{rules:[4,19,20,21,22,23,28,31,32,33],inclusive:false},b:{rules:[0,1,2,3,4,17,18,23,24,26,27],inclusive:false},p:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,22,23,28,29],inclusive:false},func:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,22,28,30,33],inclusive:false},fb:{rules:[25],inclusive:false},INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,26,27,34],inclusive:true}};return k})();g.lexer=a;function e(){this.yy={}}e.prototype=g;g.Parser=e;return new e})();
registerNamespace("InfoPlus.Dynamics.Parser");InfoPlus.Dynamics.Parser.Compile=function(a,b){this.asts=a;this.functions=b||InfoPlus.Dynamics.Functions};InfoPlus.Dynamics.Parser.Compile.prototype={asts:null,context:null,evaluate:function(c,b){this.context=(c!==undefined)?c:{};if(b!==undefined){this.targetObject=b}try{return this.getExpression(this.asts)}catch(d){var a="Error occur while evaluating the dynamic expression.\n\n";a+="Error description: "+d.message+"\n\n";a+="Click OK to continue.\n\n";alert(a)}return null},getReferenceNameArray:function(){this.references={};this.getRef(this.asts);var a=[];for(var b in this.references){if(this.references.hasOwnProperty(b)){a.push(b)}}return a},getRef:function(a){var b=a.expression;var g=a.type;if(g==="expression"){switch(a.operator){case"+":case"-":case"/":case"%":case"*":case"||":case"&&":case">":case"<":case"==":case">=":case"<=":case"!=":this.getRef(b[0]);this.getRef(b[1]);break;case"minus":case"not":case"parenthesis":this.getRef(b[0]);break;default:}}else{if(g==="references"){if(this.references[a.id]===undefined){this.references[a.id]=null}if(a.path!==undefined){for(var e=0;e<a.path.length;e++){var h=a.path[e];if(h.type==="index"){var f=h.id;if(f.type==="references"){this.getRef(f)}}else{if(h.type==="method"){if(h.args!==undefined){for(var d=0;d<h.args.length;d++){var k=h.args[d];if(k.type==="references"){this.getRef(k)}}}}}}}}else{if(g==="functionCall"){if(a.args!==undefined){for(var c=0;c<a.args.length;c++){this.getRef(a.args[c])}}}}}},isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},getArrayExpression:function(f,e,b){var c=[],d,a;if(this.isArray(f)){if(this.isArray(e)){a=Math.min(f.length,e.length);for(d=0;d<a;d++){c[d]=this.getArrayExpression(f[d],e[d],b)}}else{for(d=0,a=f.length;d<a;d++){c[d]=this.getArrayExpression(f[d],e,b)}}}else{if(this.isArray(e)){for(d=0,a=e.length;d<a;d++){c[d]=this.getArrayExpression(f,e[d],b)}}else{c=this.getExpressByValue(f,e,b)}}return c},getExpressByValue:function(c,a,b){var d;if(c!=null&&c.hasOwnProperty("value")){c=c.value}if(a!=null&&a.hasOwnProperty("value")){a=a.value}switch(b){case"+":d=c+a;break;case"-":d=c-a;break;case"/":d=c/a;break;case"%":d=c%a;break;case"*":d=c*a;break;case"||":d=c||a;break;case"&&":d=c&&a;break;case">":d=c>a;break;case"<":d=c<a;break;case"==":d=c==a;break;case">=":d=c>=a;break;case"<=":d=c<=a;break;case"!=":d=c!=a;break;case"minus":d=-c;break;case"not":d=!c;break}return d},getExpression:function(a){var f=a.expression;var c;switch(a.type){case"expression":var e=this.getExpression(f[0]);var d=(f[1]!==undefined)?this.getExpression(f[1]):undefined;switch(a.operator){case"+":case"-":case"/":case"%":case"*":case"||":case"&&":case">":case"<":case"==":case">=":case"<=":case"!=":if(this.isArray(e)||this.isArray(d)){c=this.getArrayExpression(e,d,a.operator)}else{c=this.getExpressByValue(e,d,a.operator)}break;case"minus":if(this.isArray(e)){c=this.getArrayExpression(e,undefined,a.operator)}else{c=-e}break;case"not":if(this.isArray(e)){c=this.getArrayExpression(e,undefined,a.operator)}else{c=!e}break;case"parenthesis":c=this.getExpression(f[0]);break;default:return undefined}return c;case"string":var b=a.value;if(b!=null){b=b.replace(/\\n/g,"\n").replace(/\\'/g,"'").replace(/\\"/g,'"').replace(/\\\\/g,"\\")}return b;case"number":return Number(a.value);case"bool":if(a.value==="null"){return null}else{return(a.value==="true")}case"references":return this.getReferences(a);case"functionCall":return this.getFunctionCall(a);default:return undefined}},getLiteral:function(c){var b=c.type;var a="";if(b=="string"){a=c.value}else{if(b=="number"){a=Number(c.value)}else{if(b=="bool"){if(c.value==="null"){a=null}else{if(c.value==="false"){a=false}else{if(c.value==="true"){a=true}}}}else{return this.getReferences(c)}}}return a},getReferences:function(a){var d=this.context;var b=d[a.id];if(a.path!==undefined&&b!==undefined){for(var c=0;c<a.path.length;c++){var e=a.path[c];b=this.getAttributes(e,b);if(b===undefined){break}}}return b},getAttributes:function(e,f){var d=e.type;var b;var g=e.id;if(d==="method"){b=this.getPropMethod(e,f)}else{if(d==="property"){if(this.isArray(f)){b=[];for(var c=0,a=f.length;c<a;c++){b[c]=this.getAttributes(e,f[c])}}else{b=f[g]}}else{b=this.getPropIndex(e,f)}}return b},getFunctionCall:function(a){var d,e=false;if(this.targetObject===undefined){d=this.functions[a.id];e=true}else{d=this.targetObject[a.id];if(!d||(typeof d!=="function")){d=this.functions[a.id];e=true}}var b=[];if(a.args!==undefined){for(var c=0;c<a.args.length;c++){b.push(this.getExpression(a.args[c]))}}if(d&&d.call){if(e){return d.apply(this.context,b)}else{return d.apply(this.targetObject,b)}}return undefined},getPropMethod:function(d,e){var f=d.id;var b=e[f];var a=[];if(d.args!==undefined){for(var c=0;c<d.args.length;c++){a.push(this.getExpression(d.args[c]))}}if(b&&b.call){b=b.apply(e,a)}else{b=undefined}return b},getPropIndex:function(d,e){var a=d.id;var c;c=this.getExpression(a);var b;b=e[c];return b}};
(function(b,c){var a=function(d){this.control=d};a.TYPE_BOUNDABLE="boundable";a.TYPE_REPEATABLE="repeatable";a.prototype={control:null,type:a.TYPE_BOUNDABLE,getGuid:function(){if(this.control==null){return null}return this.control.guid},getId:function(){if(this.control==null){return null}return this.control.getId()},getName:function(){if(this.control==null){return null}return $(this.control.element).attr("name")},getPath:function(){if(this.control==null){return null}return this.control.path},setValue:function(d){},getValue:function(){},setStyle:function(d,e){},getStyle:function(d){return null},registerEvent:function(e,f,d){},unRegisterEvent:function(e,d){},triggerEvent:function(d){},validate:function(){},isReadable:function(){},callMethod:function(){if(arguments.length===0){return}var e=arguments[0];if(typeof this[e]==="function"){var g=[];for(var f=1,d=arguments.length;f<d;f++){g.push(arguments[f])}this[e].apply(this,g)}}};define("InfoPlus.Core.CoreControl",a)})(window);
(function(b,c){var a=function(d){this.type=InfoPlus.Core.CoreControl.TYPE_BOUNDABLE;InfoPlus.Core.CoreControl.call(this,d)};a.prototype=$.extend(new InfoPlus.Core.CoreControl(),{setValue:function(d){if(this.control==null||!this.control.isWritable()){return}if(d!=null){if(d instanceof InfoPlus.Controls.Data.ValuePair){this.control.setValue(d.value,d.displayValue);return}if(d instanceof InfoPlus.Controls.Data.Uri){this.control.setValue(d.value);return}if(d.hasOwnProperty("value")&&d.hasOwnProperty("displayValue")){this.control.setValue(d.value,d.displayValue);return}if(d.hasOwnProperty("codeId")&&d.hasOwnProperty("codeName")){this.control.setValue(d.codeId,d.codeName);return}}this.control.setValue(d)},getValue:function(){if(this.control==null||!this.control.isReadable()){return null}return this.control.getValue()},getAttributes:function(){if(this.control==null||!this.control.isReadable()){return null}return this.control.getAttributes()},validate:function(){if(this.control==null){return true}return $IU.checkControlValidation([this.control],true,true)},registerEvent:function(e,f,d){$(this.control.element).on(e,f,d)},unRegisterEvent:function(e,d){$(this.control.element).off(e,d)},trigger:function(d){$(this.control.element).trigger(d)},isReadable:function(){return this.control.isReadable()},getDataSource:function(){return this.control.getDataSource()},setStyle:function(d,e){if(this.control==null||!this.control.isReadable()){return}this.control.setStyle(d,e)},getStyle:function(d){if(this.control==null){return null}return this.control.getStyle(d)},setFocus:function(){if(this.control==null||!this.control.isReadable()){return}this.control.setFocus()},lostFocus:function(){if(this.control==null||!this.control.isReadable()){return}this.control.lostFocus()},setOptions:function(d){if(this.control==null||!this.control.isWritable()){return}if(typeof this.control.setOptions==="function"){this.control.setOptions(this.control.element,d)}},setParentValue:function(d,e){if(this.control==null||!this.control.isWritable()){return}this.control.setParentValue(d,e)},setDataSource:function(d,e){if(this.control==null){return}if(typeof this.control.setDataSource==="function"){this.control.setDataSource(d,e)}},visible:function(d,e){if(this.control==null){return}this.control.visible(d,e)},rowVisible:function(e,f){if(this.control==null){return}var d=this.control.getRow();if(!d.is("tr")){if(e){d.show()}else{d.hide()}}else{$IU.processTrRowVisible(d,e,f)}},colVisible:function(k,g){if(this.control==null){return}var n=$(this.control.element),e=n.parents(".infoplus_repeatParentElement"),j=null;for(var h=0,m=e.length;h<m;h++){var f=$(e[h]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(f.repeatType==InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE){j=f;break}}if(j!=null){var d=$(n.parents("td")[0]),l=d.parent().children("td").index(d);if(l!=-1){j.setColumnVisible(l,k)}}},readOnly:function(d,e){if(this.control==null||this.control.isReadOnly()){return}if(d){this.control.setReadOnly()}else{this.control.element.readOnly=false;this.control.element.disabled=false;$(this.control.element).removeClass($Control.CLASSNAME_READONLY)}this.control.setDynamicReadOnly(d,e)},tooltip:function(d){if(this.control==null){return}this.control.setTooltip(d)}});define("InfoPlus.Core.CoreBoundControl",a)})(window);
(function(a,c){var b=function(d){this.type=InfoPlus.Core.CoreControl.TYPE_REPEATABLE;InfoPlus.Core.CoreControl.call(this,d)};b.prototype=$.extend(new InfoPlus.Core.CoreControl(),{getId:function(){if(this.control==null){return null}return this.control.repeatParentElement.id},getName:function(){if(this.control==null){return null}return $(this.control.repeatParentElement).attr("name")},setValue:function(d){if(this.control===null){return}this.control.setData(d)},setStyle:function(d,e){$IU.setDynamicStyle(this.control.repeatParentElement,d,e)},getStyle:function(d){return $IU.getElementStyle(this.control.repeatParentElement,d)},getValueByParentElement:function(n,f){var o={};var i=function(p){return p.substr(0,f.length)===f};var l=function(p){var q=p.substr(f.length).split("_");q.splice(0,1);return q};var m=function(p){if(p instanceof $Controls.Data.Uri){return p.value}if(p instanceof $Controls.Data.ValuePair){return{codeId:p.value,codeName:p.displayValue}}return p};var d=function(p){if(p.substr(0,5).toLowerCase()==="field"){return p.substr(5,1).toLowerCase()+p.substring(6)}else{return p.substr(0,1).toLowerCase()+p.substring(1)}};var e=function(p){if(p.substr(0,5).toLowerCase()==="group"){return p.substr(5,1).toLowerCase()+p.substring(6)}else{return p.substr(0,1).toLowerCase()+p.substring(1)}};var k=function(s,x,p){var r=x.slice(x.length-p.length);for(var v=0,q=r.length;v<q;v++){var y=e(r[v]),t=parseInt(p[v],10)+1,u=s[y];if(u==null){u=[];s[y]=u}if(u.length<t){var w=u.length;while(w<t){u[w++]={}}}s=u[t-1]}return s};var g=function(t,q,s,p,r){t=k(t,q,s);t[p]=m(r)};var h=function(r,p,q,s){r=k(r,p,q);if(r[s]===c){r[s]=[]}};var j=infoCore.getFields();$(n).find("."+$Control.CLASSNAME_CONTROL).each(function(){var p=$(this),t=p.data($Control.DATA_PATH),v=p.data($Control.DATA_FIELD),s=p.data($Control.DATA_CONTROL_OBJECT);if(v!=null&&s!=null){if(i(t)){var r=j[v],u=s.getValue(),q=r.groupArray;if(u!=null){if(t===f){o[d(r.name)]=m(u)}else{g(o,q,l(t),d(r.name),u)}}}}});$(n).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var p=$(this),r=p.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(r!=null){var s=r.path,t=r.groupName,q=r.fullGroupName.split("//");q.splice(q.length-1,1);if(s===f){if(o[e(t)]===c){o[e(t)]=[]}}else{h(o,q,l(s),e(t))}}});if(f===this.control.path){o=o[e(this.control.groupName)];if(o===c){o=[]}}return o},getValue:function(){if(this.control==null){return null}if(this.control.power.readPower===true){return this.getValueByParentElement(this.control.repeatContentParentElement,this.control.path)}else{return[]}},getAttributes:function(){return null},validate:function(){if(this.control==null){return true}var d=$(this.control.repeatContentParentElement).find("*[class*='validate']").filter($IU.isValidateControlFilter);return $IU.checkControlValidation(d,true,true)},registerEvent:function(e,f,d){$(this.control.repeatParentElement).on(e,f,d)},unRegisterEvent:function(e,d){$(this.control.repeatParentElement).off(e,d)},trigger:function(d){$(this.control.repeatParentElement).trigger(d)},isReadable:function(){return this.control.readPower},addRow:function(h,g){var f=this.control;if(f==null){return}if(f.power.insertPower===false){return}if(h===c&&g===c){f.addRepeat(null,null,true,false,false,false);return}if(typeof h==="object"){g=h;h=null}else{var e=f.getRepeatChild(h);if(e!=null){f.popupMenu.repeatSection=e}}var d=h==null?f.getRepeatChildren().length:h+1;f.addRepeat(null,null,true,false,false,false);if(g!==c){this.setRowData(d,g)}},deleteRow:function(d){if(d==null){return}var e=this.control;if(e==null){return}if(e.power.deletePower===false){return}var f=e.getRepeatChild(d);if(f!=null){e.deleteRepeat(f,true)}},setRowData:function(d,e){if(this.control==null){return}var f=this.control.path+"_"+d;$IU.setFormData(e,f,false)},getRowData:function(d){if(this.control==null){return null}var e=this.control.getRepeatChild(d);if(e!=null){return this.getValueByParentElement(e,this.control.path+"_"+d)}return null},moveRow:function(f,d){if(this.control==null){return}var e=this.control;if(e.power.writePower===false){return}e.moveRow(f,d)},sortColumn:function(d,e){if(this.control==null){return}this.control.sorter.sortColumn(d,e)},getChildren:function(){return this.control.getRepeatChildren()},readOnly:function(e,f){if(this.control==null){return}var d=this.control;d.readOnly=e;if(d.repeatAddLink==null){return}if(d.shouldShowAddLink()){d.repeatAddLink.showLink()}else{d.repeatAddLink.hideLink()}},visible:function(d,f){var e=$(this.control.repeatParentElement);if(d){if(f){e.show()}else{e.show("slow",function(){e.css("overflow","")})}}else{if(f){e.hide()}else{e.hide("slow",function(){e.css("overflow","")})}}},rowVisible:function(e,f){if(this.control==null){return}var d=this.control.getRow();if(!d.is("tr")){if(e){d.show()}else{d.hide()}}else{$IU.processTrRowVisible(d,e,f)}},colVisible:function(k,g){if(this.control==null){return}var n=$(this.control.repeatParentElement),e=n.parents(".infoplus_repeatParentElement"),j=null;for(var h=0,m=e.length;h<m;h++){var f=$(e[h]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(f.repeatType==InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE){j=f;break}}if(j!=null){var d=$(n.parents("td")[0]),l=d.parent().children("td").index(d);if(l!=-1){j.setColumnVisible(l,k)}}},itemVisible:function(e,h,g){var f=this.control.getRepeatChildren();if(h>=0&&h<f.length){var d=$(f[h]);if(e===true){if(g){d.show()}else{d.show("slow")}}else{if(g){d.hide()}else{d.hide("slow")}}}},itemReadOnly:function(f,g){var e=this.control.getRepeatChildren();if(g>=0&&g<e.length){var d=$(e[g]);d.data("isReadOnly",!!f)}}});define("InfoPlus.Core.CoreRepeatControl",b)})(window);
(function(b,c){var a=function(){};a.prototype={requestMap:{},getCodes:function(){return $$.params.formRender.entity.codes},getCode:function(d){if($$.params.formRender.entity.codes==null){return null}else{return $$.params.formRender.entity.codes[d]}},addRequestCode:function(e,f){if(this.requestMap[e]===c){this.requestMap[e]=[f]}else{var d=this.requestMap[e];if(!$IU.arrayContains(d,f)){d.push(f)}}},requestCodes:function(){var e=this.requestMap;for(var d in e){if(e.hasOwnProperty(d)){(function(f){var g={formStepId:$$.params.formStepId,formEntryId:$$.params.formEntryId,formInstanceId:$$.params.formInstanceId,prefix:"",type:"Code",code:f,parent:"",isTopLevel:true,pageNo:0,pageSize:65534,rand:Math.random()*999,settings:"{}"};$$.ajax({type:"POST",url:$$.params.formRender.suggestService,data:g,needParse:false,showParseErrMsg:false,showAjaxErrMsg:false}).done(function(n){var l=$$.params.formRender.entity.codes,k=l[f];if(k!=null&&$IU.isArray(k.items)&&k.items.length>0){return}var j=e[f];if($IU.isArray(j)){for(var m=0,h=j.length;m<h;m++){var o=j[m];$$("&"+o).options(n)}}if(k==null){k={};l[f]=k}k.items=n.items;if(e.hasOwnProperty(f)){delete e[f]}})})(d)}}}};define("InfoPlus.CodeManager",a)})(window);
(function(e,g,d){var i=g.document;var b=function(l){return new b.fn.init(l)};var k=Array.prototype.slice;b.fn=b.prototype={constructor:b,selector:"",length:0,toArray:function(){return k.call(this,0)},init:function(n){if(n instanceof InfoPlus.Controls.Control){this[0]=new InfoPlus.Core.CoreBoundControl(n);this.length=1;return this}if(n instanceof InfoPlus.Repeat.RepeatControl){this[0]=new InfoPlus.Core.CoreRepeatControl(n);this.length=1;return this}if(n instanceof InfoPlus.Core.CoreControl){this[0]=n;this.length=1;return this}if(e.isArray(n)){var t=n,r=0;for(var q=0,s=t.length;q<s;q++){var p=t[q];if(p instanceof InfoPlus.Controls.Control){this[r++]=new InfoPlus.Core.CoreBoundControl(p);continue}if(p instanceof InfoPlus.Repeat.RepeatControl){this[r++]=new InfoPlus.Core.CoreRepeatControl(p);continue}if(p instanceof InfoPlus.Core.CoreControl){this[r++]=p}}this.length=r;return this}if(typeof n==="string"){var l=/&([a-zA-Z]+[a-zA-Z\d]*)/g;n=n.replace(l,"[name='$1'],[name^='$1_']")}var o=e(n);if(o.length>0){r=0;for(q=0,s=o.length;q<s;q++){var u=e(o[q]);p=u.data(InfoPlus.Controls.Control.DATA_CONTROL_OBJECT);if(p!==d){this[r++]=new InfoPlus.Core.CoreBoundControl(p)}else{var m=u.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(m!==d){this[r++]=new InfoPlus.Core.CoreRepeatControl(m)}}}this.length=r;this.selector=n}else{this.length=0;this.selector=n}return this},each:function(m,l){return b.each(this,m,l)},on:function(m,n,l){if(typeof n==="function"){l=n;n=d}if(b.event.isCoreObjectEventTypes(m)){if(this.selector!==""){b.event.registerCoreObjectEvents(m,this.selector,n,l)}else{this.each(function(){b.event.registerCoreObjectEvents(m,this,n,l)})}}else{if(this.selector!==""){b.registerEvents(m,this.selector,false,n,l)}else{this.each(function(){this.callMethod("registerEvent",m,n,l)})}}return this},off:function(m,l){if(b.event.isCoreObjectEventTypes(m)){if(this.selector!==""){b.event.unregisterCoreObjectEvents(m,this.selector,l)}else{this.each(function(){b.event.unregisterCoreObjectEvents(m,this,l)})}}else{if(this.selector!==""){b.unregisterEvents(m,this.selector,l)}else{this.each(function(){this.callMethod("unregisterEvent",m,l)})}}return this},trigger:function(l){if(this.selector!==""){e(this.selector).trigger(l)}else{this.each(function(){this.callMethod("trigger",l)})}return this},val:function(l){if(l!==d){return this.each(function(){this.setValue(l)})}else{if(this.length>0){return this[0].getValue()}else{return null}}},attr:function(){if(this.length>0){return this[0].getAttributes()}else{return null}},css:function(l,p){if(typeof l=="string"&&p===d){if(this.length>0){return this[0].getStyle(l)}else{return null}}else{var o=[];if($IU.isArray(l)){o=l}else{if(typeof l=="object"){var n=l;if(n==null){return this}for(var m in n){if(n.hasOwnProperty(m)){o.push({name:m,value:n[m]})}}}else{if(typeof l=="string"&&typeof p=="string"){o.push({name:l,value:p})}}}return this.each(function(){for(var r=0,q=o.length;r<q;r++){this.setStyle(o[r].name,o[r].value)}})}},getName:function(){if(this.length>0){return this[0].getName()}else{return null}},contains:function(m){for(var l=0;l<this.length;l++){if(this[l].getGuid()===m.getGuid()){return true}}return false},get:function(l){if(this.length>l){return this[l]}return d},filter:function(m){var l=[];this.each(function(){if(typeof m==="function"){var s=m;if(s.call(this)===true){l.push(this)}}else{var n=true;for(var o in m){if(m.hasOwnProperty(o)){var q=m[o],r="get"+o.substring(0,1).toUpperCase()+o.substring(1),p=this[r];if(typeof p==="function"){if(p.call(this)!==q){n=false;break}}}}if(n){l.push(this)}}});return b(l)},validate:function(){var p=[];for(var q=0;q<this.length;q++){var n=this[q];if(n instanceof InfoPlus.Core.CoreBoundControl){p.push(n.control)}else{var m=e(n.control.repeatContentParentElement).find("*[class*='validate']").filter($IU.isValidateControlFilter);for(var o=0,l=m.length;o<l;o++){p.push(m[o])}}}return $IU.checkControlValidation(p,true,true)}};b.fn.init.prototype=b.fn;e.extend(b.fn,{visible:function(l,m){return this.each(function(){this.callMethod("visible",l,m)})},itemVisible:function(l,n,m){return this.each(function(){this.callMethod("itemVisible",l,n,m)})},rowVisible:function(l,m){return this.each(function(){this.callMethod("rowVisible",l,m)})},colVisible:function(l,m){return this.each(function(){this.callMethod("colVisible",l,m)})},parentValue:function(l,m){return this.each(function(){this.callMethod("setParentValue",l,m)})},dataSource:function(l,m){return this.each(function(){this.callMethod("setDataSource",l,m)})},readOnly:function(l,m){return this.each(function(){this.callMethod("readOnly",l,m)})},itemReadOnly:function(l,n,m){return this.each(function(){this.callMethod("itemReadOnly",l,n,m)})},tooltip:function(l,m){return this.each(function(){this.callMethod("tooltip",l,m)})}});e.extend(b.fn,{options:function(l){return this.each(function(){this.callMethod("setOptions",l.items)})}});e.extend(b,{DEBUG:false,MOBILE:false,WECHAT:false,PREVIEW:false,testFile:null,params:{},dynamics:{styles:{},referedStyles:{},formulas:{},referedFormulas:{},initialFormulas:{},actions:{},referedActions:{},globalContext:{}},initIds:function(){b.params.ids={save:"FormCommandSave",print:"FormCommandPrint",download:"FormCommandDownload",admin:"FormCommandAdmin"}},initVisibility:function(){b.visibility={titleBar:!($$.VIEWS_ONLY||$$.PRINT),commandBar:!($$.VIEWS_ONLY||$$.PRINT),milestone:(!($$.VIEWS_ONLY||$$.PRINT))&&($$.params.showRemark!=="false"),remark:(!($$.VIEWS_ONLY||$$.PRINT))&&($$.params.showRemark!=="false")}},initCore:function(l){b.params=e.extend({renderForm:e("#renderForm"),fieldChanging:null,fieldSyncing:false,initControls:[],ajax:{blockingIds:[],blockedCallbacks:[]},rowIndexSuffix:Math.round(Math.random()*900000+100000),initializing:true},l);b.initIds();b.initVisibility();b.codeManager=new InfoPlus.CodeManager();b.dynamics.cache=new InfoPlus.Dynamics.Cache()},setTestFile:function(l){b.testFile=l},getTestFile:function(){return b.testFile},getFormRender:function(){return b.params.formRender},registerEvents:function(o,l,n,p,m){if(n===d){m=l;b.event.registerGlobalEvents(o,m)}else{if(n===true){if(b.event.findRegisteredEvent(o,l)===true){return}}if(typeof p==="function"){m=p;p=d}if(b.event.registerSelectorEvents(o,l,m)){if(p!==d){$$.params.renderForm.on(o,l,p,m)}else{$$.params.renderForm.on(o,l,m)}}}},unregisterEvents:function(n,l,m){if(typeof l==="string"){$$.params.renderForm.off(n,l,m);b.event.unregisterSelectorEvents(n,l,m)}else{m=(typeof l==="function")?l:d;b.event.unregisterGlobalEvents(n,m)}},registerControlEvents:function(q){var o=q.events;if(!e.isArray(o)){return}if(o.length===0){return}for(var n=0,m=o.length;n<m;n++){var p=o[n];var l=p.selector!==d?p.selector:"."+InfoPlus.Controls.Control.CLASSNAME_CONTROL+"."+q.elementClassName;b.registerEvents(p.type,l,true,p.data,p.handler)}},each:function(o,r,n){var m,p=0,q=o.length,l=q===d||e.isFunction(o);if(n){if(l){for(m in o){if(o.hasOwnProperty(m)){if(r.apply(o[m],n)===false){break}}}}else{for(;p<q;){if(r.apply(o[p++],n)===false){break}}}}else{if(l){for(m in o){if(o.hasOwnProperty(m)){if(r.call(o[m],m,o[m])===false){break}}}}else{for(;p<q;){if(r.call(o[p],p,o[p++])===false){break}}}}return o}});b.event={};b.event.GLOBAL_EVENT_READY="ready";b.event.GLOBAL_EVENT_FIELD_CHANGED="fieldChanged";b.event.GLOBAL_EVENT_FIELD_REFERED="fieldRefered";b.event.INFOCORE_OBJECT_EVENT_FIELD_CHANGED="fieldChanged";b.event.INFOCORE_OBJECT_EVENT_FIELD_REFERED="fieldRefered";b.event.INFOCORE_OBJECT_EVENT_FIELD_SUGGESTED="fieldSuggested";e.extend(b.event,{globalEventTypes:[b.event.GLOBAL_EVENT_READY,b.event.GLOBAL_EVENT_FIELD_CHANGED,b.event.GLOBAL_EVENT_FIELD_REFERED],coreObjectEventTypes:[b.event.INFOCORE_OBJECT_EVENT_FIELD_CHANGED,b.event.INFOCORE_OBJECT_EVENT_FIELD_REFERED,b.event.INFOCORE_OBJECT_EVENT_FIELD_SUGGESTED],globalEventHandlers:{},selectorEventHandlers:{},coreObjectEventHandlers:{},isGlobalEventTypes:function(o){var n=b.event.globalEventTypes;for(var m=0,l=n.length;m<l;m++){if(n[m]===o){return true}}return false},isCoreObjectEventTypes:function(o){var n=b.event.coreObjectEventTypes;for(var m=0,l=n.length;m<l;m++){if(n[m]===o){return true}}return false},registerCoreObjectEvents:function(t,o,q,u){if(!b.event.isCoreObjectEventTypes(t)){return false}var m=b.event.coreObjectEventHandlers;if(m[t]===d){m[t]=[]}var p=null;if(typeof o!=="string"){p=o;o=null}var n=m[t];for(var r=0,s=n.length;r<s;r++){var l=n[r];if(l.handler===u){if(p!=null){if(l.control!=null&&l.control.getGuid()===p.getGuid()){return false}}else{if(l.selector!=null&&l.selector===o){return false}}}}n.push({control:p,selector:o,data:q,handler:u});return true},unregisterCoreObjectEvents:function(r,m,q){var n=b.event.coreObjectEventHandlers[r];if(n===d||n===null){return}if(m!==d&&q!==d){var s=null;if(typeof m!=="string"){s=m;m=null}for(var p=0,l=n.length;p<l;p++){var o=n[p];if(o.handler===q){if(s!=null){if(o.control!=null&&o.control.getGuid()===s.getGuid()){n.splice(p,1);return}}else{if(o.selector!=null&&o.selector===m){n.splice(p,1);return}}}}}else{b.event.coreObjectEventHandlers[r]=[]}},registerGlobalEvents:function(p,o){if(!b.event.isGlobalEventTypes(p)){return false}var q=b.event.globalEventHandlers;if(q[p]===d){q[p]=[]}var m=q[p];for(var n=0,l=m.length;n<l;n++){if(m[n]===o){return false}}m.push(o);return true},unregisterGlobalEvents:function(p,o){var m=b.event.globalEventHandlers[p];if(m===d||m===null){return}if(o!==d){for(var n=0,l=m.length;n<l;n++){if(m[n]===o){m.splice(n,1);return}}}else{b.event.globalEventHandlers[p]=[]}},registerSelectorEvents:function(q,m,p){var r=b.event.selectorEventHandlers;if(r[m]===d){r[m]={}}if(r[m][q]===d){r[m][q]=[]}var n=r[m][q];for(var o=0,l=n.length;o<l;o++){if(n[o]===p){return false}}n.push(p);return true},unregisterSelectorEvents:function(q,m,p){var n=b.event.selectorEventHandlers[m];if(n===d){return}n=n[q];if(n===d||n===null){return}if(p!==d){for(var o=0,l=n.length;o<l;o++){if(n[o]===p){n.splice(o,1);return}}}else{b.event.selectorEventHandlers[m][q]=[]}},findRegisteredEvent:function(m,l){var n=b.event.selectorEventHandlers[l];if(n===d){return false}return n[m]!==d}});for(var a=0,j=b.event.globalEventTypes.length;a<j;a++){b[b.event.globalEventTypes[a]]=function(l){return function(q){if(typeof q==="function"){b.event.registerGlobalEvents(l,q)}else{var n=b.event.globalEventHandlers[l];if(n===d||n===null){return}for(var p=0,m=n.length;p<m;p++){var o=n[p];if(typeof o==="function"){o.apply(g,arguments)}}}}}(b.event.globalEventTypes[a])}var h=function(m,l){if(l.selector!=null){if($$(l.selector).contains(m)){return true}}if(l.control!=null){if(l.control.getGuid()===m.getGuid()){return true}}return false};for(a=0,j=b.event.coreObjectEventTypes.length;a<j;a++){b.fn[b.event.coreObjectEventTypes[a]]=function(l){return function(v){var w=this;if(typeof v==="function"){w.on(l,v)}else{var p=b.event.coreObjectEventHandlers[l];if(p!=null){for(var n=0,m=w.length;n<m;n++){var x=w[n];for(var u=0,q=p.length;u<q;u++){var o=p[u];if(h(x,o)){if(typeof o.handler==="function"){var t=[];if(o.data!=null){t.push({data:data})}for(var r=0,s=arguments.length;r<s;r++){t.push(arguments[r])}o.handler.apply(b(x),t)}}}}}}}}(b.event.coreObjectEventTypes[a])}var f=function(l,n,m,o){m();b.ajax({type:"POST",url:b.params.doActionUrl,data:l,requestMsg:"提交表单",beforeShowErrorMsg:m}).always(o).done(function(v){var q=[],w;for(u=0;u<v.entities.length;u++){var r=v.entities[u];if(r.entryId!=b.params.formEntryId){w=r;q=[];break}else{if(r.assignUser==b.params.userId){q.push(r)}}}var t=!$IU.browserCloseable()?"确定":"关闭";var C=function(){$IU.closeWindow()};var E=(v.error==null||v.error=="")?"办理成功!":'<div class="form_do_action_error">'+v.error+"</div>";var z=null,A=null;if($$.params.printAfterAction===true||$$.params.downloadAfterAction===true){var B=function(G,F){if($$.params.printAfterAction===true&&$$.params.downloadAfterAction===true&&F!=null){E+=F;return}if($$.params.printAfterAction===true){E+="打印"}if($$.params.downloadAfterAction===true){if($$.params.printAfterAction===true){E+=G}E+="下载"}};E+=(v.error!=null?"":"<br/>")+"本步骤可以";B("、");E+="，请点击";B("","相应");E+="按钮或以后从进行中任务页面中再次打开并";B("或")}if($$.params.printAfterAction===true){z={name:"打印",defaultButton:true,preventDefault:true,callback:function(){var F=(y!=null&&y.length!=null&&y.length>1);$IU.openLink($IU.processUrl($$.params.printUrl),F);return false}}}if($$.params.downloadAfterAction===true){A={name:"下载",defaultButton:$$.params.printAfterAction!==true,preventDefault:true,callback:function(){$$.params.downloadAfterAction=false;$IU.fireClick("FormCommandDownload");return false}}}if(q.length==0&&w===d){var y=[];if(z!=null){y.push(z)}if(A!=null){y.push(A)}if(z==null&&A==null){y.push({name:t,callback:C,callOnClose:true})}var x=new InfoPlus.Render.Dialog({content:E,maxWidth:y.length>1?550:440,buttons:y});x.show()}else{if(w!==d){E+="<br/>本步骤可连续办理，请点击下一个继续执行"+w.name}else{if(q.length==1){if(!n){E+="<br/>"+(z!=null?"您也可以":"请")+"点击下一步执行"+q[0].name}else{g.location.href=$IU.processUrl(q[0].renderUri);return}}else{E+="<br/>您有权执行以下步骤，请选择并点击下一步执行:";for(var u=0;u<q.length;u++){r=q[u];E+="<br/><input class='infoplus_chooseNextStep' type='radio' value='"+r.flowStepId+"'"+(u==0?"checked":"")+" name='nextStepChooseRadio'/>办理"+r.name}}}var s=function(){if(w!==d){g.location.href=$IU.processUrl(w.renderUri)}else{if(q.length==1){g.location.href=$IU.processUrl(q[0].renderUri)}else{var H=e(".infoplus_chooseNextStep");for(var G=0;G<H.length;G++){var F=H[G];if(F.checked===true){for(u=0;u<q.length;u++){if(F.value==q[u].flowStepId){g.location.href=$IU.processUrl(q[u].renderUri);break}}break}}}}return false};var D=function(){$IU.closeWindow()};var p=function(){g.location.reload()};y=[];if(z!=null){y.push(z)}if(A!=null){y.push(A)}y.push({name:w!==d?"下一个":"下一步",defaultButton:y.length==0,callback:s,preventDefault:true});if(z==null&&A==null){y.push({name:t,callback:D,callOnClose:true})}var x=new InfoPlus.Render.Dialog({content:E,maxWidth:y.length>2?550:400,buttons:y});x.show()}})};var c=function(p,n){var l={error:null,data:null};var o=function(){if(typeof p==="string"){return p}if(p.d!=null){return p.d}if(p.string!=null){return p.string}return null};if(p==null){l.error={msg:"抱歉，服务器发生未知异常，请刷新重试或者与系统管理员联系。",errno:-1};return l}var m=o();if(typeof JSON!=="undefined"){l.data=JSON.parse(m)}else{l.data=e.parseJSON(m)}if(l.data==null||l.data.entities==null){if(n===d){l.error={msg:"JSON反序列化失败!",errno:-1}}else{l.error={msg:n,errno:-1}}return l}if(l.data.errno!==0){l.error={msg:l.data.error,errno:l.data.errno};return l}return l};e.extend(b,{parseDynamic:function(m){try{return InfoPlus.Dynamics.Parser.Expression.parse(m)}catch(n){var l="Error occur while parsing the dynamic expression.\n\n";l+=(m+"\n\n");l+="Error description: "+n.message+"\n\n";l+="Click OK to continue.\n\n";alert(l)}return null},debug:function(l){if(b.DEBUG){b.log(l)}},log:function(p,m,l){if(g.console!==d){if(typeof p==="object"){if(m!==d){console.log(m)}if(console.dirxml!=null){console.dir(p)}else{var o=function(u,q){var t="";for(var r in u){if(u.hasOwnProperty(r)){if(e.isArray(u[r])){t+=q+r+": [ \n"+o(u[r],q+"  ")+q+"]\n"}else{if(typeof u[r]==="object"){if(u[r]===null){t+=q+r+": null\n"}else{t+=q+r+": { \n"+o(u[r],q+"  ")+q+"}\n"}}else{t+=q+r+": "+u[r]+"\n"}}}}return t};console.log(o(p,""))}}else{var n=m===d?p:m+" -> "+p;if(l!==d){n="%c"+n;console.log(n,l)}else{console.log(n)}}}else{alert(p)}},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var m=Math.random()*16|0,l=n=="x"?m:(m&3|8);return l.toString(16)})},asynchronousInvoke:function(n,l,m){if(typeof n!=="function"){return}if($$.params.ajax.blockingIds.length>0){$$.params.ajax.blockedCallbacks.push({callback:n,invoker:l,args:m});$$.blockUI({message:"<span class='loading'>正在等待先前的操作...</span>"});return false}else{if(l!=null){if(m==null){n.apply(l)}else{n.apply(l,m)}}else{n.apply()}}},ajax:function(w){var m=e.Deferred();if(w==null||w.url==null){return m.reject({error:"缺少参数"})}if(w.data!=null){w.data["csrfToken"]=e(i).find("meta[itemscope=csrfToken]").attr("content")}w.cache=false;w.dataType="json";var n=w.needParse===d?true:w.needParse,u=w.requestMsg===d?"加载":w.requestMsg,t=w.parseErrMsg===d?u+"失败":w.parseErrMsg,o=w.ajaxErrMsg===d?u+"失败":w.parseErrMsg,r=w.showParseErrMsg===d?true:w.showParseErrMsg,v=w.showAjaxErrMsg===d?true:w.showAjaxErrMsg,s=w.beforeShowErrorMsg,l=w.errorTitle,p=w.block===true;var q=function(y,x,C){if(r===true){if(typeof s==="function"){s()}var B=x,D=null,F="|INFOPLUS_SPLITER|",z="\n\n";var E=B.indexOf(F);if(E!=-1){D=B.substr(E+F.length);B=B.substring(0,E)}else{E=B.indexOf(z);if(E!=-1){D=B.substr(E+z.length);B=B.substring(0,E)}}if(y==22001&&(D==null||D=="")&&w.errorTipElement!=null){var A=e(w.errorTipElement).data($Control.DATA_CONTROL_OBJECT);if(A.controlType==$Control.CONTROL_TYPE_BUTTON||A.controlType==$Control.CONTROL_TYPE_LINK_BUTTON||A.controlType==$Control.CONTROL_TYPE_CHECKBOX){$IU.errorMessageBox(B,null,null,false,false,null,400)}else{setTimeout(function(){e(w.errorTipElement).validationEngine("showPrompt",B,null,null,true)},300)}}else{$IU.errorMessageBox(B,D,(l===d)?u+"失败":(l!==""?l:null),C)}}};if(p===true){w.guid=$$.guid();$$.params.ajax.blockingIds.push(w.guid)}w.contentType="application/x-www-form-urlencoded; charset=utf-8";e.ajax(w).done(function(y){if(e.isNumeric(y.errno)){if(y.errno!==0){if(y.errno==10091&&w.requestAgain!==true){e("meta[itemscope=csrfToken]").attr("content",y.entities[0]);w.requestAgain=true;$$.ajax(w).done(function(A){m.resolve(A)}).fail(function(A){m.reject(A)})}else{q(y.errno,y.error,y.errno<0);m.reject({msg:y.error,errno:y.errno,data:y})}}else{m.resolve(y)}}else{if(n===true){var z=c(y,t);if(z.error!=null){q(z.error.errno,z.error.msg);var x={msg:z.error.msg,errno:z.error.errno,data:z.data};m.reject(x)}else{m.resolve(z.data)}}else{m.resolve(y)}}}).fail(function(x){if(v===true){if(typeof s==="function"){s()}$IU.errorMessageBox(o,x.status+":"+x.statusText,u+"失败",true)}m.reject({msg:x.statusText,errno:-1})}).always(function(){if(w.block===true){for(var y=0,x=$$.params.ajax.blockingIds.length;y<x;y++){if($$.params.ajax.blockingIds[y]==w.guid){$$.params.ajax.blockingIds.splice(y,1)}}if($$.params.ajax.blockingIds.length==0){e.unblockUI();x=$$.params.ajax.blockedCallbacks.length;while(x>0){var z=$$.params.ajax.blockedCallbacks.splice(0,1)[0];if(typeof z.callback==="function"){if(z.invoker!=null){if(z.args==null){z.callback.apply(z.invoker)}else{z.callback.apply(z.invoker,z.args)}}else{z.callback()}}x=$$.params.ajax.blockedCallbacks.length}}}});return m.promise()},doAction:function(q,p,o,l,n){if(o===d){o=true}if(typeof q!=="object"){var m=q;var r=null;e("a.command_button_content").each(function(){if(e(this).data("code")===m){r=this}});if(r!=null){q={actionId:e(r).data("actionId"),nextUsers:e.toJSON({}),formData:e.toJSON(b.params.formRender.save({},false)),remark:""}}else{return}}else{if(p!==d){q.nextUsers=e.toJSON(p)}}q.formStepId=b.params.formStepId;q.timestamp=b.params.timestamp;q.boundFields=b.params.boundFields.toString();q.rand=Math.random()*999;if(b.params.receiveCode!=null){q.thing=b.params.receiveCode}if(l===d){l=function(){$$.blockUI({message:"<span class='loading'>正在为您提交表单,请稍候...</span>"})};n=function(){e.unblockUI()}}f(q,o,l,n)},clickActionButton:function(l){if(l==null){return}var m=null;e("a.command_button_content").each(function(){if(e(this).data("code")===l){m=this}});if(m!=null){$IU.fireClick(m)}},save:function(){$IU.fireClick($$.params.ids.save)},print:function(){$IU.fireClick($$.params.ids.print)},getFields:function(){if(b.params==null||b.params.formRender==null){return null}return b.params.formRender.entity.fields},getGlobalContext:function(p){var l=function(s,u){var v=[];for(var t=0,r=s.length;t<r;t++){v.push(new $Controls.Data.ValuePair(s[t],(u[t]!==d)?u[t]:s[t]))}return v};var q=function(){var r={};$$.params.renderForm.find("."+$Control.CLASSNAME_VAR).each(function(){var s=e(this).data($Control.DATA_CONTROL_OBJECT);r[s.field.name]=s.getValue()});return r};if(p==null){p=q()}var o={};for(var n in p){if(p.hasOwnProperty(n)){if($IU.beginWith(n,"_VAR_")){if(p[n+"_name"]!==d){o[n]=new $Controls.Data.ValuePair(p[n],p[n+"_name"]);continue}if(p[n+"_Name"]!==d){o[n]=new $Controls.Data.ValuePair(p[n],p[n+"_Name"]);continue}if(p[n+"_Names"]!==d){o[n]=l($IU.splitAttribute(p[n]),$IU.splitAttribute(p[n+"_Names"]));continue}if($IU.endWith(n,"_Codes")){var m=n.substring(0,n.length-6);o[m]=l($IU.splitAttribute(p[n]),p[m+"_Names"]!==d?$IU.splitAttribute(p[m+"_Names"]):[]);o[n]=p[n];continue}if(!o.hasOwnProperty(n)){o[n]=p[n]}}}}return o},blockUI:function(m){var l={border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:0.5,color:"#fff",cursor:"pointer",width:$$.MOBILE?"65%":"45%",top:"40%",left:$$.MOBILE?"17%":"28%",textAlign:"center"};m.css=e.extend({},l,m.css||{});e.blockUI(m)},getLocaleText:function(n){var m=InfoPlus.Language,p=n.split(".");for(var o=0,l=p.length;o<l;o++){m=m[p[o]];if(m==null){if($$.params.isRelease===false){$$.log("locale text not found->"+n+"("+$$.params.lang+")")}return""}}return m}});g.infoCore=g.$$=b})(jQuery,window);
(function(b,c){var a=function(){};a.prototype={blockChangedField:function(d,e){var f;f=$(d).parents("div")[0];$(f).block({message:e?"<span class='blockingNoText'>&nbsp;</span>":"<span class='blocking'>请稍候</span>",css:{border:"none",padding:"3px 0 3px 0",backgroundColor:"#AFC5DE",opacity:0.6,cursor:"not-allowed",width:"103%",textAlign:"center",height:$(d).height()+"px",minHeight:"22px"},overlayCSS:{backgroundColor:"#AFC5DE",width:"103%",opacity:0.6}});return f},getFieldChangeSendData:function(h,g){var e=h.getValue();if(e==null){e=""}if(e instanceof $Controls.Data.ValuePair||e instanceof $Controls.Data.Uri){e=e.value}var d=h.element;var i=$(d).data($Control.DATA_FIELD);var f=$(d).data($Control.DATA_PATH);if(i==null||f==null){return null}return{formInstanceId:$$.params.formInstanceId,formEntryId:$$.params.formEntryId,formStepId:$$.params.formStepId,formData:(g!==c)?$.toJSON(g):null,fieldName:i,fieldValue:e,path:f,boundFields:$$.params.boundFields.toString()}},fieldChangeEvent:function(f,e){var d=this.getFieldChangeSendData(f,e);if(d==null){var h=$.Deferred();return h.reject({error:"控件不存在"})}var g=this.blockChangedField(f.element,f.clickFireFieldChange);$$.params.fieldChanging={controls:[],names:null};return $$.ajax({type:"POST",url:$$.params.formRender.fieldChangeService,data:d,errorTitle:null,errorTipElement:f.controlContainer||f.element,block:true}).always(function(){if(g!=null){$(g).unblock()}g=null}).done(function(o){if(o.entities.length>0){if($$.params.fieldChanging==null){$$.params.fieldChanging={controls:[],names:null}}if(o.entities[0].hasOwnProperty("fieldName")){var q=o.entities;$$.params.fieldChanging.names=$IU.getFieldNamesFromFieldChangeOldData(q);var k=[];for(var m=0;m<q.length;m++){var n=q[m].fieldName+q[m].fieldPath;if(document.getElementsByName(n).length==0){var j=$IU.addVariableControl(n,q[m].fieldValue,q[m].fieldDisplayValue);j.onFieldRefer=true;j.addFieldChangeClass();k.push(j)}else{$IU.setElementValue(n,q[m].fieldValue,q[m].fieldDisplayValue)}}$$.dynamics.globalContext=$$.getGlobalContext();for(m=0;m<k.length;m++){j=k[m];$(j.element).change()}}else{var l=$.parseJSON(o.entities[0]);delete l.entityIndex;$$.params.fieldChanging.names=$IU.getFieldNamesFromFieldChangeData(l);var p=$.type(o.entities[1])==="string"?o.entities[1]:d.path;$IU.setFormData(l,p,false)}}}).always(function(){setTimeout(function(){$$.params.fieldChanging=null},0)})}};define("InfoPlus.Controls.Event.FieldChangeEventProcessor",a)})(window);
(function(a,c){var b=function(){};b.prototype={analysisDynamic:function(o,l,h,v,e){var k=function(i){return $$.dynamics.styles[i]!==c||$$.dynamics.formulas[i]!==c||$$.dynamics.actions[i]!==c};if(k(l)||o==null||!$IU.isArray(o)){return}if(e!==c){if(o===c){o=[]}o.push({key:"parentValue",values:[{value:"$"+e,condition:"true"}]})}var m=[],u=[],q=[],j=[],n=[],t=[];var p=function(x,y){if(y==null||!$IU.isArray(y)){return}for(var w=0,i=y.length;w<i;w++){x.push(y[w])}};for(var r=0,s=o.length;r<s;r++){var g=o[r],f=g.key,d=g.values;if(f==="value"){p(j,d);continue}if(f==="style"){p(m,d);continue}if(f==="rowStyle"){p(u,d);continue}if(f==="itemStyle"){p(q,d);continue}if(f.substr(0,4)==="item"&&l.substr(0,5)==="group"){p(t,[{actionName:f,actions:d}]);continue}p(n,[{actionName:f,actions:d}])}this.analysisDynamicStyles(m,u,q,l,h,v);this.analysisDynamicFormulas(j,l,h,v);this.analysisDynamicAction(n,t,l,h,v)},analysisDynamicStyles:function(l,d,f,g,e,i){if(l.length===0&&d.length===0&&f.length===0){return}var k=$$.dynamics;if(k.styles[g]!==c){return}var j=[];var h=function(o,t,u){for(var q=0,n=o.length;q<n;q++){var s=new InfoPlus.Dynamics.Style({style:o[q].value,condition:o[q].condition,isRowStyle:t,isRepeatItemStyle:u,fieldRowIndexName:e,fieldGroupCountName:i});j.push(s);var m=s.references,r=m.length;for(var v=0;v<r;v++){var p=m[v];if(k.referedStyles[p]===c){k.referedStyles[p]=[]}k.referedStyles[p].push(s.getReferedStyle(g))}}};h(l,false,false);h(d,true,false);h(f,false,true);k.styles[g]=j},analysisDynamicFormulas:function(n,q,e,l){if(n.length>0){var p=$$.dynamics;if(p.formulas[q]===c){var k=[];for(var j=0,h=n.length;j<h;j++){if(n[j].value==null||n[j].value==""){continue}var f=new InfoPlus.Dynamics.Formula({formula:n[j].value,condition:n[j].condition,fieldRowIndexName:e,fieldGroupCountName:l});k.push(f);var d=f.references,m=d.length;for(var o=0;o<m;o++){var g=d[o];if(g==q){continue}if(p.referedFormulas[g]===c){p.referedFormulas[g]=[]}p.referedFormulas[g].push(f.getReferedFormula(q))}}p.formulas[q]=k}}},analysisDynamicAction:function(d,h,k,f,i){if(d.length===0&&h.length===0){return}var g=$$.dynamics;if(g.actions[k]!==c){return}var e=[];var j=function(y,z){for(var u=0,n=y.length;u<n;u++){var v=y[u].actionName,q=y[u].actions;for(var s=0,w=q.length;s<w;s++){var o=q[s],r="";if(o.value!=null&&o.value!=""){if(!z){r=v+"("+o.value+",$fromInit)"}else{r=v+"("+o.value+",$"+f+",$fromInit)"}}else{if(!z){r=v+"($fromInit)"}else{r=v+"($"+f+",$fromInit)"}}var x=new InfoPlus.Dynamics.Action({action:r,condition:o.condition,isRepeatItemAction:z,fieldRowIndexName:f,fieldGroupCountName:i});e.push(x);var m=x.references,t=m.length;for(var A=0;A<t;A++){var p=m[A];if(g.referedActions[p]===c){g.referedActions[p]=[]}g.referedActions[p].push(x.getReferedAction(k))}}}};j(d,false);j(h,true);g.actions[k]=e}};define("InfoPlus.Dynamics.Analyzer",b)})(window);
(function(b,c){var a=function(){};a.prototype={getReferedControls:function(j,l,d){var m=[];for(var f=0,n=l.length;f<n;f++){var g=l[f],o=d[g.getDynamicKeyName()];if(o!==c&&o!==null&&$IU.isArray(o)){for(var h=0,k=o.length;h<k;h++){var e=o[h];if($IU.dynamicReferControl(e,j)){m.push(g);break}}}}return m},processReferPath:function(e){var d=(e.referPath!==c)?e.referPath:[];d.push(e.field.name);e.referPath=c;return d},getControlNameByFieldName:function(d){if(d.length>5){if(d.substr(0,5).toLowerCase()=="group"){return d}if(d.substr(0,5).toLowerCase()=="field"){return"control"+d.substr(5)}}return"control"+d},processRepeatContext:function(g,d,i){var h={};for(var e in g){if(g.hasOwnProperty(e)){if($IU.arrayContains(d,e)||e.indexOf("RowIndex")!=-1){var f=g[e];if($IU.isArray(f)){if(f[i]!==c){h[e]=f[i]}}}else{h[e]=g[e]}}}h.rowIndex=i;h.INDEX=i;return h},processDynamicStyle:function(r,x,q,m,n){var k=$$.dynamics.styles[r.getDynamicKeyName()];if(!$IU.isArray(k)){return}if(r.repeatParentElement!=null){$IU.saveOriginStyles(r.repeatParentElement)}else{$IU.saveOriginStyles(r.element)}var l=$$(r);if(n===true){var e=this.getInitControlContext(r)}else{e=this.getControlContext(r,m)}for(var g=0,t=k.length;g<t;g++){var u=k[g];if(q===c||(q!==c&&$IU.dynamicReferControl(u,q))){var o=new InfoPlus.Dynamics.Parser.Compile(u.conditionAsts);if(u.isRepeatItemStyle===true){if(typeof r.getRepeatChildren==="function"){var h=r.getRepeatChildren();for(var s=0,d=h.length;s<d;s++){var f=this.processRepeatContext(e,r.fieldNames,s);if(u.ignoreCondition===true||o.evaluate(f)===true){var j=h[s];for(var w=0,v=u.styles.length;w<v;w++){$IU.setDynamicStyle(j,u.styles[w].name,u.styles[w].value)}}}}}else{if(u.ignoreCondition===true||o.evaluate(e)===true){if(u.isRowStyle===true){var p=r.getRow();if(p.length>0){for(w=0,v=u.styles.length;w<v;w++){$IU.setDynamicStyle(p[0],u.styles[w].name,u.styles[w].value)}}}else{l.css(u.styles)}}}}}},processDynamicAction:function(q,f,j,t,n){var l=$$.dynamics.actions[q.getDynamicKeyName()];if(!$IU.isArray(l)){return}var o=$$(q);if(n===true){var g=this.getInitControlContext(q)}else{g=this.getControlContext(q,t)}for(var s=0,p=l.length;s<p;s++){var k=l[s];if(j===c||(j!==c&&$IU.dynamicReferControl(k,j))){var d=new InfoPlus.Dynamics.Parser.Compile(k.conditionAsts);if(k.isRepeatItemAction===false){if(k.ignoreCondition===true||d.evaluate(g)===true){d=new InfoPlus.Dynamics.Parser.Compile(k.actionAsts);d.evaluate(g,o)}}else{if(typeof q.getRepeatChildren==="function"){var h=q.getRepeatChildren();for(var m=0,r=h.length;m<r;m++){var e=this.processRepeatContext(g,q.fieldNames,m);if(k.ignoreCondition===true||d.evaluate(e)===true){d=new InfoPlus.Dynamics.Parser.Compile(k.actionAsts);d.evaluate(e,o)}}}else{}}}}},processDynamicFormula:function(k,f,g,q,r,h){var n=$$.dynamics.formulas[k.getDynamicKeyName()];if(!$IU.isArray(n)){return}var i=$$(k);if(!k.isWritable()){return}if(k.repeatParentElement!==c){return}if(q!==c&&this.foundControlInReferPath(k,q)){return}if(h===true){var e=this.getInitControlContext(k)}else{e=this.getControlContext(k,r)}for(var o=0,j=n.length;o<j;o++){var m=n[o];if(g===c||(g!==c&&$IU.dynamicReferControl(m,g))){var d=new InfoPlus.Dynamics.Parser.Compile(m.conditionAsts);if(m.ignoreCondition===true||d.evaluate(e)===true){d=new InfoPlus.Dynamics.Parser.Compile(m.formulaAsts);var p=d.evaluate(e);var l=(k.repeatParentElement===c&&k.shouldFireChangeEventAgain(p));if(p===c){p=null}i.val(p);if(!m.isRowIndex){if(k.element!==c){$IU.highLightElement(k.element)}}if(l){k.referPath=q;setTimeout(function(s){return function(){$(s.element).change()}}(k),0)}}}}},processReferedStyle:function(f,j,h,e){var k=this.getReferedControls(f,j,$$.dynamics.styles);for(var g=0,d=k.length;g<d;g++){var i=k[g];this.processDynamicStyle(i,h,f,e)}},foundControlInReferPath:function(f,e){for(var d=0;d<e.length;d++){if(e[d]===f.getDynamicKeyName()){return true}}return false},processReferedFormula:function(e,j,d,l){var k=this.processReferPath(e);var f=this.getReferedControls(e,j,$$.dynamics.formulas);for(var g=0,h=f.length;g<h;g++){var i=f[g];this.processDynamicFormula(i,d,e,k,l)}},processReferedAction:function(f,k,h,e){var j=this.getReferedControls(f,k,$$.dynamics.actions);for(var g=0,d=j.length;g<d;g++){var i=j[g];this.processDynamicAction(i,h,f,e)}},fieldReferEvent:function(e,d,h,f,p,o,k,q){if($$.params.fieldChanging!=null){if(o===true){var l=this.getReferedControlsByPath(e.path,true,true,true)}else{l=this.getReferedControlsByPath(e.path,h,f,p)}if($$.params.fieldChanging.names!=null){var n=[];for(var g=0,j=l.length;g<j;g++){if(!$$.params.fieldChanging.names.hasOwnProperty(l[g].getDynamicKeyName())){n.push(l[g])}}l=n}this.processReferedFormula(e,l,d,q)}else{if(k===true){l=this.getReferedControlsByPath(e.path,true,true,true);if(h==true&&f==true&&p==true){m=l}else{var m=this.getReferedControlsByPath(e.path,h,f,p)}}else{l=this.getReferedControlsByPath(e.path,h,f,p);m=l}this.processReferedAction(e,l,d,q);this.processReferedStyle(e,l,d,q);this.processReferedFormula(e,m,d,q)}},isReferedControl:function(d,l,g,h,e,k){var m=g.path;if(m==null||d==null){return{refered:false}}var j;if(h){j=l.length-1}if(h&&e){j=l.length}for(var f=0;f<j;f++){if(l[f]===m){return{refered:true,children:false}}}if(k){if(m.length>d.length){if(m.substr(0,d.length)===d&&m.substr(d.length,1)==="_"){return{refered:true,children:true,subPath:m.substr(d.length)}}}}return{refered:false}},getReferedControlsByPath:function(f,h,d,n){var o=$IU.getReferedControlPaths(f);var l=$IU.getAllControls();var m=[];for(var j=0,k=l.length;j<k;j++){var g=l[j];var e=this.isReferedControl(f,o,g,h,d,n);if(e.refered===true){m.push(g)}}return m},getControlValue:function(j){var e=function(l,n,p){var o=[];for(var m=0,k=l.length;m<k;m++){o.push(new $Controls.Data.ValuePair(l[m],(n[m]!==c)?n[m]:l[m],p))}return o};var h=j.getValue();var i=j.field;if(i!=null){if(i.type==$Control.DATA_TYPE_INT||i.type==$Control.DATA_TYPE_DOUBLE){if($IU.isString(h)&&$IU.trimString(h)==""){h=0}}}if((h instanceof $Controls.Data.ValuePair)||(h instanceof $Controls.Data.Uri)){var d=j.getAttributes();h.expando=d;for(var g in d){if(d.hasOwnProperty(g)){if((g!=="value"&&g!=="displayValue")||(h instanceof $Controls.Data.Uri)){if(d[g+"_name"]!==c){h[g]=new $Controls.Data.ValuePair(d[g],d[g+"_name"],h.value);continue}if(d[g+"_Name"]!==c){h[g]=new $Controls.Data.ValuePair(d[g],d[g+"_Name"],h.value);continue}if(d[g+"_Names"]!==c){h[g]=e($IU.splitAttribute(d[g]),$IU.splitAttribute(d[g+"_Names"],h.value));continue}if($IU.endWith(g,"_Codes")){var f=g.substring(0,g.length-6);h[f]=e($IU.splitAttribute(d[g]),d[f+"_Names"]!==c?$IU.splitAttribute(d[f+"_Names"]):[],h.value);continue}h[g]=d[g]}}}}return h},putValueIntoContext:function(g,j,l,h){if(h.children===true){if(g[j]===c){g[j]=[]}var e=g[j];var k=h.subPath.split("_").slice(1);for(var f=0;f<k.length;f++){var d=parseInt(k[f],10);if(f===k.length-1){e[d]=l}else{if(e[d]===c){e[d]=[]}e=e[d]}}}else{g[j]=l}},getReferedKeyNames:function(l){var m=[],o={},e=$$.dynamics.referedStyles,f=$$.dynamics.referedFormulas,d=$$.dynamics.referedActions,n;for(n in e){if(e.hasOwnProperty(n)){var p=e[n],j=p.length;for(var h=0;h<j;h++){if(p[h].targetFieldName===l){if(!o.hasOwnProperty(n)){o[n]="";break}}}}}for(n in f){if(f.hasOwnProperty(n)){var k=f[n];j=k.length;for(h=0;h<j;h++){if(k[h].targetFieldName===l){if(!o.hasOwnProperty(n)){o[n]="";break}}}}}for(n in d){if(d.hasOwnProperty(n)){var g=d[n];j=g.length;for(h=0;h<j;h++){if(g[h].targetFieldName===l){if(!o.hasOwnProperty(n)){o[n]="";break}}}}}for(n in o){if(o.hasOwnProperty(n)){m.push(n)}}return m},getControlContext:function(k,s,j){var q=this,g=k.path,r=$IU.getReferedControlPaths(g),p=this.getReferedKeyNames(k.getDynamicKeyName()),e=$.extend({},$$.dynamics.globalContext);var d=function(w){var u=w.getDynamicKeyName();var i=w.getDynamicContextControlName();if(j==null||j==false){if(!$IU.arrayContains(p,u)&&!$IU.arrayContains(p,i)){return}}if(s!==c&&$IU.pathInclude(w.path,s)){return}var t=q.isReferedControl(g,r,w,true,true,true);if(t.refered===true){if($IU.arrayContains(p,u)||j==true){var v=q.getControlValue(w);if(w.controlType===$Control.CONTROL_TYPE_RADIO&&v==null){return}q.putValueIntoContext(e,u,v,t)}if($IU.arrayContains(p,i)||j==true){q.putValueIntoContext(e,i,$$(w),t)}}};var f=function(u){var i=u.getDynamicContextControlName();if(!$IU.arrayContains(p,i)){return}if(s!==c&&$IU.pathInclude(u.path,s)){return}var t=q.isReferedControl(g,r,u,true,true,true);if(t.refered===true){q.putValueIntoContext(e,i,$$(u),t)}};var n=$$.dynamics.cache.get(g);for(var h=0,l=n.length;h<l;h++){var o=n[h];if(o.repeatType==null){d(o)}else{f(o)}}e.fromInit=true;var m=$(k.element).parents(".infoplus_view");if(m.length>0){e.viewWidth=m.data("view").width}else{e.viewWidth=b.width}return e},getInitControls:function(){if($$.params.initControls.length==0){var e=[],d=this;$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).not("."+$Control.CLASSNAME_VAR).each(function(){var i=$(this).data($Control.DATA_CONTROL_OBJECT);if(i==null||i.path==null||i.field==null){return}var g=i.getDynamicKeyName();var f=i.getDynamicContextControlName();var h=d.getControlValue(i);if(i.controlType===$Control.CONTROL_TYPE_RADIO&&h==null){return}e.push({control:i,infoCoreControl:$$(i),keyName:g,controlKeyName:f,value:h,isRepeat:false})});$$.params.renderForm.find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var g=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(g==null||g.path==null||g.groupName==null){return}var f=g.getDynamicContextControlName();e.push({control:g,infoCoreControl:$$(g),controlKeyName:f,isRepeat:true})});$$.params.initControls=e}return $$.params.initControls},getInitControlContext:function(j){var d=this.getInitControls(),h=j.path,r=$IU.getReferedControlPaths(h),p=this.getReferedKeyNames(j.getDynamicKeyName()),e=$.extend({},$$.dynamics.globalContext);for(var k=0,l=d.length;k<l;k++){var f=d[k];if(!f.isRepeat){var q=f.keyName;var n=f.controlKeyName;if(!$IU.arrayContains(p,q)&&!$IU.arrayContains(p,n)){continue}var g=this.isReferedControl(h,r,f.control,true,true,true);if(g.refered===true){if($IU.arrayContains(p,q)){var o=f.value;this.putValueIntoContext(e,q,o,g)}if($IU.arrayContains(p,n)){this.putValueIntoContext(e,n,f.infoCoreControl,g)}}}else{n=f.controlKeyName;if(!$IU.arrayContains(p,n)){continue}g=this.isReferedControl(h,r,f.control,true,true,true);if(g.refered===true){this.putValueIntoContext(e,n,f.infoCoreControl,g)}}}e.fromInit=true;var m=$(j.element).parents(".infoplus_view");if(m.length>0){e.viewWidth=m.data("view").width}else{e.viewWidth=b.width}return e}};define("InfoPlus.Dynamics.Processor",a)})(window);
(function(c,f){var b=function(g){this.initData=g.initData;this.formRender=g.formRender;this.render=g.render;this.path=g.path;this.repeatParentElement=g.repeatParentElement;this.repeatContentParentElement=g.repeatContentParentElement;this.firstControlNamePrefix=g.firstControlNamePrefix;this.repeatType=g.repeatType;this.addLinkText=g.addLinkText;this.fieldNames=g.fieldNames;this.groupInformation=g.groupInformation;this.groupName=this.groupInformation.name;this.fullGroupName=this.groupInformation.groupName;this.columnVisible=[];this.init()};b.REPEAT_TYPE_SECTION=0;b.REPEAT_TYPE_TABLE=1;b.CLASS_REPEAT_SECTION_EXPAND="infoplus_repeatSection_expand";b.CLASS_REPEAT_SECTION_SHRINK="infoplus_repeatSection_shrink";b.CLASS_REPEAT_SECTION_SHRUNKEN="infoplus_repeat_section_shrunken";b.CLASS_REPEAT_SECTION_EXPAND_BUTTON_OPACITY="opacity5";b.CLASS_REPEAT_SECTION="infoplus_repeatingSection";b.CLASS_SECTION_BUTTON="infoplus_repeatSectionMenuButton";b.CLASS_REPEAT_SECTION_EXPAND_BUTTON="infoplus_repeatSectionExpandButton";b.CLASS_REPEAT_TABLE_ROW="infoplus_repeatingTableRow";b.CLASS_TABLE_BUTTON="infoplus_repeatTableMenuButton";b.CLASS_ADD_LINK="infoplus_addLink";b.CLASS_ADD_LINK_DIV="infoplus_addLinkDiv";b.CLASS_ADD_LINK_CONTAINER_DIV="infoplus_addLinkContainerDiv";b.CLASS_MENUBUTTON_SELECTED="infoplus_menuButtonSelected";b.CLASS_POPUP_MENU="infoplus_popupMenu";b.CLASS_MENU_ITEM="infoplus_menuItem";b.CLASS_REPEAT_PARENT_ELEMENT="infoplus_repeatParentElement";b.CLASS_REPEAT_SELECTED="infoplus_repeatingSelected";b.CLASS_REPEAT_MENU_POPUPED="infoplus_repeatingMenuPopuped";b.CLASS_REPEAT_MASTER="infoplus_repeat_master";b.DATA_REPEAT_CONTROL_OBJECT="repeatControl";b.DATA_REPEAT_MENU_DIV="infoplus_repeat_menu_div";b.DATA_REPEAT_DIV="infoplus_repeat_div";b.DATA_REPEAT_SECTION_DIV="infoplus_repeat_section_div";b.DATA_REPEAT_SECTION_EXPAND_BUTTON="infoplus_repeat_section_expand_button";b.DATA_REPEAT_SECTION_EXPAND_BUTTON_TOP="infoplus_repeat_expand_top";b.DATA_REPEAT_SECTION_EXPAND_BUTTON_SHRINK_TOP="infoplus_repeat_expand_shrink_top";b.DATA_REPEAT_SECTION_EXPAND_HEIGHT="infoplus_repeat_section_expand_height";b.REPEAT_SECTION_SHRINK_HEIGHT=28;b.prototype={guid:null,initData:null,eventsInitialized:false,formRender:null,render:null,path:null,popupMenu:null,repeatParentElement:null,repeatContentParentElement:null,repeatAddLink:null,repeatLayout:null,newRepeatData:null,firstControlNamePrefix:null,repeatType:0,power:null,repeatTableBody:null,keyIndex:null,groupName:null,fullGroupName:null,addLinkText:null,fieldNames:null,sorter:null,hideMenuTimer:null,dynamicProcessor:new InfoPlus.Dynamics.Processor(),readOnly:false,columnVisible:[],init:function(){this.guid=$$.guid();this.groupCountFieldName="field"+(this.groupName.substr(0,1).toUpperCase()+this.groupName.substr(1))+"Count"+$$.params.rowIndexSuffix;this.rowIndexFieldName="field"+(this.groupName.substr(0,1).toUpperCase()+this.groupName.substr(1))+"RowIndex"+$$.params.rowIndexSuffix;this.repeatParentElement.id=this.groupName+this.path;$(this.repeatParentElement).attr("name",this.repeatParentElement.id).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT,this);this.initPower();this.initRepeatableNewData();this.initCountControl();this.initRepeatParentElementStyle();this.initPopupMenu();if(this.isRepeatTable()){this.initRepeatTableBody();if(this.power.writePower===true){this.initTableSorter()}}this.createRepeatableContent(this.initData);this.initAddLink();if(InfoPlus.Repeat.RepeatControl.prototype.eventsInitialized===false){this.initEvents();InfoPlus.Repeat.RepeatControl.prototype.eventsInitialized=true}this.initMasterDetailEvent();this.initExternalCodeFields()},initMasterDetailEvent:function(){var g=this;if(this.groupInformation.isMasterDetail){$(this.repeatParentElement).on("click",".infoplus_labelControl",function(){var h=$(this).parentsUntil("tr."+b.CLASS_REPEAT_TABLE_ROW).last();if(h.size()!=0){if(!h.hasClass("detailCell")){g.showDetail(h.parent()[0])}}return false})}},initExternalCodeFields:function(){var g=this.formRender;g.eachLayout(function(i){if(i.renderType==="BoundSelect"||i.renderType==="BoundOptionList"){var k=g.entity.fields[i.field];if(k!=null&&k.code!=null){var h=null;var j=$$.codeManager.getCode(k.code);if(j!=null){h=j.items}if(h==null||($IU.isArray(h)&&h.length==0)){if(j==null||(j!=null&&j.codeType==="External")){$$.codeManager.addRequestCode(k.code,k.name)}}}}},this.render,"Boundable")},initEvents:function(){var j=InfoPlus.Repeat.RepeatControl.Events.events;for(var h=0,g=j.length;h<g;h++){var k=j[h];$$.registerEvents(k.type,k.selector,true,k.data,k.handler)}},initTableSorter:function(){this.sorter=new InfoPlus.Repeat.TableSorter(this)},initAddLink:function(){var g=this.power.insertPower?new InfoPlus.Repeat.RepeatAddLink(this.repeatParentElement,6,this.addLinkText):null;if(g!=null){if(this.shouldShowAddLink()){g.showLink()}else{g.hideLink()}}this.repeatAddLink=g},initPower:function(){this.power=new InfoPlus.Repeat.RepeatPower(this.groupInformation)},initRepeatParentElementStyle:function(){if(this.power.readPower===false){$(this.repeatParentElement).css("display","none")}$(this.repeatParentElement).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT);if(this.groupInformation.isMasterDetail){$(this.repeatParentElement).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MASTER)}},initPopupMenu:function(){var g=this.power;if(g.writePower===false&&g.insertPower===false&&g.deletePower===false&&g.enforceReadPower===false){return}this.popupMenu=new InfoPlus.Repeat.PopupMenu(this)},isRepeatSection:function(){return this.repeatType==InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_SECTION},isRepeatTable:function(){return this.repeatType==InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE},shouldShowAddLink:function(){if(this.readOnly===true){return false}return this.power.insertPower!==false},createRepeatTable:function(){var h=this.render,j=this.repeatParentElement,i=document.createElement("table");this.formRender.createAttributes(i,h.attributes);if(null!=j){j.appendChild(i)}this.formRender.createColGroup(h,i);var g=document.createElement("tbody");i.appendChild(g);var k=this.formRender.createLayout(h.renders[0],this.initData,this.path);g.appendChild(k);return g},initRepeatTableBody:function(){if(this.isRepeatTable()){this.repeatTableBody=this.createRepeatTable();this.render=this.render.renders[1];if(this.render==null){$IU.delayedErrorMessageBox(this.groupName+"设置错误，请检查是否应该用重复节替代重复表")}this.repeatContentParentElement=this.repeatTableBody}},initRepeatableNewData:function(){var k=this.fieldNames,h=this.formRender.entity;var j={};for(var i=0;i<k.length;i++){var l=k[i];if(h.fields[l]==null){$IU.debugTip("未找到字段"+l+"的信息，请检查是否正确上传视图","warning");this.newRepeatData=j;return}var g=h.fields[l].permission||"";if(h.fields[l].initialValue!=f&&g.indexOf("w")!=-1){j[l]=h.fields[l].initialValue;if(h.fields[l].initialText!=f){j[l+"_displayText"]=h.fields[l].initialText}}else{j[l]=""}}this.newRepeatData=j},sliceEntity:function(l,j,i){var m={};m.keyCount=0;m.data={};for(var k in l){if(l.hasOwnProperty(k)){var h=l[k];if($IU.isArray(h)){var g=h.length;if(j>=0&&j<g){if(null==i||$IU.arrayContains(i,k)){m.keyCount++;m.data[k]=h[j]}}}}}return m},createRepeatLayout:function(k,l){var m;if(this.isRepeatTable()){m=this.formRender.createLayout(this.render,k,l);$(m).children("td.detailCell").children().first().addClass("detailSection");m.setAttribute("id",this.groupName+"_row_"+Math.round(Math.random()*100000));var j=this.columnVisible;for(var h=0,g=j.length;h<g;h++){if(j[h]===false){$(m).children("td:nth-child("+(h+1)+")").hide()}}}else{var i=this.formRender.createLayout(this.render,k,l);m=document.createElement("div");m.appendChild(i);$(m).attr("class",$(i).attr("class"));$(i).removeAttr("class");if(i.style.width!=null){m.style.width=i.style.width}}this.addRowIndexControl(m,l);return m},initRepeatable:function(h,g,i){$(h).data($Control.DATA_PATH,g);h.repeatParentElement=this.repeatParentElement;h.popupMenu=this.popupMenu;h.isRepeatTable=this.isRepeatTable();h.keyIndex=i},createRepeatSectionExpandButton:function(i){if(i==null){return}var l=$(i).children();var h=l[0];var k=l[l.length-1];var g=document.createElement("div"),j=$(g);j.addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND_BUTTON).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRINK).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND_BUTTON_OPACITY).attr("title","收起").data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_MENU_DIV,k).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_DIV,h).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_DIV,i);j.hide();i.appendChild(g);$(i).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_EXPAND_BUTTON,g)},changeErrorDivToTempClassName:function(m,h,n,i,l){var j=m+"formError";for(var g=0;g<n.length;g++){if(n[g].className.indexOf(j)!=-1){var k=h+i;$(n[g]).removeClass(j);$(n[g]).addClass(k);l.push(k)}}},changeErrorDivToNewClassName:function(k,i){for(var h=0;h<k.length;h++){var g=k[h];var j=$("div."+g)[0];$(j).removeClass(g);$(j).addClass(g.substring(0,g.length-i.length)+"formError")}},changeRadioControlToTempName:function(j,g,h,i){j.name=$(j).data($Control.DATA_FIELD)+g+h;i.push(j)},changeRadioControlToNewName:function(i,h){for(var g=0;g<i.length;g++){var j=i[g];j.name=j.name.substr(0,j.name.length-h.length)}},changeControlPath:function(j,l,g,o,m,h,k,i){var n=this;$(j).find("."+$Control.CLASSNAME_CONTROL).each(function(){var v=$(this).data($Control.DATA_CONTROL_OBJECT);if(v==null||v.element==null){return}var w=v.element,x=$(w),r=x.data($Control.DATA_PATH);if(r==null){return}var p=l+r.substr(g.length);var u=x.data($Control.DATA_ORIGIN_INPUT);var q=(u==null)?w.id:u.id;var s=q.substr(0,q.length-r.length)+p;if(u==null){if(w.type!="radio"){x.attr("name",x.data($Control.DATA_FIELD)+p)}else{n.changeRadioControlToTempName(w,p,k,h)}w.id=s}else{u.name=x.data($Control.DATA_FIELD)+p;u.id=s}x.data($Control.DATA_PATH,p);if(v.controlType==$Control.CONTROL_TYPE_DATE){var t=v;t.reInitDatePicker()}v.path=p;if(x.hasClass($Control.CLASSNAME_ROWINDEX)){v.setValue(n.getRowIndex(p))}n.changeErrorDivToTempClassName(q,s,o,i,m)})},changeParentElementPath:function(k,o,g){var j=$(k).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT);for(var n=0;n<j.length;n++){var h=j[n],l=$(h).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);var m=l.path;if(m==f){continue}var p=o+m.substr(g.length);l.path=p;h.id=l.groupName+p;$(h).attr("name",h.id)}},changeRepeatElementPath:function(o,l,n){var g=$(o).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION+",."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW);for(var j=0;j<g.length;j++){var m=$(g[j]);var k=m.data($Control.DATA_PATH);if(k==f){continue}var h=l+k.substr(n.length);m.data($Control.DATA_PATH,h)}},changeKeyIndex:function(g,h){if(this.isRepeatSection()){$(g).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT).keyIndex=h}else{$($(g).parent().parent()[0]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT).keyIndex=h}},getRepeatChildren:function(){return $(this.repeatContentParentElement).children(this.isRepeatSection()?"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW)},getRepeatChild:function(g){var h=this.getRepeatChildren();if(g<h.length){return h[g]}return null},updateRepeatParentElementKeyIndex:function(){var i=this.getRepeatChildren();var h=[];for(var g=0;g<i.length;g++){var j=i[g];h.push(j.keyIndex)}this.keyIndex=h},reorganizeRepeatableElement:function(s){var w=this.getRepeatChildren();var h=[];var t=[];var m="_radio_temp";var j="_errorDiv_temp";var u=[];var v=$("body > div.formError");for(var r=0,q=w.length;r<q;r++){var l=w[r];var k=$(l);u.push(l.keyIndex);var g=k.data($Control.DATA_PATH);var o=g.split("_");if(parseInt(o[o.length-1])==r){continue}o.shift();var p="";for(var n=0;n<o.length-1;n++){p+="_"+o[n]}p+="_"+r;k.data($Control.DATA_PATH,p);this.changeControlPath(l,p,g,v,t,h,m,j);this.changeParentElementPath(l,p,g);this.changeRepeatElementPath(l,p,g)}this.changeRadioControlToNewName(h,m);this.changeErrorDivToNewClassName(t,j);if(s){$IU.updateErrorPromptPosition()}this.keyIndex=u},createRepeatableRow:function(k,h,i){var g=this.path+"_"+k,j=this.createRepeatLayout(h,g);this.initRepeatable(j,g,k);this.repeatContentParentElement.appendChild(j);if(this.isRepeatTable()){$(j).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW)}else{$(j).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION);this.createRepeatSectionExpandButton(j)}i.push(k);return j},createRepeatableContent:function(j){var m=0,l=this.sliceEntity(j,m,this.fieldNames),i=[],h=this.groupInformation.minOccur==null?0:this.groupInformation.minOccur;if(l.keyCount===0){if(h>0&&this.power.insertPower===true){while(m<h){var g=this.newRepeatData;var k=this.createRepeatableRow(m,g,i);this.formRender.doDynamicFormulaControls=this.formRender.doDynamicFormulaControls.concat($IU.getAllControls(k));m++}}}else{while(l.keyCount>0){g=l.data;this.createRepeatableRow(m,g,i);l=this.sliceEntity(j,++m,this.fieldNames)}}this.keyIndex=i;this.updateCountControl()},deleteRepeat:function(j,g){var k=$(j);var h=k.data($Control.DATA_PATH);var i=this.formRender;$$.dynamics.cache.build();k.find("."+$Control.CLASSNAME_CONTROL).each(function(){var l=$(this).data($Control.DATA_CONTROL_OBJECT);if(l==null||l.field===f||l.element===f){return}if(l.onFieldRefer){l.fieldReferEvent(i,true,false,false,false,false,h)}});$IU.clearErrorPrompt(j);k.empty();k.remove();if(g){this.reorganizeRepeatableElement(true);if(this.repeatAddLink!=null){if(this.shouldShowAddLink()){this.repeatAddLink.showLink()}}}this.updateCountControl()},addRepeatingClass:function(g){if(this.isRepeatSection()){$(g).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION).addClass(InfoPlus.FormRender.CLASS_REPEAT_SECTION_EXPANDED)}else{$(g).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW)}},addMenuButton:function(g){if(this.isRepeatSection()){this.createRepeatSectionExpandButton(g)}else{}},reorganizeAndUpdateKeyIndex:function(g){if(g){this.reorganizeRepeatableElement(false)}else{this.updateRepeatParentElementKeyIndex()}},showRepeatWithEffect:function(j,h,k){var g=this.isRepeatSection()?"slide":"highlight";var i=this.isRepeatSection()?{direction:h?"down":"up"}:{color:"#BFD0E6"};if(k!=null&&typeof k==="function"){if(!$(j).is(":visible")){$(j).show(g,i,"slow",k)}else{k()}}else{if(!$(j).is(":visible")){$(j).show(g,i,"slow")}}},createAfterShowCallback:function(h){var l=this.firstControlNamePrefix,j=this.shouldShowAddLink(),k=!j?this.repeatAddLink:null,g=this.formRender,i=this;return function(){$$.dynamics.cache.build();for(var n=0,m=h.length;n<m;n++){var o=h[n];o.setDynamicStyle(g);o.setDynamicValue(g);o.doDynamicAction(g);if(o.onFieldRefer){o.fieldReferEvent(g,true,false,false,false,false)}}i.setDynamicStyle(g);if(l!=null){$IU.setFocusToElement(l+$(this).data($Control.DATA_PATH))}$IU.updateErrorPromptPosition();$IU.rebindValidationEngine();if(k!=null){if(!j){k.hideLink()}}}},appendChildToLast:function(h){if(this.isRepeatSection()){var g=$(this.repeatContentParentElement).children("."+InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK_CONTAINER_DIV);if(g.length>0){g.before(h)}else{$(this.repeatContentParentElement).append(h)}}else{$(this.repeatContentParentElement).append(h)}},addLayoutToDom:function(g){if(this.popupMenu!=null&&this.popupMenu.repeatSection!=null){$(this.popupMenu.repeatSection).after(g)}else{this.appendChildToLast(g)}},getRowIndex:function(h){var g=h.split("_");return parseInt(g[g.length-1],10)},addRowIndexControl:function(k,j){var i={name:this.rowIndexFieldName,type:$Control.DATA_TYPE_INT,permission:"rw"};var h={renderCategory:"Boundable",controlId:this.rowIndexFieldName,field:this.rowIndexFieldName};var g=new $Controls.Hidden(j,i,h,this.getRowIndex(j));$(g.element).addClass($Control.CLASSNAME_ROWINDEX);$(k).append(g.element);return g},initCountControl:function(){var j=this.path;var i={name:this.groupCountFieldName,type:$Control.DATA_TYPE_INT,permission:"rw"};var h={renderCategory:"Boundable",controlId:this.groupCountFieldName,field:this.groupCountFieldName};var g=new $Controls.Hidden(j,i,h,0);$(g.element).addClass($Control.CLASSNAME_GROUP_COUNT);$(this.repeatParentElement).append(g.element);return g},updateCountControl:function(){var g=$(this.repeatParentElement).children("."+$Control.CLASSNAME_GROUP_COUNT).data($Control.DATA_CONTROL_OBJECT);var h=this.isRepeatSection()?b.CLASS_REPEAT_SECTION:b.CLASS_REPEAT_TABLE_ROW;var i=$(this.repeatContentParentElement).children("."+h).length;if(g!=null){g.setValue(i)}},addRepeat:function(x,t,i,h,s,n){if(x==null){x=this.newRepeatData}if(t==null){t=this.getNewPath()}var o=this.formRender;if(i){o.save(null,false)}var m=this.createRepeatLayout(x,t);this.initRepeatable(m,t,-1);m.style.display="none";$(m).data("isAdded",true);this.addRepeatingClass(m);var r=$IU.getAllControls(m);if(i){this.addLayoutToDom(m);$(m).find(".infoplus_select2Control").each(function(){var y=$(this).data($Control.DATA_CONTROL_OBJECT);y.initSelect2()});this.updateCountControl();this.reorganizeRepeatableElement(false);o.initFieldReferedClass();if(s===true){$(m).children("."+$Control.CLASSNAME_ROWINDEX).change()}if(h===true){if(this.popupMenu!=null&&this.popupMenu.repeatSection!=null){var q=$(this.popupMenu.repeatSection),p=q.offset().top+q.outerHeight();if(q.outerHeight()>30){p+=30}}else{p=$(this.repeatAddLink.linkDiv).offset().top;p+=30}if(p>$(document).scrollTop()+$(c).height()){setTimeout(function(){$IU.scrollTo(p-$("#command_holder").outerHeight()-30-10,500)},100)}}if(this.groupInformation.isMasterDetail&&n){var v=this;var g=$(m).find("td.detailCell"),l=g.children();l.css("height","auto");$(m).show();var w=this.createAfterShowCallback(r);w();var j={title:"详细信息",content:l,buttons:[{name:"确定",callback:function(){l.detach().appendTo(g)},callOnClose:true,defaultButton:true},{name:"取消",callback:function(){v.deleteRepeat(m,true)}}]};$IU.clearAllError();if(!$$.MOBILE){j.container=$$.params.renderForm;j.overflow="visible";j.lowZindex=true;j.maxWidth="95%";j.autoWidth=true;var u=new InfoPlus.Render.Dialog(j);u.show()}else{var k=new InfoPlus.Render.Mobile.Page(j);k.show()}}else{this.showRepeatWithEffect(m,false,this.createAfterShowCallback(r))}}return m},showDetail:function(l){if(this.isRepeatTable()&&this.groupInformation.isMasterDetail){var g=this;var h=function(){if($(l).data("isAdded")!==f){if($(l).data("isAdded")===true){return true}}return g.power.deletePower};var j=$(l).find("td.detailCell"),n=j.children();n.css("height","auto");$IU.clearAllError();var i={title:"详细信息",content:n,onShow:function(){setTimeout(function(){var o=n.find("*[class*='validate']").filter($IU.isValidateControlFilter);$IU.checkControlValidation(o,true,false)},300)},buttons:[{name:"关闭",callback:function(){n.detach().appendTo(j)},callOnClose:true,defaultButton:true}]};if(!$$.MOBILE){i.container=$$.params.renderForm;i.overflow="visible";i.lowZindex=true;i.maxWidth="95%";i.autoWidth=true;if(h()){i.buttons.push({name:"删除",preventDefault:true,callback:function(){$IU.yesNoBox("您将要删除该"+(g.isRepeatSection()?"段":"行")+"内容，是否继续？",300,function(){k.close();g.deleteRepeat(l,true)});return false}})}var k=new InfoPlus.Render.Dialog(i);k.show()}else{if(h()){i.buttons.push({name:"删除",preventDefault:true,callback:function(){$IU.yesNoBox("您将要删除该"+(g.isRepeatSection()?"段":"行")+"内容，是否继续？",300,function(){m.close();g.deleteRepeat(l,true)});return false}})}var m=new InfoPlus.Render.Mobile.Page(i);m.show()}}},moveDownRepeatSection:function(k){if(this.power.writePower===false){return}var h=$(k),l="."+(this.isRepeatSection()?InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW),i=h.next(l);if(i.length>0){var j=h.offset().top+i.outerHeight();if(j>$(document.body).scrollTop()+$(c).height()){setTimeout(function(){$IU.scrollTo(j-$("#command_holder").outerHeight()-10,500)},100)}h.detach().insertAfter(i).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);this.reorganizeRepeatableElement(true);var g=this;setTimeout(function(){g.showRepeatWithEffect(k,false)},0)}},moveUpRepeatSection:function(k){if(this.power.writePower===false){return}var h=$(k),l="."+(this.isRepeatSection()?InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW),i=h.prev(l);if(i.length>0){var j=i.offset().top;if(j<$(document.body).scrollTop()+$("#command_holder").outerHeight()){setTimeout(function(){$IU.scrollTo(j-$("#command_holder").outerHeight()-10,500)},100)}h.detach().insertBefore(i).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);this.reorganizeRepeatableElement(true);var g=this;setTimeout(function(){g.showRepeatWithEffect(k,false)},0)}},moveRow:function(k,i){if(k<0||i<0){return}if(this.power.writePower===false){return}var h=this.getRepeatChildren();if(k>=h.length){return}if(i>=h.length){i=h.length-1}if(k===i){return}var g=$(h[k]),j=$(h[i]);if(k<i){g.detach().insertAfter(j)}else{g.detach().insertBefore(j)}this.reorganizeRepeatableElement(true);this.showRepeatWithEffect(g[0],k>i)},getNewPath:function(){var i=this.popupMenu!=null?this.popupMenu.repeatSection:null,k="."+(this.isRepeatSection()?InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW),g;if(i!=null){var j=$(i).data($Control.DATA_PATH).split("_");g=this.path+"_"+(Number(j[j.length-1])+1)}else{var h=$(this.repeatContentParentElement).children(k).length;g=this.path+"_"+h}return g},getGroupIndexArray:function(k){var h=[],g=k.length;for(var j=0;j<g;j++){h.push(k.groupIndex)}return h},createFinishShowFlag:function(i){var g=[];for(var h=0;h<i.length;h++){if(i[h]===f){g[h]=true}else{g[h]=!$(i[h]).data("isNew")}}return g},createAfterShowAllCallback:function(j,g){var h=this.shouldShowAddLink(),i=this.repeatAddLink;return function(){j[g]=true;var k=true;for(var l=0;l<j.length;l++){if(j[l]===false){k=false;break}}if(k){$$.params.renderForm.validationEngine("detach");$$.params.renderForm.validationEngine("attach");if(i!=null){if(!h){i.hideLink()}else{i.showLink()}}}}},convertData:function(k){var h={};for(var i in k){if(k.hasOwnProperty(i)){if(i=="entityIndex"){continue}var j=k[i];if($IU.isArray(j)){continue}if(i.length>0){var m="field"+i.substring(0,1).toUpperCase()+i.substring(1),l=this.formRender.entity.fields[m];if(j.hasOwnProperty("attributes")){h[m+"_Attr"]=j.attributes}if(l!=null){var g=l.type.toLocaleLowerCase();if(g=="date"){if($IU.isString(j)){h[m]=$IU.dateStringToUnixTime(j)}else{h[m]=j}continue}if(g=="user"||g=="organize"||g=="code"||j.codeId!=null){h[m]=j.codeId||"";h[m+"_displayText"]=j.codeName||"";continue}}h[m]=j}}}return h},addChildren:function(j,m){for(var i=0,h=m.length;i<h;i++){if(m[i]!=null){$(m[i]).data("isNew",false)}}for(i=0,h=j.length;i<h;i++){var l=j[i]["entityIndex"];if(l===-1||l===f){var k=this.path+"_"+i;m[i]=this.addRepeat(this.convertData(j[i]),k,false,false,false,false);$(m[i]).data("isNew",true)}}for(i=0;i<m.length;i++){var g=m[i];if(g!==f){this.appendChildToLast(g);if($(g).data("isNew")===true){$(g).find(".infoplus_select2Control").each(function(){var n=$(this).data($Control.DATA_CONTROL_OBJECT);n.initSelect2()})}}}},preprocessChangedDataGroup:function(w){$IU.clearErrorPrompt(this.repeatParentElement);var q=this.getRepeatChildren(),j=q.length,k=w.length,h=[],l=[],v;var n=function(x){for(var i=0;i<k;i++){if(x===w[i]["entityIndex"]){return i}}return -1};for(var u=0;u<j;u++){var g=q[u];v=n(u);if(v==-1){if(this.power.deletePower===false){l.push(g)}else{this.deleteRepeat(g,false)}}else{h[v]=g}}if(this.power.deletePower===false&&l.length>0){for(var m=0,r=w.length;m<l.length;m++){h[m+r]=l[m]}}for(v=0;v<h.length;v++){var p=h[v];if(p!==f){$(p).detach()}}var t=this.formRender;t.save(null,false);this.addChildren(w,h);this.updateCountControl();this.reorganizeRepeatableElement(false);t.initFieldReferedClass();t.save(null,false);var s=$$.dynamics.styles;$$.dynamics.cache.build();$(this.repeatContentParentElement).find("."+$Control.CLASSNAME_CONTROL).each(function(){var i=$(this).data($Control.DATA_CONTROL_OBJECT);if(i==null||i.field===f||i.element===f){return}var x=i.field.name;if(i.onFieldRefer){i.fieldReferEvent(t,true,false,false,true,true)}if(s[x]!==f){$IU.saveOriginStyles(this)}});var o=this.createFinishShowFlag(h);for(v=0;v<h.length;v++){p=h[v];if(p!==f){if($(p).data("isNew")===true){if($$.params.fieldChanging==null){this.showRepeatWithEffect(p,false,this.createAfterShowAllCallback(o,v))}else{$(p).show()}}else{if($IU.getComputedStyle(p,"display")!=="none"){$(p).show()}}}}},setData:function(l){if(this.power.insertPower===false){var m=[];for(var j=0,h=l.length;j<h;j++){var n=l[j],g=n.entityIndex===-1||n.entityIndex===f;if(!g){m.push(n)}}l=m}this.preprocessChangedDataGroup(l);for(j=0,h=l.length;j<h;j++){n=l[j];g=n.entityIndex===-1||n.entityIndex===f;var k=this.path+"_"+j;$IU.setFormData(n,k,g)}},showPopupMenu:function(o,q){var p=this.popupMenu;if(p==null){return}if(this.readOnly===true){return}var n=$(p.menuDiv);p.repeatSection=o;p.adjustMenuItemVisibility();if(p.allMenuItemHide===true){return}if($$.MOBILE){var k=parseFloat($("html").css("font-size"));var m=8;n.find("."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM).each(function(){if($(this).css("display")!="none"){m+=parseFloat($(this).css("width"))}});n.css("width",(m/k)+"rem")}if(!$$.MOBILE){var i=o.offsetLeft+o.offsetWidth;var h=o.offsetTop;if(q===false){var g=o.parentNode.parentNode;i+=g.offsetLeft;h+=g.offsetTop}}else{h=o.offsetTop+o.offsetHeight;var j=n.parent().offset().top+h+n.outerHeight(),r=$(document.body).scrollTop()+$(c).height();if(j>r){if(j-r<n.outerHeight()){h=o.offsetTop+o.offsetHeight-n.outerHeight()}else{h=r-(j-h)-2}}var l=$(o);if(l.offset().left<0&&(l.offset().left+l.width())>$(c).width()){i=($(c).width()-n.width())/2-l.offset().left}else{if(l.offset().left<0||(l.offset().left+l.width())>$(c).width()){if(l.offset().left<0){i=o.offsetLeft-l.offset().left+((o.offsetWidth+l.offset().left)-m)/2}else{i=o.offsetLeft+(($(c).width()-l.offset().left)-m)/2}}else{i=o.offsetLeft+(o.offsetWidth-m)/2}if(i+n.parent().offset().left+n.outerWidth()>$(c).width()){i=$(c).width()-n.outerWidth()-n.parent().offset().left}if(n.parent().offset().left<0&&i+n.parent().offset().left<0){i=-n.parent().offset().left}}}n.css("left",i).css("top",h);if($$.MOBILE){n.slideDown(200)}else{n.show()}},setColumnVisible:function(h,i){if(this.repeatType!=b.REPEAT_TYPE_TABLE){return}var g=$(this.repeatParentElement).children("table");if(i){g.children("colgroup").children("col:nth-child("+(h+1)+")").show();g.children("tbody").children("tr").children("td:nth-child("+(h+1)+")").show();g.children("tr").children("td:nth-child("+(h+1)+")").show()}else{g.children("colgroup").children("col:nth-child("+(h+1)+")").hide();g.children("tbody").children("tr").children("td:nth-child("+(h+1)+")").hide();g.children("tr").children("td:nth-child("+(h+1)+")").hide()}this.columnVisible[h]=i},getDynamicKeyName:function(){return this.groupName},getDynamicContextControlName:function(){return this.groupName},setDynamicStyle:function(g,h){this.dynamicProcessor.processDynamicStyle(this,g,f,f,h)},doDynamicAction:function(g,h){this.dynamicProcessor.processDynamicAction(this,g,f,f,h)},getRow:function(){var g=$(this.repeatParentElement);return g.parents("tr,.infoplus_repeatingSection").first()},setDynamicValue:function(){}};b.selectedRepeatRow=null;define("InfoPlus.Repeat.RepeatControl",b);var e=function(h){if(InfoPlus.Repeat.RepeatControl.selectedRepeatRow!=null){if(InfoPlus.Repeat.RepeatControl.selectedRepeatRow!=h||$$.MOBILE){var g=$(InfoPlus.Repeat.RepeatControl.selectedRepeatRow);g.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED);if(g[0].popupMenu!=null){g[0].popupMenu.hideMenu()}}}};var a=function(g,i,h){$(i).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED);if(!$(i).is(":animated")){g.showPopupMenu(i,h)}else{setTimeout(function(){g.showPopupMenu(i,h)},500)}InfoPlus.Repeat.RepeatControl.selectedRepeatRow=i};var d={onRepeatSectionExpandButtonClick:function(g){var j=$(this),l=$(j.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_DIV)),k=$(j.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_DIV));var h=function(){j.hide();j.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRINK).attr("title","收起");l.css("overflow-y","");k.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRUNKEN);if(g===f){l.animate({height:j.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_EXPAND_HEIGHT)+"px"},500,function(){l.css("height","");j.show()})}else{l.css("height","");j.show()}};var i=function(){j.hide();j.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_EXPAND_HEIGHT,l.height());l.css("overflow-y","hidden");k.addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRUNKEN);l.animate({height:InfoPlus.Repeat.RepeatControl.REPEAT_SECTION_SHRINK_HEIGHT+"px"},500,function(){j.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRINK).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND).attr("title","展开").show()})};if(g){$(".formError").remove()}else{$(".formError").fadeTo("fast",0.3,function(){$(this).remove()})}if(j.hasClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND)){h()}else{i()}},onRepeatSectionTouchStart:function(g){if(this.popupMenu!=null){this.popupMenu.menuResetTimeout();e(this);g.stopPropagation()}},onRepeatSectionTouchEnd:function(h){if(this.popupMenu!=null){var g=$(this.repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(g.readOnly!==true){a(g,this,true);h.stopPropagation()}}},onRepeatSectionMouseEnter:function(){if($$.MOBILE){return false}if(this.popupMenu==null){return false}this.popupMenu.menuResetTimeout();e(this);var g=$(this.repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(g.readOnly===true){return false}a(g,this,true);return false},onRepeatSectionMouseLeave:function(g){if(this.popupMenu==null){return false}$(this).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);if($$.MOBILE&&InfoPlus.Repeat.RepeatControl.selectedRepeatRow!=this){return false}var h=$$.MOBILE?null:$(this.repeatParentElement).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION);if(this.popupMenu!=null){this.popupMenu.menuStartTimeout(this.popupMenu.menuTimeout,g.pageX,g.pageY,h)}},onRepeatTableRowTouchStart:function(g){if(this.popupMenu!=null){this.popupMenu.menuResetTimeout();e(this);g.stopPropagation()}},onRepeatTableRowTouchEnd:function(h){if(this.popupMenu!=null){var g=$($(this).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT)[0]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(g.readOnly!==true){a(g,this,false);h.stopPropagation()}}},onRepeatTableRowMouseEnter:function(){if($$.MOBILE){return false}if(this.popupMenu==null){return false}this.popupMenu.menuResetTimeout();e(this);var g=$($(this).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT)[0]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(g.readOnly===true){return false}a(g,this,false);return false},onRepeatTableRowMouseLeave:function(g){if(this.popupMenu==null){return false}$(this).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);if($$.MOBILE&&InfoPlus.Repeat.RepeatControl.selectedRepeatRow!=this){return false}var h=$$.MOBILE?null:$(this).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION);if(this.popupMenu!=null){this.popupMenu.menuStartTimeout(this.popupMenu.menuTimeout,g.pageX,g.pageY,h)}},onAddLinkClick:function(){var h=$(this.repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);var g=h.popupMenu;if(g!=null&&h.readOnly===false){g.repeatSection=null;g.onAddClick()}return false},onMenuMouseLeave:function(g){if($$.MOBILE){return false}this.menu.menuStartTimeout(this.menu.menuTimeout,g.pageX,g.pageY)},onMenuMouseEnter:function(g){if($$.MOBILE){return false}this.menu.menuResetTimeout()},onMenuItemMouseLeave:function(g){if($$.MOBILE){return false}if(this.menuType!=InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION){$(this).removeClass("infoplus_repeatMenuOn")}},onMenuItemMouseEnter:function(g){if($$.MOBILE){return false}if(this.menuType!=InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION){$(this).addClass("infoplus_repeatMenuOn");this.menu.menuResetTimeout()}},onMenuItemTouchStart:function(g){g.stopPropagation()},onMenuItemTouchEnd:function(g){var h=this.menu;setTimeout(function(){$(h.menuDiv).hide()},100);$(h.repeatSection).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);switch(this.menuType){case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP:h.onMoveUpClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN:h.onMoveDownClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD:h.onAddClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE:$IU.yesNoBox("您将要删除该"+(h.isRepeatSection()?"段":"行")+"内容，是否继续？",300,function(){h.onDeleteClick()});break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION:break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL:h.onDetailClick();break}g.stopPropagation()},onMenuItemClick:function(g){if($$.MOBILE){return false}var h=this.menu;if($$.MOBILE){setTimeout(function(){$(h.menuDiv).hide()},100)}else{$(h.menuDiv).hide()}$(h.repeatSection).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);switch(this.menuType){case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP:h.onMoveUpClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN:h.onMoveDownClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD:h.onAddClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE:$IU.yesNoBox("您将要删除该"+(h.isRepeatSection()?"段":"行")+"内容，是否继续？",300,function(){h.onDeleteClick()});break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION:break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL:h.onDetailClick();break}}};d.events=[{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"touchstart",handler:d.onRepeatSectionTouchStart},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"touchend",handler:d.onRepeatSectionTouchEnd},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"mouseenter",handler:d.onRepeatSectionMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"mouseleave",handler:d.onRepeatSectionMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"touchstart",handler:d.onRepeatTableRowTouchStart},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"touchend",handler:d.onRepeatTableRowTouchEnd},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"mouseenter",handler:d.onRepeatTableRowMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"mouseleave",handler:d.onRepeatTableRowMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK,type:"click",handler:d.onAddLinkClick},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_POPUP_MENU,type:"mouseenter",handler:d.onMenuMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_POPUP_MENU,type:"mouseleave",handler:d.onMenuMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"mouseenter",handler:d.onMenuItemMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"mouseleave",handler:d.onMenuItemMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"click",handler:d.onMenuItemClick},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"touchstart",handler:d.onMenuItemTouchStart},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"touchend",handler:d.onMenuItemTouchEnd}];define("InfoPlus.Repeat.RepeatControl.Events",d)})(window);
(function(b,c){var a=function(e){if(e==null||e.permission==null){this.readPower=false;this.enforceReadPower=false;this.writePower=false;this.insertPower=false;this.deletePower=false}else{var d=(e.permission||"");this.readPower=(d.indexOf("r")!=-1);this.enforceReadPower=(d.indexOf("R")!=-1);this.writePower=(d.indexOf("w")!=-1);this.insertPower=(d.indexOf("i")!=-1);this.deletePower=(d.indexOf("d")!=-1)}};a.prototype={readPower:false,enforceReadPower:false,writePower:false,insertPower:false,deletePower:false};define("InfoPlus.Repeat.RepeatPower",a)})(window);
(function(b,c){var a=function(f,e,d){this.repeatParentElement=f;if(d==="Insert item"||d==="插入项"){d="新增"}this.createLinkDiv(e,d)};a.prototype={repeatParentElement:null,linkDiv:null,createLinkDiv:function(f,e){var h=document.createElement("a");h.className=InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK;h.href="javascript:void(0);";h.innerHTML=(e==null?"新增":e);$(h).css("text-align","left");h.repeatParentElement=this.repeatParentElement;var g=document.createElement("div");$(g).css("display","none").css("left",f+"px").addClass(InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK_DIV);g.appendChild(h);this.linkDiv=g;var d=document.createElement("div");$(d).addClass(InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK_CONTAINER_DIV).append(this.linkDiv);this.repeatParentElement.appendChild(d)},showLink:function(){$(this.linkDiv).show()},hideLink:function(){$(this.linkDiv).hide()}};define("InfoPlus.Repeat.RepeatAddLink",a)})(window);
(function(b,c){var a=function(d){this.repeatControl=d;this.render=d.formRender;this.repeatParentElement=d.repeatParentElement;this.createMenuDiv()};a.MENU_ITEM_TYPE_MOVEUP=0;a.MENU_ITEM_TYPE_MOVEDOWN=1;a.MENU_ITEM_TYPE_ADD=2;a.MENU_ITEM_TYPE_DELETE=3;a.MENU_ITEM_TYPE_NO_ACTION=4;a.MENU_ITEM_TYPE_DETAIL=5;a.prototype={menuDiv:null,menuButton:null,repeatParentElement:null,repeatSection:null,render:null,hideMenuTimer:null,menuTimeout:200,menuItemMoveUp:null,menuItemMoveDown:null,menuItemAdd:null,menuItemDelete:null,menuItemNoAction:null,allMenuItemHide:false,menuOverMenuItem:function(){this.menuResetTimeout()},menuStartTimeout:function(e,d,g,f){this.menuResetTimeout();this.hideMenuTimer=setTimeout($.proxy(this.hideMenuWithMousePosition,this,d,g,f),e)},menuResetTimeout:function(){if(this.hideMenuTimer!=null){clearTimeout(this.hideMenuTimer)}this.hideMenuTimer=null},createMenuDiv:function(){var d=document.createElement("ul");d.id=""+Math.round(Math.random()*100000);this.menuDiv=d;d.menu=this;d.style.display="none";$(d).addClass(InfoPlus.Repeat.RepeatControl.CLASS_POPUP_MENU);this.menuItemDetail=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL);this.menuItemMoveUp=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP);this.menuItemMoveDown=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN);this.menuItemAdd=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD);this.menuItemDelete=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE);this.repeatParentElement.appendChild(this.menuDiv)},createMenuItem:function(d){var e=document.createElement("li");$(e).addClass(InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM);e.menu=this;e.menuType=d;switch(d){case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP:$(e).text("上移");$(e).addClass("infoplus_menuUp");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN:$(e).text("下移");$(e).addClass("infoplus_menuDown");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD:$(e).text("新增");$(e).addClass("infoplus_menuAdd");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE:$(e).text("删除");$(e).addClass("infoplus_menuDelete");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION:$(e).text("无任何操作");$(e).addClass("infoplus_menuNoAction");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL:$(e).text("详细");$(e).addClass("infoplus_menuDetail");break}this.menuDiv.appendChild(e);return e},hideMenuWithMousePosition:function(d,i,g){if(this.repeatSection!=null){var f=$(this.repeatSection);f.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);var h=$IU.getElementPosition(this.repeatSection);if(!(d>=h.left&&d<=h.left+this.repeatSection.scrollWidth&&i>=h.top&&i<=h.top+this.repeatSection.scrollHeight)){f.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED);if(this.isRepeatSection()){}else{}}}this.hideMenu();if(g!=null&&g.length>0){var e=$(g[0].repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(e.readOnly===false){e.showPopupMenu(g[0],true);InfoPlus.Repeat.RepeatControl.selectedRepeatRow=g[0];$(g[0]).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED)}}},hideMenu:function(){$(this.menuDiv).hide()},shouldShowDetailMenu:function(){if(this.repeatSection==null){return false}if(this.isRepeatSection()){return false}if(this.repeatControl.power.readPower===false){return false}return this.repeatControl.groupInformation.isMasterDetail===true},shouldShowMoveUpMenu:function(){if(this.repeatSection==null){return false}if(this.repeatControl.power.writePower===false){return false}if(this.isRepeatSection()){return $(this.repeatSection).prev("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION).length!=0}else{return $(this.repeatSection).prev("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW).length!=0}},shouldShowMoveDownMenu:function(){if(this.repeatSection==null){return false}if(this.repeatControl.power.writePower===false){return false}if(this.isRepeatSection()){return $(this.repeatSection).next("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION).length!=0}else{return $(this.repeatSection).next("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW).length!=0}},shouldShowAddMenu:function(){if(this.repeatSection==null){return false}return this.repeatControl.power.insertPower},shouldShowDeleteMenu:function(){if(this.repeatSection==null){return false}if($(this.repeatSection).data("isReadOnly")===true){return false}if($(this.repeatSection).data("isAdded")!==c){if($(this.repeatSection).data("isAdded")===true){return true}}return this.repeatControl.power.deletePower},adjustMenuItemVisibility:function(){var e=true;var d=function(g,f){if(f){$(g).show();e=false}else{$(g).hide()}};d(this.menuItemDetail,this.shouldShowDetailMenu());d(this.menuItemMoveUp,this.shouldShowMoveUpMenu());d(this.menuItemMoveDown,this.shouldShowMoveDownMenu());d(this.menuItemAdd,this.shouldShowAddMenu());d(this.menuItemDelete,this.shouldShowDeleteMenu());this.allMenuItemHide=e},getRepeatControlFieldNames:function(e){var d=[];$(e).find("."+$Control.CLASSNAME_CONTROL).each(function(){var f=$(this).data($Control.DATA_CONTROL_OBJECT);if(f==null||f.field===c||f.element===c){return}if(f.onFieldRefer){d.push(f.field.name)}});return d},onDetailClick:function(){this.repeatControl.showDetail(this.repeatSection)},onMoveUpClick:function(){this.repeatControl.moveUpRepeatSection(this.repeatSection)},onMoveDownClick:function(){this.repeatControl.moveDownRepeatSection(this.repeatSection)},onAddClick:function(){var d=this.repeatControl;if(d.groupInformation!=null){if(d.groupInformation.maxOccur>0){if(d.getRepeatChildren().length>=d.groupInformation.maxOccur){$IU.messageBox(null,"超出最大行数，不能再新增",null,300);return false}}}d.addRepeat(null,null,true,true,true,true)},onDeleteClick:function(){var d=this.repeatControl;if(d.groupInformation!=null){if(d.groupInformation.minOccur>0){if(d.getRepeatChildren().length<=d.groupInformation.minOccur){$IU.messageBox(null,"已达最小行数，不能再删除",null,300);return false}}}this.repeatControl.deleteRepeat(this.repeatSection,true)},isRepeatSection:function(){return this.repeatControl.isRepeatSection()},isRepeatTable:function(){return this.repeatControl.isRepeatTable()}};define("InfoPlus.Repeat.PopupMenu",a)})(window);
(function(b,c){var a=function(g){var d=this;this.repeatTableBody=g.repeatTableBody;this.repeatControl=g;this.needReorganize=g.power.writePower===true||g.power.insertPower===true||g.power.deletePower===true;var f=this.repeatTableBody.rows[0].cells;if(g.power.writePower===true){for(var e=0;e<f.length;e++){this.sortType[e]=InfoPlus.Repeat.TableSorter.SORT_TYPE_NONE;f[e].columnIndex=e;$(f[e]).addClass("infoplus_table_sort").click(function(i){if(!g.readOnly){var h=$(i.srcElement);if(h.data($Control.DATA_CONTROL_OBJECT)==null){d.onHeaderClick(this.columnIndex)}}})}}};a.SORT_TYPE_NONE=0;a.SORT_TYPE_ASC=1;a.SORT_TYPE_DESC=2;a.prototype={repeatTableBody:null,sortType:{},render:null,needReorganize:false,sortColumn:function(d,f){var e=this.repeatTableBody.rows[0].cells.length;if(d>=e){return}if(f===InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC){this.sortType[d]=InfoPlus.Repeat.TableSorter.SORT_TYPE_ASC}else{this.sortType[d]=InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC}this.onHeaderClick(d)},onHeaderClick:function(j){var r=function(v){if(v.length==0){return""}var w=v[0];var x=$(w).data($Control.DATA_CONTROL_TYPE);var u=$(w).data($Control.DATA_CONTROL_OBJECT);if(x==$Control.CONTROL_TYPE_RADIO){var t="";var i=$(v).filter("[name='"+w.name+"']:checked");if(i.length>0){t=$(i[0]).val()}return t}return u.getSortValue()};var g=function(t){if(t.length==0){return false}var v=t[0];var u=$(v).data($Control.DATA_CONTROL_OBJECT);if(u==null){return false}var i=u.field.type;return(i==$Control.DATA_TYPE_BOOL||i==$Control.DATA_TYPE_INT||i==$Control.DATA_TYPE_DOUBLE||i==$Control.DATA_TYPE_DATE)};var s=this.repeatTableBody.rows;var f=s.length;var h=new InfoPlus.QuickSortArray();var d=false;for(var m=1;m<f;m++){var q=s[m].cells[j];var p=$(q).find("*").filter($IU.isControlFilter);if(m==1){d=g(p)}h.push({oldIndex:m,value:r(p)})}if(this.sortType[j]==InfoPlus.Repeat.TableSorter.SORT_TYPE_NONE||this.sortType[j]==InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC){if(d){h.numberQuickSort()}else{h.sort(function(t,i){return t.value.localeCompare(i.value)})}this.sortType[j]=InfoPlus.Repeat.TableSorter.SORT_TYPE_ASC}else{if(d){h.numberQuickSort();h.reverse()}else{h.sort(function(t,i){return -(t.value.localeCompare(i.value))})}this.sortType[j]=InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC}var l=[];for(var e=0;e<f-1;e++){l.push(s[h[e].oldIndex])}var o=s[0];for(e=0;e<l.length;e++){$(o).after($(l[e]));o=l[e]}if(this.needReorganize){this.repeatControl.reorganizeRepeatableElement(true)}else{this.repeatControl.updateRepeatParentElementKeyIndex()}var n=s[0].cells;for(e=0;e<n.length;e++){var k=$(n[e]);if(e==j){if(this.sortType[j]==InfoPlus.Repeat.TableSorter.SORT_TYPE_ASC){k.removeClass("infoplus_table_sort_desc");k.addClass("infoplus_table_sort_asc")}else{k.removeClass("infoplus_table_sort_asc");k.addClass("infoplus_table_sort_desc")}}else{k.removeClass("infoplus_table_sort_desc");k.removeClass("infoplus_table_sort_asc")}}}};define("InfoPlus.Repeat.TableSorter",a)})(window);
(function(d,g){var f={};f.toFixed=function(j,h){var k=parseInt(h,10);if(isNaN(k)){k=0}var i=k>0?Math.pow(10,k):1;return Math.round(j*i)/i};f._add=function(l,k){var j,i,h;try{j=l.toString().split(".")[1].length}catch(n){j=0}try{i=k.toString().split(".")[1].length}catch(n){i=0}h=Math.pow(10,Math.max(j,i));return(l*h+k*h)/h};f._sum=function(o){if($IU.isNumberExactly(o)){return{value:o,count:1}}else{if($IU.isArray(o)){var m=0,n=0,h=o.length;for(var k=0;k<h;k++){var l=InfoPlus.Dynamics.Functions._sum(o[k]);m=InfoPlus.Dynamics.Functions._add(m,l.value);n+=l.count}return{value:m,count:n}}else{if(o!=null&&o.hasOwnProperty("value")){o=o.value}var j=parseFloat(o);if(!isNaN(j)){return{value:j,count:1}}}}return{value:0,count:0}};f._sumByCondition=function(o,p){if($IU.isNumberExactly(o)){if(p===g||p===true){return{value:o,count:1}}}else{if($IU.isArray(o)){var m=0,n=0,h=o.length;for(var k=0;k<h;k++){var l;if(p[k]===g){l=InfoPlus.Dynamics.Functions._sum(o[k])}else{l=InfoPlus.Dynamics.Functions._sumByCondition(o[k],p[k])}m=InfoPlus.Dynamics.Functions._add(m,l.value);n+=l.count}return{value:m,count:n}}else{if(p===g||p===true){if(o!=null&&o.hasOwnProperty("value")){o=o.value}var j=parseFloat(o);if(!isNaN(j)){return{value:j,count:1}}}}}return{value:0,count:0}};f.sum=function(h,i){if(i===g){return InfoPlus.Dynamics.Functions._sum(h).value}else{return InfoPlus.Dynamics.Functions._sumByCondition(h,i).value}};f.avg=function(i,j){var h;if(j===g){h=InfoPlus.Dynamics.Functions._sum(i)}else{h=InfoPlus.Dynamics.Functions._sumByCondition(i,j)}if(h.count===0){return 0}return(h.value/h.count)};f._concat=function(o,k,n){if(o==null){return g}if($IU.isString(o)){return o}if(n!==g&&o.hasOwnProperty(n)){return o[n]}if($IU.isArray(o)){var j="",h=o.length;for(var l=0;l<h;l++){var m=InfoPlus.Dynamics.Functions._concat(o[l],k,n);if(m!==g){j=j+m+((l!=h-1)?k:"")}}return j}return""};f.concat=function(j,h,i){return InfoPlus.Dynamics.Functions._concat(j,h,i)};f._length=function(l){if(l==null){return 0}if($IU.isString(l)){return l.length}if($IU.isArray(l)){var j=[],h=l.length;for(var k=0;k<h;k++){j[k]=InfoPlus.Dynamics.Functions._length(l[k])}return j}return 0};f.length=function(h){return InfoPlus.Dynamics.Functions._length(h)};f._countByCondition=function(l,m){if($IU.isArray(l)){var h=l.length,k=0;for(var j=0;j<h;j++){if(m[j]===g){k+=InfoPlus.Dynamics.Functions._count(l[j])}else{k+=InfoPlus.Dynamics.Functions._countByCondition(l[j],m[j])}}return k}else{if(m===g||m===true){return(l!==g)?1:0}}};f._count=function(l){if($IU.isArray(l)){var h=l.length,k=0;for(var j=0;j<h;j++){k+=InfoPlus.Dynamics.Functions._count(l[j])}return k}else{return(l!==g)?1:0}};f.count=function(h,i){if(i===g){return InfoPlus.Dynamics.Functions._count(h)}else{return InfoPlus.Dynamics.Functions._countByCondition(h,i)}};f.dateSpan=function(i,h){if(i==""||h==""){return""}return parseInt(Math.abs(h-i)/(60*60*24),10)+1};f.getBirthday=function(n){if(n===g||n===null){return null}if(!$IU.isString(n)){return null}if(n.length!==15&&n.length!==18){return null}var k,l,h;if(n.length===15){for(var j=6;j<=13;j++){if(parseInt(n.charAt(j),10)===NaN){return null}}var m=parseInt(n.substr(6,2),10);if(m<20){k=2000+m}else{k=1900+m}l=parseInt(n.substr(8,2),10);if(!(l>=1&&l<=12)){return null}h=parseInt(n.substr(10,2),10);if(!(h>=1&&h<=31)){return null}return(new Date(k,l-1,h)).getTime()/1000}else{for(j=6;j<=15;j++){if(parseInt(n.charAt(j),10)===NaN){return null}}k=parseInt(n.substr(6,4),10);if(k<1900||k>2100){return null}l=parseInt(n.substr(10,2),10);if(!(l>=1&&l<=12)){return null}h=parseInt(n.substr(12,2),10);if(!(h>=1&&h<=31)){return null}return(new Date(k,l-1,h)).getTime()/1000}};f.chineseAmount=function(j){if(isNaN(j)){return"无效数值！"}var m="";if(j<0){m="(负)"}j=Math.abs(j);if(j>=1000000000000){return"无效数值！"}var h="";var n="仟佰拾亿仟佰拾万仟佰拾元角分";var o="零壹贰叁肆伍陆柒捌玖";j+="00";var l=j.indexOf(".");if(l>=0){j=j.substring(0,l)+j.substr(l+1,2)}n=n.substr(n.length-j.length);for(var k=0;k<j.length;k++){h+=o.substr(j.substr(k,1),1)+n.substr(k,1)}return m+h.replace(/零角零分$/,"整").replace(/零[仟佰拾]/g,"零").replace(/零{2,}/g,"零").replace(/零([亿|万])/g,"$1").replace(/零+元/,"元").replace(/亿零{0,3}万/,"亿").replace(/^元/,"零元")};f.parseInt=parseInt;f.parseFloat=parseFloat;var e=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"];for(var c=0,a=e.length;c<a;c++){var b=e[c];if(typeof Math[b]=="function"){f[b]=Math[b]}}define("InfoPlus.Dynamics.Functions",f)})(window);
(function(b,c){var a={};a.DIALOG_ID="_ID_INFOPLUS_MESSAGE_"+Math.round(Math.random()*1000);a.isArray=function(d){return Object.prototype.toString.call(d)==="[object Array]"};a.isDate=function(d){return Object.prototype.toString.call(d)==="[object Date]"};a.isString=function(d){return Object.prototype.toString.call(d)==="[object String]"};a.isBoolean=function(d){return d===true||d===false||Object.prototype.toString.call(d)==="[object Boolean]"};a.isNumberExactly=function(d){return Object.prototype.toString.call(d)==="[object Number]"};a.isInt=function(d){return !isNaN(parseInt(d))};a.isNumber=function(d){return !isNaN(parseFloat(d))};a.isUrl=function(e){if(!a.isString(e)){return false}var d=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i");return d.test(e)};a.arrayContains=function(f,e){if(this.isArray(f)===false){return false}var d=f.length;while(d--){if(f[d]===e){return true}}return false};a.arrayAContainArrayB=function(e,d){if(!this.isArray(e)||!this.isArray(d)){return false}if(d.length>e.length){return false}for(var f=0;f<d.length;f++){if(e[f]!=d[f]){return false}}return true};a.arrayUnique=function(g){var d=g.concat();for(var f=0;f<d.length;++f){for(var e=f+1;e<d.length;++e){if(d[f]===d[e]){d.splice(e--,1)}}}return d};a.chineseLength=function(d){return d.replace(/[^\x00-\xff]/g,"**").length};a.stringReplaceAll=function(g,f,d,e){if(g==null){return null}if(f==null||d==null){return null}return g.replace(new RegExp(f,(e?"gi":"g")),d)};a.getElementsByClassName=function(h){var g=new RegExp("(?:^|\\s)"+h+"(?:$|\\s)");var j=document.getElementsByTagName("*");var f=[];var e;for(var d=0;(e=j[d])!=null;d++){var k=e.className;if(k&&k.indexOf(h)!=-1&&g.test(k)){f.push(e)}}return f};a.getDateIsoString=function(d){if(d==null){return""}if(Date.prototype.toISOString!=c){return d.toISOString()}var e=function(g){var f=String(g);if(f.length===1){f="0"+f}return f};return d.getUTCFullYear()+"-"+e(d.getUTCMonth()+1)+"-"+e(d.getUTCDate())+"T"+e(d.getUTCHours())+":"+e(d.getUTCMinutes())+":"+e(d.getUTCSeconds())+"."+String((d.getUTCMilliseconds()/1000).toFixed(3)).slice(2,5)+"Z"};a.stdTimezoneOffset=function(){var e=new Date();var d=new Date(e.getFullYear(),0,1);var f=new Date(e.getFullYear(),6,1);return Math.max(d.getTimezoneOffset(),f.getTimezoneOffset())};a.unixTimeToDate=function(e){if(isNaN(e)){return null}var d=new Date();d.setTime((e+infoCore.params.tenantTimeZoneOffset)*1000);d.setTime((d.getTime()/1000+d.getTimezoneOffset()*60)*1000);return d};a.unixTimeToDateString=function(e){var d=InfoPlus.Utilities.unixTimeToDate(e);if(null==d){return null}return InfoPlus.Utilities.dateFormat(d,"yyyy-MM-dd")};a.unixTimeToString=function(e){var d=InfoPlus.Utilities.unixTimeToDate(e);if(null==d){return null}return InfoPlus.Utilities.dateFormat(d,"yyyy-MM-dd hh:mm:ss")};a.unixTimeToLocalTime=function(e){if(isNaN(e)){return null}var d=new Date();d.setTime(e*1000);return d};a.unixTimeToLocalTimeString=function(e){if(isNaN(e)){return null}var d=new Date();d.setTime(e*1000);return InfoPlus.Utilities.dateFormat(d,"yyyy-MM-dd hh:mm:ss")};a.dateStringToUnixTime=function(d){try{d=d.replace(/-/g,"/");d=d.substr(0,10);var f=Date.parse(d);if(isNaN(f)){return null}return f/1000-(new Date(f)).getTimezoneOffset()*60-infoCore.params.tenantTimeZoneOffset}catch(e){return null}};a.isSameTimezone=function(){var d=new Date();return(infoCore.params.tenantTimeZoneOffset/60==-d.getTimezoneOffset())};a.getTimezoneString=function(g){var d=parseInt(g/60,10),f=Math.abs(g-d*60);var e="UTC";if(d==0&&f==0){return e}if(d>=0){e+="+"}e+=d.toString()+":";if(f>0){e+=f.toString()}else{e+="00"}if($$.timezone[e]!=null){return $$.timezone[e]+$$.timezone.time+e}return e};a.getPageScroll=function(){var d=0,e=0;if(b.pageYOffset){e=b.pageYOffset;d=b.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){e=document.documentElement.scrollTop;d=document.documentElement.scrollLeft}else{if(document.body){e=document.body.scrollTop;d=document.body.scrollLeft}}}return{X:d,Y:e}};a.getPageSize=function(){var e=0,h=0;if(b.innerHeight&&b.scrollMaxY){e=b.innerWidth+b.scrollMaxX;h=b.innerHeight+b.scrollMaxY}else{if(document.body.scrollHeight>document.body.offsetHeight){e=document.body.scrollWidth;h=document.body.scrollHeight}else{if(document.body){e=document.body.offsetWidth;h=document.body.offsetHeight}}}var d=0,g=0;if(b.innerHeight){d=b.innerWidth;g=b.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){d=document.documentElement.clientWidth;g=document.documentElement.clientHeight}else{if(document.body){d=document.body.clientWidth;g=document.body.clientHeight}}}var f=(e<d)?d:e;var i=(h<g)?g:h;return{PageW:f,PageH:i,WinW:d,WinH:g}};a.getElementPosition=function(f){var e=f.offsetTop;var d=f.offsetLeft;while(f=f.offsetParent){e+=f.offsetTop;d+=f.offsetLeft}return{top:e,left:d}};a.getDialog=function(){var d=$("#"+InfoPlus.Utilities.DIALOG_ID);if(d.length===0){var e=document.createElement("div");e.id=InfoPlus.Utilities.DIALOG_ID;document.body.appendChild(e);d=$(e)}return d};a.setMessageBoxButtonText=function(g,h){var i=$(InfoPlus.Utilities.getDialog()).parent();var e=i.find(".ui-dialog-buttonset").children();if(e.length>0){if(g<e.length){var f=e[g];var d=f.childNodes[0];$(d).text(h)}}};a.browserCloseable=function(){if(navigator.userAgent.match(/TaskCenterApp/)){return true}return !(b.opener==null||b.top!=b)};a.closeWindow=function(){if($$.params.back!=null&&$$.params.back!=""){b.location.href=$$.params.back}else{if(!a.browserCloseable()){b.location.reload()}else{b.open("","_self","");b.close()}}};a.delayedErrorMessageBox=function(d){if(a.errorMessage==null){a.errorMessage=d;setTimeout(function(){a.errorMessageBox(a.errorMessage,null,"错误",false,false,"#ff0000");a.errorMessage=null},0)}else{a.errorMessage=a.errorMessage+"\n"+d}};a.errorMessageBox=function(s,j,o,h,f,d,q){var m;m=$(document.createElement("div"));if(h===true){var p=document.createElement("span");p.style.color="#FF0000";$(p).text("发生错误：");m.append(p)}p=document.createElement("span");$(p).html($IU.htmlEncode(s));m.append(p);if(j!=null){var r=document.createElement("div");r.style.height="5px";var e=document.createElement("div");var l=document.createElement("a");l.href="#";l.style.color="#2446AB";l.title="点击显示错误的详细信息";$(l).text("详细信息　").addClass("moreDetail");$(l).one("click",{link:l,dialogDiv:m},InfoPlus.Utilities.moreDetailClick);var k=document.createElement("div");var n=document.createElement("div");$(n).html($IU.htmlEncode(j)).addClass("error_detail_message");$(k).addClass("error_detail_message_container").append(n);k.style.display="none";$(e).append(l);$(e).append(k);m.append(r);m.append(e)}var i=null;if(f&&$IU.browserCloseable()){i=[{name:"关闭",callOnClose:true,callback:function(){$IU.closeWindow()}}]}var g=new InfoPlus.Render.Dialog({title:o,titleColor:d,content:m,maxWidth:q!=null?q:800,buttons:i});g.show();return false};a.getMaxZIndex=function(){var d=$("div");var f=0;for(var e=0;e<d.length;e++){if(f<d[e].style.zIndex){f=d[e].style.zIndex}}return f+1};a.confirmBox=function(i,h,d,e,j){var g=$$.getLocaleText("common.cancel");var f=new InfoPlus.Render.Dialog({title:h!=d?h:null,content:i,maxWidth:e,buttons:[{name:d,defaultButton:true,callback:j},{name:g}]});f.show()};a.yesNoBox=function(h,e,i){var d="是",g="否";var f=new InfoPlus.Render.Dialog({title:null,content:h,maxWidth:e,buttons:[{name:d,defaultButton:true,callback:i},{name:g}]});f.show()};a.messageBox=function(h,g,f,e,i){if(f==null||f==""){f=$$.getLocaleText("common.ok")}var d=new InfoPlus.Render.Dialog({title:h,content:g,maxWidth:e,buttons:[{name:f,defaultButton:true,callback:i,callOnClose:i!=null}]});d.show()};a.debugBox=function(g,f,e,d,h){if($$.params.isRelease===false){a.messageBox(g,f,e,d,h)}};a.iframeBox=function(i,j,h,g,d){var f=document.createElement("iframe");f.src=i;f.setAttribute("width","100%");f.setAttribute("height",(d==0||d==null?$(b).height()*0.75:d)+"px");var e=new InfoPlus.Render.Dialog({title:j,content:f,maxWidth:(g==null||g==0?$(b).width:g),showFooter:false,showCloseButton:true,showMinimiseButton:!h,modal:h});e.show()};a.tip=function(e,d){new InfoPlus.Tip({text:e,type:d})};a.debugTip=function(e,d){if($$.params.isRelease===false){a.tip(e,d)}};a.shouldShowSuggesterPage=function(){return $$.MOBILE&&!(/iPad/i.test(navigator.userAgent))};a.showSuggester2Page=function(d){var f=d.getValue();var j=new $Controls.Suggester2(d.path,d.field,d.render,f.value,f.displayValue,d.parentValue,d.suggestService,d.getAttributes(),true);$(j.element).removeClass("xdTextBox");j.initSelect2();j.onFieldRefer=d.onFieldRefer;var i=d.tooltip,g=j.getControlContainer();if(i!=null&&i.tip!=null&&i.tip!=""){g=document.createElement("div");var k=document.createElement("div");$(k).text(i.tip).addClass("infoplus_suggester_tooltip");$(g).append(k).append(j.getControlContainer())}var e={title:d.field.label,content:g,onShow:function(){var l=$(j.element).data($Control.DATA_ORIGIN_INPUT);$(l).select2("open")},onClose:function(){d.onSuggestPage=false}};var h=new InfoPlus.Render.Mobile.Page(e);h.show()};a.getTransitionEndEventName=function(){var f=document.createElement("fake"),e={WebkitTransition:"webkitTransitionEnd",transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"};for(var d in e){if(e.hasOwnProperty(d)){if(f.style[d]!==c){return e[d]}}}return null};a.initValidationEngine=function(){$$.params.renderForm.validationEngine("attach",{validationEventTriggers:"blur",success:false,promptPosition:$$.MOBILE?"topLeft":"topRight"})};a.rebindValidationEngine=function(){$$.params.renderForm.validationEngine("detach");a.initValidationEngine()};a.clearErrorPrompt=function(f){var d=$(f).find("*[class*='validate']");for(var e=0;e<d.length;e++){$(d[e]).validationEngine("hidePrompt")}};a.clearAllError=function(){$("div.formError").remove()};a.updateErrorPromptPosition=function(){var k=function(l){for(var i=0;i<l.length;i++){var m=l[i];if(m.indexOf("formError")!=-1&&m!="formError"){return m.substring(0,m.indexOf("formError"))}}return null};var e=$("div.formError");for(var g=0;g<e.length;g++){var j=e[g];var f=j.className.split(" ");var d=k(f);if(d!=null){var h=$(j).children(".formErrorContent")[0].innerHTML;if(h!=c){$("#"+d).validationEngine("showPrompt",h,"error",null,true)}}}};a.isControlFilter=function(){if(this.tagName==="OBJECT"){return false}var d=$(this).data($Control.DATA_IS_CONTROL);if(d==null){return false}return d===true};a.isSuggesterFilter=function(){if(this.tagName==="OBJECT"){return false}return($(this).data($Control.DATA_SUGGESTER)!=null)};a.isValidateControlFilter=function(){if(this.tagName==="OBJECT"){return false}var d=$(this).data($Control.DATA_IS_CONTROL);if(d==null){return false}if(d===false){return false}if($(this).parents(".detailCell").size()>0){if($(this).css("display")=="none"){return false}}else{if(!$(this).is(":visible")){return false}}return true};a.isValidateFilter=function(){if(this.tagName==="OBJECT"){return false}var d=this.getAttribute("class");if(d==null){return false}return(d.indexOf("validate")!=-1)};a.addElementValidateClass=function(d){$(d).addClass("validate[funcCall[checkRenderFormFields]]")};a.removeElementValidateClass=function(d){$(d).removeClass("validate[funcCall[checkRenderFormFields]]")};a.trimString=function(d){if(d==null){return null}return d.replace(/^\s+|\s+$/g,"")};a.clearSuggester=function(f){var d=$(f).find("*").filter(InfoPlus.Utilities.isSuggesterFilter);for(var e=0;e<d.length;e++){var g=$(d[e]).data($Control.DATA_SUGGESTER);g.dispose()}};a.highLightElement=function(g){var j=$(g).data($Control.DATA_CONTROL_TYPE);if(j==$Control.CONTROL_TYPE_IFRAME){return}if(!(j==$Control.CONTROL_TYPE_SUGGESTER||j==$Control.CONTROL_TYPE_SUGGESTER2)&&!$(g).is(":visible")){return}var f=function(l){if($.browser.msie){try{var o=document.body.createTextRange();o.moveToElementText(l);var k=o.queryCommandValue("BackColor");var m=k==null?"rgb(255,255,255)":"rgb("+(k&255)+","+((k&65280)>>8)+","+((k&16711680)>>16)+")";l.style.backgroundColor=m}catch(n){}}};var d=function(k){if($(k).data("isEffecting")!==c){return}f(k);$(k).data("isEffecting",true).effect("highlight",{},1000,function(){$(this).removeData("isEffecting")})};if(j!=null){switch(j){case $Control.CONTROL_TYPE_REMARK:case $Control.CONTROL_TYPE_ANCHOR:case $Control.CONTROL_TYPE_ACTION:case $Control.CONTROL_TYPE_HIDDEN:break;case $Control.CONTROL_TYPE_LABEL:var i=$(g).data($Control.DATA_CONTROL_OBJECT);if(i!=null){d(i.element)}break;case $Control.CONTROL_TYPE_SUGGESTER:var h=$(g).data($Control.DATA_SUGGESTER);if(h!=null){d(h.activeInput)}break;case $Control.CONTROL_TYPE_SUGGESTER2:var e=$(g).data("select2Object");if(e!=null){d($(g).siblings(".select2").find(".select2-selection")[0])}break;default:d(g);break}}};a.htmlEncode=function(f){var e="";if(f.length==0){return""}for(var d=0;d<f.length;d++){switch(f.substr(d,1)){case"<":e+="&lt;";break;case">":e+="&gt;";break;case"&":e+="&amp;";break;case" ":e+="&nbsp;";break;case'"':e+="&quot;";break;case"\n":e+="<br>";break;default:e+=f.substr(d,1);break}}return e};a.moreDetailClick=function(g){var f=g.data.link;var e=$(f).siblings("div")[0];var d=g.data.dialogDiv;if(e!=null){d.dialog("option","width",850);d.dialog("option","position","center");e.style.display="block";$(f).empty()}return false};a.dateFormat=function(e,f){var g={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};if(/(y+)/.test(f)){f=f.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))}for(var d in g){if(g.hasOwnProperty(d)){if(new RegExp("("+d+")").test(f)){f=f.replace(RegExp.$1,RegExp.$1.length==1?g[d]:("00"+g[d]).substr((""+g[d]).length))}}}return f};a.variablesFormat=function(j,e){var d=j.match(/\${\w+}/g);if(d!=null){for(var f=0;f<d.length;f++){var g=d[f];var h=g.substring(2,g.length-1);if(e[h]!=null){j=j.replace(g,InfoPlus.Utilities.trimString(e[h]))}else{j=j.replace(g,"")}}}return InfoPlus.Utilities.trimString(j)};a.checkFieldEmpty=function(g,e){var f="required";switch(g.attr("type")){case"text":case"password":case"textarea":case"file":default:if(!a.trimString(g.val())){return e?e.allrules[f].alertText:true}break;case"radio":case"checkbox":var d=g.attr("name");if($("input[name='"+d+"']:checked").size()==0){if($("input[name='"+d+"']").size()==1){return e?e.allrules[f].alertTextCheckboxe:true}else{return e?e.allrules[f].alertTextCheckboxMultiple:true}}break;case"select-one":if(!g.val()){return e?e.allrules[f].alertText:true}break;case"select-multiple":if(!g.find("option:selected").val()){return e?e.allrules[f].alertText:true}break}if(!e){return false}else{return c}};a.getReferedControlPaths=function(e){var j=[],g=e.split("_"),d=g.length;for(var f=0;f<d;f++){var h=g[f];if(f===0){j.push(h)}else{j.push(j[j.length-1]+"_"+h)}}return j};a.isSibling=function(j,h){if(j==null||h==null||j==""||h==""){return false}var g=j.split("_"),f=h.split("_");if(g.length!=f.length){return false}for(var e=0,d=g.length;e<d-1;e++){if(g[e]!=f[e]){return false}}return g[d-1]!=f[d-1]};a.convertFileSize=function(d){if(d==null||!InfoPlus.Utilities.isNumber(d)){return{size:"",unit:""}}if(d<1024){return{size:d.toString(),unit:"B"}}d=d/1024;if(d<1024){return{size:d.toFixed(1).toString(),unit:"K"}}d=d/1024;if(d<1024){return{size:d.toFixed(1).toString(),unit:"M"}}d=d/1024;return{size:d.toFixed(1).toString(),unit:"G"}};a.getElementStyle=function(g,e){var k=g.getAttribute("style");if(k==null){return null}var j=k.split(";");for(var f=0,d=j.length;f<d;f++){var h=$IU.trimString(j[f]);if(h!==""){var l=h.split(":");if(l.length===2){if($IU.trimString(l[0].toLowerCase())==$IU.trimString(e.toLowerCase())){return $IU.trimString(l[1])}}}}return null};a.saveOriginStyles=function(g){if($(g).data(InfoPlus.Controls.Control.DATA_ORIGIN_STYLE)!==c){return null}var i={},f=$(g).attr("style");if(f==null){$(g).data(InfoPlus.Controls.Control.DATA_ORIGIN_STYLE,i);return i}var e=f.split(";"),d=e.length;for(var j=0;j<d;j++){var h=$IU.trimString(e[j]);if(h!==""){var k=h.split(":");if(k.length===2){i[$IU.trimString(k[0]).toLowerCase()]=$IU.trimString(k[1])}}}$(g).data(InfoPlus.Controls.Control.DATA_ORIGIN_STYLE,i);return i};a.setDynamicStyle=function(d,f,i){var h=function(p,l){l=l.toLowerCase();var o=p.getAttribute("style"),n=o.split(";"),j=n.length;for(var k=0;k<j;k++){var m=InfoPlus.Utilities.trimString(n[k]);if(m!==""){var q=m.split(":");if(q.length===2){if(q[0].toLowerCase()===l){return InfoPlus.Utilities.trimString(q[1])}}}}return""};var g=function(r,j,t){j=InfoPlus.Utilities.trimString(j.toLowerCase());t=InfoPlus.Utilities.trimString(t);var n=r.getAttribute("style");if(n==null){r.setAttribute("style",j+":"+t)}else{var o=n.split(";"),m=o.length,k="";for(var l=0;l<m;l++){var q=InfoPlus.Utilities.trimString(o[l]);if(q!==""){var p=q.split(":");if(p.length===2){if(p[0].toLowerCase()!==j){k=k+(k!==""?";":"")+q}else{if(t!==""){k=k+(k!==""?";":"")+j+":"+t}}}}}r.setAttribute("style",k)}};f=InfoPlus.Utilities.trimString(f.toLowerCase());var e=$(d).data(InfoPlus.Controls.Control.DATA_ORIGIN_STYLE);if(e===c){e=$IU.saveOriginStyles(d)}i=InfoPlus.Utilities.trimString(i);if(i==="null"||i===""){if(e[f]!==c){g(d,f,e[f])}else{g(d,f,"")}}else{$(d).css(f,i)}};a.setElementValue=function(m,g,n,j){if(g==null){g=""}if(n==null){n=""}var e=document.getElementsByName(m);for(var l=0;l<e.length;l++){var i=e[l],h=$(i).data($Control.DATA_CONTROL_OBJECT),k=false;if(h!=null&&h.isWritable()){var d=h.getValue();if(d!=null&&d.value!==c){d=d.value}k=d!==g;if(k){if(h.field.type==InfoPlus.Controls.Control.DATA_TYPE_DATE&&$IU.isString(g)){var f=$IU.dateStringToUnixTime(g);if(f!=d){h.setValue(f)}else{k=false}}else{h.setValue(g,n,false,j)}if(k&&h.autoTriggerFieldChangeEvent&&(h.onFieldChange||h.onFieldRefer)){$(h.element).change()}}else{if(j!=null){h.setValue(g,n,false,j)}}if($$.params.fieldChanging!=null){$$.params.fieldChanging.controls.push(h)}}if(k){$IU.highLightElement(i)}}};a.getFieldNamesFromFieldChangeOldData=function(f){var e={};for(var d=0;d<f.length;d++){e[f[d].fieldName]=null}return e};a.getFieldNamesFromFieldChangeData=function(h){var m={};var j=function(i){if(i.length>0){return"field"+i.substring(0,1).toUpperCase()+i.substring(1)}return null};var k=function(i){if(i.length>0){return"group"+i.substring(0,1).toUpperCase()+i.substring(1)}return null};var f=function(p){for(var i in p){if(p.hasOwnProperty(i)){d(i)}}};var d=function(i){if(i!=null){if(!m.hasOwnProperty(i)){m[i]=null}}};for(var o in h){if(h.hasOwnProperty(o)){if(o==="entityIndex"){continue}var n=h[o];if(!$IU.isArray(n)){d(j(o))}else{d(k(o));for(var g=0,l=n.length;g<l;g++){var e=$IU.getFieldNamesFromFieldChangeData(n[g]);f(e)}}}}return m};a.setFormData=function(v,l,t){var m=$$.params.formRender.entity.fields;var k=function(i){if(i.length>0){return m["field"+i.substring(0,1).toUpperCase()+i.substring(1)]}return null};var j=function(i,y){if(i.length>0){return"field"+i.substring(0,1).toUpperCase()+i.substring(1)+(y!==c?y:"")}return null};var o=function(i,y){if(i.length>0){return"group"+i.substring(0,1).toUpperCase()+i.substring(1)+y}return null};var s=function(A,y){if(m[y]==null){return false}var z=m[y]["parent"];var i=[];while(z!==c){i.push(z);if(A==z){return true}if(m[z]==null){return false}z=m[z]["parent"];if(z!==c&&$IU.arrayContains(i,z)){a.errorMessageBox("字段"+A+"的parent设置存在自环，请检查");return false}}return false};var p=function(z){var F=[];var y=[];for(var E in z){if(z.hasOwnProperty(E)){if(E==="entityIndex"){continue}var D=z[E],C=E,H={key:C,value:D};if($IU.isArray(D)){y.push(H);continue}for(var A=0,B=F.length;A<B;A++){var G=F[A].key;if(s(j(C),j(G))){F.splice(A,0,H);break}}if(B==F.length){F.push({key:C,value:D})}}}return F.concat(y)};var w=p(v);for(var q=0,r=w.length;q<r;q++){var x=w[q].key,n=w[q].value;if(!$IU.isArray(n)){if(!t){var e=j(x,l);var d=k(x);if(e!=null&&d!=null){if($IU.isString(n)){$IU.setElementValue(e,n);continue}if(n.hasOwnProperty("codeId")){$IU.setElementValue(e,n.codeId,n.codeName,n.attributes);continue}if(d.type==$Control.DATA_TYPE_CODE){$IU.setElementValue(e,n.codeId,n.codeName,n.attributes);continue}$IU.setElementValue(e,n)}}}else{var f=o(x,l);if(f!=null){var g=$("#"+f);if(g.length>0){var h=g[0];var u=$(h).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(u!=null){u.setData(n);if($$.params.fieldChanging!=null){$$.params.fieldChanging.controls.push(u)}}}}}}};a.setFocusToElement=function(d){if($$.MOBILE){return}var f=document.getElementsByName(d);if(f.length>0){var h=f[0];var e=function(){var i=$(h).data($Control.DATA_SUGGESTER);if(i!=null){i.containerClick()}else{try{document.getElementById(h.id).focus()}catch(j){}}};var g=(navigator.appVersion.indexOf("MSIE")!=-1);if(g){setTimeout(e,1000)}else{e()}}};a.getComputedStyle=function(d,e){if(d==null||e==null){return null}if(b.getComputedStyle!=null){var f=b.getComputedStyle(d);return f[e]}else{if(d.currentStyle!=null){return d.currentStyle[e]}}return null};a.fireClick=function(e){if(typeof e=="string"){e=document.getElementById(e)}if(!e){return}if(document.dispatchEvent){var d=document.createEvent("MouseEvents");d.initMouseEvent("click",true,true,b,1,1,1,1,1,false,false,false,false,0,e);e.dispatchEvent(d)}else{if(document.fireEvent){e.click()}}};a.openLink=function(e,f){var d=document.createElement("a");if(f){d.setAttribute("target","_blank")}else{d.setAttribute("target","_self")}d.setAttribute("href",e);document.body.appendChild(d);$IU.fireClick(d);document.body.removeChild(d)};a.splitAttribute=function(d){if(d==null){return[]}var e=d.split("\r\n");if(e.length==1){return d.split("\n")}else{return e}};a.beginWith=function(e,d){if(e==null||e==""||d==null||d==""){return false}if(d.length>e.length){return false}return(e.substr(0,d.length)===d)};a.endWith=function(e,d){if(e==null||e==""||d==null||d==""){return false}if(d.length>e.length){return false}return(e.lastIndexOf(d)==(e.length-d.length))};a.checkControlValidation=function(n,j,e){var d=function(i){if(i instanceof InfoPlus.Controls.Suggester){return $(i.element).data($Control.DATA_SUGGESTER).activeInput}else{if(i instanceof InfoPlus.Controls.Control){return i.element}else{return i}}};var k=function(i){i.validationEngine("showPrompt","详细信息出错，请修改",null,"row",true)};var m=function(s){var o,p=$(s),q=p.parents(".detailCell").size()>0;var r="#"+p[0].id;if(!j){if(p.data($Control.DATA_ORIGIN_INPUT)!=null){o=$(p.data($Control.DATA_ORIGIN_INPUT)).data($Control.DATA_VALIDATOR)}else{o=p.data($Control.DATA_VALIDATOR)}var i=o.required;o.required=false;if($$.params.renderForm.validationEngine("validateField",r,(!q||!e))===true){o.required=i;if(q&&e){k(p.parents(".detailCell").parent())}return false}o.required=i}else{if($$.params.renderForm.validationEngine("validateField",r,(!q||!e))===true){if(q&&e){k(p.parents(".detailCell").parent())}return false}}return true};var g=true;for(var h=0,l=n.length;h<l;h++){var f=d(n[h]);if(m(f)===false){g=false}}return g};a.clacImgZoomParam=function(i,h,g,d){var j={top:0,left:0,width:g,height:d};if(g>i||d>h){var f=g/i,e=d/h;if(f>e){j.width=i;j.height=Math.round(d/f)}else{j.width=Math.round(g/e);j.height=h}}j.left=Math.round((i-j.width)/2);j.top=Math.round((h-j.height)/2);return j};a.dynamicReferControl=function(f,e){var g=e.getDynamicKeyName();var d=e.getDynamicContextControlName();return a.arrayContains(f.references,g)||a.arrayContains(f.references,d)};a.scrollTo=function(e,d){$("html,body").animate({scrollTop:e},d)};a.adjustWidth=function(k,j,f){var h=0;for(var g=0,d=k.length;g<d;g++){k[g]=Math.round(k[g]*f);h+=k[g]}if(h!=j){var e=Math.ceil((j-h)/k.length);for(g=0,d=k.length;g<d;g++){if(j==h){break}if((e>0&&e<(j-h))||(e<0&&e>(j-h))){k[g]+=e;h+=e}else{k[g]+=(j-h);h=j}if((h!=j)&&g==(d-1)){k[g]+=(j-h)}}}};a.addVariableControl=function(d,k,h,g){if(k==null){k=""}var j=$("#"+d);if(j.length>0){var l=j.data($Control.DATA_CONTROL_OBJECT);l.setValue(k,h,true,g)}else{var f=$("#variables_container");var e={name:d,type:h==null?$Control.DATA_TYPE_STRING:$Control.DATA_TYPE_CODE,permission:"rw"};var i={renderCategory:"Boundable",controlId:d,field:d};l=new $Controls.Hidden("",e,i,k,h,g);f.append(l.element);if($IU.beginWith(d,"_VAR_")){$(l.element).addClass($Control.CLASSNAME_VAR)}}return l};a.getAllControls=function(d){if(d===c){d=$$.params.renderForm}var e=[];$(d).find("."+$Control.CLASSNAME_CONTROL+",."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var f=$(this).data($Control.DATA_CONTROL_OBJECT);if(f==null){f=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(f==null){return}}e.push(f)});return e};a.pathInclude=function(h,j){var g=h.split("_"),e=j.split("_");if(e.length>g.length){return false}for(var f=0,d=e.length;f<d;f++){if(e[f]!=g[f]){return false}}return true};a.processUrl=function(d){var f=function(g){return d.indexOf("&"+g+"=")!=-1||d.indexOf("?"+g+"=")!=-1};var e=function(g){if($$.params[g]!=null&&$$.params[g]!=""&&!f(g)){d+=((d.indexOf("?")!=-1)?"&":"?")+g+"="+encodeURIComponent($$.params[g])}};if($$.getTestFile()!=null){d+=((d.indexOf("?")!=-1)?"&":"?")+"jsTestFile="+$$.getTestFile()}e("back");e("memberShip");e("showRemark");e("theme");e("lang");return d};a.getParamFromUrl=function(e){var n={};if(!a.isString(e)||e==null){return n}var f=[];var m=e.split("?");if(m.length>1){f=m[0].split("#").concat(m[1].split("#"));f.splice(0,1)}else{f=m[0].split("#")}for(var h=0,k=f.length;h<k;h++){var d=f[h].split("&");for(var j=0,g=d.length;j<g;j++){var l=d[j].split("=");if(l.length==2){n[l[0]]=decodeURIComponent(l[1])}}}return n};a.getWindowWidth=function(){var d=$(b).width();if(d==0){d=b.outerWidth}if(d==0){d=b.screen.width}return d};a.processTrRowVisible=function(i,h,d){var m=function(E){var u=E.closest("table"),H=E.parent().children("tr");if(u.data("analysed")==null){for(var p=0,C=H.size();p<C;p++){var I=$(H[p]),q=I.children("td");for(var t=0,A=q.size();t<A;t++){var s=$(q[t]);if(s.attr("colspan")!=null){var z=parseInt(s.attr("colspan"),10)-1;for(var F=0;F<z;F++){var B=document.createElement("td");$(B).addClass("fake").css("display","none");s.after(B)}}if(s.attr("rowspan")!=null){var v=parseInt(s.attr("rowspan"),10)-1;z=s.attr("colspan")!=null?parseInt(s.attr("colspan"),10):1;for(var w=1;w<=v;w++){if(p+w<H.size()){var r=$(H[p+w]);if(s.index()>0){for(F=0;F<z;F++){B=document.createElement("td");$(B).addClass("fake").css("display","none");var n=s.index()-1,o=r.children("td");for(var x=0,G=0,D=o.size();x<D;x++){var y=$(o[x]);if(G==n){y.after(B);break}else{if(y.attr("colspan")!=null){G+=parseInt(y.attr("colspan"),10)-1}}G++}}}else{for(F=0;F<z;F++){B=document.createElement("td");$(B).addClass("fake").css("display","none");r.prepend(B)}}}}}}}H.each(function(){var J=$(this).index()+":";$(this).children("td").each(function(){J+=$(this).index();$(this).data("rawTdIndex",$(this).index())});$(this).children("td.fake").remove()});u.data("analysed",true)}};var g=function(t,o){var q=parseInt(o.attr("rowspan"),10)-1,n=o.data("rawTdIndex"),x=0,u=0;while(x<q&&u<t.size()){var s=$(t[u]),v=s.children("td");for(var w=0,r=v.size();w<r;w++){var p=$(v[w]);if(p.data("rawTdIndex")===n&&p.hasClass("fake")){p.remove()}}if(!s.hasClass("fake")){x++}u++}};var e=function(){var o=false,p=[];i.nextAll("tr:not(.fake)").each(function(){if(!o){p.push($(this));if($(this).css("display")!="none"){o=true}}});var r=i.children("td");for(var q=0,n=r.size();q<n;q++){var s=$(r[q]);if(s.attr("rowspan")!=null){f(s,p)}}};var f=function(s,o){var n=function(w,y){var A=s.clone();A.attr("rowspan",y);A.data("rawTdIndex",s.data("rawTdIndex"));A.addClass("fake");var x=s.data("rawTdIndex");var v=w.children("td");for(var z=0,u=v.size();z<u;z++){var B=$(v[z]);if(B.data("rawTdIndex")!=null){if(B.data("rawTdIndex")>x){B.before(A);return}}}w.append(A)};var p=parseInt(s.attr("rowspan"),10);for(var t=0,r=o.length;t<r;t++){if(p>1){var q=o[t];n(q,--p)}}};var k=function(n,p){var o=1;n.prevAll("tr").not(".fake").each(function(){$(this).children("td").each(function(){var r=$(this);var q=r.attr("rowspan")==null?1:parseInt(r.attr("rowspan"),10);if(o==q){if(p){if(r.data("oldBorderBottomStyle")!=null){r.css("border-bottom-style",r.data("oldBorderBottomStyle"))}}else{if(r.data("oldBorderBottomStyle")==null){r.data("oldBorderBottomStyle",r.css("border-bottom-style"))}r.css("border-bottom-style","none")}}});o++})};var l=function(n){var o=n.clone();o.children("td").removeAttr("rowspan").css("border-width","0").css("border-style","none").css("padding","0").empty();o.addClass("fake").removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW);if(o.css("min-height")!=null){o.css("min-height","")}if(o.css("display")!=null){o.css("display","")}n.before(o)};if(i.closest("table").data("analysed")==null){m(i)}if(h){if(i.css("display")=="none"){if(i.prev("tr").size()>0){i.prev("tr.fake").remove()}var j=i.nextAll("tr");i.children("td").each(function(){if($(this).attr("rowspan")!=null){g(j,$(this))}})}i.show()}else{if(i.is(":visible")||d){if(i.prev("tr").size()>0){l(i)}e()}i.hide()}};define("InfoPlus.Utilities",a);b.$IU=a;b.checkRenderFormFields=function(p,s,j,t){var m=p[0];if(m.style.display=="none"){return c}if(m.type=="hidden"){return c}var g=$(m);var k=g.data($Control.DATA_VALIDATOR_PROMPT_POSITION);if(k!==c){t.promptPosition=k}if(g.data($Control.DATA_ORIGIN_INPUT)!=null){g=$(g.data($Control.DATA_ORIGIN_INPUT))}var d=g.data($Control.DATA_VALIDATOR);if(!d){return c}var h=g.data($Control.DATA_CONTROL_OBJECT);if(h==null){return c}if(h.onSuggestPage===true){return c}var q=m.type=="checkbox"?m.checked:g.val();var l=c;if(d.required){l=InfoPlus.Utilities.checkFieldEmpty(g,t)}else{if(q===""){return c}}if(d.regEx){try{var o=new RegExp(d.regEx)}catch(n){var r=h.field.name;$$.log("invalid reg("+r+"):"+d.regEx);return c}if(!o.test(q)){var f=d.prompt!=null&&d.prompt!=""?d.prompt:t.allrules.formatError.alertText;if(l!=c){return l+"<br/>"+f}else{return f}}}return l}})(window);
(function(b,c){var a=function(){Array.call(this,arguments)};a.prototype=new Array();a.prototype.numberQuickSort=function(){return d(this,0,this.length-1);function d(e,f,n){if(f<n){var k=e[parseInt((f+n)/2)],m=f-1,h=n+1;while(true){while(e[++m].value<k.value){}while(e[--h].value>k.value){}if(m>=h){break}var g=e[m];e[m]=e[h];e[h]=g}d(e,f,m-1);d(e,h+1,n)}}};define("InfoPlus.QuickSortArray",a)})(window);
(function(b,c){var a={time:"时间","UTC-12:00":"国际日期变更线西","UTC-11:00":"协调世界时-11","UTC-10:00":"夏威夷","UTC-9:00":"阿拉斯加","UTC-8:00":"太平洋","UTC-7:00":"亚利桑那","UTC-6:00":"墨西哥城","UTC-5:00":"波哥大","UTC-4:30":"加拉加斯","UTC-4:00":"乔治敦","UTC-3:30":"纽芬兰","UTC-3:00":"布宜诺斯艾利斯","UTC-2:00":"协调世界时-02","UTC-1:00":"佛得角群岛",UTC:"伦敦","UTC+1:00":"柏林","UTC+2:00":"雅典","UTC+3:00":"莫斯科","UTC+3:30":"德黑兰","UTC+4:00":"阿布扎比","UTC+4:30":"喀布尔","UTC+5:00":"伊斯兰堡","UTC+5:30":"新德里","UTC+5:45":"加德满都","UTC+6:00":"达卡","UTC+6:30":"仰光","UTC+7:00":"曼谷","UTC+8:00":"北京","UTC+8:30":"平壤","UTC+9:00":"东京","UTC+9:30":"阿德莱德","UTC+10:00":"布里斯班","UTC+11:00":"所罗门群岛","UTC+12:00":"奥克兰","UTC+13:00":"萨摩亚群岛","UTC+14:00":"圣诞岛"};$$.timezone=a})(window);
(function(a,c){var b=function(d){this.options=$.extend(b.DEFAULT_OPTIONS,d);this.init(this.options)};b.CLASSNAME_TIP="infoplus_tip";b.CLASSNAME_CLOSE="infoplus_tip_close";b.DEFAULT_OPTIONS={color:"#FFFFFF",type:"info",text:""};b.SPACE_HEIGHT=8;b.prototype={options:{},element:null,getMinTop:function(){var g=$("body"),h=$(a).height(),i=h,d=null,f=0,e=0;g.children("."+b.CLASSNAME_TIP).each(function(){var j=parseFloat($(this).css("top"));if(j<i){i=j;d=$(this)}f++;e+=$(this).outerHeight()+b.SPACE_HEIGHT});if(d!=null){d.css("z-index",2)}if(f>0&&(h-e<i)){i=h-e}return i},render:function(){var e=this.options;var j=document.createElement("div"),d=$(j),g=$("body"),i=this.getMinTop(),f=$(a).width()-20;d.html(e.text);d.css("color",e.color).css("left","10px").css("top",i).css("max-width",f+"px").addClass(b.CLASSNAME_TIP).addClass(e.type+"_tip").addClass("z-depth-1");var h=document.createElement("i");$(h).addClass("i-icon-close2").addClass(b.CLASSNAME_CLOSE);d.append(h);g.append(j);setTimeout(function(){var k=d.outerHeight();d.css("top",i-k-b.SPACE_HEIGHT)},0);return j},init:function(){this.element=this.render();this.initEvents()},initEvents:function(){var d=this,e=$(this.element),h=e.children("."+b.CLASSNAME_CLOSE);var f=$IU.getTransitionEndEventName();if(f!=null){var g=function(){e.css("left","-"+e.outerWidth()+"px");e.one(f,function(){d.remove()})}}else{g=function(){d.remove()}}h.click(g);if($$.MOBILE){e.click(g)}},remove:function(){var e=parseFloat($(this.element).css("top")),d=$(this.element).outerHeight()+b.SPACE_HEIGHT;$(this.element).siblings("."+b.CLASSNAME_TIP).each(function(){var f=parseFloat($(this).css("top"));if(f<e){$(this).css("top",(f+d)+"px")}});$(this.element).remove()}};define("InfoPlus.Tip",b)})(window);
(function(a,c){var b=function(k,g,f,l,j,d,h,m,i,e){this.field=k;this.mode=h;this.tipFormat=m;this.type=j;this.code=d;this.data=f;this.text=l;this.dataElement=g;this.path=$(g).data($Control.DATA_PATH);this.suggestService=i||"";this.suggestMinimizeSize=(this.type==$Control.DATA_TYPE_USER)?2:0;this.suggestInitializeService=e;this.clearFocusFlag();this.createSuggester()};b.KEY_CODE_ENTER=13;b.KEY_CODE_BACKSPACE=8;b.KEY_CODE_ESC=27;b.KEY_CODE_PAGE_UP=33;b.KEY_CODE_PAGE_DOWN=34;b.KEY_CODE_UP=38;b.KEY_CODE_DOWN=40;b.KEY_CODE_DELETE=46;b.KEY_CODE_TAB=9;b.CLASSNAME_SUGGESTER_ITEM="infoplus_suggester_item";b.CLASSNAME_SUGGESTER_ITEM_SELECT="suggest_selected";b.CLASSNAME_SUGGESTER_ITEM_UNSELECT="suggest_unselected";b.CLASSNAME_SUGGESTER_DIV="suggest_div";b.CLASSNAME_SUGGESTER_LOADING="suggest_loading";b.CLASSNAME_SUGGESTER_FRAME_OUTER="suggest_frame_outer";b.CLASSNAME_SUGGESTER_FRAME_INNER="suggest_frame_inner";b.CLASSNAME_SUGGESTER_ACTIVE_DIV="active_div";b.CLASSNAME_SUGGESTER_ACTIVE_TIP_CONTAINER="active_tip_container";b.CLASSNAME_SUGGESTER_BUTTON="suggest_button";b.CLASSNAME_SUGGESTER_ACTIVE_INPUT="active_input";b.CLASSNAME_SUGGESTER_ACTIVE_INPUT_GRAY="active_input_gray";b.CLASSNAME_SUGGESTER_ACTIVE_INPUT_FOCUS="active_input_focus";b.CLASSNAME_SUGGESTER_MORE_ITEM="infoplus_suggester_item_more";b.CLASSNAME_SUGGESTER_MORE_USER="infoplus_suggester_user_more";b.CLASSNAME_SUGGESTER_MORE_ITEM_DOWN="infoplus_suggester_item_more_down";b.CLASSNAME_SUGGESTER_MORE_ITEM_LOADING="infoplus_suggester_item_more_loading";b.CLASSNAME_SUGGESTER_EMPTY_ITEM="infoplus_suggester_item_empty";b.CLASSNAME_CONTROL="infoplus_control";b.CLASSNAME_READONLY="infoplus_readonly";b.DATA_SUGGESTER_ATTRIBUTES="attributes";b.DATA_SUGGESTER_MORE_ITEM="moreItem";b.DATA_SUGGESTER_EMPTY_ITEM="emptyItem";b.MESSAGE_SUGGESTER_MORE_ITEM="按↓键到此行或PageDown键获取更多";b.MESSAGE_SUGGESTER_MORE_USER="共找到%d位用户,请输入更多条件缩小范围<br>请输入汉字,拼音,账号,学工号,院系等多个条件空格分隔";b.MESSAGE_SUGGESTER_EMPTY_ITEM="〈清空〉";b.MESSAGE_EMPTY="请输入汉字或拼音(支持拼音首字母)";b.MESSAGE_EMPTY_USER="请输入汉字,拼音,账号,学工号,院系(多个条件空格分隔)";b.MESSAGE_INVALID="未找到符合条件的数据";b.PAGE_ITEM_COUNT=15;b.PAGE_ITEM_HEIGHT=25;b.PAGE_ITEM_PADDING_TOP=2;b.PAGE_ITEM_PADDING_BOTTOM=2;b.SUGGEST_DIV_PADDING_TOP=2;b.SUGGEST_DIV_PADDING_BOTTOM=2;b.MODE_FLAG_EXTERNAL_VALUE=1;b.MODE_FLAG_AUTOSIZE=2;b.MODE_FLAG_READONLY=4;b.MODE_FLAG_DISAPPEAR=8;b.MODE_FLAG_DISABLE_MULTIPAGE=16;b.MODE_FLAG_EMPTY_ITEM_APPEAR=32;b.SUBMIT_DELAY=500;b.prototype={activeInputValidateClass:null,createSuggester:function(){this.initOuterFrame();this.initInnerFrame();this.initData();this.initActiveDiv();this.initActiveInput();this.initSuggestDiv();this.initEmptyDiv();this.initSuggestButton();this.initFieldChange();this.initValidateClass();this.delegateEvent()},initOuterFrame:function(){var j=document.createElement("div");this.container=j;if(this.dataElement.style!=null){var i=function(k){k=k.toLowerCase();return k.indexOf("font")!=-1||k=="height"||k=="width"};var e=this.dataElement.style.cssText.split(";");for(var g=0;g<e.length;g++){var f=e[g].split(":");if(f.length==2){var h=$IU.trimString(f[0]);var d=$IU.trimString(f[1]);if(i(h)){$(j).css(h,d)}}}}this.dataElement.style.display="none";j.appendChild(this.dataElement);j.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_OUTER;if(this.isDisappear()){j.style.display="none"}},initInnerFrame:function(){var f=document.createElement("div"),d=$(f);this.inputDiv=f;$(f).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_INNER);d.css("width",this.container.style.width);var e=$(this.container).outerHeight();d.css("height",(e<22?24:(e+2))+"px");this.container.appendChild(this.inputDiv)},initData:function(){this.suggestData=[];this.suggestItems=[];this.currentLastPageNo=1;this.lastSubmitTime=0;this.lastInitialize=0;this.initializeInterval=30*1000;this.lastSubmitValue="";this.prefix=this.container.id;if(null==this.prefix||""==this.prefix){this.prefix=this.dataElement.id}this.prefix+=Math.round(Math.random()*1000)},initActiveDiv:function(){var d=document.createElement("div");d.setAttribute("id",this.prefix+"_activeDiv");d.setAttribute("class",InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_DIV);this.inputDiv.appendChild(d);this.activeDiv=d},initActiveInput:function(){var j=document.createElement("input");j.style.width="100%";if(this.dataElement.style!=null){if(this.dataElement.style.cssText!=null){var i=function(k){k=k.toLowerCase();return k.indexOf("font")!=-1||k=="height"};var e=this.dataElement.style.cssText.split(";");for(var g=0;g<e.length;g++){var f=e[g].split(":");if(f.length==2){var h=$IU.trimString(f[0]).toLowerCase();var d=$IU.trimString(f[1]).toLowerCase();if(i(h)){$(j).css(h,d)}}}}}j.setAttribute("id",this.prefix+"_activeInput");j.setAttribute("type","text");j.setAttribute("maxlength","100");$(j).data($Control.DATA_ORIGIN_INPUT,this.dataElement).data($Control.DATA_IS_CONTROL,true).css("display","block");if(this.isReadOnly()){j.setAttribute("readOnly","true")}j.value=this.text||"";j.setAttribute("class",this.getActiveInputClass(false));this.activeDiv.appendChild(j);this.activeInput=j},initSuggestDiv:function(){var d=document.createElement("div");d.id=this.prefix+"_suggestDiv";d.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV;d.style.display="none";$(d).attr("tabindex",Math.random()*1000+100000);this.activeDiv.appendChild(d);this.suggestDiv=d},initEmptyDiv:function(){var d=document.createElement("div");this.emptyDiv=d;d.id=this.prefix+"_emptyDiv";d.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV;d.style.backgroundColor="#eeeeee";this.setEmptyDivContent();d.style.display="none";this.activeDiv.appendChild(d)},initSuggestButton:function(){var e=document.createElement("div");var g=document.createElement("div"),d=$(g);e.setAttribute("class",InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_TIP_CONTAINER);d.attr("id",this.prefix+"_suggestButton").addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_BUTTON);switch(this.type){case"User":d.css("backgroundPosition","-80px 0px");break;case"Organize":d.css("backgroundPosition","-128px 0px");break;case"Code":default:d.css("backgroundPosition","0px 0px");break}var f=$(this.container).outerHeight();if(f!=0){d.css("top",((f-16)/2)+"px")}e.appendChild(g);this.activeDiv.appendChild(e);this.activeTip=e;this.suggestButton=g},initValidateClass:function(){var e=this.dataElement.className.split(" ");for(var d=0;d<e.length;d++){var f=e[d];if(f.substr(0,9)=="validate["){this.activeInputValidateClass=f;$(this.activeInput).addClass(f);$(this.dataElement).removeClass(f)}}},setSuggesterStyle:function(d,e){$IU.setDynamicStyle(this.container,d,e);$IU.setDynamicStyle(this.activeInput,d,e)},getSuggesterStyle:function(d){$IU.getElementStyle(this.container,d)},delegateEvent:function(){$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM,"mouseenter",{suggester:this},this.onSuggesterItemMouseEnter);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM,"mousedown",{suggester:this},this.onSuggesterItemMouseDown);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM,"click",{suggester:this},this.onSuggesterMoreItemClick);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_OUTER,"click",{suggester:this},this.onSuggesterContainerClick);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_INNER,"click",{suggester:this},this.onSuggesterContainerClick);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_BUTTON,"click",{suggester:this},this.onSuggesterContainerClick);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"blur",{suggester:this},this.onSuggesterActiveInputBlur);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"focus",{suggester:this},this.onSuggesterActiveInputFocus);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"keydown",{suggester:this},this.onSuggesterActiveInputKeyDown);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"keyup",{suggester:this},this.onSuggesterActiveInputKeyUp);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"keypress",{suggester:this},this.onSuggesterActiveInputKeyPress);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_BUTTON,"click",{suggester:this},this.onSuggesterButtonClick);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"focus",{suggester:this},this.onSuggesterDivFocus);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"blur",{suggester:this},this.onSuggesterDivBlur);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"mouseup",{suggester:this},this.onSuggesterDivMouseUp);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"mouseenter",{suggester:this},this.onSuggesterDivMouseEnter);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"mouseleave",{suggester:this},this.onSuggesterDivMouseLeave)},initFieldChange:function(){var d=this.field;if(d!=null){if(d.fieldChanging===true){this.onFieldChange=true}}},dispose:function(){this.field=null;this.suggestData=null;this.suggestItems=null;this.dataElement=null;if(this.container!=null){$(this.container).undelegate()}this.container=null;$(this.container).empty()},sayHello:function(){a.alert("hello, "+InfoPlus.Suggester.MESSAGE_INVALID)},isAutoSize:function(){return this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_AUTOSIZE)!=0},isAllowExtern:function(){return this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_EXTERNAL_VALUE)!=0},isReadOnly:function(){return(this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_READONLY)!=0)||this.dataElement.readOnly==true},isDisappear:function(){return this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_DISAPPEAR)!=0},isMultiPageDisabled:function(){return this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_DISABLE_MULTIPAGE)!=0},isEmptyItemAppear:function(){return this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_EMPTY_ITEM_APPEAR)!=0},setData:function(j,n,o,m){n=$IU.trimString(n);if(j==null){this.data=this.text=null}else{this.data=j.codeId!=null?j.codeId:j;if(null!=n){this.text=n}else{this.text=(null!=j.codeName)?j.codeName:j}}var h=$(this.dataElement).data($Control.DATA_CONTROL_OBJECT);var f=false;var l=this.getData();if(j==null||(!(l==j||l==j.codeId))){if(this.children!=null){for(var k=0;k<this.children.length;k++){this.children[k].setData(null)}}if(h.onFieldChange||h.onFieldRefer||h.onFieldSync){f=true}}if(null!=this.dataElement){var p=this.dataElement.tagName.toLowerCase();if("select"==p){var e=this.dataElement;e.options.length=0;var d=document.createElement("option");d.value=this.data||"";$(d).text(this.text);e.appendChild(d);d.value=this.data||""}else{this.dataElement.value=this.data||""}}this.activeInput.value=this.text||"";var g=null;if(j!=null&&j.attributes!=null){g=j.attributes}$(h.element).data(InfoPlus.Suggester.DATA_SUGGESTER_ATTRIBUTES,g);if(f===true){$(this.dataElement).change()}},getData:function(){if(this.dataElement==null){return""}return this.dataElement.value},setCursor:function(e,f){var d=e.createTextRange();d.collapse(true);d.moveStart("character",f);d.select()},activeFocus:function(){for(var d=0;d<1;d++){if(this.activeInput){this.activeInput.focus()}}},getActiveInputClass:function(e){var d=InfoPlus.Suggester.CLASSNAME_CONTROL;d+=" "+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT;if(this.activeInputValidateClass!=null){d+=" "+this.activeInputValidateClass}if(this.isReadOnly()){d+=" "+InfoPlus.Suggester.CLASSNAME_READONLY}else{if(e){d+=" "+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT_FOCUS}}return d},adjustView:function(){var h=function(j){var l=0;for(var k=0;k<j.length;k++){if((j.charCodeAt(k)<0)||(j.charCodeAt(k)>255)){l=l+2}else{l=l+1}}return l};if(this.isAutoSize()){var e=10;var g=h(this.activeInput.value);var f=((g/e)+1)*e*6+5;if(!this.isMobileView()){this.activeInput.style.width=f+"px"}else{var d=parseFloat($("html").css("font-size"));this.activeInput.style.width=(f*1/d*1.35)+"rem"}}else{this.activeInput.style.width="100%"}h=null},getSuggest:function(){for(var d=0;d<this.suggestItems.length;d++){if($(this.suggestItems[d]).hasClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT)){return d}}return -1},emptyItemIsSelected:function(){var d=this.getEmptyItem();if(d==null){return false}return $(d).hasClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT)},selectSuggesterItem:function(d){$(d).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_UNSELECT);$(d).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT)},unselectSuggesterItem:function(d){$(d).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT);$(d).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_UNSELECT)},requestCode:function(i,m){var n=this,f=$$.params.formRender.entity.codes,h=this.code,g=this.currentLastPageNo;var e=function(){if(i!=""){return false}if(g!==1){return false}if(h==null){return false}return(f[h]!=null&&f[h].codeType==="Internal")};var k=function(){if(f[h].cache!=null&&f[h].cache[m]!=null){return f[h].cache[m]}return null};var j=new Date().getTime();if(e()){var o=k();if(o!=null){this.onAjaxCallback(i,o,j);n.emptyDiv.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV;return}}this.lastSubmitTime=j;var l={formStepId:$$.params.formStepId==c?0:$$.params.formStepId,prefix:i,type:this.type,code:this.code||null,parent:m,isTopLevel:this.field.parent==null,pageNo:this.currentLastPageNo-1,rand:Math.random()*999,settings:$.toJSON(this.field.settings==null?{}:this.field.settings)};$$.ajax({type:"POST",url:this.suggestService,data:l,needParse:false,showParseErrMsg:false,showAjaxErrMsg:false}).done(function(d){n.onAjaxCallback(i,d,j);if(e()){if(f[h].cache==null){f[h].cache={}}f[h].cache[m]=d}}).always(function(){n.emptyDiv.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV})},suggestAjaxSubmit:function(){if(this.activeInput.value.length<this.suggestMinimizeSize){this.suggestData=[];this.suggestDiv.style.display="none";this.emptyDiv.style.display="block";this.setEmptyDivContent();return}if(this.suggestService!=""){this.emptyDiv.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV+" "+InfoPlus.Suggester.CLASSNAME_SUGGESTER_LOADING;this.changeLoadingStatus(true);var h=$(this.dataElement).data($Control.DATA_CONTROL_OBJECT);var g=h.parentValue;if(this.field.parent!=null&&g==null){var i=$IU.getReferedControlPaths(this.path);var f=this.field.parent;$(document).find("."+$Control.CLASSNAME_CONTROL).each(function(){var n=$(this).data($Control.DATA_CONTROL_OBJECT);if(n==null||n.path==null||n.field==null||n.field.name!=f){return}var k=n.path;var j=i.length;for(var l=0;l<j;l++){if(i[l]===k){var m=n.getValue();if(m instanceof $Controls.Data.ValuePair||m instanceof $Controls.Data.Uri){g=m.value}else{g=m}h.parentValue=g;return}}})}var d=this.activeInput.value,e=g==null?"":g;this.requestCode(d,e)}},onAjaxCallback:function(e,j,f){if(this.lastSubmitTime>f){return}if(this.focused===false){return}var k=function(){var n;if(j.items===c){if("undefined"!=typeof(JSON)){n=JSON.parse(j.d)}else{n=$.parseJSON(j.d)}}else{n=j}for(var o=0,i=n.items.length;o<i;o++){var p=n.items[o];p.codeName=$IU.trimString(p.codeName);p.description=$IU.trimString(p.description)}return n};this.changeLoadingStatus(false);var d=k();var l=(this.currentLastPageNo==1||this.suggestData==null)?0:this.suggestData.length;if(this.currentLastPageNo==1){this.suggestData=d.items;this.totalResults=d.total}else{for(var h=0;h<d.items.length;h++){this.suggestData[this.suggestData.length]=d.items[h]}if(d.items.length<InfoPlus.Suggester.PAGE_ITEM_COUNT){this.removeMoreItem()}}if(this.suggestData==null||this.suggestData.length==0){this.suggestData=[];this.totalResults=null;this.suggestDiv.style.display="none";this.emptyDiv.style.display="block";if(this.activeInput.value.length<this.suggestMinimizeSize){this.setEmptyDivContent()}else{this.emptyDiv.innerHTML=InfoPlus.Suggester.MESSAGE_INVALID}this.currentLastPageNo=1;return}if(d.items.length==0){if(this.currentLastPageNo>1){this.currentLastPageNo-=1;for(h=0;h<this.suggestData.length;h++){var m=this.suggestItems[h];if(m!=null){m.style.background=""}}this.adjustSuggestDiv((this.currentLastPageNo-1)*InfoPlus.Suggester.PAGE_ITEM_COUNT,InfoPlus.Suggester.PAGE_ITEM_COUNT);this.lastNextPageRequest=null;return}}this.suggestAjaxShow(l,e);var g=$(this.dataElement).data($Control.DATA_CONTROL_OBJECT);$$(g).fieldSuggested(e,d.items)},hasMoreItem:function(){if(this.isMultiPageDisabled()){return false}return $(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)!=null},shouldShowMoreItemInSuggestDiv:function(e,d){if(this.isMultiPageDisabled()){return false}var f=this.getMoreItem();if(f==null){return false}if(this.suggestItems.length<InfoPlus.Suggester.PAGE_ITEM_COUNT){return false}if(d<InfoPlus.Suggester.PAGE_ITEM_COUNT){return false}return(e+d>=this.suggestItems.length)},getMoreItem:function(){if(this.isMultiPageDisabled()){return null}return $(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)},removeMoreItem:function(){var d=this.getMoreItem();if(d!=null){$(d).remove();$(this.suggestDiv).removeData(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)}},changeLoadingStatus:function(f){for(var d=0;d<this.suggestItems.length;d++){var e=this.suggestItems[d];if(f){$(e).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_LOADING)}else{$(e).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_LOADING)}}},changeMoreItemIcon:function(e){var d=this.getMoreItem();if(d==null){return}if(e===true){$(d).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_DOWN);$(d).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_LOADING)}else{$(d).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_LOADING);$(d).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_DOWN)}},getEmptyItem:function(){return $(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_EMPTY_ITEM)},suggestAjaxShow:function(r,u){var o=function(w){var i=parseFloat($("html").css("font-size"));if(w==null){return 0}var H=0;for(var G=0;G<w.length;G++){if((w.charCodeAt(G)<0)||(w.charCodeAt(G)>255)){H=H+($$.MOBILE?i*1.2:13)}else{H=H+($$.MOBILE?Math.ceil(i*1.2/2):7)}}return H};var g=function(w,i){x=o(w);if(i<x){return x}return i};var j=function(L){var K=L.innerHTML;var H=K.split("<br>");var G=0;for(var I=0,w=H.length;I<w;I++){var J=o(H[I]);if(G<J){G=J}}return G};var F=function(H,G,i){var w=$IU.trimString(H.codeName);if(H.description!=null&&H.description!=""){w+="("+$IU.trimString(H.description)+")"}$(G).html('<div class="item_code_id">'+s($IU.trimString(H.codeId))+"</div>"+s(w)).addClass("infoplus_suggester_item_duplicated");w+=$IU.trimString(H.codeId);return g(w,i)};var p=function(w,J){var K={};for(var G=0,i=w.length;G<i;G++){E=w[G];if(E==null){continue}var I=$(E).data("code");var H=I.codeName;if(!K.hasOwnProperty(H)){K[H]=E}else{J=F(I,E,J);J=F($(K[H]).data("code"),K[H],J)}}return J};var h=function(K,J){var M=u.toLocaleLowerCase().split(/[ ]|,/);if(M.length==0){return{index:-1,len:0}}var G=-1,I=0;for(var H=0,w=M.length;H<w;H++){if(M[H].length==0){continue}var L=K.indexOf(M[H],J);if(L!=-1&&(G==-1||L<G)){G=L;I=M[H].length}}return{index:G,len:I}};var s=function(H){var w=H.toLocaleLowerCase(),i=0,G="";var I=h(w,i);while(I.index!=-1){G+=H.substring(i,I.index);G+="<u>"+H.substr(I.index,I.len)+"</u>";i=I.index+I.len;I=h(w,i)}G+=H.substr(i);return G};var e=function(w,I){for(var G=0,i=w.length;G<i;G++){E=w[G];if(E==null){continue}var H=$(E).data("code");var J=h(H.codeId.toLocaleLowerCase(),0);if(J.index!=-1){I=F(H,E,I)}}return I};var D=function(i){if(i>100000){return"大于10万"}if(i>10000){return"大于1万"}if(i>1000){return"大于1千"}return i};if(this.currentLastPageNo==1){this.suggestItems=[];$(this.suggestDiv).empty();if(this.isEmptyItemAppear()){var A=document.createElement("div");$(A).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM);A.innerHTML=InfoPlus.Suggester.MESSAGE_SUGGESTER_EMPTY_ITEM;$(A).data("code",null);this.suggestDiv.appendChild(A);$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_EMPTY_ITEM,A)}if(!this.isMultiPageDisabled()){$(this.suggestDiv).removeData(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM);if(this.suggestData.length>=InfoPlus.Suggester.PAGE_ITEM_COUNT){var l=document.createElement("div");$(l).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM);l.innerHTML=InfoPlus.Suggester.MESSAGE_SUGGESTER_MORE_ITEM;this.suggestDiv.appendChild(l);$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM,l)}}else{if(this.type=="User"){if(this.suggestData.length>=InfoPlus.Suggester.PAGE_ITEM_COUNT){l=document.createElement("div");$(l).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_USER);l.innerHTML=InfoPlus.Suggester.MESSAGE_SUGGESTER_MORE_USER.replace("%d",this.totalResults!=null?D(this.totalResults):this.suggestData.length);this.suggestDiv.appendChild(l);$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM,l)}else{$(this.suggestDiv).removeData(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)}}}}var C=(this.currentLastPageNo==1?0:parseInt($(this.suggestDiv).width())-20);var n=0;l=(this.type!="User")?this.getMoreItem():$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM);for(var y=0;y<this.suggestData.length;y++){if(y<r){var E=this.suggestItems[y];if(E!=null){E.style.background=""}}else{var f=this.suggestData[y];E=document.createElement("div");$(E).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_UNSELECT);$(E).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM);if(this.tipFormat!=null&&f.attributes!=null){$(E).attr("title",$IU.variablesFormat(this.tipFormat,f.attributes))}var z=$IU.trimString(f.codeName);if(null!=f.description&&""!=f.description){z+="("+$IU.trimString(f.description)+")"}var x=o(z);if(C<x){C=x}$(E).html(s(z));$(E).data("code",f);this.suggestItems[y]=E;if(l!=null){$(l).before(E)}else{this.suggestDiv.appendChild(E)}n++}}C=p(this.suggestItems,C);C=e(this.suggestItems,C);var t=this.activeInput.offsetWidth;if(l!=null){var m=j(l);if(t<m){t=m}}if(C>t){var q=C+20}else{q=t+20}if(!this.isMobileView()){$(this.suggestDiv).width(q)}else{var k=parseFloat($("html").css("font-size"));$(this.suggestDiv).width((q*1/k)+"rem")}this.suggestDiv.style.display="block";this.emptyDiv.style.display="none";if(this.currentLastPageNo!=1){var v;if(this.lastNextPageRequest.key=="down"){v=this.lastNextPageRequest.selectIndex+1}else{v=this.lastNextPageRequest.selectIndex>0?this.lastNextPageRequest.selectIndex+InfoPlus.Suggester.PAGE_ITEM_COUNT:InfoPlus.Suggester.PAGE_ITEM_COUNT}if(v>=this.suggestItems.length){v=this.suggestItems.length-1}var d=0;if(this.suggestItems.length-InfoPlus.Suggester.PAGE_ITEM_COUNT>0){d=this.suggestItems.length-InfoPlus.Suggester.PAGE_ITEM_COUNT}this.adjustSuggestDiv(d,InfoPlus.Suggester.PAGE_ITEM_COUNT);if(this.suggestDiv.style.display=="block"){this.changeSelectedSuggesterItemStyle(this.lastNextPageRequest.selectIndex,v)}this.lastNextPageRequest=null}else{if(this.suggestDiv.style.display=="block"){if(!this.isAllowExtern()){if(this.isEmptyItemAppear()){if(this.suggestData.length==1){this.selectSuggesterItem(this.suggestItems[0])}else{var B=false;for(y=0;y<this.suggestData.length;y++){if(this.activeInput.value==this.suggestData[y].codeName){this.selectSuggesterItem(this.suggestItems[y]);this.unselectSuggesterItem(this.getEmptyItem());B=true;break}}if(!B){this.selectSuggesterItem(this.getEmptyItem())}}}else{if(null!=this.suggestItems[0]){this.selectSuggesterItem(this.suggestItems[0])}}}this.adjustSuggestDiv(0,n)}}o=null},getSuggestDivScrollTop:function(d){if(d==null){return 0}return d.offsetTop-InfoPlus.Suggester.SUGGEST_DIV_PADDING_TOP},requestNextPage:function(d,e){if(this.lastNextPageRequest!=null){return}this.currentLastPageNo++;this.lastNextPageRequest={selectIndex:d,requestPageNo:this.currentLastPageNo,key:e};this.suggestAjaxSubmit()},containerClick:function(){if(this.isReadOnly()){return}if(this.activeInput){this.activeInput.focus()}},getCurrentPageTopIndex:function(){var e=this.getSuggest();var d=this.suggestItems;var g=e;while(g>=0){if(d[g].offsetTop-InfoPlus.Suggester.SUGGEST_DIV_PADDING_TOP<this.suggestDiv.scrollTop){g=g+1;break}g--}var f=g<0?0:g;return f},moveDownOneRow:function(d){var f=this.getCurrentPageTopIndex();var e=this.suggestItems;if(d||f+1<e.length){this.suggestDiv.scrollTop=this.getSuggestDivScrollTop(e[f+1])}},changeSelectedSuggesterItemStyle:function(d,e){if(this.isEmptyItemAppear()){if(d==-1){this.unselectSuggesterItem(this.getEmptyItem())}else{if(this.suggestItems[d]!=null){this.unselectSuggesterItem(this.suggestItems[d])}}if(e==-1){this.selectSuggesterItem(this.getEmptyItem())}else{if(this.suggestItems[e]!=null){this.selectSuggesterItem(this.suggestItems[e])}}}else{if(this.suggestItems[d]!=null){this.unselectSuggesterItem(this.suggestItems[d])}if(this.suggestItems[e]!=null){this.selectSuggesterItem(this.suggestItems[e])}}},isMobileView:function(){return $(document.body).hasClass("infoplus_mobile_view")},adjustSuggestDiv:function(j,g){var e=parseFloat($("html").css("font-size"));if(this.shouldShowMoreItemInSuggestDiv(j,g)){g++}var h=(this.isEmptyItemAppear()&&j==0);if(h){g++}if(!this.isMobileView()){var i=InfoPlus.Suggester.PAGE_ITEM_HEIGHT;if(this.type=="User"&&$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)!=null){var f=$($(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)).outerHeight()}var d=(g*i+8+(f!=null?f:0));this.suggestDiv.style.height=d+"px"}else{i=2;if(this.type=="User"&&$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)!=null){f=$($(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)).outerHeight()/e}d=(g*i+(8/e)+(f!=null?f:0));this.suggestDiv.style.height=d+"rem"}this.suggestDiv.scrollTop=h===true?0:this.getSuggestDivScrollTop(this.suggestItems[j])},activeInputKeyDown:function(m){this.activeInput.className=this.getActiveInputClass(true);var l=this.getSuggest(),f=this.suggestItems,e=this.suggestDiv,g,k,n;switch(m){case InfoPlus.Suggester.KEY_CODE_BACKSPACE:if(this.activeDiv.value==""){this.setData(null)}break;case InfoPlus.Suggester.KEY_CODE_UP:if(f[0]!=null&&e.style.display=="block"){if(l==-1){}else{var d=l-1;if(d<0){if(this.isEmptyItemAppear()){d=-1}else{d=0}}this.changeSelectedSuggesterItemStyle(l,d);if(d!=-1){if(f[d].offsetTop<this.suggestDiv.scrollTop){this.adjustSuggestDiv(d,InfoPlus.Suggester.PAGE_ITEM_COUNT)}}}}break;case InfoPlus.Suggester.KEY_CODE_DOWN:if(f[0]!=null&&e.style.display=="block"){if(l==-1){if(this.isEmptyItemAppear()){if(this.emptyItemIsSelected()){this.unselectSuggesterItem(this.getEmptyItem());this.selectSuggesterItem(f[0])}else{this.selectSuggesterItem(this.getEmptyItem())}}else{this.selectSuggesterItem(f[0])}}else{var i=l+1;if(i>=f.length){if(this.hasMoreItem()){this.moveDownOneRow(true);this.requestNextPage(l,"down")}return}this.changeSelectedSuggesterItemStyle(l,i);if(this.suggestDiv.scrollTop+this.suggestDiv.offsetHeight<f[i].offsetTop+InfoPlus.Suggester.PAGE_ITEM_HEIGHT){this.adjustSuggestDiv(i-InfoPlus.Suggester.PAGE_ITEM_COUNT+1,InfoPlus.Suggester.PAGE_ITEM_COUNT)}}}break;case InfoPlus.Suggester.KEY_CODE_PAGE_UP:if(this.isMultiPageDisabled()){return}g=l>0?(Math.floor(l/InfoPlus.Suggester.PAGE_ITEM_COUNT)+1):1;var h=g-1;k=l-InfoPlus.Suggester.PAGE_ITEM_COUNT;if(k<0){k=0;h=1}n=InfoPlus.Suggester.PAGE_ITEM_COUNT;if(h*InfoPlus.Suggester.PAGE_ITEM_COUNT>f.length){n=f.length%InfoPlus.Suggester.PAGE_ITEM_COUNT}this.adjustSuggestDiv((h-1)*InfoPlus.Suggester.PAGE_ITEM_COUNT,n);this.changeSelectedSuggesterItemStyle(l,k);break;case InfoPlus.Suggester.KEY_CODE_PAGE_DOWN:if(this.isMultiPageDisabled()){return}l=this.getSuggest();g=l>0?(Math.floor(l/InfoPlus.Suggester.PAGE_ITEM_COUNT)+1):1;f=this.suggestItems;k=l>0?l+InfoPlus.Suggester.PAGE_ITEM_COUNT:InfoPlus.Suggester.PAGE_ITEM_COUNT;if(k>=f.length&&this.hasMoreItem()){this.requestNextPage(l,"pageDown")}else{var j=g*InfoPlus.Suggester.PAGE_ITEM_COUNT;if(k>=f.length){k=f.length-1;if(j>=f.length){j=f.length-InfoPlus.Suggester.PAGE_ITEM_COUNT;if(j<0){j=0}}}n=InfoPlus.Suggester.PAGE_ITEM_COUNT;if(g==1){if(f.length<InfoPlus.Suggester.PAGE_ITEM_COUNT){n=f.length%InfoPlus.Suggester.PAGE_ITEM_COUNT}}this.adjustSuggestDiv(j,n);this.changeSelectedSuggesterItemStyle(l,k)}break}},setFocusToNextControl:function(e,d){var f=e.eq(d+1)[0];if(f==null){return}if(f.disabled||f.style.display=="none"){this.setFocusToNextControl(e,d+1)}else{$(f).trigger("focus")}},activeInputKeyPress:function(g){switch(g){case InfoPlus.Suggester.KEY_CODE_ENTER:var d=this.getSuggest();var f=this.activeInput.value;if(this.isEmptyItemAppear()&&d==-1){if(this.emptyItemIsSelected()){this.setData("")}else{if(this.isAllowExtern()){if(this.text!==f){this.setData(f,f,false,true)}}else{this.setData("")}}}else{var e=this.suggestDiv.style.display=="block"&&d!=-1&&this.suggestItems.length>0;if(e){this.setData(this.suggestData[d])}else{if(this.isAllowExtern()){if(this.text!==f){this.setData(f,f,false,true)}}else{}}}this.activeInputBlur();break}},activeInputKeyUp:function(d){this.adjustView();switch(d){case InfoPlus.Suggester.KEY_CODE_ESC:this.activeInput.value=this.text||"";this.activeInputBlur();break}},clearFocusFlag:function(){this.focused=false;this.activeInputOnFocus=false;this.suggestDivOnFocus=false;this.mouseInSuggestDiv=false;this.suggestDivScrolled=false},activeInputBlur:function(){this.clearFocusFlag();this.suggestDiv.style.display="none";this.emptyDiv.style.display="none";if(!this.isAllowExtern()){this.activeInput.value=this.text||""}else{if(this.dataElement.options[0].text!==this.activeInput.value){this.setData(this.activeInput.value,this.activeInput.value,false,true)}}this.activeInput.className=this.getActiveInputClass(false);this.activeInput.blur()},setEmptyDivContent:function(){if(this.type==$Control.DATA_TYPE_USER){this.emptyDiv.style.width=$$.MOBILE?"32rem":"320px";this.emptyDiv.innerHTML=InfoPlus.Suggester.MESSAGE_EMPTY_USER}else{this.emptyDiv.style.width=$$.MOBILE?"25rem":"250px";this.emptyDiv.innerHTML=InfoPlus.Suggester.MESSAGE_EMPTY}},activeInputFocus:function(){this.focused=true;this.activeInput.className=this.getActiveInputClass(true);this.activeDiv.style.position="relative";if(this.activeInput.value==""){this.emptyDiv.style.display="block";this.setEmptyDivContent()}else{this.emptyDiv.style.display="none"}this.currentLastPageNo=1;this.suggestAjaxSubmit()},onSuggesterItemMouseEnter:function(f){var e=f.data.suggester;for(var d=0;d<e.suggestItems.length;d++){e.unselectSuggesterItem(e.suggestItems[d])}if(e.isEmptyItemAppear()){e.unselectSuggesterItem(e.getEmptyItem())}e.selectSuggesterItem(this)},onSuggesterItemMouseDown:function(e){var d=e.data.suggester;d.setData($(this).data("code"));d.suggestDiv.style.display="none";d.emptyDiv.style.display="none";d.activeInput.className=d.getActiveInputClass(false);d.focused=false;d.activeInput.blur();return false},onSuggesterMoreItemClick:function(d){return false},onSuggesterContainerClick:function(e){var d=e.data.suggester;d.containerClick()},onSuggesterActiveInputKeyDown:function(e){var d=e.data.suggester;if(d.isReadOnly()){return false}d.activeInputKeyDown(e.keyCode);return e.keyCode!=InfoPlus.Suggester.KEY_CODE_PAGE_DOWN},onSuggesterActiveInputKeyUp:function(e){var d=e.data.suggester;if(d.isReadOnly()){return}d.activeInputKeyUp(e.keyCode)},onSuggesterActiveInputKeyPress:function(e){var d=e.data.suggester;if(d.isReadOnly()){return}d.activeInputKeyPress(e.keyCode);return e.keyCode!=InfoPlus.Suggester.KEY_CODE_ENTER},onSuggesterActiveInputFocus:function(f){var e=f.data.suggester;e.activeInputOnFocus=true;if(e.isReadOnly()){return}if(e.mouseInSuggestDiv==false){if($IU.shouldShowSuggesterPage()){$IU.clearAllError();var d=$(e.dataElement).data($Control.DATA_CONTROL_OBJECT);d.onSuggestPage=true;$IU.showSuggester2Page(d);return false}else{e.activeInputFocus();setTimeout($.proxy(e.submitSuggester,e),InfoPlus.Suggester.SUBMIT_DELAY)}}},onSuggesterActiveInputBlur:function(e){var d=e.data.suggester;d.activeInputOnFocus=false;if(d.isReadOnly()){return}if(d.mouseInSuggestDiv==false){d.activeInputBlur()}},onSuggesterDivFocus:function(e){var d=e.data.suggester;d.suggestDivOnFocus=true},onSuggesterDivBlur:function(e){var d=e.data.suggester;d.suggestDivOnFocus=false;if(d.activeInputOnFocus==false&&d.suggestDivScrolled==false){d.activeInputBlur()}},onSuggesterDivMouseUp:function(e){var d=e.data.suggester;d.suggestDivScrolled=true;d.activeInput.focus()},onSuggesterDivMouseEnter:function(e){var d=e.data.suggester;d.mouseInSuggestDiv=true},onSuggesterDivMouseLeave:function(e){var d=e.data.suggester;d.mouseInSuggestDiv=false},onSuggesterButtonClick:function(e){var d=e.data.suggester;if(d.isReadOnly()){return false}return false},submitSuggester:function(){if(this.focused){if(this.lastSubmitValue!==this.activeInput.value){this.currentLastPageNo=1;this.suggestAjaxSubmit();this.lastSubmitValue=this.activeInput.value}setTimeout($.proxy(this.submitSuggester,this),InfoPlus.Suggester.SUBMIT_DELAY)}}};define("InfoPlus.Suggester",b)})(window);
(function(b,c){var a={};a.DEFINITION_STATUS_ONLINE=1;a.DEFINITION_STATUS_OFFLINE=2;a.INSTANCE_STATE_UNKNOWN=-1;a.INSTANCE_STATE_CREATED=0;a.INSTANCE_STATE_ONLINE=1;a.INSTANCE_STATE_OFFLINE=2;a.INSTANCE_STATE_TERMINATED=3;a.INSTANCE_STATE_COMPLETE=4;a.STEP_STATE_TODO=1;a.STEP_STATE_DONE=2;a.STEP_STATE_DRAFT=3;a.STEP_TYPE_MANUAL="Manual";a.STEP_TYPE_AUTO="Auto";a.STEP_TYPE_SPLIT="Split";a.STEP_TYPE_JOIN="Join";a.STEP_TYPE_CONDITIONAL="Conditional";a.NOBODY_ACCOUNT="__INFOPLUS_SELECT_USER__";a.MESSAGE_CLICK_TO_UNBLOCK="点我关闭";a.MESSAGE_BOX_TITLE="SJTU InfoPlus";a.FILE_HANDLER="";define("InfoPlus.Settings",a)})(window);
(function(b,c){var a=function(d){this.initializeConfig(d);this.dynamicAnalyzer=new InfoPlus.Dynamics.Analyzer()};a.prototype={holder:null,entity:null,prefix:"infoplus_view_"+Math.round(Math.random()*9000+1000)+"_",selectedDiv:null,events:[],initializeConfig:function(d){this.config={};for(var e in d){if(d.hasOwnProperty(e)){if("function"!=typeof(d[e])){this.config[e]=d[e]}}}return this.assertConfig()},assertConfig:function(){var f=this.config.formStepId,g=this.config.workflowId;if(f===c&&g===c){return false}this.formStepId=f;var h=this.config.holderId;if(h===c){return false}var e=document.getElementById(h);if(e===null){return false}this.holder=e;var d=this.config.entity;if(d===c){return false}this.entity=d;if(this.config.suggest==null){return false}this.suggestService=this.config.suggest;if(this.config.suggestInitialize==null){return false}this.suggestInitializeService=this.config.suggestInitialize;if(this.config.fieldChange==null){return false}this.fieldChangeService=this.config.fieldChange;if(this.config.buttonService==null){return false}this.buttonService=this.config.buttonService;if(this.config.thingService==null){return false}this.thingService=this.config.thingService;if(this.config.tenantTimeZoneOffset==null){return false}this.tenantTimeZoneOffset=this.config.tenantTimeZoneOffset;this.discard();this.events=[];return true},dispose:function(){this.holder=null;this.entity=null;this.selectedDiv=null},addCssStyle:function(l){var m=l.styleSheet;var i=l.id+"_style";if($IU.isArray(m)){var h=null;if(document.getElementById(i)==null){h=document.createElement("style");h.type="text/css";h.media="all";h.id=i;document.getElementsByTagName("head")[0].appendChild(h);h=document.styleSheets[document.styleSheets.length-1]}else{for(var f=0;f<document.styleSheets.length;f++){h=document.styleSheets[f];if(h.id==i){break}}}if(h.rules){while(h.rules.length>0){h.removeRule(0)}}else{if(h.cssRules){while(h.cssRules.length>0){h.deleteRule(0)}}}for(f=0;f<m.length;f++){var e=m[f];if(h.rules){var k=e.split("{");var g=k[0].split(/,/);var d=k[1].split("}")[0];for(var j=0;j<g.length;j++){h.addRule(g[j],d)}}else{if(h.cssRules){if(!/\s$/.test(e)){h.insertRule(e,0)}}}}}},addCssStyleSheet:function(e){var h=e.styleSheetUri;if(null!=h&&""!=h){for(var d=0;d<document.styleSheets.length;d++){var f=document.styleSheets[d].href;if(null!=f&&f.length>=h.length){if(f.substr(f.length-h.length)===h){break}}}var j=e.id+"_cached_link";var g;if(d>=document.styleSheets.length){g=document.getElementById(j);if(null==g){g=document.createElement("link");g.type="text/css";g.media="all";g.rel="stylesheet";g.id=j;document.getElementsByTagName("head")[0].appendChild(g)}g.href=h}else{var i=document.styleSheets[d];g=i.ownerNode||i.owningElement||document.getElementById(j);document.getElementsByTagName("head")[0].removeChild(g);document.getElementsByTagName("head")[0].appendChild(g)}}},processEvent:function(){var e=this.entity.views.length>1;if(!$$.PREVIEW&&!$$.PRINT&&e===true){var d=function(){$IU.scrollTo($(this).data("view").offset().top-40,500)};$(".infoplus_view_label").click(d)}$(document.body).on("change","."+InfoPlus.Controls.Control.CLASSNAME_FIELD_CHANGE,{render:this},this.onFieldChange);$(document.body).on("focus","."+InfoPlus.Controls.Control.CLASSNAME_CONTROL,this.onFieldFocus)},createViewMenuLabel:function(j,l,k){var h=document.createElement("div");$(h).attr("id",this.prefix+"label_"+k);$(h).addClass("infoplus_view_label").addClass("round-corner").addClass("z-depth-0");$(h).text(j.name);$(h).data("view",$(l)).data("name",j.name).data("viewIndex",k);var e=j.name,i=new RegExp("[^\x00-\xff]"),g="";if(i.test(e.charAt(0))){g=e.charAt(0)}else{for(var d=0,f=e.length;d<f;d++){if(!i.test(e.charAt(d))){g+=e.charAt(d)}else{break}}}if(g.length>4){g=g.substr(0,4)}$(h).data("abstractName",g);l.appendChild(h)},appendViewDom:function(d){if(!$$.MOBILE){$(d).addClass("round-corner").addClass("z-depth-1");this.holder.appendChild(d)}else{var f=document.createElement("div");$(f).addClass("infoplus_view_wrap_inner");if($.browser.msie){$(f).css("top","17px")}f.appendChild(d);var e=document.createElement("div");$(e).addClass("infoplus_view_wrap_outer").addClass("z-depth-1");e.appendChild(f);this.holder.appendChild(e)}},processAutoWidthView:function(e,d){if(e.autoWidth===true&&e.width!==c){var f=$(d).find("table");f.each(function(){if($(this).parentsUntil(".infoplus_view").filter("table").length==0){var g=this.getAttribute("style");if(g!=null&&g!=""){g=g.replace("width:100%","width:98%");this.setAttribute("style",g)}}})}},addPrintPagination:function(e,d){$(e).css("page-break-before","always");$(e).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION).each(function(f){if(f!==0){if($(this).parentsUntil("#"+d).length===1){$(this).css("page-break-before","always")}}})},initVarControls:function(){var g=document.createElement("div");g.setAttribute("id","variables_container");$(this.holder).append(g);var f=this.entity.data;for(var d in f){if(f.hasOwnProperty(d)){if(d.substr(0,5)!="field"){$IU.addVariableControl(d,f[d])}}}var e=$IU.getParamFromUrl(b.location.href);$IU.addVariableControl("_VAR_URL",b.location.href,b.location.href,e);$IU.addVariableControl("_VAR_ENTRY_NAME",$$.params.instanceName);$IU.addVariableControl("_VAR_ENTRY_TAGS",$$.params.instanceTags)},initDynamicParallel:function(){if($$.params.dynamicParallel==null){return}var g=$$.params.dynamicParallel.splitPath;var j=$$.params.dynamicParallel.splitPathGroup;var f=function(m){var o="";for(var n=0;n<=m;n++){o+="_"+g[n]}return o};for(var h=0,e=j.length;h<e;h++){var l=j[h];var d=this.entity.groups[l].permission||"";d=d.replace(/[w|i|d]/g,"");this.entity.groups[l].permission=d;var k=f(h);$$("&"+l).each(function(){var o=this.getChildren(),n=true;for(var m=0,q=o.length;m<q;m++){var i=$(o[m]),p=this.getPath()+"_"+m;if(k===p){if(d.indexOf("r")!=-1){i.show();n=false}else{i.hide()}}else{if(d.indexOf("R")!=-1){i.show();i.find("."+$Control.CLASSNAME_CONTROL).each(function(){var r=$(this),s=r.data($Control.DATA_CONTROL_OBJECT);if(s!=null){s.setReadOnly()}});n=false}else{i.hide()}}}if(n){this.visible(false,true)}})}},convertSize:function(){var e=function(){var i=b.screen.width;if(i<600){var j=Math.floor(16+2*(i-375)/225)}else{if((i<1000)){j=Math.floor(18+4*(i-600)/400)}else{j=Math.floor(22+5*(i-1000)/1000)}}return j};var d=e();$("html").css("font-size",d+"px");var h=function(i){if(i==null||i.length<2){return null}return i.substr(i.length-2).toLocaleLowerCase()};var g=function(l,j){var k=h(l),i=parseFloat(l);if(isNaN(i)){return l}switch(k){case"cm":i=i*96/2.54;break;case"mm":i=i*9.6/2.54;break;case"in":i=i*96;break;case"pt":i=i*4/3;break;case"px":break;case"pc":i=i*12*4/3;break;default:return l}return(i/d*j)+"rem"};var f=function(i){switch(i){case"xx-small":case"1":case"x-small":case"2":return"12px";case"small":case"3":return"14px";case"medium":case"4":return"16px";case"large":case"5":return"18px";case"x-large":case"6":return"32px";case"xx-large":case"7":return"48px"}return null};this.eachLayout(function(l){if(l.renderType==="LayoutFont"){var s=-1;for(var p=0,r=l.attributes.length;p<r;p++){if(l.attributes[p]["key"]!=null&&l.attributes[p]["value"]!=null&&l.attributes[p]["key"].toLocaleLowerCase()=="style"){s=p}}for(p=0,r=l.attributes.length;p<r;p++){if(l.attributes[p]["key"]!=null&&l.attributes[p]["value"]!=null&&l.attributes[p]["key"].toLocaleLowerCase()=="size"){var t=f($IU.trimString(l.attributes[p]["value"]));if(t!=null){if(s!=-1){l.attributes[s]["value"]+=";font-size:"+t}else{l.attributes[p]["key"]="style";l.attributes[p]["value"]="font-size:"+t}}}}}if(l.attributes.length>0){for(p=0,r=l.attributes.length;p<r;p++){if(l.attributes[p]["key"]!=null&&l.attributes[p]["value"]!=null&&l.attributes[p]["key"].toLocaleLowerCase()=="style"){var v=l.attributes[p]["value"].split(";");var w=[];for(var q=0,n=v.length;q<n;q++){var k=v[q].split(":");if(k.length==2){var m=$IU.trimString(k[0]),y=$IU.trimString(k[1]);switch(m.toLocaleLowerCase()){case"height":case"min-height":if($$.MOBILE){w.push(m+":"+g(y,1.4))}break;case"font-size":y=f(y);if($$.MOBILE){if(y==null){y=$IU.trimString(k[1])}w.push(m+":"+g(y,1.2))}else{if(y!=null){w.push(m+":"+y)}}}}}var o="";for(var x=0,u=w.length;x<u;x++){o+=w[x]+";"}if(o!=""){var j=l.attributes[p]["value"];l.attributes[p]["value"]=l.attributes[p]["value"]+";"+o}}}}})},preProcessAutoViewWidth:function(d){var f=function(g){return g.key!=null&&g.value!=null};var e=function(h,l){var n=h.attributes[l]["value"].split(";");for(var k=0,j=n.length;k<j;k++){var g=n[k].split(":");if(g.length==2){var i=$IU.trimString(g[0]),o=$IU.trimString(g[1]);if(i.toLocaleLowerCase()=="width"){if(o.substr(o.length-1)!="%"){var m=parseInt(o,10);if(m<=d.width*1.1&&m>=d.width*0.9){h.attributes[l]["value"]=h.attributes[l]["value"]+";width:100%"}}}}}};this.eachLayout(function(k){if(k.renderType==="LayoutTable"){for(var j=0,g=k.attributes.length;j<g;j++){if(f(k.attributes[j])){if(k.attributes[j]["key"].toLocaleLowerCase()=="style"){e(k,j)}}}}if(k.renderType==="LayoutDivision"){var h=false;for(j=0,g=k.attributes.length;j<g;j++){if(k.attributes[j]["key"]!=null&&k.attributes[j]["value"]!=null){if(k.attributes[j]["key"].toLocaleLowerCase()=="class"&&k.attributes[j]["value"].indexOf("xdRepeatingSection")!=-1){h=true}if(k.attributes[j]["key"].toLocaleLowerCase()=="xctname"&&k.attributes[j]["value"].indexOf("RepeatingSection")!=-1){h=true}}}if(h){for(j=0,g=k.attributes.length;j<g;j++){if(f(k.attributes[j])){if(k.attributes[j]["key"].toLocaleLowerCase()=="style"){e(k,j)}}}}}},d)},createViews:function(){var h=this.entity.views,d=h.length,k=(d>1),g=[];if($$.MOBILE&&h.length>0&&h[0].mobile===true){this.convertSize()}this.findSyncFields();this.convertReadOnlyControls();this.findMasterDetailGroups();$$.params.printInvoice=$$.params.printInvoice&&this.findBoundThingControl();this.views=g;for(var j=0;j<d;j++){var f=h[j];if(f.autoWidth===true&&f.width!==c&&f.width<=$(b).width()){this.preProcessAutoViewWidth(f)}if(f.id==null){f.id=this.prefix+j}this.addCssStyle(f);this.addCssStyleSheet(f);var e=this.createView(f);if(e!=null){g.push(e);$(e).addClass("infoplus_view").data("view",f);if($$.MOBILE&&f.mobile===true){$(document.body).addClass("infoplus_mobile_view")}if(!$$.PREVIEW&&!$$.PRINT&&k===true){this.createViewMenuLabel(f,e,j)}if($$.PRINT&&j>0){this.addPrintPagination(e,f.id)}this.appendViewDom(e);this.processAutoWidthView(f,e)}}$(".infoplus_select2Control").each(function(){var i=$(this).data($Control.DATA_CONTROL_OBJECT);i.initSelect2()});this.initVarControls();this.initDynamicParallel()},findSyncFields:function(){var e=this,d={};this.eachLayout(function(f){var h=f.field;if(d.hasOwnProperty(h)){d[h].needSync=true}else{var g=e.getField(h);if(g!=null){d[h]=g}}},null,"Boundable")},convertReadOnlyControls:function(){if($$.params.tenantReadOnlyStyle=="None"){return}var d=this,f=["BoundEdit","BoundRichText","BoundDate","BoundSuggester","BoundSuggester2"];var e=function(g){g=g||"";return g.indexOf("r")!=-1&&g.indexOf("w")==-1};this.eachLayout(function(g){var h=d.getField(g.field);if(e(h.permission)&&$IU.arrayContains(f,g.renderType)){g.renderType="BoundConvertedLabel"}},null,"Boundable")},findBoundThingControl:function(){var d=false;this.eachLayout(function(e){if(e.renderType==="BoundThing"){d=true}},null,"Boundable");return d},findMasterDetailGroups:function(){if($$.PRINT){return}var l=this,f={};var j=function(p,o,n){if(!f.hasOwnProperty(p)){f[p]={}}if(o){f[p].rtRender=n}else{f[p].rsRender=n}};this.eachLayout(function(n){if(n.repeatable===true){var p=n.groupName,o=n.renderType=="LayoutTable";j(p,o,n)}},null,"Layoutable");var i=["BoundEdit","BoundRichText","BoundDate","BoundSuggester","BoundSuggester2","BoundSelect","BoundOption","BoundOptionList","BoundCheckList","BoundThing"];var m=function(p){if(p==null){return false}for(var o=0,n=i.length;o<n;o++){if(i[o]==p){return true}}return false};var h=function(o){var n=[];l.eachLayout(function(p){n.push(p.field)},o,"Boundable");return n};for(var d in f){if(f.hasOwnProperty(d)){if(f[d].rtRender!=null&&f[d].rsRender!=null){var k=l.entity.groups[d];k.isMasterDetail=true;var g=$.extend(true,{},f[d].rsRender);g.repeatable=false;f[d].rtRender.columns.push({renderType:"Renderable",renderCategory:"Renderable",width:0,attributes:[{key:"style",value:"WIDTH: 0px"}]});f[d].rtRender.renders[0].renders.push({renderCategory:"Layoutable",renderType:"LayoutTableCell",repeatable:false,attributes:[{key:"class",value:"detailCell"}],renders:[]});var e=h(g);this.eachLayout(function(n){if(m(n.renderType)){if($IU.arrayContains(e,n.field)){n.renderType="BoundLabel"}}},f[d].rtRender.renders[1],"Boundable");f[d].rtRender.renders[1].renders.push({renderCategory:"Layoutable",renderType:"LayoutTableCell",repeatable:false,attributes:[{key:"class",value:"detailCell"}],renders:[g]})}}}},draw:function(){var e=$.Deferred();if(null==this.holder||null==this.entity){return e.reject()}var g=$(this.holder);g.undelegate();g.empty();try{CollectGarbage()}catch(j){}if(this.entity.step!=null){document.title=(this.entity.step.name!=null?this.entity.step.name+" - ":"")+this.entity.workflowName;if($$.WECHAT){var f=$("body");var h=$("<iframe style='display:none;' src='/static/img/favicon.ico'></iframe>");h.on("load",function(){setTimeout(function(){h.off("load").remove()},0)}).appendTo(f)}}$$.dynamics.globalContext=$$.getGlobalContext(this.data);var d=this;var i=function(){var k=Array.prototype.slice.call(arguments);if(k.length>0){k[0].apply();k.splice(0,1);setTimeout(function(){i.apply(null,k)},0)}};this.doDynamicFormulaControls=[];i(function(){d.createViews();progress("正在加载页面",80)},function(){d.initDynamicStyles();progress("正在加载页面",83)},function(){d.initDynamicActions();progress("正在加载页面",87)},function(){d.initDynamicValues();progress("正在加载页面",90)},function(){$$.params.initControls=[];d.initFieldReferedClass();d.processEvent();d.triggerVarUrlChange();$$.codeManager.requestCodes();progress("正在加载页面",95);setTimeout(function(){e.resolve()},0)});return e.promise()},triggerVarUrlChange:function(){$("#_VAR_URL").change()},doDynamicFormulas:function(j){if(j==null){return}var g=$$.dynamics.formulas;for(var e=0,d=j.length;e<d;e++){var h=j[e],f=h.getDynamicKeyName();if(f==null){continue}if(g.hasOwnProperty(f)){h.setDynamicValue(this,true)}}},doDynamicStyles:function(j,k){var f=$$.dynamics.styles;for(var e=0,d=j.length;e<d;e++){var h=j[e],g=h.getDynamicKeyName();if(g==null){continue}if(f.hasOwnProperty(g)){h.setDynamicStyle(this,k)}}},doDynamicActions:function(j,k){var e=$$.dynamics.actions;for(var f=0,d=j.length;f<d;f++){var h=j[f],g=h.getDynamicKeyName();if(g==null){continue}if(e.hasOwnProperty(g)){h.doDynamicAction(this,k)}}},initDynamicValues:function(){this.doDynamicFormulas(this.doDynamicFormulaControls)},initDynamicStyles:function(){this.doDynamicStyles($IU.getAllControls(),true)},initDynamicActions:function(){this.doDynamicActions($IU.getAllControls(),true)},initFieldReferedClass:function(){var e=$$.dynamics.referedFormulas,d=$$.dynamics.referedStyles,f=$$.dynamics.referedActions;$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).each(function(){var g=$(this).data($Control.DATA_CONTROL_OBJECT);if(g==null||g.field===c){return}if(g.onFieldRefer===false){if(e[g.field.name]!==c||d[g.field.name]!==c||f[g.field.name]!==c){g.onFieldRefer=true;g.addFieldChangeClass()}}})},updateAllRowIndex:function(){$$.params.renderForm.find("."+$Control.CLASSNAME_ROWINDEX).each(function(){var d=this;setTimeout(function(){$(d).change()},0)})},getEntity:function(k,j,d){var h=j.split("_");h.shift();var g=d[k];if(g==null){return null}for(var f=0;f<h.length;f++){var e=parseInt(h[f]);if($IU.isArray(g)&&e<g.length){g=g[e]}else{return null}if(g==null){return null}}return g},setEntity:function(d,k,m,e,j){if(null==e){e=this.data}var l=[];var g;if(null!=m&&""!=m.length){l=m.split("_");g=0;var n=l[g];while(null!=n){if($IU.trimString(n)==""){l.splice(g,1)}else{g++}n=l[g]}}if(l.length>0){g=0;if(null==e[k]){e[k]=[]}var f=e[k];var h;while(g<l.length-1){h=parseInt(l[g++]);if(null==f[h]){f[h]=[]}f=f[h]}h=parseInt(l[l.length-1]);if(null==d){f.splice(h,1)}else{if(f[h]==null||!j){f[h]=d}}}else{if(e[k]==null||!j){e[k]=d}}return e},diceLayout:function(e){var d=[];this.eachLayout(function(f){var g=f.field;if(g!=null&&!$IU.arrayContains(d,g)){d.push(g)}},e,"Boundable");return d},createView:function(e){var d=this.createLayout(e,this.data,"");d.id=e.id;return d},createDisplayElement:function(h){var g;switch(h.renderType){case"DisplayText":g=document.createTextNode(h.text);break;case"DisplayBreak":g=document.createElement("br");break;case"DisplayAnchor":g=document.createElement("a");g.setAttribute("href",h.uri||"");g.setAttribute("target","_blank");$(g).text(h.text||"");break;case"DisplayImage":g=document.createElement("img");g.setAttribute("border","0");if(h.uri!=null){g.setAttribute("src",$$.params.baseUrl+"file/form/"+this.entity.viewId+"/"+h.uri)}if(h.attributes!=null){for(var f=0,e=h.attributes.length;f<e;f++){var d=h.attributes[f];if(d.key=="style"){g.setAttribute("style",d.value);break}}}break}return g},createLayout:function(v,x,r){var u=function(i){if(i!=null&&i.renders!==c&&i.renders.length>0&&i.renders[0].text!==c){return i.renders[0].text}return null};var e=this.createLayoutElement(v);var h=e;this.createAttributes(e,v.attributes);if(v.renderType=="LayoutTable"){var d=document.createElement("tbody");e.appendChild(d);h=d}var o=v.renders;var n=false;for(var t=0;t<o.length;t++){var y=o[t];if(y==null){continue}var s=y.renderCategory;if(s==null){continue}var k;switch(s){case"Boundable":k=this.createControl(y,x,r);if(h!=null&&k!=null){h.appendChild(k)}break;case"Displayable":k=this.createDisplayElement(y);if(h!=null&&k!=null){h.appendChild(k)}break;case"Layoutable":if(y.repeatable===true){var m=h,q=(y.renderType=="LayoutTable"),g=q?this.diceLayout(y.renders[1]):this.diceLayout(y);var j=g.length>0?g[g.length-1]:null;var p=y.groupName;if(p==null){$IU.messageBox(null,"重复节表缺少必要的名称",null,250);break}var l=this.entity.groups[p];if(l.isMasterDetail===true&&!q){l.detailRender=y}else{var f=u(o[t+1]);var w=new InfoPlus.Repeat.RepeatControl({initData:x,formRender:this,render:y,path:r,repeatParentElement:m,repeatContentParentElement:m,firstControlNamePrefix:j,repeatType:q?InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE:InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_SECTION,addLinkText:f,fieldNames:g,groupInformation:l});this.dynamicAnalyzer.analysisDynamic(y.properties,w.getDynamicKeyName(),w.rowIndexFieldName,w.groupCountFieldName)}n=true}else{if(n===true){n=false}else{k=this.createLayout(y,x,r);if(h!=null){h.appendChild(k)}}}break}}return e},createColGroup:function(h,j){var g=h.columns;if(g!=null){var d=document.createElement("colgroup");for(var f=0;f<g.length;f++){var e=document.createElement("col");if(g[f].width>0){e.width=g[f].width}this.createAttributes(e,g[f]["attributes"]);d.appendChild(e)}j.appendChild(d)}},createLayoutElement:function(e){var d=null;switch(e.renderType){case"FormView":case"LayoutDivision":d=document.createElement("div");break;case"LayoutTable":d=document.createElement("table");this.createColGroup(e,d);break;case"LayoutTableRow":d=document.createElement("tr");break;case"LayoutTableCell":d=document.createElement("td");break;case"LayoutHeader":d=document.createElement("h"+e.size);break;case"LayoutFont":d=document.createElement("font");break;case"LayoutPhrase":switch(e.phraseType){case"Emphasized":d=document.createElement("em");break;case"Strong":d=document.createElement("strong");break;case"Definition":d=document.createElement("dfn");break;case"Code":d=document.createElement("code");break;case"Keyboard":d=document.createElement("kbd");break;case"Sample":d=document.createElement("samp");break;case"Variable":d=document.createElement("var");break;case"Citation":d=document.createElement("cite");break;case"Superscript":d=document.createElement("sup");break;case"Subscript":d=document.createElement("sub");break;case"Underline":d=document.createElement("u");break;case"Italic":d=document.createElement("i");break;case"Small":d=document.createElement("small");break;case"StrikeThrough":d=document.createElement("s");break;case"Big":d=document.createElement("big");break}break;case"LayoutOrderedList":d=document.createElement("ol");break;case"LayoutUnorderedList":d=document.createElement("ul");break;case"LayoutListItem":d=document.createElement("li");break;case"LayoutAnchor":d=document.createElement("a");d.setAttribute("href",e.uri||"");d.setAttribute("target","_blank");break;default:d=document.createElement("div")}return d},getDisplayText:function(f,g,h,e){var i;if(g[e+"_displayText"]!=c){i=g[e+"_displayText"]}else{var d=f.fieldText||e+"_Name";i=this.getEntity(d,h,this.data)}return i},getAttributeValue:function(f,g,e){if($$.params.initializing===true){var d=this.getEntity(g+"_Attr",f,this.data);if(d!=null){return $.parseJSON(d)}}if(e!=null&&e.hasOwnProperty(g+"_Attr")){return e[g+"_Attr"]}return null},getParentValue:function(f,g,e){var d=this.getAttributeValue(f,g);if(d!=null){return d._parent}if(e!==c){return this.getParentValueOrAttributes(f,e,true)}return null},getParentValueOrAttributes:function(k,j,d){var l=[],e=k.split("_");l.push("");for(var f=1;f<e.length;f++){l.push(l[l.length-1]+"_"+e[f])}var h=l.pop(),g=null;while(h!==c){g=(d===true)?this.getEntity(j,h,this.data):this.getAttributeValue(h,j);if(g!=null){break}h=l.pop()}return g},getParentAttributes:function(e,d){return this.getParentValueOrAttributes(e,d,false)},getField:function(e){var d=null;if(null!=e&&null!=this.entity.fields){d=this.entity.fields[e]}return d},createControl:function(d,g,l){var j=d.field;if(j==null){return null}var i=this.getField(j);if(i==null){return null}var e=g[j],k="",h=null;if(e!==c&&e!=""){k=this.getDisplayText(d,g,l,j)}if(i.parent!==c){h=this.getParentValue(l,j,i.parent)}var f=this.getAttributeValue(l,i.name,g);return this.createControlElement(l,i,d,e,k,h,f)},getSelectDataSource:function(e){var d=null;if(e.code!=null){if(this.entity.codes[e.code]!=null){d=this.entity.codes[e.code].items}}return d},createControlElement:function(m,i,d,j,k,h,e){var g=null;var f=null;switch(d.renderType){case $Control.CONTROL_TYPE_EDIT:f=new $Controls.Edit(m,i,d,j);break;case $Control.CONTROL_TYPE_PASSWORD:f=new $Controls.Password(m,i,d,j);break;case $Control.CONTROL_TYPE_TEXT:f=new $Controls.Text(m,i,d,j);break;case $Control.CONTROL_TYPE_DATE:f=new $Controls.Date(m,i,d,j);break;case $Control.CONTROL_TYPE_CHECKBOX:f=new $Controls.Check(m,i,d,j);break;case $Control.CONTROL_TYPE_CHECKBOX_LIST:f=new $Controls.CheckList(m,i,d,j);break;case $Control.CONTROL_TYPE_RADIO:if(i.type==$Control.DATA_TYPE_BOOL){f=new $Controls.RadioGroup(m,i,d,j)}else{f=new $Controls.Radio(m,i,d,j)}break;case $Control.CONTROL_TYPE_RADIO_LIST:f=new $Controls.RadioList(m,i,d,j,k,h,e);break;case $Control.CONTROL_TYPE_SELECT:f=new $Controls.Select(m,i,d,j,k,h,e);break;case $Control.CONTROL_TYPE_REMARK:f=new $Controls.Remark(m,i,d,j);break;case $Control.CONTROL_TYPE_BUTTON:f=new $Controls.Button(m,i,d,j);break;case $Control.CONTROL_TYPE_LINK_BUTTON:f=new $Controls.LinkButton(m,i,d,j);break;case $Control.CONTROL_TYPE_ANCHOR:f=new $Controls.Anchor(m,i,d,j,k);break;case $Control.CONTROL_TYPE_LABEL:f=new $Controls.Label(m,i,d,j,k,e);break;case $Control.CONTROL_TYPE_CONVERTED_LABEL:f=new $Controls.Label(m,i,d,j,k,e,true);break;case $Control.CONTROL_TYPE_HIDDEN:f=new $Controls.Hidden(m,i,d,j,k,e);break;case $Control.CONTROL_TYPE_SUGGESTER:var l=(i.code!=null)?this.entity.codes[i.code].tipFormat:null;f=new $Controls.Suggester(m,i,d,this,j,k,h,l,this.suggestService,this.suggestInitializeService,e);break;case $Control.CONTROL_TYPE_SUGGESTER2:f=new $Controls.Suggester2(m,i,d,j,k,h,this.suggestService,e);break;case $Control.CONTROL_TYPE_FILE:f=new $Controls.File(m,i,d,j);break;case $Control.CONTROL_TYPE_HELP:f=new $Controls.Help(m,i,d,j);break;case $Control.CONTROL_TYPE_IMAGE:f=new $Controls.Image(m,i,d,j);break;case $Control.CONTROL_TYPE_PICTURE:f=new $Controls.Picture(m,i,d,j);break;case $Control.CONTROL_TYPE_IFRAME:f=new $Controls.Iframe(m,i,d,j);break;case $Control.CONTROL_TYPE_THING:f=new $Controls.Thing(m,i,d,j,k,e);break}if(f!=null){this.dynamicAnalyzer.analysisDynamic(d.properties,f.getDynamicKeyName(),f.getGroupRowIndexName(),f.getGroupCountName(),i.parent);g=f.getControlContainer();$$.registerControlEvents(f);if(!(f instanceof $Controls.Edit)){$(f.element).removeClass("xdTextBox");$(g).removeClass("xdTextBox")}}return g},createAttributes:function(j,f){if(j==null){return}if(f==null||f.length==null||f.length==0){return}var h=function(){if(j.nodeName==null){return false}var i=j.nodeName.toLocaleLowerCase();return i=="table"||i=="tbody"||i=="tr"||i=="td"||i=="th"};var g=function(s){if(s==null||s==""){return""}if(s.toLocaleLowerCase().indexOf("min-height")==-1){return s}var q=s.split(";");var r=[];for(var o=0,n=q.length;o<n;o++){var p=$IU.trimString(q[o]);if(p!==""){if(p.toLocaleLowerCase().indexOf("min-height")==-1){r.push(p)}}}return r.join(";")};for(var k=0;k<f.length;k++){var d=f[k];var l=d.key;if(null!=d.namespace&&""!=d.namespace){l=d.namespace+":"+l}try{switch(l.toLocaleLowerCase()){case"class":$(j).addClass(d.value);break;case"onclick":case"value":break;case"style":if(h()){var m=g(d.value);if(m!=""){j.setAttribute(l,m)}}else{j.setAttribute(l,d.value)}break;default:j.setAttribute(l,d.value);break}}catch(e){}}},saveAttributes:function(h,j,g,e,i){var d=h.getAttributes(),f=h.getParentValue();if(d!=null||f!=null){if(d==null){d={}}if(f!=null){d._parent=f}}if(d!=null){this.setEntity($.toJSON(d),j+"_Attr",g,e,i)}},save:function(f,k){if(k===c){k=false}if(null==this.holder||null==this.entity){return f}if(null==f){var h=this.entity.fields;for(var m in h){if(h.hasOwnProperty(m)){if(this.data.hasOwnProperty(m)){delete this.data[m]}if(this.data.hasOwnProperty(m+"_Name")){delete this.data[m+"_Name"]}if(this.data.hasOwnProperty(m+"_Attr")){delete this.data[m+"_Attr"]}}}f=this.data}var d=$("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT);for(var g=0,j=d.length;g<j;g++){var e=$(d[g]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(e==null){continue}this.setEntity(e.keyIndex,e.groupName,e.path,f,false)}var l=this;$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).each(function(){var i=$(this);if(i.hasClass($Control.CLASSNAME_ROWINDEX)){return}if(i.hasClass($Control.CLASSNAME_GROUP_COUNT)){return}var p=i.data($Control.DATA_PATH);var o=i.data($Control.DATA_FIELD);var n=i.data($Control.DATA_CONTROL_OBJECT);if(o!=null&&n!=null){var r=(k===true&&!n.isDetailControl())||(k===false&&n.isDetailControl());var q=n.getValue();if(q instanceof $Controls.Data.ValuePair){l.setEntity(q.value,o,p,f,r);l.setEntity(q.displayValue,o+"_Name",p,f,r);l.saveAttributes(n,o,p,f,r)}else{if(q instanceof $Controls.Data.Uri){l.setEntity(q.value,o,p,f,r)}else{if(q!=null){l.setEntity(q,o,p,f,r)}}}}});return f},discard:function(){if(null==this.entity.data){this.entity.data={}}this.data=$.extend(true,{},this.entity.data)},eachLayout:function(s,m,f){if(null==m){var h=[];for(var j=0;j<this.entity.views.length;j++){var r=this.entity.views[j];if(null!=r){var k=this.eachLayout(s,r,f);for(var g=0;g<k.length;g++){h.push(k[g])}}}return h}var o=[];if(null==f||f==m.renderCategory){if(typeof s=="function"){s(m)}o.push(m)}var q=[];var p=m;while(null!=p){var d=p.renders;for(j=0;j<d.length;j++){var e=d[j];var l=e.renderCategory;if(null==f||f==e.renderCategory){if(typeof s=="function"){s(e)}o.push(e)}if(l=="Layoutable"){q.push(e)}}p=q.pop()}return o},onFieldChange:function(f){if($$.params.fieldSyncing===true){return}var g=$(this).data($Control.DATA_SOURCE_CONTROL);if(g===c){g=$(this).data($Control.DATA_CONTROL_OBJECT)}if(g!=null){var e=f.data.render;var d=function(){if($$.params.fieldChanging!=null&&!g.clickFireFieldChange){return}var h={};h=e.save(h,g.isDetailControl());g.fieldChangeEvent(h).done(function(){$$.dynamics.cache.build();e.doDynamicStyles($IU.getAllControls(),false);e.doDynamicActions($IU.getAllControls(),false);e.updateAllRowIndex()}).done(function(){$$.fieldChanged($$(g))}).done(function(){$$(g).fieldChanged()}).always(function(){if(g instanceof $Controls.Button){$(g.element).removeAttr("disabled")}if(g instanceof $Controls.LinkButton){$(g.element).removeAttr("disabled")}})};if(g.onFieldSync){g.fieldSyncEvent()}if(g.onFieldRefer){$$.dynamics.cache.build();g.fieldReferEvent(e,true,true,true,true,true);$$.fieldRefered($$(g));$$(g).fieldRefered()}if(g.onFieldChange&&($$.params.fieldChanging==null||g.clickFireFieldChange)){if(g.onFieldRefer){setTimeout(d,200)}else{d()}}}},onFieldFocus:function(d){var e=$(this).data($Control.DATA_SOURCE_CONTROL);if(e==null){e=$(this).data($Control.DATA_CONTROL_OBJECT)}if(e==null){e=$($(this).data($Control.DATA_ORIGIN_INPUT)).data($Control.DATA_CONTROL_OBJECT)}if(e!=null){e.showTooltip()}}};define("InfoPlus.FormRender",a)})(window);
(function(b,c){var a=function(d){this.initializeConfig(d)};a.prototype={remarkHolder:null,progressHolder:null,entity:null,stepId:null,instanceId:null,onDelete:null,prefix:"infoplus_remark_"+Math.round(Math.random()*9000+1000)+"_",initializeConfig:function(d){this.config={};for(var e in d){if(d.hasOwnProperty(e)){if("function"!=typeof(d[e])){this.config[e]=d[e]}}}this.remarkHolder=$("#form_remark_holder")[0];this.progressHolder=$("#form_progress_holder")[0];this.entity=this.config.entity;this.stepId=this.config.stepId;this.instanceId=this.config.instanceId;this.onDelete=d.onDelete;this.userId=this.config.userId;this.readOnly=this.config.readOnly;this.preferredWidth=this.config.preferredWidth;this.administrable=this.config.administrable},getUserName:function(e,d){var f=e.trueName||e.userName||"";if(f==""){if(!this.readOnly){f=d?"您":"相关用户"}else{f="相关用户"}}else{if(e.userName==this.userId){f="您("+f+")"}}return f},getActionDescription:function(d,e){var f;if(e==null){switch(d){case InfoPlus.Settings.STEP_STATE_TODO:case InfoPlus.Settings.STEP_STATE_DRAFT:f="正在填写/办理";break;default:f="填写/办理了"}}else{f="办理了";switch(e){case"INSTANCE_ADMIN":f+="数据管理";break;case"INSTANCE_KILL":f+="终止";break;case"INSTANCE_WITHDRAW":f+="撤回";break}}return f},sortSteps:function(){var h=[],l=[],m=this.entity.remarks,e=this.entity.activities,g,n;var o=function(i,q){var s=i.length;for(var r=0;r<s;r++){if(i[r].actionDate>q.actionDate){break}}i.splice(r,0,q)};if(this.administrable){for(var j=0,k=e.length;j<k;j++){var f=e[j];m.push({actionDate:f.timestamp,trueName:f.user.name,userName:f.user.id,activityType:f.tags,remark:f.description})}}for(j=0,k=m.length;j<k;j++){var d=m[j];if(d.actionDate!==c){if(!this.administrable&&d.withdrawTo!=null){continue}o(h,d)}else{if(d.formStepId==this.stepId){g=d}else{o(l,d)}}}var p=function(){if(h.length>0){var i=h[h.length-1];if(i.activityType==="INSTANCE_KILL"){return true}}return false};if(!p()){n=h.concat(l);if(g!==c){n.push(g)}}else{n=h}return n},drawRemarks:function(){if(this.remarkHolder==null||this.entity==null){return}var w=$(this.remarkHolder);var u=function(i,H){var K=document.createElement("div"),J=document.createElement("div"),I=document.createElement("span");$(J).css("height","0px");$(I).addClass("moreHistory").html("<i class='i-icon-angle-double-down'></i> 点击展开"+i+"个较早历史").attr("title","点击展开历史");if(H){$(K).addClass("lastMore")}$(K).click(function(){$(this).hide();$(this).nextAll().not(".remark_admin,.remark_withdraw,.remark_withdrawn,.remark_kill").filter("li:lt("+$(this).data("hideHistoryCount")+")").show("slide",{direction:"up"},"slow",function(){w.css("height","100%")});$(this).prev("li").css("border-bottom","")});J.appendChild(I);K.appendChild(J);$(K).data("hideHistoryCount",i);return K};var D=function(H){var I=function(){return $(this).css("display")!="none"&&(!$(this).hasClass("remark_admin")&&!$(this).hasClass("remark_withdraw")&&!$(this).hasClass("remark_withdrawn")&&!$(this).hasClass("remark_kill"))};if(H!=null){var i=$(H).prevAll().filter(I);return i.first()}else{return $(y).children("li").filter(I).last()}};w.hide();var A=this.sortSteps();w.empty();var y=document.createElement("ul");var E=0,x=true;for(var z=A.length-1;z>=0;z--){var l=A[z];var t=this.readOnly?false:(this.stepId==l.formStepId),o=(z===0);if(t===true&&A.length>1){continue}var k=l.remark!=null&&$IU.trimString(l.remark)!="";var C=document.createElement("li");if(z==0){$(C).css("border-bottom","0")}var m=document.createElement("div");$(m).addClass("form_remark_title").addClass("clearFix");var s=l.stepName||"";var n=this.getUserName(l,t);var F=this.getActionDescription(l.status,l.activityType);switch(l.activityType){case"INSTANCE_ADMIN":$(C).addClass("remark_admin");break;case"INSTANCE_WITHDRAW":$(C).addClass("remark_withdraw");break;case"INSTANCE_KILL":$(C).addClass("remark_kill");if(x){$(C).css("display","block")}break;default:if(l.withdrawTo!=null){$(C).addClass("remark_withdrawn")}else{$(C).css("display","block")}break}if(l.thing==null){if(l.activityType!=null){m.innerHTML="<span class='color_b4' style='float:left'><b>"+n+"</b>   "+F+"</span>"}else{var j=l.actionName!=null?"(<span class='color_b3'><b>"+l.actionName+"</b></span>)":"";m.innerHTML="<span class='color_b2' style='float:left;"+(l.withdrawTo!=null?"text-decoration:line-through":"")+"'><span class='"+(t?"color_o1":"")+"'><b>"+n+"</b></span>   "+F+"<b>"+s+"</b>"+j+"</span>"}}else{if(l.activitytype!=null){m.innerHTML="<span class='color_b4' style='float:left'><b>"+n+"</b>   "+F+"</span>"}else{s=l.stepName!=null?"(<span class='color_b3'><b>"+l.stepName+"</b></span>)":"";if(l.actionName!=null){m.innerHTML="<span class='color_b2' style='float:left;"+(l.withdrawTo!=null?"text-decoration:line-through":"")+"'><span class='"+(t?"color_o1":"")+"'><b>"+n+"</b></span>   <span class='color_b4' style='font-weight:bold'>"+l.actionName+"了</span>"+l.thing.thingName+s+"</span>"}else{m.innerHTML="<span class='color_b2' style='float:left;'><span class='"+(t?"color_o1":"")+"'><b>"+n+"</b></span>   <span class='color_b4' style='font-weight:bold'>正在接收</span>"+l.thing.thingName+s+"</span>"}}var d=document.createElement("span");var B=document.createElement("i");$(B).addClass("i-icon-truck");$(d).append(B).css("float","left").css("width","30px").addClass("color_b4");$(m).addClass("thing").prepend(d)}if(!t){var v="yyyy/MM/dd hh:mm";var p=document.createElement("span");$(p).addClass("form_remark_time");if(l.creationDate!=null){var h=new Date(l.creationDate*1000);var e="创建时间:"+$IU.dateFormat(h,v)}else{e=""}if(l.actionDate!=null){var r=new Date(l.actionDate*1000);e+=("  完成时间:"+$IU.dateFormat(r,v))}var G=null==l.actionDate?l.creationDate:l.actionDate;p.innerHTML=$IU.dateFormat(new Date(G*1000),v);p.title=e;var f=(new Date()).getTime();if((f-G*1000)<1000*3600*24){$(p).attr("datetime",$IU.getDateIsoString(new Date(G*1000)));$(p).addClass("remark_display_time")}m.appendChild(p)}C.appendChild(m);if(k){var g=document.createElement("div");$(g).addClass("form_remark_content");if(l.activityType!=null){$(g).addClass("activity")}var q=$IU.htmlEncode(l.remark||"");$(g).html(q);C.appendChild(g)}else{if(l.activityType==null&&l.withdrawTo==null&&!x){$(C).css("display","none");E++}}x=false;y.appendChild(C);if(E>0){if(k&&!(l.activityType==="INSTANCE_ADMIN"||l.activityType==="INSTANCE_WITHDRAW"||l.activityType==="INSTANCE_KILL"||l.withdrawTo!=null)){if(E!=1){D(C).after(u(E,false))}else{$(C).prev().show()}E=0}else{if(o){if(E!=1){D(C).after(u(E,true))}else{$(C).show()}E=0}}}}D().css("border-bottom","0");this.remarkHolder.appendChild(y);if(w.children("ul").children().length>0){w.show()}$("span.remark_display_time").timeago({selector:"span.remark_display_time"})},draw:function(){this.drawRemarks()}};define("InfoPlus.RemarkRender",a)})(window);
(function(a,c){var b=function(d){this.milestones=d.milestones;this.status=d.status;this.milestoneHolder=$("#form_milestone_holder")[0]};b.prototype={milestoneHolder:null,status:null,drawMilestone:function(){var y=$(this.milestoneHolder),s=y.find(".form_milestone_holder_wrap_inner"),l=s.children(".form_milestone_view");if(this.milestones==null||this.milestones.length==0){y.remove();return}if(this.milestoneHolder==null){return}var t=(this.status==="done");var u=function(i,D){var C="gray";if(i===true||(D===true&&t)){C="green"}else{if(D===true){C="blue"}}return C};y.hide();l.empty();var r=this.milestones;for(var A=0,B=r.length,j="";A<B;A++){var h=r[A];var n=document.createElement("li"),p=$(n);var x=u(h.done,h.current);p.addClass("form_milestone_step").addClass(x);if(A===0){p.addClass("first")}if(A===(B-1)){p.addClass("last")}var w=document.createElement("div"),k=$(w);k.addClass("floater").addClass(x);var d=document.createElement("div"),f=$(d);f.addClass("content");var v=document.createElement("div");$(v).text(h.name);$(v).addClass("content_name");f.append(v);var q=document.createElement("div");$(q).addClass("milestone_tip").addClass("round-corner").addClass("z-depth-1");if(h.current===true&&!t){k.addClass("singleLine");$(q).text("您正在办理此步").addClass("singleLine")}else{if(h.done===true||(h.current===true&&t)){if(h.actionTime!==c){k.addClass("doubleLine");var m=document.createElement("div");$(m).attr("datetime",$IU.getDateIsoString($IU.unixTimeToLocalTime(h.actionTime))).addClass("content_time");f.append(m);$(q).text("该步执行于"+$IU.unixTimeToLocalTimeString(h.actionTime))}else{k.addClass("singleLine");$(q).text("该步已完成").addClass("singleLine")}}else{k.addClass("singleLine");$(q).text("该步尚待处理").addClass("singleLine")}}if(!$$.MOBILE){f.append(q)}if(A>0){var e=document.createElement("li");$(e).addClass("form_milestone_step_arrow_li").addClass(x);var g=document.createElement("div");$(g).addClass("form_milestone_step_arrow").addClass(j);var o=document.createElement("div");$(o).addClass("form_milestone_step_arrow").addClass("white");var z=document.createElement("div");$(z).addClass("form_milestone_step_arrow_wrap").append(g).append(o);$(e).append(z);l.append(e)}p.append(k).append(f);l.append(n);j=x}y.show();$("div.content_time").timeago({selector:"div.content_time"});if($$.MOBILE){s.find(".clear").css("height","10px");y.addClass("round-corner")}this.adjustMilestoneWidth(true);y.find(".form_milestone_step .milestone_tip").each(function(){var C=$(this),i=C.parent();C.css("left",(i.outerWidth()-C.outerWidth())/2+"px")});y.css("visibility","visible");if($$.MOBILE){y.hide();setTimeout(function(){y.show()},100)}},adjustMilestoneWidth:function(w){var z=this,t=$(this.milestoneHolder),n=t.find(".form_milestone_holder_wrap_inner"),g=n.children(".form_milestone_view"),q=t.find(".form_milestone_holder_wrap_outer"),k=$("#form_holder").outerWidth(),v=$("#div_render_container").outerWidth(),j=n.find(".form_milestone_step");if(t.length==0){return}if(k==0){setTimeout(function(){z.adjustMilestoneWidth(w)},200);return}if(t.data("originalTotalWidth")==null){var i=[],m=[],p=0;j.each(function(){var l=$(this);i.push(l.width());m.push(parseInt(l.css("padding-left"),10)+parseInt(l.css("padding-right"),10));var A=l.outerWidth();l.data("originalWidth",A);p+=A});var u=n.find(".form_milestone_step_arrow_li"),x=0;u.each(function(){x+=$(this).outerWidth()});p+=x;t.data("stepWidthArray",i);t.data("stepPaddingArray",m);t.data("originalTotalWidth",p);t.data("arrowTotalWidth",x)}else{p=t.data("originalTotalWidth")}if(!$$.MOBILE){if(w===true){if(p<k){var o=k}else{if(p>v){o=k>v?k:v-5}else{o=p}}if(o!=p){var d=this.adjustWidth(t,o);for(var h=0,r=j.length;h<r;h++){$(j[h]).width(d[h])}n.width(o)}}else{if(p>k){if(p>v){o=k>v?k:v-5;d=this.adjustWidth(t,o);for(h=0,r=j.length;h<r;h++){$(j[h]).width(d[h])}n.width(o)}else{for(h=0,r=j.length;h<r;h++){$(j[h]).css("width","")}n.css("width","")}}}}else{if(p<=v){o=v;d=this.adjustWidth(t,o);for(h=0,r=j.length;h<r;h++){$(j[h]).width(d[h])}q.width(v);g.width(v);t.width(v)}else{q.width(v);g.width(p+1);t.css("width","");j.css("width","");var f=false,s=0,y=0,e=0;j.each(function(){if(!f&&$(this).hasClass("gray")){s=e-v/2;s-=y/2;f=true}y=$(this).outerWidth();e+=y;var l=$(this).prev();if(l.hasClass("form_milestone_step_arrow_li")){e+=l.outerWidth()}});if(s>0){n.scrollLeft(s)}else{n.scrollLeft(0)}}}},adjustWidth:function(h,n){var j=h.data("stepWidthArray").slice(0),q=h.data("stepPaddingArray"),e=h.data("originalTotalWidth"),d=0;d+=h.data("arrowTotalWidth");for(var k=0,m=j.length;k<m;k++){var o=q[k];j[k]=Math.round((n-e)/m+o+j[k]);d+=j[k]}if(d!=n){var g=Math.ceil((n-d)/j.length);for(k=0,m=j.length;k<m;k++){if(n==d){break}if((g>0&&g<(n-d))||(g<0&&g>(n-d))){j[k]+=g;d+=g}else{if(k==0&&g==0){var p=n>d?1:-1;for(var l=0,f=Math.abs(n-d);l<f;l++){j[l]+=p}d=n}else{j[k]+=(n-d);d=n}}if((d!=n)&&k==(m-1)){j[k]+=(n-d)}}}return j},processEvent:function(){if($$.MOBILE){return}var d=$(".form_milestone_step");d.mouseenter(function(){var l=function(o,p){if(p>0){o.data("widthBeforeReduce",o.outerWidth());o.width(p)}};var f=$(this),i=$(this).prevAll(".form_milestone_step").first(),j=$(this).nextAll(".form_milestone_step").first(),k=f.data("originalWidth")+1;var g=k-f.outerWidth();if(g>1){if(i.length>0){if(j.length>0){var e=Math.ceil(g/2),h=g-e,m=i.outerWidth()-e,n=j.outerWidth()-h;l(i,m);l(j,n);l(f,k)}else{l(i,i.outerWidth()-g);l(f,k)}}else{if(j.length>0){l(j,j.outerWidth()-g);l(f,k)}}}});d.mouseleave(function(){var h=function(i){if(i.data("widthBeforeReduce")!=null){i.width(i.data("widthBeforeReduce"));i.data("widthBeforeReduce",null)}};var g=$(this),f=$(this).prevAll(".form_milestone_step").first(),e=$(this).nextAll(".form_milestone_step").first();h(f);h(e);h(g)})},draw:function(){this.drawMilestone();this.processEvent()}};define("InfoPlus.MilestoneRender",b)})(window);
(function(b,c){var a=function(d){this.initializeConfig(d)};a.ACTION_TYPE_SAVE=0;a.ACTION_TYPE_OPERATE=1;a.ACTION_TYPE_UPLOAD=2;a.ACTION_TYPE_DELETE_ATTACHMENT=3;a.ACTION_TYPE_LOAD=4;a.INFOPLUS_SPLITER="|INFOPLUS_SPLITER|";a.prototype={render:null,loadDefault:function(){this.title_holder=$("#title_holder");this.command_holder=$("#command_holder");this.command_bar=$("#form_command_bar");this.command_save="#FormCommandSave";this.command_print="#FormCommandPrint";this.command_printThing="#FormCommandPrintThing";this.command_download="#FormCommandDownload";this.div_form_remark="#form_remark_div";this.div_master_content="div.master_content";if(0==$(this.div_master_content).length){this.div_master_content=null}this.form_holder=$("#form_holder");this.form_remark_holder=$("#form_remark_holder");this.title_content=$("#title_content");this.renderDivId="div_render_container";this.footDivId="master_footer";this.printable=false;this.downloadable=true;this.withdrawable=false;this.killable=false;this.needSwitchMenu=false;this.printAfterAction=false;this.boundFields=[]},initializeConfig:function(d){this.loadDefault();for(var e in d){if(d.hasOwnProperty(e)){if(typeof(d[e])!=="function"){this[e]=d[e]}}}},createTodoTip:function(e){if($IU.isArray(e)){var n=e;var o=document.createElement("span"),d=document.createElement("div"),g=document.createElement("nobr");$(g).text("您现在可以继续办理，请点击选择");$(d).append(g);$(o).append(d);for(var j=0,k=n.length;j<k;j++){d=document.createElement("div");$(d).text("办理");l=document.createElement("a");$(l).attr("href","#").data("link",$IU.processUrl(n[j].renderUri)).text(n[j].stepName).click(function(){b.location.href=$(this).data("link");return false});$(d).append(l);$(o).append(d)}$(o).addClass("toolbar_helper left round-corner z-depth-1");$(o).click(function(){return false})}else{o=document.createElement("span");d=document.createElement("div");g=document.createElement("nobr");$(g).text("您现在可以继续办理“"+e.stepName+"”");$(d).append(g);$(o).append(d);d=document.createElement("div");var l=document.createElement("a");$(l).attr("href","#").text("立即办理").click(function(){b.location.href=$IU.processUrl(e.renderUri);return false});$(d).append(l).css("text-align","center").css("margin-top","5px");$(o).append(d);$(o).addClass("toolbar_helper left round-corner z-depth-1");$(o).click(function(){return false})}var m=$("#form_command_bar"),h=m.children(".no_action");if(h.length>0){h.append(o)}else{var f=m.children(".command_button");if(f.length>0){$(f[0]).append(o)}}},createDoingTip:function(q){var h=function(i){var t=i.trueName||i.userName||"";if(t==""){t="相关用户"}return t};var r=document.createElement("span"),s="";for(var n=0,o=q.length;n<o;n++){var f=q[n];s=h(f)+"正在办理"+(f.stepName!=null?f.stepName:"");var g=document.createElement("div"),l=document.createElement("nobr");$(l).text(s);$(g).append(l);$(r).append(g)}$(r).addClass("toolbar_helper left round-corner z-depth-1");var d=document.createElement("div");$(d).css("margin-top","6px");var e=document.createElement("a");$(e).attr("href","#").text("我知道了");d.appendChild(e);r.appendChild(d);var k=function(){$(r).hide("fade",function(){$(r).remove()})};$(e).click(function(){k();return false});$(r).click(function(){return false});var p=$("#form_command_bar"),m=p.children(".no_action");if(m.length>0){m.append(r)}else{var j=p.children(".command_button");if(j.length>0){$(j[0]).append(r)}}},createStepTip:function(g){var e=[],j=[];if($IU.isArray(g)){for(var f=0,d=g.length;f<d;f++){var h=g[f];if(h.status===1){if(h.renderUri!=null){e.push(h)}else{j.push(h)}}}}if(e.length>0){if(e.length==1){this.createTodoTip(e[0])}else{this.createTodoTip(e)}}else{if(j.length>0){this.createDoingTip(j)}}},refreshRemarks:function(e){if(!$$.visibility.remark){return}if(this.form_remark_holder.length==0){return}var d=this;this.form_remark_holder.block({message:"<span class='loading'>正在为您加载历史信息,请稍候...</span>"});$$.ajax({type:"POST",url:this.interface_list_remarks.replace("{id}",this.instanceId),data:{},requestMsg:"加载历史信息",beforeShowErrorMsg:function(){d.form_remark_holder.unblock()}}).done(function(h){var g=null,f=h.entities[0];d.remarkRender=new InfoPlus.RemarkRender({stepId:d.formStepId,instanceId:d.instanceId,entity:f,userId:d.userId,readOnly:d.readOnly,commandsHolder:g,preferredWidth:d.preferredWidth,administrable:d.administrable});d.remarkRender.draw();if(!d.administrable){d.milestoneRender=new InfoPlus.MilestoneRender({milestones:f.milestones,status:f.status});d.milestoneRender.draw()}if(e){d.createStepTip(f.remarks)}})},redraw:function(){if(null==this.render){return false}this.render.draw();return false},doValidate:function(j,d){var i=(j==null||j===false),f=$$.params.renderForm.find("*[class*='validate']").filter($IU.isValidateControlFilter);if(j){f=f.filter(function(){var l=$(this);if(l.data($Control.DATA_ORIGIN_INPUT)!=null){var k=$(l.data($Control.DATA_ORIGIN_INPUT)).data($Control.DATA_VALIDATOR)}else{k=l.data($Control.DATA_VALIDATOR)}return k!=null&&k.builtIn===true})}if($IU.checkControlValidation(f,i,true)===false){var e=function(){var k=null;$("div.formError").each(function(){var l=parseInt($(this).css("top"),10);if(!isNaN(l)){if(k==null){k=l}else{if(l<k){k=l}}}});if(k!=null&&k>60){$IU.scrollTo(k-60,500)}};var h=(d!==true)?"验证失败，请确保填写内容完整及格式正确！":"请确保填写内容完整及格式正确！";var g=$(".formErrorContent");if(g.length==1){h=g.text();if(h.substr(0,2)=="* "){h=h.substr(2)}if(d!==true){h="验证失败，"+h}}$IU.messageBox(null,h,null,350,function(){$(".formError").effect("bounce",{},150)});setTimeout(e,400);return false}return true},save:function(){var l=this;var f=function(o){o=o||"";var n={};n=l.render.save(n,false);var p=function(){if(l.adminView){b.location.href=$IU.processUrl(l.url_admin_view)}else{b.location.reload()}};$$.blockUI({message:"<span class='loading'><span style='color: green; '>"+$$.getLocaleText("common.tip")+"：</span>"+$$.getLocaleText("save.wait")+"</span>"});$$.ajax({type:"POST",url:l.interface_save,data:{formStepId:l.formStepId,entryId:l.entryId,formData:$.toJSON(n),remark:o,timestamp:l.timestamp,rand:Math.random()*999,boundFields:$$.params.boundFields.toString()},requestMsg:$$.getLocaleText("save.saving")}).done(function(){$IU.messageBox(null,$$.getLocaleText("save.success"),null,240,p)}).always(function(){$.unblockUI()});return n};if(null==this.render){return null}if(this.doValidate(true)===false){return null}if($$.params.adminView){var j=document.createElement("div"),e=$(j);var g=document.createElement("div");$(g).text("请输入修改数据的理由，注意该理由所有用户都可以看见！");e.append(g);var d=document.createElement("div"),h=$(d);h.text("必须输入修改理由!").css("color","red").hide();e.append(d);var i=document.createElement("textarea"),m=$(i);m.css("height","120px").css("width","100%");e.append(i);var k=new InfoPlus.Render.Dialog({content:j,maxWidth:600,buttons:[{name:"确定",callback:function(){var n=m.val()||"";if($IU.trimString(n)==""){if(!h.is(":visible")){h.show().effect("highlight")}else{h.effect("pulsate")}return false}else{f(n)}},defaultButton:true,preventDefault:true},{name:"取消"}]});k.show()}else{return f()}},createToolButtons:function(j){for(var h=0,d=j.length;h<d;h++){var f=j[h];var e=document.createElement("li");var g=document.createElement("a");g.innerHTML=f.name;g.title=f.description;e.appendChild(g);$(g).click(f.handler);if(h==0){$("#command_tool_dropdown").append(e)}else{$("#command_tool_dropdown").find(">li:first").before(e)}}},listSteps:function(h){var g=$.Deferred();if(this.render==null){return g.reject({error:"缺少必要的参数"})}if(h==null){return g.reject({error:"无可执行动作"})}var f=this.render.save(f,false);var e=$.toJSON(f);var d=this;$$.blockUI({message:"<span class='loading'>准备提交表单,请稍候...</span>"});$$.ajax({type:"POST",url:this.interface_list_next_steps,data:{formStepId:this.formStepId,actionId:h,formData:e,timestamp:this.timestamp,rand:Math.random()*999,boundFields:$$.params.boundFields.toString()},requestMsg:"准备提交表单",errorTitle:"",beforeShowErrorMsg:function(){$.unblockUI()}}).always(function(){$.unblockUI()}).done(function(l){var m=l.entities,k=m.length,n=false,j=d.distinguishSteps(m);if(j==null&&k>0){n=true;for(var o=0;o<k;o++){if(m[o].executorSelection!=3){n=false;break}}}if(n===true){g.resolve({showSelectUser:false,steps:[],jsonData:e,remark:l.error})}else{g.resolve({showSelectUser:true,steps:m,isEndStep:j!=null,jsonData:e,remark:l.error})}}).fail(function(i){g.reject(i)});return g.promise()},putActionButtonToCommandBar:function(d){var e=d.getElement();if(e!=null){this.command_bar.prepend(e)}},createActionButtons:function(g,j){var m=this,d=g.length;if(d>1){this.needSwitchMenu=true}var k=true;var l=function(){var q=$(this),s=q.data("actionId"),r=q.data("remarkRequired"),p=q.data("skipMessage"),o=q.data("inputBarCode");if(!q.data("skipValidation")){if(m.doValidate(false)===false){return false}}var i=function(){var t=m.listSteps(s);t.done(function(u){if(r===true||u.showSelectUser===true){m.showDoAction(q,u)}else{var v={actionId:s,formData:u.jsonData,remark:u.remark||"",rand:Math.random()*999};$$.doAction(v,{},p)}})};var n=function(){var v=document.createElement("div"),u=document.createElement("span"),y=document.createElement("input"),x=$(y);$(u).text("请扫码输入编号 ");$(v).append(u);u=document.createElement("span");x.attr("id","form_thing_id_input").attr("type","text").attr("maxlength",InfoPlus.Controls.Thing.BARCODE_LENGTH);$(u).append(y);$(v).append(u);var w=[{name:"确定",defaultButton:true,callOnClose:false,preventDefault:true,callback:function(){if(x.val()==""){$IU.messageBox(null,"请输入条码编号",null,200,function(){x.focus()});return false}$$.params.receiveCode=x.val();i()}},{name:"取消"}];var t=new InfoPlus.Render.Dialog({content:v,maxWidth:320,buttons:w});t.show();setTimeout(function(){x.focus()},100)};if(o==true){n()}else{i()}return false};for(var h=0;h<d;h++){var e=g[h];if(e==null){continue}e.skipMessage=!((e.descriptionAfterAction||"")!=""||$$.params.printAfterAction||$$.params.downloadAfterAction);e.remarkRequiredTip=$IU.trimString(e.remarkRequiredTip||"");e.oneKey=true;var f=new InfoPlus.Render.ActionButton({id:e.id,text:e.name,tip:e.description||"",action:e,hide:k,onClick:function(){$$.asynchronousInvoke(l,this);return false}});this.command_bar.prepend(f.getElement());if(this.needSwitchMenu){j.addMenuItem({text:e.name,title:e.description,name:(this.render!=null?this.render.prefix:this.buttonPrefix)+e.id,action:e,onClick:function(){$$.asynchronousInvoke(l,this);return false}})}}},createKillButton:function(i){var d=this;var g=function(){$IU.closeWindow()};var f=function(){$$.blockUI({message:"<span class='loading'>"+$$.getLocaleText("kill.blockMessage")+"</span>"});$$.ajax({type:"POST",url:d.interface_kill,data:{formStepId:d.formStepId,instanceId:d.instanceId,rand:Math.random()*999},requestMsg:$$.getLocaleText("kill.message"),beforeShowErrorMsg:function(){$.unblockUI()}}).always(function(){$.unblockUI()}).done(function(){$IU.messageBox(null,$$.getLocaleText("kill.success"),null,240,g)})};var e=function(){var l=$$.getLocaleText("kill.title"),k=$$.getLocaleText("kill.confirm"),j=$$.getLocaleText("common.ok");$IU.confirmBox(k,l,j,300,f);return false};var h=new InfoPlus.Render.ActionButton({id:"kill",text:$$.getLocaleText("kill.title"),textClass:"kill",tip:$$.getLocaleText("kill.tip"),hide:true,onClick:e});this.command_bar.prepend(h.getElement());i.addMenuItem({text:$$.getLocaleText("kill.title"),title:$$.getLocaleText("kill.menuTip"),name:(this.render!=null?this.render.prefix:this.buttonPrefix)+"kill",onClick:e})},createWithdrawButton:function(h){var d=this;this.disableSaveButton();var f=function(){$$.blockUI({message:"<span class='loading'>"+$$.getLocaleText("withdraw.blockMessage")+"</span>"});$$.ajax({type:"POST",url:d.interface_withdraw,data:{formStepId:d.formStepId,rand:Math.random()*999},requestMsg:$$.getLocaleText("withdraw.message"),beforeShowErrorMsg:function(){$.unblockUI()}}).always(function(){$.unblockUI()}).done(function(i){$IU.messageBox(null,$$.getLocaleText("withdraw.success"),null,240,function(){if(i!=null&&i.entities!=null&&i.entities[0]!=null&&i.entities[0].renderUri!=null){b.location.href=$IU.processUrl(i.entities[0].renderUri)}else{b.location.reload()}})})};var e=function(){var i=$$.getLocaleText("withdraw.confirm"),j=$$.getLocaleText("withdraw.title");$IU.confirmBox(i,j,$$.getLocaleText("common.ok"),350,f);return false};var g=new InfoPlus.Render.ActionButton({id:"withdraw",text:$$.getLocaleText("withdraw.title"),textClass:"withdraw",tip:$$.getLocaleText("withdraw.tip"),hide:true,onClick:e});this.command_bar.prepend(g.getElement())},createCommandButtonTip:function(){var d=new InfoPlus.Render.ScrollTip({toolbarId:"form_command_bar",text:$$.getLocaleText("command.helper"),left:true});$("#form_command_bar").find(">li.command_button").first().append(d.getElement());var e=new InfoPlus.Render.ScrollTip({toolbarId:"form_command_bar",text:$$.getLocaleText("command.helper"),left:true});$("#command_menu").append(e.getElement())},createCommandBarButtons:function(e){if(!$$.visibility.commandBar){return}var f=e.actions;var d=[];var g=new InfoPlus.Render.CommandMenu();this.command_bar.prepend(g.getElement());if(this.killable){this.createKillButton(g)}if(this.readOnly===true){if(this.withdrawable){this.createWithdrawButton(g)}}else{if(f.length>0){this.createActionButtons(f,g)}if(d.length>0){this.createToolButtons(d)}}this.createNoActionText(e.step);this.createCommandButtonTip()},createNavMenu:function(){var j=new InfoPlus.Render.NavMenu({onSaveClick:function(){$IU.fireClick($$.params.ids.save)},onPrintClick:function(){$IU.fireClick($$.params.ids.print)},onDownloadClick:function(){$IU.fireClick($$.params.ids.download)},onHelpClick:function(){loadHelp()},onHistoryClick:function(){$IU.scrollTo($("div#form_remark_holder").offset().top-40,500)}});var k=function(i){return function(){$IU.fireClick(i)}};var e=$(".infoplus_view_label");for(var h=e.length-1;h>=0;h--){var d=$(e[h]),g=d.data("name"),f=d.data("viewIndex");j.createMenuItem("bookmark",f,g,null,k(d[0]),true)}$("#renderContent_holder").prepend(j.getElement());return j},createTitleIcon:function(g){var e=($$.params.back!=null);var h=function(){if(e==true){b.location.href=$$.params.back;return false}else{var k=$(g.getElement());if(!k.is(":visible")){var j=k.data("showing");if(j!==true){k.data("showing",true);k.show("slide",{direction:"left",complete:function(){$(this).data("showing",false)}},200);var i=$(".infoplus_view_label").not(".infoplus_view_hide").first().data("menuLi");if(i!=null){k.find("li.current").removeClass("current");$(i).addClass("current")}}}else{var l=k.data("hiding");if(l!==true){k.data("hiding",true);k.hide("slide",{direction:"left",complete:function(){$(this).data("hiding",false)}},100)}}}};var f=new InfoPlus.Render.TitleIcon({id:"title_icon",back:e,onClick:h});var d=new InfoPlus.Render.TitleIcon({id:"command_bar_title_icon",back:e,onClick:h});d.hide();$(this.title_holder).append(f.getElement());$(this.command_bar).before(d.getElement());return{titleIcon:f,commandBarIcon:d}},createTitleContent:function(d,p){var g=d.step,o=d.workflowName,f=this.title_holder;var n=o+(g.name!=null&&g.name!="null"?":"+g.name:""),e="流水号:"+g.entryId,h=(g.entryRelease===false?'<i title="DEBUG" class="i-icon-bug"/>':""),r=$$.params.adminView?'<i title="管理数据" class="i-icon-unlock"/>':"",m=$$.params.printInvoice?'<i title="打印小票" class="i-icon-print print-invoice"/>':"",i=r+h+m+e;if(g.department!=null&&g.department!=""){e+=",主管部门:"+g.department}if(g.contact!=null&&g.contact!=""){e+=",联系方式:"+g.contact}var l=function(t,s){f.addClass(t);$(p.getElement()).addClass(t);$("meta[name=theme-color]").attr("content",s)};if(!$$.params.adminView){switch(g.entryStatus){case InfoPlus.Settings.INSTANCE_STATE_COMPLETE:n+="(已完成)";l("complete","#4CAF50");break;case InfoPlus.Settings.INSTANCE_STATE_TERMINATED:n+="(已终止)";l("terminated","#D84315");break;case InfoPlus.Settings.INSTANCE_STATE_OFFLINE:n+="(已挂起)";l("offline","#F9A825");break;default:if(g.status===2){if(g.actionName!=null){n+="("+g.actionName+(g.actionUserName!=null?","+g.actionUserName:"")+")"}else{n+="(办理中)"}l("doing","#00ACC1")}else{l("todo","#039be5")}break}}else{n+="(管理数据)";l("admin","#4CAF50")}var q=r+h+m+e;var k=new InfoPlus.Render.TitleContent({title:n,step:g,workflowName:o});f.append(k.getElement());var j=new InfoPlus.Render.TitleDescription({full:q,compact:i});f.append(j.getElement())},createTitle:function(f){if(!$$.visibility.titleBar){return}var e=this.createNavMenu();var d=this.createTitleIcon(e);this.createTitleContent(f,d.commandBarIcon);this.navMenu=e},createNoActionText:function(f){var g=function(){return f.name!=null&&f.name!="null"};var h=$("#form_command_bar");if(h.find("li.command_button").length===0){var e=document.createElement("li");$(e).addClass("no_action");if(!$$.params.adminView){var d="";if(g()&&f.actionUser!=null){d="此任务已处理,"}d+="您无需任何操作";$(e).text(d)}else{$(e).addClass("admin").text("您正在管理数据！")}h.append(e)}},draw:function(d){this.form_holder.hide();$(this.div_form_remark).hide();this.render=new InfoPlus.FormRender({formStepId:this.formStepId,workflowId:this.workflowId,holderId:this.form_holder.attr("id"),entity:d,suggest:this.interface_suggest,suggestInitialize:this.interface_suggestInitialize,fieldChange:this.interface_fieldChange,buttonService:this.interface_buttonClick,tenantTimeZoneOffset:this.tenantTimeZoneOffset,thingService:this.interface_thing});$$.initCore({formRender:this.render,userId:this.userId,timestamp:this.timestamp,tenantTimeZoneOffset:this.tenantTimeZoneOffset,tenantReadOnlyStyle:this.tenantReadOnlyStyle,formInstanceId:this.instanceId,formEntryId:this.entryId,formStepId:this.formStepId,workflowId:this.workflowId,isRelease:this.entryRelease,doActionUrl:this.interface_do_action,boundFields:this.boundFields,instanceView:this.instanceView,adminView:this.adminView,baseUrl:this.base_url,printAfterAction:this.printAfterAction&&this.printable,downloadAfterAction:this.printAfterAction&&this.downloadable,printUrl:this.url_print,memberShip:this.memberShip,back:this.back,showRemark:this.showRemark,theme:this.theme,lang:this.lang,dynamicParallel:this.dynamicParallel,printInvoice:((this.interface_printInvoice||"")!=""),uriBarcode:this.interface_printInvoice,uriFilePreview:this.interface_filePreviewUrl,instanceName:this.instanceName,instanceTags:this.instanceTags,receiveThing:this.receiveThing});return this.render.draw()},processFields:function(d){var e=[];if(d!=null){for(var f in d){if(d.hasOwnProperty(f)){var g=d[f];if(g.groupName!=null){g.groupArray=g.groupName.split("//")}if(g.bound===true&&g.name!==c){e.push(g.name)}}}}this.boundFields=e},getRenderWidth:function(){if(this.width==null||this.width==""){return $IU.getWindowWidth()}else{var d=parseInt(this.width,10);if(isNaN(d)){return $IU.getWindowWidth()}else{return d}}},preview:function(f){var e=function(i,h,j){loadFormError();$IU.errorMessageBox(i,h,"加载流程失败",j,true)};var g=function(m){var i=m.fields;for(var j in i){if(i.hasOwnProperty(j)){var l=i[j];l.permission="rw"}}var h=m.groups;for(j in h){if(h.hasOwnProperty(j)){var k=h[j];k.permission="r"}}};progress("正在加载流程信息",20,60,5000);if(this.workflowId==null){e("页面参数不正确",null,true);return $.Deferred().reject()}var d=this;return $$.ajax({type:"POST",url:this.interface_preview,data:{workflowId:this.workflowId,rand:Math.random()*999,width:this.getRenderWidth()},requestMsg:"加载流程",beforeShowErrorMsg:function(){$.unblockUI()},showParseErrMsg:false}).fail(function(j){var i=j.msg,h=null;if(i==null){i="未知的错误"}var k=i.split("|INFOPLUS_SPLITER|");if(k.length>1){i=k[0];h=k[1]}e(i,h,j.errno<0)}).done(function(i){progress("正在加载中",60,80,1000);var j=i.entities[0];d.processFields(j.fields);g(j);var h=j.permission;f.startable=(h.startable===true);d.draw(j).done(function(){var l=new InfoPlus.Preview.Introduce({app:f.app}),m=new InfoPlus.Preview.Start({startable:f.startable,onClick:function(){if(!f.startable){return false}if(d.doValidate(false,true)===false){return false}if($$.PREVIEW_APP_URI!==c){document.body.onbeforeunload=null;b.location.href=$IU.processUrl($$.PREVIEW_APP_URI);return false}var o={};o=d.render.save(o,false);var n=$.toJSON(o);$$.blockUI({message:"<span class='loading'>正在为您启动新流程,请稍候...</span>"});$$.ajax({type:"POST",url:d.interface_start,data:{idc:f.idc,release:f.release,csrfToken:$(document).find("meta[itemscope=csrfToken]").attr("content"),formData:n},requestMsg:"启动新流程",beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(q){var p=q.entities[2];document.body.onbeforeunload=null;b.location.href=$IU.processUrl(p)})}}),k=new InfoPlus.Preview.Layout({views:d.render.views,introduce:l,start:m});if($("#header_holder").length==0){$("#renderContent_holder").addClass("no_header")}d.form_holder.show("fade",{},"normal");d.checkBrowser()})})},adjustVisibility:function(){if(!$$.visibility.titleBar){$("#title_holder").hide()}if(!$$.visibility.commandBar){$("#command_holder").hide()}if(!$$.visibility.remark){$("#form_remark_holder").hide();$("#nav_menu_history").children("span").addClass("disabled")}if(!$$.visibility.milestone){$("#form_milestone_holder").hide()}},createPrintInvoiceDiv:function(){if($$.params.printInvoice){$(".print-invoice").click(function(){var i=$("#div_invoice");i.empty();var f=[],k=false,l=b.open(),e=function(){if(!j||!k){return}for(var o=0,n=f.length;o<n;o++){if(!f[o]){return}}l.focus();l.print();l.close()};var h=true,j=false;$(".infoplus_thingControl").each(function(){var o=$(this).data($Control.DATA_CONTROL_OBJECT);if(o!=null){var n=o.getPrintContent(f,e);if(n!=null){i.append(n);h=false}}});j=true;if(!h){var g=i.html();l.document.write("<style>body {text-align:center}</style>"+g);l.document.close();var m=function(){if(!k){k=true;e()}};$(l).load(m);$(l.document).ready(m)}});var d=document.createElement("div");d.id="div_invoice";document.body.appendChild(d)}},setTitleBar:function(g,n){var p=this,i=$(this.title_content[0]),k=$("#title_description"),h=$("#title_description_short"),e=$("#title_holder"),o=$("#command_bar_title_icon");i.empty();var d="流水号:"+g.entryId,f=(g.entryRelease===false?'<i title="DEBUG" class="i-icon-bug"/>':""),q=$$.params.adminView?'<i title="管理数据" class="i-icon-unlock"/>':"",m=$$.params.printInvoice?'<i title="打印小票" class="i-icon-print print-invoice"/>':"";h.html(q+f+m+d);if(g.department!=null&&g.department!=""){d+=",主管部门:"+g.department}if(g.contact!=null&&g.contact!=""){d+=",联系方式:"+g.contact}var l=n+(g.name!=null&&g.name!="null"?":"+g.name:"");var j=function(s,r){e.addClass(s);o.addClass(s);$("meta[name=theme-color]").attr("content",r)};if(!$$.params.adminView){switch(g.entryStatus){case InfoPlus.Settings.INSTANCE_STATE_COMPLETE:l+="(已完成)";j("complete","#4CAF50");break;case InfoPlus.Settings.INSTANCE_STATE_TERMINATED:l+="(已终止)";j("terminated","#D84315");break;case InfoPlus.Settings.INSTANCE_STATE_OFFLINE:l+="(已挂起)";j("offline","#F9A825");break;default:if(g.status===2){if(g.actionName!=null){l+="("+g.actionName+(g.actionUserName!=null?","+g.actionUserName:"")+")"}else{l+="(办理中)"}j("doing","#00ACC1")}else{j("todo","#039be5")}break}}else{l+="(管理数据)";j("admin","#4CAF50")}i.html("<nobr>"+l+"</nobr>");k.html(q+f+m+d)},disableSaveButton:function(){$("#nav_menu_save").children("span").addClass("disabled")},load:function(){var g=function(l,k,m){loadFormError();$IU.errorMessageBox(l,k,"加载流程失败",m,true)};var i=function(p){var l=p.fields;for(var m in l){if(l.hasOwnProperty(m)){var o=l[m];if(o.permission!==c){if(o.permission.indexOf("r")!==-1){o.permission="r"}else{o.permission=""}}if(o.fieldChanging!==c){o.fieldChanging=false}if(o.fieldChangeMappingList!==c){o.fieldChangeMappingList=null}}}var k=p.groups;for(m in k){if(k.hasOwnProperty(m)){var n=k[m];if(n.permission!==c){if(n.permission.indexOf("r")!==-1){n.permission="r"}else{n.permission=""}}}}};var j=function(k){return(k.entryStatus!=InfoPlus.Settings.INSTANCE_STATE_COMPLETE&&k.entryStatus!=InfoPlus.Settings.INSTANCE_STATE_TERMINATED&&k.entryStatus!=InfoPlus.Settings.INSTANCE_STATE_OFFLINE&&k.status===2)};progress("正在加载页面",20,60,5000);var d=this;if(this.formStepId<0&&this.instanceId==null){g("页面参数不正确",null,true);return $.Deferred().reject()}var f=!$$.PRINT?this.interface_render:this.interface_print,e=$.Deferred(),h={formStepId:this.formStepId,instanceId:this.instanceId,admin:this.adminView,rand:Math.random()*999,width:this.getRenderWidth()};if(this.snapshot=="true"){h.snapshot=true}$$.ajax({type:"POST",url:f,data:h,requestMsg:"加载表单",beforeShowErrorMsg:function(){$.unblockUI()},showParseErrMsg:false}).fail(function(n){if(n.errno===15008){b.location.href=$IU.processUrl(n.data.entities[0]["step"]["renderUri"]);e.reject();return}var m=n.msg,l=null;if(m==null){m="未知的错误"}var o="|INFOPLUS_SPLITER|",k="\n\n";var p=m.indexOf(o);if(p!=-1){l=m.substr(p+o.length);m=m.substring(0,p)}else{p=m.indexOf(k);if(p!=-1){l=m.substr(p+k.length);m=m.substring(0,p)}}g(m,l,n.errno<0)}).done(function(k){progress("正在加载页面",60,80,1000);setTimeout(function(){var n=function(p){if(p==null){return[]}var o=p.split("/");o.splice(0,1);return o};var m=k.entities[0],l=m.step;d.processFields(m.fields);d.instanceId=l.instanceId;d.entryId=l.entryId;d.entryRelease=l.entryRelease;d.formStepId=l.flowStepId;d.timestamp=l.timestamp;d.printAfterAction=l.printAfterAction;d.exportReadOnly=l.exportReadOnly;d.dynamicParallel={splitPath:n(l.splitPath),splitPathGroup:n(l.splitPathGroup)};d.instanceName=l.instanceName;d.instanceTags=l.instanceTags;d.receiveThing=(l.thing!=null);d.readOnly=!m.permission.executable;d.printable=m.permission.printable;d.downloadable=m.permission.exportable;d.withdrawable=m.permission.withdrawable;d.killable=m.permission.killable;d.administrable=d.instanceView===true&&m.permission.administrable===true;d.preferredWidth=m.preferredWidth;d.buttonPrefix="infoplus_action_"+Math.round(Math.random()*9000+1000)+"_";if($$.PRINT){i(m)}d.draw(m).done(function(){$IU.initValidationEngine();if(!$$.PRINT){d.createTitle(m);d.createCommandBarButtons(m);if(!$$.params.adminView){var r=null;if(d.downloadable&&$$.params.downloadAfterAction&&!d.readOnly){r={message:(d.printable?$$.getLocaleText("download.downloadPrintAfterAction"):$.getLocaleText("download.downloadAfterAction")),doAfterAction:true,doText:""}}var p=new InfoPlus.Render.ToolButton({id:"Download",iconName:"cloud-download",disabled:!d.downloadable,tip:(d.downloadable?$$.getLocaleText("download.support"):$$.getLocaleText("download.notSupport")),helper:r,onClick:function(){if($(this).children("a").hasClass("disabled")){return false}if(!d.readOnly&&$$.params.downloadAfterAction){$IU.messageBox(null,$$.getLocaleText("download.pleaseDownloadAfterAction"),null,300);return false}d.download();return false}});d.command_bar.append(p.getElement());r=null;if(!$$.MOBILE&&d.printable){if($$.params.printAfterAction&&!d.readOnly){if(!d.downloadable){r={message:$$.getLocaleText("print.printAfterActionHelper"),doAfterAction:true,doText:""}}}else{r={message:$$.getLocaleText("print.helper"),doAfterAction:false,doText:$$.getLocaleText("print.printNow")}}}var o=new InfoPlus.Render.ToolButton({id:"Print",iconName:"print",disabled:!d.printable||$$.MOBILE,tip:(!d.printable?$$.getLocaleText("print.notSupport"):$$.getLocaleText("print.support")),helper:r,href:(d.printable&&(!$$.MOBILE))?$IU.processUrl($$.params.printUrl):null,onClick:function(){if($(this).children("a").hasClass("disabled")){return false}if(!d.readOnly&&d.printAfterAction){$IU.messageBox(null,$$.getLocaleText("print.printAfterAction"),null,300);return false}}});d.command_bar.append(o.getElement())}if(!(d.readOnly&&(!$$.params.adminView||d.withdrawable))){var s=new InfoPlus.Render.ToolButton({id:"Save",iconName:"save",tip:$$.getLocaleText("save.tip"),scrollTip:new InfoPlus.Render.ScrollTip({toolbarId:"form_command_bar",text:$$.getLocaleText("save.scrollTip"),left:false}),onClick:function(){if($(this).children("a").hasClass("disabled")){return false}$$.asynchronousInvoke(d.save,d);return false}});d.command_bar.append(s.getElement())}if(d.administrable||d.adminView){var t=new InfoPlus.Render.ToolButton({id:"Admin",iconName:d.adminView?"lock-open":"lock",href:d.adminView?$IU.processUrl(d.url_admin_view):$IU.processUrl(d.url_admin),target:"_self",tip:d.adminView?"退出数据管理":"管理表单数据"});d.command_bar.append(t.getElement())}if(d.administrable){var q=new InfoPlus.Render.ToolButton({id:"ShowAdminRemarks",iconName:"history",tip:"显示数据管理历史",onClick:function(){$(".remark_admin,.remark_withdraw,.remark_withdrawn,.remark_kill").addClass("show");$("#form_remark_holder").children("ul").children("li").not(":last").css("border-bottom","");return false}});d.command_bar.append(q.getElement())}$(d.command_bar).children("li.tool_button").each(function(){if($(this).children("span.toolbar_helper").length>0){$(this).parent().children("li.tool_button").children("a").addClass("hide_tip")}});d.createPrintInvoiceDiv();if(d.navMenu!=null){d.navMenu.disableUnusedMenuItem()}}d.adjustVisibility();d.form_holder.show("fade",{},"normal",function(){if($$.visibility.remark){d.refreshRemarks(j(l))}});if($$.PRINT){$("#form_holder").find(".infoplus_view").each(function(){if($(this).find("table").first().height()===0){$(this).remove()}})}if($("#header_holder").length==0){$("#renderContent_holder").addClass("no_header")}d.checkBrowser();e.resolve()}).always(function(){$$.params.initializing=false})},0)}).always(function(){});return e.promise()},checkBrowser:function(){if($.browser.msie){if($.browser.version.substr(0,1)=="6"||$.browser.version.substr(0,1)=="7"){$("#browserOverlayer").css("height",$(b).height()+"px").show();$("#browserNotice").css("margin-top",$(b).height()/2-100+"px").show()}}},showDoAction:function(g,F){var L=g.children("nobr").text(),x=g.data("description"),o=g.data("lastRemark")!=""?g.data("lastRemark"):F.remark,d=g.data("remarkRequired"),w=g.data("remarkRequiredTip"),h=g.data("actionPrintable"),t=g.data("actionId"),f=F.jsonData,D=F.steps,v=F.isEndStep;if(this.render==null){return false}var H=this;this.mustInputRemark=d==null?false:d;this.remarkTip=$IU.trimString(w);if(this.remarkTip==null||this.remarkTip==""){this.remarkTip="*"}if(t==null){$IU.messageBox(null,"无可执行动作",null,300);return false}if(o!=null){$("#form_do_action_remark").val(o)}else{$("#form_do_action_remark").val("")}if(d===true){$("#form_do_action_remark_tip").html('请填写备注信息:<span style="color:red">('+this.remarkTip+')</span><span class="form_do_action_must_input_remark" style="display:none">您必须填写此备注</span>')}else{$("#form_do_action_remark_tip").html("请填写备注信息:")}if(d===true||(o!=null&&o!="")){$("#form_do_action_show_remark").hide();$("#form_do_action_remark_div").show()}else{$("#form_do_action_show_remark").show();$("#form_do_action_remark_div").hide()}var s=$("#form_do_action_message_description");if(x==null||x==""){s.hide().text("")}else{s.text(x);s.show()}var E=[];if(this.printable&&h===true){E.push({name:$$.getLocaleText("common.print"),callback:function(){$("#linkPrint").attr("href",$IU.processUrl(H.url_print));$IU.fireClick("linkPrint")}})}E=E.concat([{name:$$.getLocaleText("common.confirmAction"),callback:function(){return H.doAction(t,f)},preventDefault:true,defaultButton:true},{name:$$.getLocaleText("common.cancel"),callback:function(){g.data("lastRemark",$("#form_do_action_remark").val())},callOnClose:true}]);var G=$("#form_do_action_next_steps");G.hide();var p=$("#form_do_action_user_list")[0];$(p).empty();if(v===true){}else{if(D.length>0){var m=function(O,U,i){var N=function(){var Z=function(ac){if(ac.tenantUserId!=null){ac.displayName=ac.trueName+"("+ac.tenantUserId+")"}else{ac.displayName=ac.trueName}};var ab={};for(var aa=0,X=U.length;aa<X;aa++){var Y=U[aa];if(ab.hasOwnProperty(Y.trueName)){var W=ab[Y.trueName];Z(W);Z(Y)}else{ab[Y.trueName]=Y;Y.displayName=Y.trueName}}};N();var S=document.createElement("select");for(var M=0;M<U.length;M++){var Q=U[M];var T=Q.displayName;var V=Q.organizeName;if(V!=null&&V!=""){T=T+"("+V+")"}var P=new Option(T,Q.userId);if($.browser.msie){S.add(P)}else{S.add(P,null)}}var R=(O.splitIdentifier)==null?"":O.splitIdentifier;$(S).data("stepId",O.stepId+","+R).data("stepName",O.name).data("mustSelectNextUser",i);return S};var n=function(P){var O=new InfoPlus.QuickSortArray();for(var N=0,M=P.length;N<M;N++){O.push(P[N])}O.sort(function(Q,i){return Q.trueName.localeCompare(i.trueName)});return O};var I={trueName:"-- 请选择 --",userId:InfoPlus.Settings.NOBODY_ACCOUNT};var q={trueName:"-- 所有用户 --",userId:InfoPlus.Settings.NOBODY_ACCOUNT};var K,u,A;for(var z=0,C=D.length;z<C;z++){var k=D[z],r=n(k.users),l=document.createElement("li");l.innerHTML="<b>"+k.name+"：</b>执行人&nbsp;";switch(k.executorSelection){case 0:r.splice(0,0,q);l.appendChild(m(k,r,false));A=document.createElement("span");$(A).attr("class","tip_help").attr("original-title","您可以指定此步骤的执行人，如果不指定，<br>所有有权限的用户将都可办理此步骤").data("selectUser",k.executorSelection).data("tipContent","您可以指定此步骤的执行人，如果不指定，所有有权限的用户将都可办理此步骤");l.appendChild(A);break;case 1:if(r.length===1){K=r[0];l.innerHTML=l.innerHTML+("<b>"+K.trueName+"</b>");u=document.createElement("input");u.type="hidden";u.value=K.userId;l.appendChild(u);var e=(k.splitIdentifier)==null?"":k.splitIdentifier;$(u).data("stepId",k.stepId+","+e)}else{r.splice(0,0,I);l.appendChild(m(k,r,true));var y=document.createElement("span");$(y).text("(*)").css("color","red");l.appendChild(y);y=document.createElement("span");$(y).text("您必须指定此步骤的执行人").addClass("form_do_action_must_select_user").css("display","none");l.appendChild(y);A=document.createElement("span");$(A).attr("class","tip_help").attr("original-title","您必须指定此步骤的执行人").data("selectUser",k.executorSelection).data("tipContent","您必须指定此步骤的执行人");l.appendChild(A)}break;case 2:case 3:l.innerHTML=l.innerHTML+"<b>系统指定</b>"}p.appendChild(l)}$(A).tipsy({html:true,fade:true,gravity:"w",trigger:"manual",opacity:0.8});$("#form_do_action_show_next_steps").show()}else{$("#form_do_action_show_next_steps").hide()}G.show()}var J=$(".tip_help");if($$.MOBILE){var j=new InfoPlus.Render.Mobile.Page({title:L,content:$("#form_do_action_dialog"),isDoAction:true,onClose:function(){$("#form_do_action_dialog").detach().hide().appendTo(document.body)},buttons:E});j.show();J.click(function(){var M=document.createElement("div");$(M).html($(this).data("tipContent")).css("display","none");var i=$(this);if(i.data("selectUser")==0){$(M).css("color","#616161")}else{$(M).css("color","red")}i.parent().append(M);i.hide();$(M).slideDown("slow")})}else{var B=new InfoPlus.Render.Dialog({title:L,content:$("#form_do_action_dialog"),maxWidth:620,onClose:function(){$("#form_do_action_dialog").detach().hide().appendTo(document.body)},buttons:E});B.show();J.click(function(){$(this).tipsy("show")}).mouseenter(function(){$(this).tipsy("show")}).mouseleave(function(){$(this).tipsy("hide")})}return false},doAction:function(d,i){var m=this;var e={},l=false,g="",h="";if($("#form_do_action_next_steps").css("display")!="none"){var o=$("#form_do_action_user_list");o.find("select").each(function(p){var r=$(this).val();if(r==InfoPlus.Settings.NOBODY_ACCOUNT){if($(this).data("mustSelectNextUser")){if(!$$.MOBILE){var q=$(this).siblings(".form_do_action_must_select_user");if(!q.is(":visible")){q.show().effect("highlight")}else{q.effect("pulsate")}}g+=(g!=""?"<br>":"")+"请选择操作<span class='color_o1'>"+$(this).data("stepName")+"</span>步骤的用户";l=true;return}r=""}e[$(this).data("stepId")]=r});o.find("input[type*=hidden]").each(function(p){e[$(this).data("stepId")]=$(this).val()});if(l){if($$.MOBILE){$IU.messageBox("请选择",g,null,400)}return false}}else{}var f=$("#form_do_action_remark");if($$.MOBILE){if(f.is(":visible")){h=f.val()}}else{if($("#form_do_action_remark_div").css("display")==="block"){h=f.val()}}if(this.mustInputRemark===true&&$IU.trimString(h).length==0){if($$.MOBILE){$IU.messageBox(null,this.remarkTip,null,300);return false}else{var k=$("#form_do_action_remark_tip").children(".form_do_action_must_input_remark");if(!k.is(":visible")){k.show().effect("highlight")}else{k.effect("pulsate")}return false}}var n=function(){$$.blockUI({message:"<span class='loading'>正在为您提交表单,请稍候...</span>"})};var j=function(){$.unblockUI()};$$.doAction({actionId:d,formData:i,remark:h,rand:Math.random()*999},e,false,n,j)},distinguishSteps:function(e){var d=null;if(null!=e&&0<e.length){for(var f=0;f<e.length;f++){var g=e[f];if(g.type==InfoPlus.Settings.STEP_TYPE_AUTO){d=g;e.splice(f,1);break}}}return d},download:function(){var e=document.createElement("div");var d=document.createElement("input");d.type="radio";d.name="optDownloadType";var f=document.createElement("label");f.appendChild(d);$(f).addClass("download_radio_div").val("   ");var h=document.createElement("div");$(h).addClass("download_word");h.appendChild(f);e.appendChild(h);var g=document.createElement("input");g.type="radio";g.name="optDownloadType";f=document.createElement("label");f.appendChild(g);$(f).addClass("download_radio_div").val("   ");h=document.createElement("div");$(h).addClass("download_pdf");h.appendChild(f);e.appendChild(h);$(e).addClass("download_content_div");if(this.exportReadOnly){d.disabled=true;g.checked=true;$(d).parents("div.download_word").addClass("download_disable")}else{d.checked=true}var i=document.createElement("a");i.href=$IU.processUrl(this.url_download_word);i.target="_blank";$(i).css("display","none");var j=document.createElement("a");j.href=$IU.processUrl(this.url_download_pdf);j.target="_blank";$(j).css("display","none");e.appendChild(i);e.appendChild(j);var l=[{name:$$.getLocaleText("common.ok"),defaultButton:true,callback:function(){if(d.checked==true){$IU.fireClick(i)}else{$IU.fireClick(j)}}},{name:$$.getLocaleText("common.cancel")}];var k=new InfoPlus.Render.Dialog({title:$$.getLocaleText("download.choose"),content:e,maxWidth:340,buttons:l});k.show()},registerGlobalEvents:function(){var d=this;$("a.show_comment").click(function(){$("#form_do_action_remark_div").show();return false});$(b).resize(function(){d.switchTitleWidth();d.switchCommandButtonOrMenu();if(d.milestoneRender!=null){d.milestoneRender.adjustMilestoneWidth(false)}adjustRenderWidth()});var f=$("#ScrollToTop");var e=0;$(b).scroll(function(){var m=$(document).scrollTop();if(m>=$(b).height()/2){f.removeClass("Offscreen")}else{f.addClass("Offscreen")}var l=$("#command_holder"),g=$("#title_holder"),o=$("#nav_menu"),A=l.parent(),t=g.height();if(l.length>0){var n=(m<t)?-m:-t;A.css("top",n+"px");o.css("top",(n+l.height()+g.height())+"px");var C=$("#command_bar_title_icon");if(m>t){if(!C.is(":visible")){var p=C.data("showing");if(p!==true){C.data("showing",true);C.show("slide",{direction:"left",complete:function(){$(this).data("showing",false)}},300)}}}else{if(C.is(":visible")){C.hide()}}d.switchCommandButtonOrMenu()}var h=$(".infoplus_view_label");if(h.length>0){var y=(l.length>0?l.height():0)+4,s=5,k=null;for(var x=0;x<h.length;x++){var B=$(h[x]),v=B.data("view");if(B.css("position")!=="fixed"){var u=y;if(x>0){for(var w=0;w<x;w++){u+=($(h[w]).outerHeight()+s)}}var r=u+3;if(v.offset().top-$(b).scrollTop()<r){var z=B.offset().left;B.css("position","fixed").css("left",z+"px").css("top",u+"px")}}if(B.css("position")==="fixed"){if(B.offset().top<=v.offset().top){B.css("position","").css("left","").css("top","")}if(B.data("isAbstract")!==true){if(B.data("fullHeight")==null){B.data("fullHeight",B.outerHeight())}if(B.data("fullHeight")+B.offset().top>v.outerHeight()+v.offset().top){B.text(B.data("abstractName")).data("isAbstract",true)}}else{if(B.data("isAbstract")===true){if(B.data("fullHeight")+B.offset().top<=v.outerHeight()+v.offset().top){B.text(B.data("name")).data("isAbstract",false)}}}if(v.outerHeight()+v.offset().top<$(b).scrollTop()+y){B.addClass("infoplus_view_hide")}else{B.removeClass("infoplus_view_hide");if(k==null){k=B}}}}if(o.length>0){o.find("li.current").removeClass("current");if(k==null){o.find("li").first().addClass("current")}else{var q=k.data("menuLi");if(q!=null){$(q).addClass("current")}}}}e=m});f.click(function(){$("html, body").animate({scrollTop:"0px"},400);return false})},getCommandToolbarMinWidth:function(){var i=$("#command_holder");if(i.css("min-width")!=null){return parseInt(i.css("min-width"),10)}var l=$(this.command_save),f=$(this.command_print),g=70,k=60,h=60,d=122,j=10;var e=d+j;if(l.length>0){if(l.css("display")!="none"&&!(l.parent().hasClass("hide"))){e=e+g}}if(f.length>0){if(f.css("display")!="none"&&!(f.parent().hasClass("hide"))){e=e+h}}return e},getToolCommandTotalWidth:function(){var g=$(this.command_save),j=$(this.command_print),h=$(this.command_printThing),e=$(this.command_download),i=4,f=10;var d=0;if(g.length>0&&g.is(":visible")){d+=g.outerWidth()+i}if(j.length>0&&j.is(":visible")){d+=j.outerWidth()+i}if(h.length>0&&h.is(":visible")){d+=h.outerWidth()+i}if(e.length>0&&e.is(":visible")){d+=e.outerWidth()+i}return d+f},getCommandButtonTotalWidth:function(){var k=$("#form_command_bar"),h=k.find("li.command_button"),f=2,j=6,e=0;for(var g=0,d=h.length;g<d;g++){e+=$(h[g]).outerWidth()+f}e+=j;return e},getCommandButtonMaxCount:function(){var k=$("#form_command_bar"),f=$("#command_bar_title_icon");var d=document.documentElement.clientWidth,j=6,h=100,e=2;var i=k.find("li.command_button");if(i.length>0&&i.outerWidth()>0){h=i.outerWidth()+e}d=d-j;if(f.is(":visible")){d=d-f.outerWidth()}d=d-this.getToolCommandTotalWidth();var g=Math.floor(d/h);return g>1?g:1},getCommandHolderWidth:function(e,d){return document.documentElement.clientWidth},setCommandHolderWidth:function(e,d){$("#command_holder").width(this.getCommandHolderWidth(e,d))},switchCommandButtonOrMenu:function(){var k=$("li.command_button"),j=$("#command_menu"),i=k.length;if($$.MOBILE){if(i===3){k.find(".command_button_content").removeClass("smallButton").removeClass("smallFont")}var h=this.getCommandButtonMaxCount();if(i===3&&document.documentElement.clientWidth>=360&&h<3){k.find(".command_button_content").addClass("smallButton");h=this.getCommandButtonMaxCount();var f=false;k.find("nobr").each(function(){if($IU.chineseLength($(this).text())===12){f=true}});if(f){k.find(".command_button_content").addClass("smallFont")}}var e=(h<i)&&this.needSwitchMenu}else{var g=$("#command_bar_title_icon"),d=this.getToolCommandTotalWidth()+this.getCommandButtonTotalWidth();if(g.is(":visible")){d+=g.outerWidth()}if(d>document.documentElement.clientWidth){e=true}}if(e){k.addClass("hide");j.removeClass("hide")}else{k.removeClass("hide");j.addClass("hide")}},switchTitleWidth:function(){var g=$(b).width(),d=$("#title_description"),j=$("#title_description_short"),e=d.outerWidth(),k=j.outerWidth(),i=$("#title_icon").outerWidth(),f=10,h=$("#title_content");h.css("max-width",(g-(k+i+f))+"px");if(h.width()+e+i+f>g){d.hide();j.show()}else{j.hide();d.show()}}};define("InfoPlus.Transformer",a)})(window);
(function(b,c){var a=function(f,i,j){if(i==null){i={}}this.settings=i;this.endPoint=f;if(f.indexOf("http://")==-1){this.endPoint="http://"+f}this.assignSize=false;this.mode=InfoPlus.ExternalLink.DEFAULT_MODE;if(i.windowMode!=null&&$IU.isInt(i.windowMode)){var d=parseInt(i.windowMode,10);if(!isNaN(d)&&(d>=InfoPlus.ExternalLink.MODE_INNER_MODAL&&d<=InfoPlus.ExternalLink.MODE_SELF)){this.mode=d}}if(i.windowWidth!=null&&$IU.isNumber(i.windowWidth)){var e=parseFloat(i.windowWidth);if(!isNaN(e)){this.width=e;this.assignSize=true}}if(i.windowHeight!=null&&$IU.isNumber(i.windowHeight)){var g=parseFloat(i.windowHeight);if(!isNaN(g)){this.height=g;this.assignSize=true}}};a.MODE_INNER_MODAL=1;a.MODE_INNER_MODALESS=2;a.MODE_OUTER_DIALOG=3;a.MODE_OUTER_MODAL=4;a.MODE_OUTER_MODALESS=5;a.MODE_SELF=6;a.DEFAULT_MODE=a.MODE_INNER_MODAL;a.DEFAULT_DIALOG_WIDTH=$(b).width();a.DEFAULT_DIALOG_HEIGHT=$(b).height()*0.7;a.prototype={assignSize:false,mode:a.MODE_INNER_MODAL,width:a.DEFAULT_DIALOG_WIDTH,height:a.DEFAULT_DIALOG_HEIGHT,endPoint:null,dialogDiv:null,href:null,openWindow:function(){var e=true;switch(this.mode){case InfoPlus.ExternalLink.MODE_INNER_MODAL:case InfoPlus.ExternalLink.MODE_INNER_MODALESS:if(!$$.MOBILE){var d=$("#title_holder"),f=d.height(),i=$("#command_holder").height(),k=parseInt(d.parent().css("top"),10),g=f+i+(isNaN(k)?0:k),j=$(b).height()-g-40-48-4-20;$IU.iframeBox(this.href,this.settings.displayText,this.mode==InfoPlus.ExternalLink.MODE_INNER_MODAL,this.width,this.assignSize?this.height:j)}else{var h=new InfoPlus.Render.Mobile.Page({title:this.settings.displayText,uri:this.href});h.show()}break;case InfoPlus.ExternalLink.MODE_OUTER_DIALOG:var l="directories=0,location=0,menubar=0,resizable=1,scrollbars=1,status=0,titlebar=0,toolbar=0";if(!this.assignSize){l+=",channelmode=1,fullscreen=1"}else{l+=",channelmode=0,fullscreen=0,width="+this.width+",height="+this.height+",top="+(screen.availHeight-this.height)/2+",left="+(screen.availWidth-this.width)/2}b.open(this.href,"",l);break;case InfoPlus.ExternalLink.MODE_OUTER_MODAL:$IU.messageBox("操作完毕后关闭","请在新窗口中进行相关操作<br/>操作完毕后请关闭本窗口",null,300);e=false;break;case InfoPlus.ExternalLink.MODE_SELF:case InfoPlus.ExternalLink.MODE_OUTER_MODALESS:e=false;break}return e}};define("InfoPlus.ExternalLink",a)})(window);
(function(b,c){var a=function(e,d,f){this.value=e;this.displayValue=d;this.name=d;this.parentId=f};a.prototype={};define("InfoPlus.Controls.Data.ValuePair",a)})(window);
(function(b,c){var a=function(e,d){InfoPlus.Controls.Data.ValuePair.call(this,e,d)};a.prototype=$.extend(new InfoPlus.Controls.Data.ValuePair(),{});define("InfoPlus.Controls.Data.Thing",a)})(window);
(function(b,c){var a=function(d){this.value=d};a.prototype={};define("InfoPlus.Controls.Data.Uri",a)})(window);
(function(b,c){var a=function(g){this.styles=this.splitStyles(g.style);this.condition=g.condition||"";this.isRowStyle=g.isRowStyle===true;this.isRepeatItemStyle=g.isRepeatItemStyle===true;var d=g.fieldRowIndexName||"";if(d!=""){if(this.condition.indexOf("$INDEX")!=-1){this.condition=this.condition.replace(/\$INDEX/g,"$"+d)}}var f=g.fieldGroupCountName||"";if(f!=""){if(this.condition.indexOf("$COUNT")!=-1){this.condition=this.condition.replace(/\$COUNT/g,"$"+f)}}if(this.condition===""||this.condition.toLowerCase()==="true"){this.ignoreCondition=true}else{this.conditionAsts=$$.parseDynamic(this.condition);var e=new InfoPlus.Dynamics.Parser.Compile(this.conditionAsts);this.references=e.getReferenceNameArray()}};a.prototype={styles:null,ignoreCondition:false,condition:"",conditionAsts:null,references:[],isRowStyle:false,isRepeatItemStyle:false,splitStyles:function(g){var h=[];var f=g.split(";");for(var d=0;d<f.length;d++){var e=f[d];var i=e.split(":");if(i.length===2){h.push({name:i[0],value:i[1]})}}return h},getReferedStyle:function(d){return new InfoPlus.Dynamics.ReferedStyle(d,this)}};define("InfoPlus.Dynamics.Style",a)})(window);
(function(a,b){var c=function(h){this.formula=h.formula;this.condition=h.condition||"";var g=h.fieldRowIndexName||"";if(g!=""){if(this.formula.indexOf("$INDEX")!=-1){this.formula=this.formula.replace(/\$INDEX/g,"$"+g);this.isRowIndex=true}if(this.condition.indexOf("$INDEX")!=-1){this.condition=this.condition.replace(/\$INDEX/g,"$"+g)}}var j=h.fieldGroupCountName||"";if(j!=""){if(this.formula.indexOf("$COUNT")!=-1){this.formula=this.formula.replace(/\$COUNT/g,"$"+j)}if(this.condition.indexOf("$COUNT")!=-1){this.condition=this.condition.replace(/\$COUNT/g,"$"+j)}}var k=[];if(this.condition===""||this.condition.toLowerCase()==="true"){this.ignoreCondition=true}else{this.conditionAsts=$$.parseDynamic(this.condition);var f=new InfoPlus.Dynamics.Parser.Compile(this.conditionAsts);k=f.getReferenceNameArray()}this.formulaAsts=$$.parseDynamic(this.formula);f=new InfoPlus.Dynamics.Parser.Compile(this.formulaAsts);var m=f.getReferenceNameArray();var e=[];for(var i=0;i<m.length;i++){var l=m[i];var n=false;for(var d=0;d<k.length;d++){if(k[d]===l){n=true;break}}if(!n){e.push(l)}}this.references=e.concat(k)};c.prototype={formula:"",formulaAsts:null,ignoreCondition:false,condition:"",conditionAsts:null,references:[],isRowIndex:false,getReferedFormula:function(d){return new InfoPlus.Dynamics.ReferedFormula(d,this)}};define("InfoPlus.Dynamics.Formula",c)})(window);
(function(b,c){var a=function(d){this.formula=d.formula;this.condition=d.condition||"";if(this.condition===""||this.condition.toLowerCase()==="true"){this.ignoreCondition=true}else{this.conditionAsts=$$.parseDynamic(d.condition)}this.formulaAsts=$$.parseDynamic(d.formula)};a.prototype={formula:"",formulaAsts:null,ignoreCondition:false,condition:"",conditionAsts:null};define("InfoPlus.Dynamics.InitialFormula",a)})(window);
(function(b,c){var a=function(d,e){this.targetFieldName=d,this.formula=e.formula;this.formulaAsts=e.formulaAsts;this.ignoreCondition=e.ignoreCondition;this.condition=e.condition;this.conditionAsts=e.conditionAsts};a.prototype={targetFieldName:"",formula:"",formulaAsts:null,condition:"",conditionAsts:null,ignoreCondition:false};define("InfoPlus.Dynamics.ReferedFormula",a)})(window);
(function(a,c){var b=function(d,e){this.targetFieldName=d,this.styles=e.styles;this.ignoreCondition=e.ignoreCondition;this.condition=e.condition;this.conditionAsts=e.conditionAsts};b.prototype={targetFieldName:"",style:[],condition:"",conditionAsts:null,ignoreCondition:false};define("InfoPlus.Dynamics.ReferedStyle",b)})(window);
(function(a,c){var b=function(k){this.action=k.action;this.condition=k.condition||"";this.isRepeatItemAction=k.isRepeatItemAction===true;var j=[];var g=k.fieldRowIndexName||"";if(g!=""){if(this.action.indexOf("$INDEX")!=-1){this.action=this.action.replace(/\$INDEX/g,"$"+g)}if(this.condition.indexOf("$INDEX")!=-1){this.condition=this.condition.replace(/\$INDEX/g,"$"+g)}}var i=k.fieldGroupCountName||"";if(i!=""){if(this.action.indexOf("$COUNT")!=-1){this.action=this.action.replace(/\$COUNT/g,"$"+i)}if(this.condition.indexOf("$COUNT")!=-1){this.condition=this.condition.replace(/\$COUNT/g,"$"+i)}}if(this.condition===""||this.condition.toLowerCase()==="true"){this.ignoreCondition=true}else{this.ignoreCondition=false;this.conditionAsts=$$.parseDynamic(this.condition);var f=new InfoPlus.Dynamics.Parser.Compile(this.conditionAsts);j=f.getReferenceNameArray()}this.actionAsts=$$.parseDynamic(this.action);f=new InfoPlus.Dynamics.Parser.Compile(this.actionAsts);var m=f.getReferenceNameArray();var e=[];for(var h=0;h<m.length;h++){var l=m[h];var n=false;for(var d=0;d<j.length;d++){if(j[d]===l){n=true;break}}if(!n){e.push(l)}}this.references=e.concat(j)};b.prototype={action:"",actionAsts:null,ignoreCondition:false,condition:"",conditionAsts:null,references:[],isRepeatItemAction:false,getReferedAction:function(d){return new InfoPlus.Dynamics.ReferedAction(d,this)}};define("InfoPlus.Dynamics.Action",b)})(window);
(function(b,c){var a=function(d,e){this.targetFieldName=d,this.action=e.action;this.actionAsts=e.actionAsts;this.ignoreCondition=e.ignoreCondition;this.condition=e.condition;this.conditionAsts=e.conditionAsts};a.prototype={targetFieldName:"",action:"",actionAsts:null,condition:"",conditionAsts:null,ignoreCondition:true};define("InfoPlus.Dynamics.ReferedAction",a)})(window);
(function(b,c){var a=function(){};a.prototype={context:{},build:function(){var l={},n=[],d={};var m=function(p){var i=p.path;if(l[i]==null){l[i]=[];n.push(i)}l[i].push(p)};$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).each(function(){var i=$(this).data($Control.DATA_CONTROL_OBJECT);if(i==null||i.path==null||i.field==null){return}m(i)});$$.params.renderForm.find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var i=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(i==null||i.path==null||i.groupName==null){return}m(i)});var f=function(q){var s=[];for(var r=0,p=n.length;r<p;r++){var t=n[r];if(t.length>q.length){if(t.substr(0,q.length)===q&&t.substr(q.length,1)==="_"){s.push(t)}}}return s};for(var o in l){if(l.hasOwnProperty(o)){var j=$IU.getReferedControlPaths(o),k=f(o);j=j.concat(k);var h=[];for(var e=0,g=j.length;e<g;e++){h=h.concat(l[j[e]])}d[o]=h}}this.context=d},get:function(e){var d=this.context;if(d.hasOwnProperty(e)){return d[e]}return[]}};define("InfoPlus.Dynamics.Cache",a)})(window);
(function(a,c){var b=function(j,g,f,e,d,i){if(j==null||f==null){return}this.controlType=j;this.path=g;this.field=f;this.render=e;this.initValue=d;this.initDisplayValue=i;if(f.fieldChanging===true){this.onFieldChange=true}if(f.needSync===true){this.onFieldSync=true}var h=this.createControl();if(h==null){this.element=null;this.controlContainer=null}};b.CONTROL_TYPE_EDIT="BoundEdit";b.CONTROL_TYPE_TEXT="BoundRichText";b.CONTROL_TYPE_DATE="BoundDate";b.CONTROL_TYPE_CHECKBOX="BoundCheck";b.CONTROL_TYPE_CHECKBOX_LIST="BoundCheckList";b.CONTROL_TYPE_RADIO="BoundOption";b.CONTROL_TYPE_RADIO_LIST="BoundOptionList";b.CONTROL_TYPE_RADIO_GROUP="BoundOptionGroup";b.CONTROL_TYPE_SELECT="BoundSelect";b.CONTROL_TYPE_REMARK="BoundRemark";b.CONTROL_TYPE_ANCHOR="BoundAnchor";b.CONTROL_TYPE_ACTION="BoundAction";b.CONTROL_TYPE_LABEL="BoundLabel";b.CONTROL_TYPE_HIDDEN="BoundHidden";b.CONTROL_TYPE_SUGGESTER="BoundSuggester";b.CONTROL_TYPE_SUGGESTER2="BoundSuggester2";b.CONTROL_TYPE_FILE="BoundFile";b.CONTROL_TYPE_IMAGE="BoundImage";b.CONTROL_TYPE_PICTURE="BoundPicture";b.CONTROL_TYPE_HELP="BoundHelp";b.CONTROL_TYPE_BUTTON="BoundButton";b.CONTROL_TYPE_LINK_BUTTON="BoundLinkButton";b.CONTROL_TYPE_PASSWORD="BoundPassword";b.CONTROL_TYPE_IFRAME="BoundIFrame";b.CONTROL_TYPE_THING="BoundThing";b.CONTROL_TYPE_CONVERTED_LABEL="BoundConvertedLabel";b.DATA_CONTROL_OBJECT="controlObject";b.DATA_TYPE="dataType";b.DATA_TYPE_STRING="string";b.DATA_TYPE_ANYURI="anyURI";b.DATA_TYPE_XHTML="XHTML";b.DATA_TYPE_INT="integer";b.DATA_TYPE_DOUBLE="double";b.DATA_TYPE_BOOL="boolean";b.DATA_TYPE_DATE="date";b.DATA_TYPE_TIME="time";b.DATA_TYPE_DATETIME="dateTime";b.DATA_TYPE_USER="User";b.DATA_TYPE_ORGANIZE="Organize";b.DATA_TYPE_CODE="Code";b.DATA_TYPE_FILE="File";b.DATA_TYPE_THING="Thing";b.DATA_IS_CONTROL="isControl";b.DATA_PATH="path";b.DATA_RENDER="render";b.DATA_FIELD="field";b.DATA_EXTERNAL_LINK="externalLink";b.DATA_SUGGESTER="suggester";b.DATA_CONTROL_TYPE="controlType";b.DATA_VALIDATOR="validator";b.DATA_VALIDATOR_PROMPT_POSITION="validatorPromptPosition";b.DATA_ORIGIN_INPUT="originInput";b.DATA_SOURCE_CONTROL="sourceControl";b.DATA_ORIGIN_STYLE="originStyle";b.DATA_ATTRIBUTES="attributes";b.DATA_DISPLAY_VALUE="displayValue";b.CLASSNAME_CONTROL="infoplus_control";b.CLASSNAME_READONLY="infoplus_readonly";b.CLASSNAME_WRITABLE="infoplus_writable";b.CLASSNAME_FIELD_CHANGE="infoplus_fieldChange";b.CLASSNAME_VAR="infoplus_var";b.CLASSNAME_ROWINDEX="infoplus_rowIndex";b.CLASSNAME_GROUP_COUNT="infoplus_groupCount";b.prototype={guid:null,compatibleFieldTypes:[],element:null,elementClassName:"",controlContainer:null,onFieldChange:false,onFieldRefer:false,onFieldSync:false,ignoreClass:false,ignoreValidation:false,allowFocus:true,autoTriggerFieldChangeEvent:true,fieldChangeProcessor:new InfoPlus.Controls.Event.FieldChangeEventProcessor(),dynamicProcessor:new InfoPlus.Dynamics.Processor(),events:[],conditionalStyles:[],validatorPromptPosition:null,parentValue:null,maxLength:null,clickFireFieldChange:false,synced:false,tooltip:null,createControl:function(){if(this.checkCompatibility()===false){$IU.delayedErrorMessageBox("字段"+this.field.name+"创建控件时发生错误，请检查数据类型和渲染类型是否匹配！");return null}this.element=this.createElement();if(this.element==null){return null}this.guid=$$.guid();this.setInfopathFormAttributes();this.setControlData();this.setElementAttribute();if(this.ignoreValidation===false){this.processValidation()}this.specialSetting();this.setPermission();this.setPlaceHolder();if(this.isReadable()){this.setValue(this.initValue,this.initDisplayValue,true)}this.addFieldChangeClass();this.registerEvent();return this.element},createElement:function(){return null},createHiddenElement:function(d,f){var e=document.createElement("input");e.type="hidden";$(d).data($Control.DATA_ORIGIN_INPUT,e);$(e).data($Control.DATA_SOURCE_CONTROL,this).data($Control.DATA_CONTROL_TYPE,this.controlType);if(f==null){d.appendChild(e)}else{f.appendChild(e)}},syncValue:function(f,e,d){if(this.autoTriggerFieldChangeEvent===false){this.synced=true}this.setValue(f,e,false,d)},setValue:function(e,d,f){$(this.element).val(e)},getValue:function(){if(this.element!=null){return $(this.element).val()}return null},setStyle:function(d,e){$IU.setDynamicStyle(this.element,d,e)},getStyle:function(d){return $IU.getElementStyle(this.element,d)},getId:function(){return this.element.id},getParentValue:function(){return this.parentValue},getAttributes:function(){return null},getSortValue:function(){var d=this.getValue();if(d instanceof $Controls.Data.ValuePair){return d.displayValue}if(d instanceof $Controls.Data.Uri){return d.value}return d},setElementAttribute:function(){var d=this.element;var e=this.render;d.id=e.controlId+this.path;$(d).attr("name",e.field+this.path);$(d).data($Control.DATA_FIELD,e.field).data($Control.DATA_RENDER,e);if(this.controlContainer!=null){$(this.controlContainer).attr("id",d.id+"_Container")}},setHiddenAttribute:function(h){var d=$(this.element),f=d.data($Control.DATA_ORIGIN_INPUT),e=this.render,g=this.path;this.element.id=h+"_"+$$.guid();f.id=e.controlId+g;f.name=e.field+g;$(f).data($Control.DATA_PATH,g).data($Control.DATA_FIELD,e.field).data($Control.DATA_RENDER,e).data($Control.DATA_IS_CONTROL,true).data($Control.DATA_CONTROL_OBJECT,this);d.data($Control.DATA_FIELD,e.field);if(this.controlContainer!=null){$(this.controlContainer).attr("id",this.element.id+"_Container")}},specialSetting:function(){},getControlContainer:function(){if(this.controlContainer!=null){return this.controlContainer}return this.element},setReadOnly:function(){this.element.readOnly=true;switch(this.controlType){case $Control.CONTROL_TYPE_EDIT:case $Control.CONTROL_TYPE_TEXT:case $Control.CONTROL_TYPE_DATE:case $Control.CONTROL_TYPE_PASSWORD:$(this.element).addClass($Control.CLASSNAME_READONLY);break;case $Control.CONTROL_TYPE_SELECT:case $Control.CONTROL_TYPE_CHECKBOX:case $Control.CONTROL_TYPE_RADIO:case $Control.CONTROL_TYPE_BUTTON:$(this.element).addClass($Control.CLASSNAME_READONLY);this.element.disabled=true;break;case $Control.CONTROL_TYPE_CHECKBOX_LIST:$(this.element).find("input[type=checkbox]").each(function(){$(this).addClass($Control.CLASSNAME_READONLY);this.disabled=true});break;case $Control.CONTROL_TYPE_RADIO_LIST:$(this.element).find("input[type=radio]").each(function(){$(this).addClass($Control.CLASSNAME_READONLY);this.disabled=true});break;case $Control.CONTROL_TYPE_SUGGESTER2:var d=$(this.element).data($Control.DATA_ORIGIN_INPUT);$(this.element).addClass($Control.CLASSNAME_READONLY);d.disabled=true;break;case $Control.CONTROL_TYPE_REMARK:case $Control.CONTROL_TYPE_SUGGESTER:case $Control.CONTROL_TYPE_FILE:case $Control.CONTROL_TYPE_ANCHOR:case $Control.CONTROL_TYPE_LINK_BUTTON:case $Control.CONTROL_TYPE_THING:$(this.element).addClass($Control.CLASSNAME_READONLY);break;case $Control.CONTROL_TYPE_LABEL:case $Control.CONTROL_TYPE_HIDDEN:break}},setDynamicReadOnly:function(d){},setWritableClass:function(){switch(this.controlType){case $Control.CONTROL_TYPE_EDIT:case $Control.CONTROL_TYPE_TEXT:case $Control.CONTROL_TYPE_DATE:case $Control.CONTROL_TYPE_SELECT:case $Control.CONTROL_TYPE_SUGGESTER2:case $Control.CONTROL_TYPE_CHECKBOX:case $Control.CONTROL_TYPE_RADIO:$(this.element).addClass($Control.CLASSNAME_WRITABLE);break;case $Control.CONTROL_TYPE_RADIO_LIST:$(this.element).find("input[type=radio]").addClass($Control.CLASSNAME_WRITABLE);break;case $Control.CONTROL_TYPE_CHECKBOX_LIST:$(this.element).find("input[type=checkbox]").addClass($Control.CLASSNAME_WRITABLE);break;case $Control.CONTROL_TYPE_REMARK:case $Control.CONTROL_TYPE_SUGGESTER:case $Control.CONTROL_TYPE_FILE:break;case $Control.CONTROL_TYPE_ANCHOR:case $Control.CONTROL_TYPE_ACTION:case $Control.CONTROL_TYPE_LABEL:case $Control.CONTROL_TYPE_HIDDEN:break}},checkCompatibility:function(){if(this.field==null||this.render==null||this.render.renderCategory!="Boundable"){return false}return $.inArray(this.field.type,this.compatibleFieldTypes)!=-1},checkDataType:function(d){switch(this.field.type){case InfoPlus.Controls.Control.DATA_TYPE_STRING:case InfoPlus.Controls.Control.DATA_TYPE_ANYURI:case InfoPlus.Controls.Control.DATA_TYPE_XHTML:case InfoPlus.Controls.Control.DATA_TYPE_USER:case InfoPlus.Controls.Control.DATA_TYPE_ORGANIZE:case InfoPlus.Controls.Control.DATA_TYPE_CODE:return $IU.isString(d);case InfoPlus.Controls.Control.DATA_TYPE_INT:case InfoPlus.Controls.Control.DATA_TYPE_DATE:return $IU.isInt(d);case InfoPlus.Controls.Control.DATA_TYPE_DOUBLE:return $IU.isNumber(d);case InfoPlus.Controls.Control.DATA_TYPE_BOOL:return $IU.isBoolean(d)}return false},setControlData:function(){var d=$(this.element);d.data($Control.DATA_TYPE,this.field.type).data($Control.DATA_CONTROL_TYPE,this.controlType).data($Control.DATA_CONTROL_OBJECT,this).data($Control.DATA_IS_CONTROL,true).data($Control.DATA_PATH,this.path).addClass($Control.CLASSNAME_CONTROL).addClass(this.elementClassName);if(this.controlContainer!=null){$(this.controlContainer).data($Control.DATA_CONTROL_OBJECT,this)}},processValidation:function(){var g=this.field;var e=this.element;if(g.notNull===true||g.regEx){var d=g.permission||"";if(d.indexOf("r")!=-1&&d.indexOf("w")==-1){return}var f=$(e).data($Control.DATA_ORIGIN_INPUT);if(f!=c){$(f).data($Control.DATA_VALIDATOR,{required:g.notNull,regEx:g.regEx,prompt:g.prompt,builtIn:false})}$(e).data($Control.DATA_VALIDATOR,{required:g.notNull,regEx:g.regEx,prompt:g.prompt,builtIn:false});if(this.validatorPromptPosition!==null){$(e).data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition)}$IU.addElementValidateClass(e)}},setInfopathFormAttributes:function(){var h=this.element;if(h==null){return}var d=$(h);var k=this.render.attributes;if(k==null||k.length==null||k.length==0){return}for(var g=0;g<k.length;g++){var j=k[g];var f=j.key;if(null!=j.namespace&&""!=j.namespace){f=j.namespace+":"+f}try{switch(f.toLocaleLowerCase()){case"class":if(!this.ignoreClass){d.addClass(j.value)}break;case"hidefocus":case"tabindex":if(this.allowFocus){h.setAttribute(f,j.value)}break;case"onclick":case"value":case"contenteditable":break;default:h.setAttribute(f,j.value);break}}catch(e){}}},isWritable:function(){var e=this.field;if(e!=null){var d=e.permission||"";return d.indexOf("w")!=-1}return false},isReadable:function(){var e=this.field;if(e!=null){var d=e.permission||"";return d.indexOf("r")!=-1}return false},hasNoPowerAtAll:function(){return(!this.isWritable()&&!this.isReadable())},isReadOnly:function(){return(!this.isWritable()&&this.isReadable())},hideControl:function(){this.element.style.display="none";this.element.disabled=true},setPermission:function(){if(this.field==null){return}var d=this.element;if(!this.isReadable()){this.visible(false);return}if(this.isReadOnly()){this.setReadOnly()}if(this.isWritable()){this.setWritableClass()}},addFieldChangeClass:function(){if(this.onFieldChange||this.onFieldRefer||this.onFieldSync){var d=$(this.element).data($Control.DATA_ORIGIN_INPUT);if(d!==c){$(d).addClass($Control.CLASSNAME_FIELD_CHANGE)}else{$(this.element).addClass($Control.CLASSNAME_FIELD_CHANGE)}}},setDynamicStyle:function(d,e){this.dynamicProcessor.processDynamicStyle(this,d,c,c,e)},doDynamicAction:function(d,e){this.dynamicProcessor.processDynamicAction(this,d,c,c,e)},setDynamicValue:function(d,e){this.dynamicProcessor.processDynamicFormula(this,d,c,c,c,e)},fieldChangeEvent:function(d){return this.fieldChangeProcessor.fieldChangeEvent(this,d)},fieldReferEvent:function(g,h,e,j,i,d,f){this.dynamicProcessor.fieldReferEvent(this,g,h,e,j,i,d,f)},fieldSyncEvent:function(){var q=new Date();var s=this.getValue(),g=this.render.field+this.path,j=this.element,p=0,r,k;if(s instanceof $Controls.Data.ValuePair){r=s.displayValue;k=this.getAttributes();s=s.value}if(s instanceof $Controls.Data.Uri){s=s.value}$$.params.fieldSyncing=true;var h=function(d){var i=d.data($Control.DATA_SOURCE_CONTROL);if(i===c){i=d.data($Control.DATA_CONTROL_OBJECT)}return i};var f=document.getElementsByName(g);for(var n=0,o=f.length;n<o;n++){var m=h($(f[n]));if(m==null||f[n]==j||m==this){continue}if(this.controlType==$Control.CONTROL_TYPE_RADIO&&m.controlType==$Control.CONTROL_TYPE_RADIO){continue}var e=m.getValue();if(e instanceof $Controls.Data.Thing){var l=(e.value!=s)||(e.displayValue!=r)}else{if(e!=null&&e.value!==c){e=e.value}l=e!==s}if(!l){continue}m.syncValue(s,r,k);p++}$$.params.fieldSyncing=false},registerEvent:function(){},shouldFireChangeEvent:function(f){if(this.synced===true){this.synced=false;return false}if(this.onFieldChange||this.onFieldRefer||this.onFieldSync){var d=this.getValue(),e=(f!=null&&f.value!==c&&f.displayValue!==c);if(d instanceof $Controls.Data.Uri){return d.value!=f}if(d instanceof $Controls.Data.Thing){if(e){return(d.value!=f.value)||(d.displayValue!=f.displayValue)}else{return(d.displayValue!=f)}}if(d instanceof $Controls.Data.ValuePair){if(e){return(d.value!=f.value)}else{return(d.value!=f)}}if(e){return(d!=f.value)}else{return(d!=f)}}return false},shouldFireChangeEventAgain:function(d){return this.autoTriggerFieldChangeEvent&&this.shouldFireChangeEvent(d)},getDataSource:function(){return null},getDataType:function(){if(this.field==null){return null}return this.field.type},setFocus:function(){if(this.element==null||!this.isReadable()){return}try{this.element.focus()}catch(d){}},lostFocus:function(){if(this.element==null||!this.isReadable()){return}try{this.element.blur()}catch(d){}},getDynamicKeyName:function(){if(this.field==null){return null}return this.field.name},getDynamicContextControlName:function(){if(this.field==null||this.field.name==null){return null}var d=this.field.name;if(d.length>5){if(d.substr(0,5).toLowerCase()=="field"){return"control"+d.substr(5)}}return"control"+d},setPlaceHolder:function(){if(this.element!=null&&this.element.placeholder!==c){if(this.field!=null&&this.field.placeHolder!=null){$(this.element).attr("placeholder",this.field.placeHolder)}}},setParentValue:function(d){if((d instanceof $Controls.Data.ValuePair)||(d instanceof $Controls.Data.Uri)){this.parentValue=d.value}else{this.parentValue=d}},visible:function(d){if(this.element==null){return}if(d){if(this.isReadable()){if(this.isWritable()){$(this.element).removeAttr("disabled")}$(this.element).show();if(this.controlContainer!=null){$(this.controlContainer).show()}}}else{$(this.element).attr("disabled","disabled").hide();if(this.controlContainer!=null){$(this.controlContainer).hide()}}},convertEmptyValue:function(d){if(d==null||d===""){return""}else{return d}},getRow:function(){var d=this.controlContainer,e=d==null?this.element:d;return $(e).parents("tr,.infoplus_repeatingSection").first()},setMaxLength:function(){if(this.field.settings!=null){if(this.field.settings.maxLength!=null){var d=parseInt(this.field.settings.maxLength,10);if(!isNaN(d)&&d!==0){this.maxLength=d}}}},getGroupName:function(){if(this.field==null){return""}var d=this.field;if(d.groupArray.length<2){return""}return d.groupArray[d.groupArray.length-1]},getGroupRowIndexName:function(){if(this.field==null){return""}var d=this.field;if(d.groupArray.length<2){return""}var e=d.groupArray[d.groupArray.length-1];e=e.substr(0,1).toUpperCase()+e.substr(1);return"field"+e+"RowIndex"+$$.params.rowIndexSuffix},getGroupCountName:function(){if(this.field==null){return""}var d=this.field;if(d.groupArray.length<2){return""}var e=d.groupArray[d.groupArray.length-1];e=e.substr(0,1).toUpperCase()+e.substr(1);return"field"+e+"Count"+$$.params.rowIndexSuffix},isDetailControl:function(){if(this.element==null){return false}return $(this.element).parents(".detailCell").size()>0||$(this.element).parents(".detailSection").size()>0},setTooltip:function(d){try{if(d==""){this.tooltip=null}else{this.tooltip=$.parseJSON(d);if(typeof this.tooltip!="object"){this.tooltip={tip:d,type:"info"}}}}catch(f){this.tooltip={tip:d,type:"info"}}},showTooltip:function(){if(this.tooltip==null||this.tooltip.tip==""){return}$(this.element).validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",true);$(this.element).one("blur",function(){$(this).validationEngine("hidePrompt")})}};define("InfoPlus.Controls.Control",b);a.$Controls=InfoPlus.Controls;a.$Control=InfoPlus.Controls.Control})(window);
(function(c,d){var b=function(h,g,f,e,i){$Control.call(this,$Control.CONTROL_TYPE_ANCHOR,h,g,f,e,i)};b.DEFAULT_TEXT="";b.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_CODE],ignoreValidation:true,allowFocus:false,elementClassName:"infoplus_anchorControl",clickFireFieldChange:true,createElement:function(){var j=this.field;var h=this.initValue;if(h==null||h==""){h="#"}var g=document.createElement("a");var e=$(g);var i=b.DEFAULT_TEXT;if(this.initDisplayValue!=null&&this.initDisplayValue!=""){i=this.initDisplayValue}else{if(j.settings!=null&&j.settings.displayText!=null){i=j.settings.displayText}}e.text(i);var f=new InfoPlus.ExternalLink(h,j.settings,i);g.setAttribute("href","＃");g.setAttribute("target",f.mode==InfoPlus.ExternalLink.MODE_SELF?"_self":"_blank");e.data("href",h).data($Control.DATA_EXTERNAL_LINK,f);return g},setValue:function(h,g){var e=$(this.element).data($Control.DATA_EXTERNAL_LINK);if(e==null){return}if(h!=null&&h!=""){e.endPoint=h}else{e.endPoint="#"}var f=b.DEFAULT_TEXT;if(g!=null&&g!=""){f=g}else{if(this.field.settings!=null&&this.field.settings.displayText!=null){f=this.field.settings.displayText}}$(this.element).text(f)},getValue:function(){var e=$(this.element).data($Control.DATA_EXTERNAL_LINK);if(e==null){switch(this.field.type){case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri("");case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair("","")}return""}switch(this.field.type){case $Control.DATA_TYPE_STRING:return e.endPoint;case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri(e.endPoint);case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair(e.endPoint,$(this.element).text())}return""},getSortValue:function(){return this.element.innerHTML},getAttributes:function(){if(this.field.type==$Control.DATA_TYPE_ANYURI){var e=this.getValue();return $IU.getParamFromUrl(e.value)}return null},registerEvent:function(){this.events=InfoPlus.Controls.Anchor.Events.events},setDynamicReadOnly:function(e){if(e){$(this.element).addClass($Control.CLASSNAME_READONLY)}else{$(this.element).removeClass($Control.CLASSNAME_READONLY)}}});define("InfoPlus.Controls.Anchor",b);var a={onActionClick:function(){var k=$(this).data($Control.DATA_CONTROL_OBJECT),j=k.field,h=$(this).data($Control.DATA_EXTERNAL_LINK),g=h.endPoint,f=this;if(j==null){return false}if($(f).data("clickFromCode")===true){$(f).data("clickFromCode",false);return true}var e=function(){f.href=g;h.href=g;return(!h.openWindow())};if(j.placeHolder!=null&&j.placeHolder!=""){if(!confirm(j.placeHolder)){return false}}if(j.fieldChanging===true){var i={};i=$$.getFormRender().save(i,k.isDetailControl());k.fieldChangeEvent(i).done(function(){var l=$$.getFormRender();l.doDynamicStyles($IU.getAllControls(),false);l.doDynamicActions($IU.getAllControls(),false)}).done(function(){$$.fieldChanged($$(k))}).done(function(){$$(k).fieldChanged()}).done(function(){g=$(f).data($Control.DATA_EXTERNAL_LINK).endPoint;if(e()){$(f).data("clickFromCode",true);$IU.fireClick(f.id)}});return false}else{return e()}}};a.events=[{type:"click",handler:a.onActionClick}];define("InfoPlus.Controls.Anchor.Events",a)})(window);
(function(c,d){var b=function(h,g,f,e){g.fieldChanging=true;$Control.call(this,$Control.CONTROL_TYPE_BUTTON,h,g,f,e)};b.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],ignoreClass:true,ignoreValidation:true,elementClassName:"infoplus_buttonControl",clickFireFieldChange:true,createElement:function(){var f=document.createElement("button"),g=this.field.settings,h=(g!=null&&g.displayText!=null)?g.displayText:((this.initValue==null)?"按钮":this.initValue);var e=document.createElement("div");this.createHiddenElement(f,e);f.setAttribute("type","button");$(f).text(h).addClass("btn").addClass("btn-default");e.appendChild(f);this.controlContainer=e;$(e).addClass("infoplus_buttonControlContainer");return f},setValue:function(f,e){if(this.field.settings!=null&&this.field.settings.displayText!=null){f=this.field.settings.displayText}$(this.element).val(f)},getValue:function(){return this.convertEmptyValue($(this.element).val())},registerEvent:function(){this.events=InfoPlus.Controls.Button.Events.events},triggerChange:function(){var e=$(this.element),f=e.data($Control.DATA_ORIGIN_INPUT);if(this.onFieldChange){e.attr("disabled","disabled")}$(f).change()}});define("InfoPlus.Controls.Button",b);var a={onButtonClick:function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT),f=e.field;if(f==null){return false}if(e.isReadOnly()||$(e.element).hasClass($Control.CLASSNAME_READONLY)){return false}if(f.placeHolder!=null&&f.placeHolder!=""){$IU.yesNoBox(f.placeHolder,400,function(){e.triggerChange()})}else{e.triggerChange()}return false}};a.events=[{type:"click",handler:a.onButtonClick}];define("InfoPlus.Controls.Button.Events",a)})(window);
(function(c,d){var b=function(h,g,f,e){g.fieldChanging=true;$Control.call(this,$Control.CONTROL_TYPE_LINK_BUTTON,h,g,f,e)};b.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],ignoreClass:true,ignoreValidation:true,elementClassName:"infoplus_linkButtonControl",clickFireFieldChange:true,createElement:function(){var g=document.createElement("a"),e=$(g),h=this.field.settings,i=(h!=null&&h.displayText!=null)?h.displayText:((this.initValue==null)?"按钮":this.initValue);var f=document.createElement("div");this.createHiddenElement(g,f);e.text(i);g.setAttribute("href","＃");f.appendChild(g);this.controlContainer=f;$(f).addClass("infoplus_buttonControlContainer");return g},setValue:function(e){if(this.field.settings!=null&&this.field.settings.displayText!=null){e=this.field.settings.displayText}$(this.element).text(e)},getValue:function(){return $(this.element).text()},registerEvent:function(){this.events=InfoPlus.Controls.LinkButton.Events.events},setDynamicReadOnly:function(e){if(e){$(this.element).addClass($Control.CLASSNAME_READONLY)}else{$(this.element).removeClass($Control.CLASSNAME_READONLY)}},triggerChange:function(){var e=$(this.element),f=e.data($Control.DATA_ORIGIN_INPUT);if(this.onFieldChange){e.attr("disabled","disabled")}$(f).change()}});define("InfoPlus.Controls.LinkButton",b);var a={onButtonClick:function(){if($(this).is("[disabled]")){return false}var e=$(this).data($Control.DATA_CONTROL_OBJECT),f=e.field;if(f==null){return false}if(e.isReadOnly()||$(e.element).hasClass($Control.CLASSNAME_READONLY)){return false}if(f.placeHolder!=null&&f.placeHolder!=""){$IU.yesNoBox(f.placeHolder,400,function(){e.triggerChange()})}else{e.triggerChange()}return false}};a.events=[{type:"click",handler:a.onButtonClick}];define("InfoPlus.Controls.LinkButton.Events",a)})(window);
(function(b,d){var a=function(h,g,f,e){$Control.call(this,$Control.CONTROL_TYPE_CHECKBOX,h,g,f,e,null)};a.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_BOOL],elementClassName:"infoplus_checkControl",createElement:function(){var e=document.createElement("input");e.type="checkbox";return e},setValue:function(e){if(e==null){e=false}if($IU.isString(e)){e=(e.toLowerCase()=="true")}if(e===true){this.element.checked=true}else{this.element.checked=false}},getValue:function(){return this.element.checked},getSortValue:function(){return this.getValue()?1:0},registerEvent:function(){this.events=InfoPlus.Controls.Check.Events.events}});define("InfoPlus.Controls.Check",a);var c={onCheckChange:function(e){var h=$(this).data($Control.DATA_CONTROL_OBJECT),g=h.field;if(g!=null&&g.placeHolder!=null&&g.placeHolder!=""){if(h.checkFromConfirm===true){h.checkFromConfirm=false;return}var f=$(this).is(":checked");h.setValue(!f);$IU.yesNoBox(g.placeHolder,400,function(){h.setValue(f);h.checkFromConfirm=true;$(h.element).change()});e.stopImmediatePropagation();return false}}};c.events=[{type:"change",handler:c.onCheckChange}];define("InfoPlus.Controls.Check.Events",c)})(window);
(function(c,d){var a=function(m,l,j,h){var f=null;if(l.code!=null){var k=$$.codeManager.getCode(l.code);if(k!=null){f=[];for(var g=0,e=k.items.length;g<e;g++){f.push({id:k.items[g].codeId,text:k.items[g].codeName})}}}this.items=f;$Control.call(this,$Control.CONTROL_TYPE_CHECKBOX_LIST,m,l,j,h)};a.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],ignoreClass:true,autoTriggerFieldChangeEvent:false,elementClassName:"infoplus_checkListControl",createElement:function(){var e=document.createElement("div");this.createHiddenElement(e);this.setDataSourceFromItems(e,this.items,true);return e},setValue:function(j,i,k){if(j==null){j=""}var h=!(!!k)&&this.shouldFireChangeEvent(j);var e=$(this.element);var g=e.data($Control.DATA_ORIGIN_INPUT);switch(this.field.type){case $Control.DATA_TYPE_STRING:g.value=j;break}var f=j.split(",");$(this.element).find("input[type=checkbox]").each(function(){this.checked=$IU.arrayContains(f,$IU.trimString($(this).val()))});if(h){setTimeout(function(){$(g).change()},0)}},getValue:function(){if(this.field==null||this.element==null){return""}var e="";$(this.element).find("input[type=checkbox]").each(function(){if(this.checked){e+=$IU.trimString(this.value)+","}});if(e!=""){e=e.substr(0,e.length-1)}return e},setDataSourceFromItems:function(h,l,g){var f=$(h).data($Control.DATA_ORIGIN_INPUT);var p=g?f.value:this.getValue(),o=(p==null||p=="")?[]:p.split(",");$(h).children("label").remove();if($IU.isArray(l)){for(var j=0,k=l.length;j<k;j++){var q=l[j];var n=document.createElement("label");var m=document.createElement("input");m.type="checkbox";m.value=q.id;if($IU.arrayContains(o,$IU.trimString(q.id))){m.checked=true}var e=document.createTextNode(q.text);$(n).append(m);$(n).append(e);h.appendChild(n)}}},showTooltip:function(){if(this.tooltip==null||this.tooltip.tip==""){return}var e=$(this.element);e.validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",true);e.find("input").one("blur",function(){e.validationEngine("hidePrompt")})},setDataSource:function(j,k){this.items=[];if($IU.isString(j)){if(j.indexOf("\n")!=-1){var f=j.split("\n")}else{f=j.split(",")}for(var g=0,e=f.length;g<e;g++){var h=f[g];this.items.push({id:h,text:h})}}this.setDataSourceFromItems(this.element,this.items,k);this.setPermission()},specialSetting:function(){var e=$(this.element).attr("style");if(e!=null){e=e.toLowerCase();if(e.indexOf("height:")!==-1){$(this.element).css("min-height",$(this.element).css("height"));$(this.element).css("height","")}}},setElementAttribute:function(){this.setHiddenAttribute("checkList")},registerEvent:function(){this.events=InfoPlus.Controls.CheckList.Events.events}});define("InfoPlus.Controls.CheckList",a);var b={onClick:function(){var e=$(this).parent().siblings("input[type=hidden]");var f=$(e).data($Control.DATA_CONTROL_OBJECT);$(e).val(f.getValue());$(e).change()}};b.events=[{type:"click",selector:".infoplus_checkListControl > label > input[type=checkbox]",handler:b.onClick}];define("InfoPlus.Controls.CheckList.Events",b)})(window);
(function(c,e){var b=function(i,h,g,f){$Control.call(this,$Control.CONTROL_TYPE_DATE,i,h,g,f,null)};b.DEFAULT_VALIDATOR_REGEX="^(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8]))))|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))-02-29)$";b.DEFAULT_VALIDATOR_PROMPT="请正确输入日期";b.INPUT_TYPE_DATE_SUPPORT=true;var a=function(){return $$.MOBILE&&b.INPUT_TYPE_DATE_SUPPORT};b.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_DATE],elementClassName:"infoplus_dateControl",createElement:function(){var f=document.createElement("input");if(a()){try{f.type="date"}catch(g){b.INPUT_TYPE_DATE_SUPPORT=false;f.type="text"}}else{f.type="text"}return f},setValue:function(f){if(f==null){f=""}if(f!=""&&isNaN(f)===false){this.element.value=$IU.unixTimeToDateString(f)}else{this.element.value=""}},getValue:function(){var f=this.convertEmptyValue(this.element.value);f=$IU.dateStringToUnixTime(f);if(f!=null&&f!=""&&!isNaN(f)){return f}else{return""}},getSortValue:function(){var f=this.getValue();return f==""?0:f},addDefaultValidator:function(){var f=this.field.permission||"";if(f.indexOf("r")!=-1&&f.indexOf("w")==-1){return}var g=$(this.element);var h=g.data($Control.DATA_VALIDATOR);if(h==null){g.data($Control.DATA_VALIDATOR,{required:this.field.notNull,regEx:b.DEFAULT_VALIDATOR_REGEX,prompt:b.DEFAULT_VALIDATOR_PROMPT,builtIn:true})}else{if(h.regEx==null||h.regEx==""){h.regEx=b.DEFAULT_VALIDATOR_REGEX;h.prompt=b.DEFAULT_VALIDATOR_PROMPT;h.builtIn=(!h.required===true)}}},specialSetting:function(){if(!a()){this.initDatePicker()}this.addDefaultValidator()},initDatePicker:function(){if(a()){return}var f=this.field.permission||"";if(f.indexOf("w")!=-1){$(document).ready($.proxy(this.initDatePickerOption,this))}},reInitDatePicker:function(){if(a()){return}var f=this.field.permission||"";if(f.indexOf("w")!=-1){$(this.element).datepicker("destroy");this.initDatePickerOption()}},initDatePickerOption:function(h){var f=this.field.permission||"";if(f.indexOf("w")!=-1){var g={dateFormat:"yy-mm-dd",changeYear:true,beforeShow:this.onDatePickerBeforeShow,onClose:this.onDatePickerClose,yearRange:"c-100:c+50"};this.options=$.extend({},g,h);$(this.element).datepicker(this.options)}},onDatePickerBeforeShow:function(f,h){var g=$(this).data($Control.DATA_VALIDATOR);if(g===e||g===null){return}if(g.required===true||(g.regEx&&g.prompt)){$IU.removeElementValidateClass(this)}if($(f).attr("readonly")){return false}},onDatePickerClose:function(h,g){var f=$(this).data($Control.DATA_VALIDATOR);if(f===e||f===null){return}if(f.required===true||(f.regEx&&f.prompt)){$IU.addElementValidateClass(this);$$.params.renderForm.validationEngine("validateField","#"+this.id)}},registerEvent:function(){this.events=InfoPlus.Controls.Date.Events.events}});define("InfoPlus.Controls.Date",b);var d={onChange:function(){var i=$(this).data($Control.DATA_CONTROL_OBJECT),h=i.getValue();var k=i.field.name;if(k.length>4){if(k.substr(k.length-4)=="From"){var j=k.lastIndexOf("From");var g=k.substr(0,j)+k.substr(j).replace(/From/,"To")+i.path;var f=$$.params.renderForm.find("."+i.elementClassName+"[name='"+g+"'");if(f.length>0){if(a()){if(h!=""){f.attr("min",$IU.unixTimeToDateString(h))}else{f.attr("min","")}}else{f.datepicker("destroy");if(h!=""){f.data($Control.DATA_CONTROL_OBJECT).initDatePickerOption({minDate:$IU.unixTimeToDate(h)})}else{f.data($Control.DATA_CONTROL_OBJECT).initDatePickerOption()}}}}}}};d.events=[{type:"change",handler:d.onChange}];define("InfoPlus.Controls.Date.Events",d)})(window);
(function(b,c){var a=function(g,f,e,d){$Control.call(this,$Control.CONTROL_TYPE_EDIT,g,f,e,d,null)};a.DEFAULT_VALIDATOR_REGEX_INTEGER="^-?\\d+$";a.DEFAULT_VALIDATOR_REGEX_DOUBLE="^(-?\\d+)(\\.\\d+)?$";a.DEFAULT_VALIDATOR_PROMPT_INTEGER="请正确输入整数";a.DEFAULT_VALIDATOR_PROMPT_DOUBLE="请正确输入数值";a.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_INT,$Control.DATA_TYPE_DOUBLE],elementClassName:"infoplus_editControl",createElement:function(){var d=document.createElement("input");d.type="text";if(this.field.placeHolder!=null){$(d).attr("placeholder",this.field.placeHolder)}return d},addDefaultValidator:function(){var d=this.field.permission||"";if(d.indexOf("r")!=-1&&d.indexOf("w")==-1){return}var f=this.field.type;if(f!=$Control.DATA_TYPE_INT&&f!=$Control.DATA_TYPE_DOUBLE){return}var e=$(this.element);var g=e.data($Control.DATA_VALIDATOR);if(g==null){if(f==$Control.DATA_TYPE_INT){e.data($Control.DATA_VALIDATOR,{required:this.field.notNull,regEx:a.DEFAULT_VALIDATOR_REGEX_INTEGER,prompt:a.DEFAULT_VALIDATOR_PROMPT_INTEGER,builtIn:true})}else{e.data($Control.DATA_VALIDATOR,{required:this.field.notNull,regEx:a.DEFAULT_VALIDATOR_REGEX_DOUBLE,prompt:a.DEFAULT_VALIDATOR_PROMPT_DOUBLE,builtIn:true})}$IU.addElementValidateClass(this.element)}else{if(g.regEx==null||g.regEx==""){g.regEx=(f==$Control.DATA_TYPE_INT)?a.DEFAULT_VALIDATOR_REGEX_INTEGER:a.DEFAULT_VALIDATOR_REGEX_DOUBLE;g.prompt=(f==$Control.DATA_TYPE_INT)?a.DEFAULT_VALIDATOR_PROMPT_INTEGER:a.DEFAULT_VALIDATOR_PROMPT_DOUBLE;g.builtIn=(!g.required===true);$IU.addElementValidateClass(this.element)}}},specialSetting:function(){this.setMaxLength();if(this.maxLength!=null){$(this.element).attr("maxlength",this.maxLength)}this.addDefaultValidator()},setValue:function(e){if(e==null){e=""}switch(this.field.type){case $Control.DATA_TYPE_STRING:if(this.maxLength!=null){e=e.substr(0,this.maxLength)}$(this.element).val(e);break;case $Control.DATA_TYPE_INT:var d=parseInt(e,10);$(this.element).val(isNaN(d)?"":d);break;case $Control.DATA_TYPE_DOUBLE:var f=parseFloat(e);$(this.element).val(isNaN(f)?"":f);break}},getValue:function(){if(this.field==null||this.element==null){return""}var f=this.convertEmptyValue(this.element.value);switch(this.field.type){case $Control.DATA_TYPE_STRING:f=f||"";if(this.maxLength!=null){f=f.substr(0,this.maxLength)}return f;case $Control.DATA_TYPE_INT:var d=parseInt(f);return isNaN(d)?"":d;case $Control.DATA_TYPE_DOUBLE:var e=parseFloat(f);return isNaN(e)?"":e}return""},getSortValue:function(){var d=this.getValue();if((this.field.type==$Control.DATA_TYPE_INT||this.field.type==$Control.DATA_TYPE_DOUBLE)&&d==""){return 0}else{return d}}});define("InfoPlus.Controls.Edit",a)})(window);
(function(a,c){var b=function(h,g,f,e,i,d){$Control.call(this,$Control.CONTROL_TYPE_HIDDEN,h,g,f,e,i);if(this.element!=null&&d!=null){$(this.element).data($Control.DATA_ATTRIBUTES,d)}};b.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_INT,$Control.DATA_TYPE_DOUBLE,$Control.DATA_TYPE_BOOL,$Control.DATA_TYPE_DATE,$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE,$Control.DATA_TYPE_THING],autoTriggerFieldChangeEvent:false,ignoreValidation:true,allowFocus:false,elementClassName:"infoplus_hiddenControl",createElement:function(){var d=document.createElement("input");d.type="hidden";return d},getAttributes:function(){if(this.field.type==$Control.DATA_TYPE_ANYURI){var d=this.getValue();return $IU.getParamFromUrl(d.value)}return $(this.element).data($Control.DATA_ATTRIBUTES)},setValue:function(g,f,i,d){if(g==null){g=""}var e=!(!!i)&&this.shouldFireChangeEvent(g);var h=$(this.element);h.val(g);h.data($Control.DATA_ATTRIBUTES,d);h.data($Control.DATA_DISPLAY_VALUE,f);if(e){setTimeout(function(){h.change()},0)}},getValue:function(){if(this.field==null||this.element==null){return""}var h=this.convertEmptyValue(this.element.value),e=$(this.element).data($Control.DATA_DISPLAY_VALUE);switch(this.field.type){case $Control.DATA_TYPE_STRING:case $Control.DATA_TYPE_XHTML:return h;case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri(h);case $Control.DATA_TYPE_INT:var f=parseInt(h);return isNaN(f)?"":f;case $Control.DATA_TYPE_DOUBLE:var g=parseFloat(h);return isNaN(g)?"":g;case $Control.DATA_TYPE_BOOL:return h.toLowerCase()=="true";case $Control.DATA_TYPE_DATE:var d=parseInt(h);return isNaN(d)?"":d;case $Control.DATA_TYPE_USER:case $Control.DATA_TYPE_ORGANIZE:case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair(h,e);case $Control.DATA_TYPE_THING:return new $Controls.Data.Thing(h,e)}return""},getSortValue:function(){var e=this.getValue();var d=this.field.type;if(d==$Control.DATA_TYPE_BOOL){return e?1:0}if((d==$Control.DATA_TYPE_INT||d==$Control.DATA_TYPE_DOUBLE||d==$Control.DATA_TYPE_DATE)&&e==""){return 0}if(d==$Control.DATA_TYPE_USER||d==$Control.DATA_TYPE_ORGANIZE||d==$Control.DATA_TYPE_CODE||d==$Control.DATA_TYPE_THING){return e.displayValue}return e}});define("InfoPlus.Controls.Hidden",b)})(window);
(function(b,c){var a=function(i,h,g,f,j,e,d){this.isConverted=(d===true);$Control.call(this,$Control.CONTROL_TYPE_LABEL,i,h,g,f,j);if(this.element!=null&&e!=null){$(this.element).data($Control.DATA_ATTRIBUTES,e)}};a.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_XHTML,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_INT,$Control.DATA_TYPE_DOUBLE,$Control.DATA_TYPE_BOOL,$Control.DATA_TYPE_DATE,$Control.DATA_TYPE_DATETIME,$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE,$Control.DATA_TYPE_THING],ignoreClass:true,ignoreValidation:true,allowFocus:false,autoTriggerFieldChangeEvent:false,elementClassName:"infoplus_labelControl",isConverted:false,createElement:function(){var d=document.createElement("div");var e=document.createElement("div");this.createHiddenElement(e,d);d.appendChild(e);this.controlContainer=d;$(d).addClass("infoplus_labelControlContainer");if(this.isConverted&&$$.params.tenantReadOnlyStyle=="Underline"){$(d).addClass("underline")}return e},getAttributes:function(){if(this.field.type==$Control.DATA_TYPE_ANYURI){var d=this.getValue();return $IU.getParamFromUrl(d.value)}return $(this.element).data($Control.DATA_ATTRIBUTES)},setValue:function(e,q,l,j){if(e==null){e=""}if(q==null){q=""}var f=!(!!l)&&this.shouldFireChangeEvent(e);var o=$(this.element);var h=o.data($Control.DATA_ORIGIN_INPUT);h.value=e;switch(this.field.type){case $Control.DATA_TYPE_DATE:if(e!=""&&isNaN(e)===false){e=parseInt(e,10);o.text($IU.unixTimeToDateString(e))}else{o.text("")}break;case $Control.DATA_TYPE_DATETIME:if(e!=""&&isNaN(e)===false){e=parseInt(e,10);if($IU.isSameTimezone()){o.text($IU.unixTimeToLocalTimeString(e))}else{var n=document.createElement("span");$(n).text($IU.unixTimeToLocalTimeString(e));o.append(n);var k=document.createElement("i");var g=$(k);g.addClass("i-icon-clock-o help");o.append(k);var p="当前时区:"+$IU.getTimezoneString(-$IU.stdTimezoneOffset())+"<br>";p+=$IU.getTimezoneString($$.params.tenantTimeZoneOffset/60)+" "+$IU.unixTimeToString(e);g.attr("original-title",p);g.tipsy({html:true,fade:true,gravity:"w",trigger:"manual",opacity:0.9});g.click(function(){$(this).tipsy("show")}).mouseenter(function(){$(this).tipsy("show")}).mouseleave(function(){$(this).tipsy("hide")})}}else{o.text("")}break;case $Control.DATA_TYPE_USER:case $Control.DATA_TYPE_ORGANIZE:case $Control.DATA_TYPE_CODE:o.text(q).data($Control.DATA_DISPLAY_VALUE,q);break;case $Control.DATA_TYPE_XHTML:o.html(e);break;case $Control.DATA_TYPE_INT:var m=parseInt(e,10);o.text(isNaN(m)?"":m);break;case $Control.DATA_TYPE_THING:o.text(q);break;default:var d=InfoPlus.Utilities.htmlEncode(e.toString()||"");o.html(d)}o.data($Control.DATA_ATTRIBUTES,j);if(f){setTimeout(function(){$(h).change()},0)}},getValue:function(){if(this.field==null||this.element==null){return""}var f=this.element;var g=$(f).data($Control.DATA_ORIGIN_INPUT);var j=this.convertEmptyValue(g.value);var e=$(f).data($Control.DATA_DISPLAY_VALUE);switch(this.field.type){case $Control.DATA_TYPE_STRING:case $Control.DATA_TYPE_XHTML:return j;case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri(j);case $Control.DATA_TYPE_DATE:case $Control.DATA_TYPE_DATETIME:var d=parseInt(j);return isNaN(d)?"":d;case $Control.DATA_TYPE_INT:var h=parseInt(j);return isNaN(h)?"":h;case $Control.DATA_TYPE_DOUBLE:var i=parseFloat(j);return isNaN(i)?"":i;case $Control.DATA_TYPE_BOOL:return j.toLowerCase()=="true";case $Control.DATA_TYPE_USER:case $Control.DATA_TYPE_ORGANIZE:case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair(j,e);case $Control.DATA_TYPE_THING:return new $Controls.Data.Thing(j,e)}return""},getSortValue:function(){var e=this.getValue();var d=this.field.type;if(d==$Control.DATA_TYPE_BOOL){return e?1:0}if((d==$Control.DATA_TYPE_INT||d==$Control.DATA_TYPE_DOUBLE||d==$Control.DATA_TYPE_DATE||d==$Control.DATA_TYPE_DATETIME)&&e==""){return 0}if(d==$Control.DATA_TYPE_USER||d==$Control.DATA_TYPE_ORGANIZE||d==$Control.DATA_TYPE_CODE||d==$Control.DATA_TYPE_THING){return e.displayValue}return e},setElementAttribute:function(){this.setHiddenAttribute("label")},specialSetting:function(){var d=$(this.element).attr("style"),e=false;if(d!=null){d=d.toLowerCase();if(d.indexOf("height:")===-1){e=true}else{$(this.element).css("min-height",$(this.element).css("height"));$(this.element).css("height","")}}else{e=true}if(e){$(this.element).addClass("inline");$(this.controlContainer).addClass("inline")}if(this.isWritable()&&this.field.type==$Control.DATA_TYPE_XHTML){$IU.debugTip("标签控件"+this.field.name+"数据类型为xhtml且具有可写权限，这可能引起安全问题","warning")}}});define("InfoPlus.Controls.Label",a)})(window);
(function(b,c){var a=function(g,f,e,d){$Control.call(this,$Control.CONTROL_TYPE_RADIO,g,f,e,d,null)};a.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],elementClassName:"infoplus_radioControl",createElement:function(){var d=document.createElement("input");d.type="radio";d.value=this.render.onValue;return d},setValue:function(d){if(d==null){d=""}this.element.checked=(d==this.element.value)},getValue:function(){var d=this;if(this.element.checked){return this.convertEmptyValue(this.element.value)}else{var e="";$("."+this.elementClassName+"[name="+this.element.name+"]").each(function(){if(this.checked){e=d.convertEmptyValue(this.value)}});return e}},shouldFireChangeEventAgain:function(d){return d==this.element.value&&this.shouldFireChangeEvent(d)}});define("InfoPlus.Controls.Radio",a)})(window);
(function(b,d){var c=function(m,k,f,j,l,h,g){var i=null;if(k.code!=null){var e=$$.codeManager.getCode(k.code);if(e!=null){i=e.items}if(i==null||($IU.isArray(i)&&i.length==0)){if(e==null||(e!=null&&e.codeType==="External")){$$.codeManager.addRequestCode(k.code,k.name)}}}this.items=i;this.parentValue=h;if(j!==""){if(i==null||($IU.isArray(i)&&i.length==0)){this.items=[{codeId:j,codeName:l,enabled:true,parentId:h,attributes:g}]}}$Control.call(this,$Control.CONTROL_TYPE_RADIO_LIST,m,k,f,j,l)};c.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_CODE],ignoreClass:true,elementClassName:"infoplus_radioListControl",validatorPromptPosition:"topLeft",createElement:function(){var e=document.createElement("div");if($IU.isArray(this.items)){this.setOptions(e,this.items,this.initValue)}return e},setValue:function(f,p,l,j){if(f==null){f=""}if(j!=null&&j.datasource!=null){var n=[];var e=$IU.splitAttribute(j.datasource),o=$IU.splitAttribute(j.datasource_Names);for(k=0,m=e.length;k<m;k++){n.push({codeId:e[k],codeName:o[k]!=null?o[k]:e[k],enabled:true})}this.setOptions(this.element,n,f)}else{var h=$(this.element).find("input[type=radio]");for(var k=0,m=h.length;k<m;k++){var g=h[k];g.checked=g.value==f}}},getValue:function(){var f=$(this.element).find("input[type=radio]");for(var j=0,e=f.length;j<e;j++){var g=f[j];if(g.checked){var h=$(g).parent().text();return new $Controls.Data.ValuePair(g.value,h,this.parentValue)}}return new $Controls.Data.ValuePair("","",this.parentValue)},setDataSourceFromItems:function(g,e,h,i){var f=this.getValue();this.setOptions(g,e,h)},setElementAttribute:function(){var e=$(this.element),f=this.render;this.element.id="optionListDiv_"+$$.guid();e.attr("name",f.field+this.path);e.data($Control.DATA_FIELD,f.field).data($Control.DATA_RENDER,f)},addValidation:function(f){var g=this.field;if(g.notNull===true||g.regEx){var e=g.permission||"";if(e.indexOf("r")!=-1&&e.indexOf("w")==-1){return}$(f).data($Control.DATA_VALIDATOR,{required:g.notNull,regEx:g.regEx,prompt:g.prompt,builtIn:false}).data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition);$IU.addElementValidateClass(f)}},processValidation:function(){var l=this.field;var k=this.element;if(l.notNull===true||l.regEx){var f=l.permission||"";if(f.indexOf("r")!=-1&&f.indexOf("w")==-1){return}var g=$(k).find("input[type=radio]");g.data($Control.DATA_VALIDATOR,{required:l.notNull,regEx:l.regEx,prompt:l.prompt,builtIn:false});if(this.validatorPromptPosition!==null){g.data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition)}for(var j=0,e=g.length;j<e;j++){var h=g[j];$IU.addElementValidateClass(h)}}},registerEvent:function(){},setOptions:function(j,m,n){var q=this.field,l=this.parentValue,u=this.path,e=this.render.field+u;if(n===d){n=this.initValue}var f=function(i){if(q.code!=null){if(q.parent==null){return true}else{return l==i.parentId}}else{if(q.parent==null){return true}else{return l==i.parentId}}};var r=function(i){return !(i.isEnabled===false||i.enabled===false)};$(j).children("label").remove();if($IU.isArray(m)){for(var h=0,k=m.length;h<k;h++){var t=m[h];if(r(t)&&f(t)){var p=document.createElement("label");var o=document.createElement("input");o.type="radio";o.value=t.codeId;o.name="radioList-"+e;o.id=e+"-"+h;if(n==$IU.trimString(t.codeId)){o.checked=true}$(o).data($Control.DATA_IS_CONTROL,true).data($Control.DATA_CONTROL_OBJECT,this);var s=t.codeName;if((t.description||"")!=""){s=s+"("+$IU.trimString(t.description)+")"}var g=document.createTextNode(s);$(p).append(o);$(p).append(g);j.appendChild(p);this.addValidation(o)}}}this.items=m},showTooltip:function(){if(this.tooltip==null||this.tooltip.tip==""){return}var e=$(this.element);e.validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",true);e.find("input").one("blur",function(){e.validationEngine("hidePrompt")})},setDataSource:function(j,k){if(!this.isWritable()){return}var f=this.getValue();if(f==null){f=""}else{f=f.value}this.items=[];if($IU.isArray(j)){for(var g=0,e=j.length;g<e;g++){var h=j[g];if(h.value!==d&&h.displayValue!==d){this.items.push({codeId:h.value,codeName:h.displayValue,enabled:true,parentId:h.parentId})}}}this.setOptions(this.element,this.items,f)},setParentValue:function(f,g){var e=this.getValue();if(e==null){e=""}else{e=e.value}if((f instanceof $Controls.Data.ValuePair)||(f instanceof $Controls.Data.Uri)){this.parentValue=f.value}else{this.parentValue=f}this.setOptions(this.element,this.items,e)}});define("InfoPlus.Controls.RadioList",c);var a={onClick:function(){var f=$(this).data($Control.DATA_CONTROL_OBJECT);var e=f.getValue();$(f.element).data($Control.DATA_ORIGIN_INPUT).value=(e!=null)?e.value:""}};a.events=[{type:"click",handler:a.onClick}];define("InfoPlus.Controls.RadioList.Events",a)})(window);
(function(c,d){var a=function(h,g,f,e){$Control.call(this,$Control.CONTROL_TYPE_RADIO_GROUP,h,g,f,e,null)};a.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_BOOL],elementClassName:"infoplus_radioGroupControl",createElement:function(){var e=document.createElement("input");e.type="radio";e.value=true;return e},unselectSiblings:function(){var e=this.path;if(this.getValue()===true){$$("&"+this.field.name).each(function(){var f=this.control;if($IU.isSibling(e,f.path)){f.setValue(false)}})}},setValue:function(e){if(e===true){this.element.checked=true;this.unselectSiblings()}else{this.element.checked=false}},getValue:function(){return this.element.checked},registerEvent:function(){this.events=InfoPlus.Controls.RadioGroup.Events.events}});define("InfoPlus.Controls.RadioGroup",a);var b={onClick:function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);e.unselectSiblings()}};b.events=[{type:"click",handler:b.onClick}];define("InfoPlus.Controls.RadioGroup.Events",b)})(window);
(function(b,d){var c=function(h,g,f,e){$Control.call(this,$Control.CONTROL_TYPE_REMARK,h,g,f,e,null)};c.HAS_VALUE="infoplus_remarkControl_has_value";c.NO_VALUE="infoplus_remarkControl_no_value";c.prototype=$.extend(new $Controls.Control(),{autoTriggerFieldChangeEvent:false,compatibleFieldTypes:[$Control.DATA_TYPE_STRING],allowFocus:false,remarkValue:"",elementClassName:"infoplus_remarkControl",createElement:function(){var e=document.createElement("div");this.createHiddenElement(e);$(e).tipsy({html:true,fade:true,gravity:$.fn.tipsy.autoWE,trigger:"manual"});return e},setValue:function(j,i,k){if(j==null){j=""}if(this.maxLength!=null){j=j.substr(0,this.maxLength)}var e=this.element;var h=$(e).data($Control.DATA_ORIGIN_INPUT);var g=!(!!k)&&this.shouldFireChangeEvent(j);h.value=j;if(j===""){$(e).removeClass(InfoPlus.Controls.Remark.HAS_VALUE).addClass(InfoPlus.Controls.Remark.NO_VALUE)}else{$(e).removeClass(InfoPlus.Controls.Remark.NO_VALUE).addClass(InfoPlus.Controls.Remark.HAS_VALUE)}var f='<div class="tipsy-inner-infoplus">'+$IU.htmlEncode(j)+"</div>";e.setAttribute("original-title",f);if(g){setTimeout(function(){$(h).change()},0)}},getValue:function(){var e=$(this.element).data($Control.DATA_ORIGIN_INPUT);var f=this.convertEmptyValue(e.value);f=f.replace(/\r\n/g,"\n");if(this.maxLength!=null){f=f.substr(0,this.maxLength)}return f},setTipEncodeInnerHtml:function(m,j){var g=function(i,n){if(n>52){i.style.width="365px"}else{i.style.width=parseInt(n*7)+5+"px"}i.style.whiteSpace="normal"};var h="";if(m==null||m.length==0){g(j,0);j.innerHTML="";return}var l=1;var e=0;var k=0;for(var f=0;f<m.length;f++){if(f>j.maxCharCount){$(j).html(h+"...");k+=3;if(k>e){e=k}g(j,e);return}if(m.charCodeAt(f)>127||m.charCodeAt(f)==94){k+=2}else{k+=1}if(k>e){e=k}switch(m.substr(f,1)){case"<":h+="&lt;";break;case">":h+="&gt;";break;case"&":h+="&amp;";break;case" ":if(m.substr(f+1,1)==" "){h+=" &nbsp;";f++}else{h+=" "}break;case'"':h+="&quot;";break;case"\n":if(++l>j.maxLineCount){$(j).html(h+"...");k+=3;if(k>e){e=k}g(j,e);return}else{h+="<br>";k=0}break;default:h+=m.substr(f,1);break}}g(j,e);$(j).html(h)},showRemarkDialog:function(){var h=this.element,s=this,r=document.createElement("textarea"),q="请输入文本内容";r.setAttribute("id","form_remark_textarea");if(this.field.placeHolder!=null){$(r).attr("placeholder",this.field.placeHolder)}var k=r;if(this.maxLength!=null&&this.isWritable()){var e=document.createElement("div"),o=$(e);o.addClass("infoplus_textareaControlContainer");o.append(r);var g=document.createElement("span");$(g).addClass("infoplus_textareaControlMaxLengthTip");o.append(g);$(g).hide();k=e;o.css("margin-bottom","20px");$(g).css("bottom","-17px")}if(h.readOnly===true){r.readOnly=true;$(r).addClass($Control.CLASSNAME_READONLY)}$(r).val($(h).data($Control.DATA_ORIGIN_INPUT).value);var n;if(h.readOnly===true){n=[]}else{n=[{name:"确定",defaultButton:true,callOnClose:true,callback:function(){s.setValue($(r).val());var u=$(h).data($Control.DATA_VALIDATOR);if(u===d||u===null){return}if(u.required===true||(u.regEx&&u.prompt)){$$.params.renderForm.validationEngine("validateField","#"+h.id)}}},{name:"取消"}]}var t={container:$$.params.renderForm,title:q,content:k,maxWidth:600,buttons:n};if(this.tooltip!=null&&this.tooltip.tip!=""){t.onShow=function(){setTimeout(function(){$(r).validationEngine("showPrompt",$IU.htmlEncode(s.tooltip.tip),s.tooltip.type,"topRight",true);$(r).on("blur",function(){$(this).validationEngine("hidePrompt")});$(r).on("focus",function(){$(r).validationEngine("showPrompt",$IU.htmlEncode(s.tooltip.tip),s.tooltip.type,"topRight",true)})},300)};t.onClose=function(){$(r).validationEngine("hidePrompt")}}var m=new InfoPlus.Render.Dialog(t);m.show();var f=this.maxLength;if(f!=null&&this.isWritable()){var j=function(){var v=$(r).val();var u=v.replace(/\r\n/g,"~").replace(/\n/g,"~").length;return{used:u,remaining:f-u}};var l=function(v){var u=j();var w=$(g);w.text(u.used+"/"+f);if(u.remaining>0){w.css("color","green")}else{w.css("color","red")}if(w.data("hideTipTimer")!=null){clearTimeout(w.data("hideTipTimer"))}if(v===true){w.show("slide",{direction:"right"},500)}else{w.show()}var x=setTimeout(function(){w.fadeOut(1000)},3000);w.data("hideTipTimer",x)};var i=function(){var u=j();var v=$(g);v.text("最多可输入"+f+"个字符");if(u.remaining>0){v.css("color","green")}else{v.css("color","red")}if(v.data("hideTipTimer")!=null){clearTimeout(v.data("hideTipTimer"))}v.show();var w=setTimeout(function(){v.hide("slide",{direction:"right"},1000,function(){l(true)})},5000);v.data("hideTipTimer",w)};var p=function(){var u=j();if(u.remaining>=0){return}var x=r,v=$(x).val().split(/\r\n|\n/),y="",w=0;while(y.length<f&&w<v.length){y+=v[w].substring(0,f-y.length)+"\n";w++}$(x).val(y.substring(0,f));x.scrollTop=x.scrollHeight;l()};$(r).keypress(function(w){var x=$(r).val(),u=x.replace(/\r\n/g,"~").replace(/\n/g,"~").length;var v=String.fromCharCode(w.charCode==null?w.keyCode:w.charCode);return(w.ctrlKey||w.metaKey||v=="\u0000"||u<f)});$(r).focus(function(u){i()});$(r).keyup(function(u){l();p()})}return false},registerEvent:function(){this.events=InfoPlus.Controls.Remark.Events.events},setElementAttribute:function(){this.setHiddenAttribute("remark")},specialSetting:function(){this.setMaxLength();var e=$(this.element);e.css("width","").css("height","")},showTooltip:function(){}});define("InfoPlus.Controls.Remark",c);var a={onClick:function(){var e=$(this).data($Control.DATA_CONTROL_OBJECT);e.showRemarkDialog()},onMouseEnter:function(){if(!$$.MOBILE){if($(this).data($Control.DATA_ORIGIN_INPUT).value!=""){$(this).tipsy("show")}}},onMouseLeave:function(){if(!$$.MOBILE){$(this).tipsy("hide")}}};a.events=[{type:"mouseenter",handler:a.onMouseEnter},{type:"mouseleave",handler:a.onMouseLeave},{type:"click",handler:a.onClick}];define("InfoPlus.Controls.Remark.Events",a)})(window);
(function(b,c){var a=function(l,j,e,i,k,g,f){var h=null;if(j.code!=null){var d=$$.codeManager.getCode(j.code);if(d!=null){h=d.items}if(h==null||($IU.isArray(h)&&h.length==0)){if(d==null||(d!=null&&d.codeType==="External")){$$.codeManager.addRequestCode(j.code,j.name)}}}this.items=h;this.parentValue=g;if(i!==""){if(h==null||($IU.isArray(h)&&h.length==0)){this.items=[{codeId:i,codeName:k,enabled:true,parentId:g,attributes:f}]}}$Control.call(this,$Control.CONTROL_TYPE_SELECT,l,j,e,i,k)};a.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_CODE],elementClassName:"infoplus_selectControl",emptyOption:null,setDataSourceFromItems:function(f,d,g,i){var e=this.getValue();this.setOptions(f,d,g);if(i!==true){if(f.selectedIndex===0){if(this.field.notNull===true&&f.options.length==2){f.options[1].selected=true}}$IU.highLightElement(f);var h=this.getValue();if(this.onFieldChange||this.onFieldRefer||this.onFieldSync){if(e.value!=h.value){setTimeout(function(){$(f).change()},0)}}}},createElement:function(){var e=document.createElement("select");if(this.isReadOnly()){if(this.initValue!=null){var f=document.createElement("option");f.value=this.initValue;f.text=this.initDisplayValue;f.selected=true;e.add(f)}}else{var d=document.createElement("option");d.value="";d.text="-请选择-";$(d).addClass("emptyOption");e.add(d);this.emptyOption=d;if($IU.isArray(this.items)){this.setOptions(e,this.items,this.initValue)}else{}}return e},setPlaceHolder:function(){if(this.emptyOption!=null){if(this.field!=null&&this.field.placeHolder!=null&&this.field.placeHolder!=""){$($(this.element).children()[0]).text(this.field.placeHolder)}}},setValue:function(f,o,k,h){if(f==null){f=""}if(h!=null&&h.datasource!=null){var m=[];var d=$IU.splitAttribute(h.datasource),n=$IU.splitAttribute(h.datasource_Names);for(j=0,l=d.length;j<l;j++){m.push({codeId:d[j],codeName:n[j]!=null?n[j]:d[j],enabled:true})}this.setOptions(this.element,m,f)}else{var g=this.element.options,l=g.length,e=false;for(var j=1;j<l;j++){if(g[j].value==f){g[j].selected=true;e=true}}if(!e){if(k===true&&(f==null||f=="")&&this.field.notNull===true&&l==2){this.element.selectedIndex=1}else{this.element.selectedIndex=0}}}},getValue:function(){var d=this.element.selectedIndex;if(d<0){return new $Controls.Data.ValuePair("","",this.parentValue)}var f=this.element.options[d].value;var e=this.element.options[d].text;if(d==0&&f==""){e=""}return new $Controls.Data.ValuePair(f,e,this.parentValue)},getAttributes:function(){var d=this.element.selectedIndex;if(d==-1){return null}if(this.items==null){return null}var g=this.element.options[d].value;if(g==""){return null}if($IU.isArray(this.items)){for(var f=0,e=this.items.length;f<e;f++){if(this.items[f].enabled==true&&this.items[f].codeId==g){return this.items[f].attributes}}}return null},getDataSource:function(){var e=[];var f=this.element.options;for(var g=0,d=f.length;g<d;g++){var h=f[g];if(g===0&&h.value==""){continue}e.push(new $Controls.Data.ValuePair(h.value,h.text,this.parentValue))}return e},setOptions:function(e,k,l){var m=this.field,j=this.parentValue;if(l===c){l=e.value}var d=function(i){if(m.code!=null){if(m.parent==null){return true}else{return j==i.parentId}}else{if(m.parent==null){return true}else{return j==i.parentId}}};var n=function(i){return !(i.isEnabled===false||i.enabled===false)};e.options.length=1;if(!$IU.isArray(k)){return}for(var f=0,h=k.length;f<h;f++){var o=k[f];if(n(o)&&d(o)){var g=document.createElement("option");g.value=o.codeId;g.text=o.codeName;if(o.codeId==l){g.selected=true}e.add(g)}}this.items=k},setDataSource:function(h,j){if(!this.isWritable()){return}var e=this.element.value;this.items=[];if($IU.isArray(h)){for(var f=0,d=h.length;f<d;f++){var g=h[f];if(g.value!==c&&g.displayValue!==c){this.items.push({codeId:g.value,codeName:g.displayValue,enabled:true,parentId:g.parentId})}}}this.setDataSourceFromItems(this.element,this.items,e,j)},setParentValue:function(e,f){var d=this.element.value;if((e instanceof $Controls.Data.ValuePair)||(e instanceof $Controls.Data.Uri)){this.parentValue=e.value}else{this.parentValue=e}this.setDataSourceFromItems(this.element,this.items,d,f)},specialSetting:function(){var d=$(this.element);if(d.css("text-align").toLocaleLowerCase()=="right"){d.attr("dir","rtl")}}});define("InfoPlus.Controls.Select",a)})(window);
(function(a,c){var b=function(n,j,d,k,i,l,h,m,g,f,e){this.parentValue=h;this.suggestService=g;this.initializeService=f;this.tipFormat=m;this.formRender=k;$Control.call(this,$Control.CONTROL_TYPE_SUGGESTER,n,j,d,i,l);if(this.element!=null&&e!=null){$(this.element).data(InfoPlus.Suggester.DATA_SUGGESTER_ATTRIBUTES,e)}};b.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE],autoTriggerFieldChangeEvent:false,elementClassName:"infoplus_suggesterControl",createElement:function(){var d=document.createElement("select");return d},getAttributes:function(){return $(this.element).data(InfoPlus.Suggester.DATA_SUGGESTER_ATTRIBUTES)},setValue:function(g,f,h,d){if(g==null){g=""}if(f==null){f=""}var e=$(this.element).data($Control.DATA_SUGGESTER);if(e==null){return}$(this.element).data(InfoPlus.Suggester.DATA_SUGGESTER_ATTRIBUTES,d);e.setData({codeId:g,codeName:f,attributes:d},f)},getValue:function(){var e=this.element;var g=this.convertEmptyValue(e.value);var f=$(e).data($Control.DATA_SUGGESTER);if(f==null){return new $Controls.Data.ValuePair("","",this.parentValue)}var d=f.text||"";return new $Controls.Data.ValuePair(g,d,this.parentValue)},getSortValue:function(){return this.getValue().displayValue},setStyle:function(d,f){var e=$(this.element).data($Control.DATA_SUGGESTER);e.setSuggesterStyle(d,f)},getStyle:function(d){var e=$(this.element).data($Control.DATA_SUGGESTER);return e.getSuggesterStyle(d)},specialSetting:function(){this.createSuggester()},setDynamicReadOnly:function(e){if(e){this.element.readOnly=true;var d=$(this.element).data($Control.DATA_SUGGESTER);$(d.activeInput).addClass(InfoPlus.Suggester.CLASSNAME_READONLY)}else{this.element.readOnly=false;var d=$(this.element).data($Control.DATA_SUGGESTER);$(d.activeInput).removeClass(InfoPlus.Suggester.CLASSNAME_READONLY)}},createSuggester:function(){var h=this.field;var d=this.element;var f=h.type;var g=h.code;if(f==$Control.DATA_TYPE_CODE&&g==null){$IU.delayedErrorMessageBox("字段"+h.name+"创建控件时发生错误，请检查是否设置了代码表！");return null}var i=this.configSuggesterMode();var e=new InfoPlus.Suggester(h,d,this.initValue,this.initDisplayValue,f,g,i,this.tipFormat,this.suggestService,this.initializeService);$(d).data($Control.DATA_SUGGESTER,e);this.controlContainer=e.container;$(this.controlContainer).data($Control.DATA_CONTROL_OBJECT,this).attr("id",this.element.id+"_Container");if($(d).css("text-align").toLocaleLowerCase()=="right"){$(e.activeInput).css("text-align","right")}return e},configSuggesterMode:function(){var d=this.field.permission||"";var f=this.field;var e=f.type;var g=0;if(d.indexOf("w")<0){g|=InfoPlus.Suggester.MODE_FLAG_READONLY}if(d.indexOf("w")<0&&d.indexOf("r")<0){g|=InfoPlus.Suggester.MODE_FLAG_DISAPPEAR}if(e==$Control.DATA_TYPE_USER){g|=InfoPlus.Suggester.MODE_FLAG_DISABLE_MULTIPAGE}if(f.notNull===false){g|=InfoPlus.Suggester.MODE_FLAG_EMPTY_ITEM_APPEAR}if(f.allowExternalCode===true){g|=InfoPlus.Suggester.MODE_FLAG_EXTERNAL_VALUE}return g},setPlaceHolder:function(){if(this.field!=null&&this.field.placeHolder!=null){var e=$(this.element).data($Control.DATA_SUGGESTER);if(e!=null){var d=e.activeInput;if(d!=null&&d.placeholder!==c){$(d).attr("placeholder",this.field.placeHolder)}}}},setFocus:function(){var d=$(this.element).data($Control.DATA_SUGGESTER);d.containerClick()},lostFocus:function(){var d=$(this.element).data($Control.DATA_SUGGESTER);if(d.activeInput){d.activeInput.blur()}},hideControl:function(){this.controlContainer.style.display="none"},getDataSource:function(){var f=$(this.element).data($Control.DATA_SUGGESTER);if(f==null){return[]}var h=[];for(var e=0,g=f.suggestData,d=g.length;e<d;e++){h.push({value:g[e].codeId,displayValue:g[e].codeName})}return h},showTooltip:function(){if(this.tooltip==null||this.tooltip.tip==""){return}var d=$(this.controlContainer).find(".active_input");d.validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",true);d.one("blur",function(){$(this).validationEngine("hidePrompt")})},setParentValue:function(d,f){var e=this.parentValue;if((d instanceof $Controls.Data.ValuePair)||(d instanceof $Controls.Data.Uri)){this.parentValue=d.value}else{this.parentValue=d}if(f!==true&&$$.params.fieldChanging==null&&(e!=this.parentValue)){this.setValue("","");$IU.highLightElement(this.element)}},visible:function(d){if(this.controlContainer==null){return}if(d){$(this.controlContainer).show()}else{$(this.controlContainer).hide()}}});define("InfoPlus.Controls.Suggester",b)})(window);
(function(a,c){var b=function(o,m,d,k,n,h,i,f,j){var g={ajax:{url:i,delay:250,dataType:"json",type:"POST",data:this.getQueryData(m),processResults:this.processQueryResults,transport:this.ajaxTransport},allowClear:true,dropdownAutoWidth:(j!==true),language:{errorLoading:function(){return"无法载入结果"},inputTooLong:function(q){var p=q.input.length-q.maximum;return"请删除"+p+"个字符"},inputTooShort:function(q){var p=q.minimum-q.input.length;return"请再输入至少"+p+"个字符"},loadingMore:function(){return"载入更多结果…"},maximumSelected:function(p){return"最多只能选择"+p.maximum+"个结果"},noResults:function(){return"未找到结果"},searching:function(q){$$.params.suggeseter2={query:q};var p=q.term||"";if(p.length==0){return m.type.toLocaleLowerCase()=="user"?"请输入汉字,拼音,账号,学工号,院系(多个条件空格分隔)":"请输入汉字或拼音(支持拼音首字母)"}else{return"搜索中..."}}},templateResult:this.formatState};this.option=g;this.parentValue=h;this.initAttributes=f;this.suggestService=i;this.dataType=m.type;this.isOnPagePopup=j;if(j===true){m.needSync=true}$Control.call(this,$Control.CONTROL_TYPE_SUGGESTER2,o,m,d,k,n);var l=$(this.element).data($Control.DATA_ORIGIN_INPUT),e=$(l);e.data("ajaxOption",g)};b.PAGE_ITEM_COUNT=15;b.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE],elementClassName:"infoplus_select2Control",searchResults:[],formatState:function(f){var e=function(l){var k=0,i="";if(l==null){return i}for(var j=0;j<l.length;j++){if((l.charCodeAt(j)<0)||(l.charCodeAt(j)>255)){k+=2}else{k++}}k=Math.round(k/2);for(j=0;j<k;j++){i+="　"}return i};var g=function(o,p){var k=$$.params.suggeseter2.query.term||"";var q=k.toLocaleLowerCase().split(/[ ]|,/);if(q.length==0){return{index:-1,len:0}}var m=-1,r=0;for(var l=0,n=q.length;l<n;l++){if(q[l].length==0){continue}var j=o.indexOf(q[l],p);if(j!=-1&&(m==-1||j<m)){m=j;r=q[l].length}}return{index:m,len:r}};var d=function(l){var j=l.toLocaleLowerCase(),i=0,k="";var m=g(j,i);while(m.index!=-1){k+=l.substring(i,m.index);k+="<u>"+l.substr(m.index,m.len)+"</u>";i=m.index+m.len;m=g(j,i)}k+=l.substr(i);return k};if(f.item==null){return f.text}else{if(f.item.duplicated!==true){var h=g(f.item.codeId,0);if(h.index!=-1){return $("<span>"+(d(f.text)+e(f.item.codeId))+'</span><span class="tip">'+d(f.item.codeId)+"</span>")}else{return $("<span>"+d(f.text)+"</span>")}}else{return $("<span>"+(d(f.text)+e(f.item.codeId))+'</span><span class="tip">'+d(f.item.codeId)+"</span>")}}},getQueryData:function(d){return function(f){var e=this.data($Control.DATA_CONTROL_OBJECT);if(e==null){return null}return{formStepId:$$.params.formStepId==c?0:$$.params.formStepId,prefix:f.term==null?"":f.term,type:d.type,code:d.code||"",parent:e.parentValue||"",isTopLevel:d.parent==null,pageNo:isNaN(f.page)?0:f.page-1,rand:Math.random()*999,settings:$.toJSON(d.settings==null?{}:d.settings)}}},processQueryResults:function(w,v){var k=w.items;var g=this.$element.data($Control.DATA_CONTROL_OBJECT);if(v._type=="query"){g.searchResults=[]}var p=function(x,z){var A=[];for(var y=0,l=x.length;y<l;y++){var B=x[y];if((B.codeName||"")==(z.codeName||"")){A.push(B)}}return A};var d=function(z,A){for(var y=0,x=z.length;y<x;y++){var l=z[y];if(l.id==A.codeId){return l}}return null};var e=function(i){var l=$IU.trimString(i.codeName)||"";if(i.description!=null&&i.description!=""){l+="("+$IU.trimString(i.description)+")"}return l};var t=function(i){if(i>100000){return"大于10万"}if(i>10000){return"大于1万"}if(i>1000){return"大于1千"}return i};for(var q=0,r=k.length,n=[];q<r;q++){var u=k[q];var j=e(u);var s=p(g.searchResults,u);if(s.length>0){u.duplicated=true;for(var f=0,o=s.length;f<o;f++){var m=s[f];m.duplicated=true;var h=d(n,m);if(h!=null){h.item.duplicated=true}else{this.container.$results.find(".select2-results__option").each(function(){var i=$(this).data("data");if(i!=null){$(this).html(g.formatState(i))}})}}}u.text=j;g.searchResults.push(u);n.push({id:u.codeId,name:$IU.trimString(u.codeName)||"",text:j,attributes:u.attributes,item:u})}if(g.dataType.toLocaleLowerCase()=="user"&&w.total>b.PAGE_ITEM_COUNT){n.push({id:" ",name:"",text:"共找到"+t(w.total)+"位用户,请输入更多条件(姓名、拼音、学工号、院系等,以空格分隔)",attributes:null,item:null})}return{results:n,pagination:{more:g.dataType.toLocaleLowerCase()=="user"?false:r>=b.PAGE_ITEM_COUNT}}},ajaxTransport:function(h,g,d){if(h.data.type.toLocaleLowerCase()=="user"){var f=h.data.prefix||"";if(f.length<2){return}}h.needParse=false;h.showParseErrMsg=false;h.showAjaxErrMsg=false;var e=$$.ajax(h);e.done(g).fail(d)},createElement:function(){var e=document.createElement("div");var d=document.createElement("select");var f=document.createElement("option");f.value="";f.text="";d.add(f);if(this.initValue!=null&&this.initValue!=""){f=document.createElement("option");f.value=this.initValue||"";f.text=this.initDisplayValue||"";f.selected=true;d.add(f)}$(e).data($Control.DATA_ORIGIN_INPUT,d);$(d).data($Control.DATA_SOURCE_CONTROL,this).data($Control.DATA_CONTROL_TYPE,this.controlType);this.controlContainer=e;$(e).addClass("infoplus_suggester2ControlContainer");e.appendChild(d);return e},getAttributes:function(){var d=$(this.element).data($Control.DATA_ORIGIN_INPUT),e=$(d);if(e.data("select2Object")!=null){var f=e.select2("data");return f!=null&&f.length>0?f[0].attributes:null}else{return this.initAttributes}},setValue:function(i,h,k,e){if(i==null){i=""}if(h==null){h=""}var d=$(this.element).data($Control.DATA_ORIGIN_INPUT),f=$(d).data("select2Object");d.options.length=0;var j=document.createElement("option");j.value="";j.text="";d.add(j);if(i!=""){j=document.createElement("option");j.value=i;j.text=h;j.selected=true;d.add(j)}if(f!=null){f.val(i).trigger("change");var g=$(d).find("option:selected").data("data");if(g!=null){g.name=g.text;g.attributes=e}}},getValue:function(){var e=$(this.element).data($Control.DATA_ORIGIN_INPUT),f=$(e).data("select2Object");if(f!=null){var j=$(e).select2("data");if(j!=null&&j.length>0){return new $Controls.Data.ValuePair($IU.trimString(j[0].id),j[0].name,this.parentValue)}else{return new $Controls.Data.ValuePair("","",this.parentValue)}}else{var h=e.options,d=h.length;for(var g=0;g<d;g++){var k=h[g];if(k.selected==true){return new $Controls.Data.ValuePair(k.value,k.text,this.parentValue)}}return new $Controls.Data.ValuePair("","",this.parentValue)}},getSortValue:function(){return this.getValue().displayValue},setElementAttribute:function(){this.setHiddenAttribute("suggester2")},specialSetting:function(){var d=$(this.element).data($Control.DATA_ORIGIN_INPUT),e=this.element.getAttribute("style");if(e!=null){d.setAttribute("style",e)}},initSelect2:function(){var l=$(this.element).data($Control.DATA_ORIGIN_INPUT),e=$(l),m=e.css("height"),h=e.data("ajaxOption"),i=e.select2(h);e.removeAttr("style");e.data("select2Object",i);var g=e.find("option:selected").data("data");if(g!=null){g.name=g.text;g.attributes=this.initAttributes}if(!this.isReadable()){this.visible(false)}var j=e.siblings(".select2"),k=j.find(".select2-selection__arrow");k.children().remove();var d=parseInt(m,10);if(!isNaN(d)&&d!=0){var f=j.find(".select2-selection");f.css("height",d+"px");f.find(".select2-selection__rendered").css("height",d+"px").css("line-height",d+"px");k.css("height",(d-2)+"px")}k.addClass(this.dataType.toLocaleLowerCase());if(this.isOnPagePopup===true){$(this.element).css("width","100%");j.css("width","100%")}this.initEvent()},initEvent:function(){var d=$(this.element).data($Control.DATA_ORIGIN_INPUT),g=$(d),f=g.data("select2Object"),e=this;if(this.field.parent!=null){f.on("select2:opening",function(h){var i=$(this);if(i.data("openAgain")!==true){setTimeout(function(){i.data("openAgain",true);f.select2("open");i.data("openAgain",false)},0);return false}else{if($IU.shouldShowSuggesterPage()&&e.isOnPagePopup!==true){$IU.clearAllError();$IU.showSuggester2Page(e);return false}}})}else{if($IU.shouldShowSuggesterPage()&&e.isOnPagePopup!==true){f.on("select2:opening",function(h){$IU.clearAllError();$IU.showSuggester2Page(e);return false})}}f.on("select2:select",function(j){var i=$(this),m=i.find("option:selected");m.text(j.params.data.name);var l=m.data("data");l.text=l.name;i.find("option").not(":selected").each(function(){if($(this).val()!=""){$(this).remove()}});if(e.isOnPagePopup===true){var h=i.closest(".mobile_page_div");if(h.length>0){var k=h.data(InfoPlus.Render.Mobile.Page.DATA_PAGE_OBJECT);if(k!=null){k.close()}}}});if(this.dataType.toLocaleLowerCase()=="user"){f.on("select2:selecting",function(h){if(($IU.trimString((h.params.args.data.id))||"")==""){return false}})}f.on("select2:open",function(){var j=$(this).closest("div.dialog");if(j.length>0){var i=j.parent().css("z-index");if((i||"")!=""){f.data("select2").$dropdown.css("z-index",i)}}if(e.isOnPagePopup===true){var h=$(this).closest(".mobile_page_div");if(h.length>0){f.data("select2").$dropdown.css("z-index",h.css("z-index"))}}})},setPlaceHolder:function(){if(this.field!=null&&this.field.placeHolder!=null){this.option.placeholder=this.field.placeHolder}else{this.option.placeholder=""}},showTooltip:function(){if(this.tooltip==null||this.tooltip.tip==""){return}var e=this.tooltip;var d=$(this.element);setTimeout(function(){var f=null;$(".select2-container").each(function(){if(!$(this).hasClass("select2")){f=$(this)}});if(f!=null){if(f.offset().top<d.offset().top){d.validationEngine("showPrompt",$IU.htmlEncode(e.tip),e.type,"bottomLeft",true)}else{d.validationEngine("showPrompt",$IU.htmlEncode(e.tip),e.type,"topLeft",true)}$(".select2-search__field").one("blur",function(){d.validationEngine("hidePrompt")})}},300)},setParentValue:function(f,h){if((f instanceof $Controls.Data.ValuePair)||(f instanceof $Controls.Data.Uri)){this.parentValue=f.value}else{this.parentValue=f}var d=$(this.element).data($Control.DATA_ORIGIN_INPUT);if(h!==true&&$$.params.fieldChanging==null){d.options.length=0;var g=document.createElement("option");g.value="";g.text="";d.add(g);this.setValue("","");var e=$(d).data("select2Object");if(e!=null){$IU.highLightElement(d)}}},visible:function(e){if(this.element==null){return}var d=$(this.element).data($Control.DATA_ORIGIN_INPUT),h=$(d),g=h.data("select2Object");if(e){h.show()}else{h.hide()}if(g!=null){var f=h.siblings(".select2");if(e){f.show()}else{f.hide()}}},setDynamicReadOnly:function(e){var f=$(this.element),d=f.data($Control.DATA_ORIGIN_INPUT);if(e){d.disabled=true;f.addClass($Control.CLASSNAME_READONLY)}else{d.disabled=false;f.removeClass($Control.CLASSNAME_READONLY)}}});define("InfoPlus.Controls.Suggester2",b)})(window);
(function(e,a){var i=function(m,l,k,j){$Control.call(this,$Control.CONTROL_TYPE_TEXT,m,l,k,j,null)};i.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_XHTML],elementClassName:"infoplus_textareaControl",createElement:function(){var j=document.createElement("textarea");if(this.field.placeHolder!=null){$(j).attr("placeholder",this.field.placeHolder)}return j},setValue:function(j){if(j==null){j=""}if(this.maxLength!=null){j=j.substr(0,this.maxLength)}$(this.element).val(j)},registerEvent:function(){if(this.maxLength!=null&&this.isWritable()){this.events=InfoPlus.Controls.Text.Events.events}},specialSetting:function(){this.setMaxLength();if(this.maxLength!=null&&this.isWritable()){var l=document.createElement("div"),j=$(l);j.addClass("infoplus_textareaControlContainer");j.append(this.element);var k=document.createElement("span");$(k).addClass("infoplus_textareaControlMaxLengthTip");j.append(k);if(this.element.style.width!=null){j.css("width",this.element.style.width)}this.maxLengthTipSpan=k;this.controlContainer=l;$(k).hide()}if(this.isWritable()&&this.field.type==$Control.DATA_TYPE_XHTML){$IU.debugTip("大文本控件"+this.field.name+"数据类型为xhtml且具有可写权限，这可能引起安全问题","warning")}},getValue:function(){var j=this.convertEmptyValue(this.element.value);j=j.replace(/\r\n/g,"\n");if(this.maxLength!=null){j=j.substr(0,this.maxLength)}return j}});define("InfoPlus.Controls.Text",i);var c=function(l){var k=$(l.element).val();var j=k.replace(/\r\n/g,"~").replace(/\n/g,"~").length;return{used:j,remaining:l.maxLength-j}};var d=function(k,l,j){if(k.remaining>0){l.removeClass("incorrect").addClass("correct")}else{l.removeClass("correct").addClass("incorrect")}if(j){l.addClass("length")}else{l.removeClass("length")}};var f=function(n,k){var m=n.maxLength,j=c(n);var l=$(n.maxLengthTipSpan);l.text(j.used+"/"+m);d(j,l,true);if(n.hideTipTimer!=null){clearTimeout(n.hideTipTimer)}if(k===true){l.show("slide",{direction:"right"},500)}else{l.show()}n.hideTipTimer=setTimeout(function(){l.fadeOut(1000)},3000)};var b=function(m){var l=m.maxLength,j=c(m);var k=$(m.maxLengthTipSpan);k.text("最多可输入"+l+"个字符");d(j,k,false);if(m.hideTipTimer!=null){clearTimeout(m.hideTipTimer)}k.show();m.hideTipTimer=setTimeout(function(){k.hide("slide",{direction:"right"},1000,function(){f(m,true)})},5000)};var h=function(p){var j=c(p);if(j.remaining>=0){return}var n=p.element,l=p.maxLength,k=$(n).val().split(/\r\n|\n/),o="",m=0;while(o.length<l&&m<k.length){o+=k[m].substring(0,l-o.length)+"\n";m++}$(n).val(o.substring(0,l));n.scrollTop=n.scrollHeight;f(p)};var g={onKeyPress:function(m){var o=$(this).data($Control.DATA_CONTROL_OBJECT),k=o.maxLength,n=$(o.element).val(),j=n.replace(/\r\n/g,"~").replace(/\n/g,"~").length;if(k==null){return true}var l=String.fromCharCode(m.charCode==null?m.keyCode:m.charCode);return(m.ctrlKey||m.metaKey||l=="\u0000"||j<k)},onKeyUp:function(k){var l=$(this).data($Control.DATA_CONTROL_OBJECT),j=l.maxLength;if(j!=null&&l.maxLengthTipSpan!=null){f(l);h(l)}},focus:function(){var k=$(this).data($Control.DATA_CONTROL_OBJECT),j=k.maxLength;if(j!=null&&k.maxLengthTipSpan!=null){b(k)}},onPaste:function(j){},onCut:function(j){}};g.events=[{type:"keypress",handler:g.onKeyPress},{type:"keyup",handler:g.onKeyUp},{type:"focus",handler:g.focus}];define("InfoPlus.Controls.Text.Events",g)})(window);
(function(c,d){var a=function(i,h,g,f){this.supportXhr=qq.UploadHandlerXhr.isSupported();$Control.call(this,$Control.CONTROL_TYPE_FILE,i,h,g,f)};a.UPLOAD_PROGRESS_DIV="uploadProgressDiv";a.DISPLAY_DIV="displayDiv";a.UPLOAD_DIV="uploadDiv";a.UPLOAD_FILE_ID="uploadingFileId";a.CLASS_UPLOAD_FILE_NAME="uploadFileName";a.CLASS_UPLOAD_FILE_SIZE="uploadFileSize";a.CLASS_CANCEL="infoplus_fileControl_cancel";a.CLASS_DELETE="infoplus_fileControl_delete";a.CLASS_PREVIEW="infoplus_fileControl_preview";a.OFFICE_FILE_SUFFIX=["doc","docx","xls","xlsx","ppt","pptx"];a.MAX_PERCENT_WIDTH=100;a.MIN_PERCENT_WIDTH=40;var e=function(h,k,g,j){var f=h.width()-16-16,m=k.width(),l=g.width(),i=j.outerWidth();if(m+l+i<f){if(f-m-l>a.MAX_PERCENT_WIDTH){j.css("width",a.MAX_PERCENT_WIDTH+"px")}else{j.css("width",(f-m-l)+"px")}}else{j.css("width","");k.css("width",(f-l-a.MIN_PERCENT_WIDTH)+"px")}};a.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_FILE],ignoreClass:true,allowFocus:true,fileInfo:null,events:[],supportXhr:false,autoTriggerFieldChangeEvent:false,validatorPromptPosition:"topLeft",elementClassName:"infoplus_fileControl",uploadCallbacks:{onCancel:function(g,f){},onError:function(h,g,f){},onSubmit:function(l,k){var i=$($(this._options.button).data("container")),f=i.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV),j=f.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).html($IU.htmlEncode(k)).css("width","");f.find(".pi").css("width","0%");f.removeClass("focus");i.data(InfoPlus.Controls.File.UPLOAD_FILE_ID,l);j[0].setAttribute("title","正在上传"+k+",请稍候");i.data(InfoPlus.Controls.File.DISPLAY_DIV).hide();i.data(InfoPlus.Controls.File.UPLOAD_DIV).hide();i.find(".uploadFileTip").hide();i.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).show();var h=f.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE).empty(),g=f.find(".po");e(f,j,h,g)},onUpload:function(g,f){},onProgress:function(g,j,l,n){var f=$($(this._options.button).data("container")),h=f.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV);var p=$IU.convertFileSize(n);var k=h.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE).html("("+p.size+p.unit+")");if(l<n){var m=Math.round(l/n*100);h.find(".pi").css("width",m+"%")}else{h.find(".pi").css("width","100%")}var i=h.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME),o=h.find(".po");e(h,i,k,o)},onComplete:function(k,j,i){var h=$($(this._options.button).data("container"));h.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).removeClass("focus");h.data(InfoPlus.Controls.File.DISPLAY_DIV).removeClass("focus");h.data(InfoPlus.Controls.File.UPLOAD_FILE_ID,null);var f=h.data($Control.DATA_CONTROL_OBJECT);if(i.success&&i.infoPlusFile!=null){var g=i.infoPlusFile;f.setValue({uploadSuccess:true,id:g.id,name:g.name,size:g.size,uri:g.uri,mime:g.mime,createTime:g.createTime})}else{$IU.messageBox(null,"上传文件失败,请重新选择文件上传",null,300);f.setValue(null)}},onValidate:function(f){var p=this._options.validation;if(p===d||p===null){return true}var j=function(u){var i=u.lastIndexOf(".");if(i!==-1&&((i+1)<u.length)){return u.substring(i+1).toLowerCase()}return""};var o=f.length;for(var n=0;n<o;n++){var m=f[n];if(m.name!==d){if(p.allowedExtensions!==d&&p.allowedExtensions.length>0){var r=j(m.name);var g=p.allowedExtensions;var l=p.allowedExtensions.length;var k=false;var s="";for(var q=0;q<l;q++){s=s+g[q]+((q!=l-1)?",":"");if(r===g[q]){k=true}}if(!k){$IU.messageBox(null,"请上传后缀为"+s+"的文件",null,300);return false}}}if(m.size!==d){var h=p.sizeLimit;if(h!==null&&!isNaN(h)&&h!==0){if(m.size>h){var t=$IU.convertFileSize(h);$IU.messageBox(null,"选择的文件超出上传文件大小限制("+t.size+t.unit+")",null,360);return false}}}}return true}},hasFile:function(){var f=this.fileInfo;return(f!=null&&f.id!=null)},setPlaceHolder:function(){if(this.field!=null&&this.field.placeHolder!=null&&this.field.placeHolder!=""){var f=this.element;var h=document.createElement("div");var g=document.createElement("a");g.setAttribute("href","#");$(g).text(this.field.placeHolder);h.appendChild(g);$(h).addClass("uploadFileTip");$(f).find(".uploadFileButton").after(h);$(h).click(function(){$IU.fireClick($(this).siblings(".uploadFileButton").children("input")[0]);return false})}},createDisplayDiv:function(g){var k=document.createElement("div");$(k).addClass("display").hide().data("container",g);var j=document.createElement("a");$(j).attr("target","_blank").attr("href","#").addClass("infoplus_fileControl_link");var i=document.createElement("div");i.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME);var m=document.createElement("div");m.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE);var l=document.createElement("div");$(l).addClass("infoplus_fileControl_preview").attr("title","预览");j.appendChild(i);j.appendChild(m);j.appendChild(l);k.appendChild(j);if(this.isWritable()){var f=document.createElement("span");f.setAttribute("class","uploadSuccess");$(f).css("display","none");$(f).text("上传成功");k.appendChild(f);var h=document.createElement("div");h.setAttribute("class",InfoPlus.Controls.File.CLASS_DELETE);h.setAttribute("title","删除");k.appendChild(h)}g.appendChild(k);$(g).data(InfoPlus.Controls.File.DISPLAY_DIV,$(k))},createUploadProgressDiv:function(f){var h=document.createElement("div");$(h).addClass("uploadProgress").hide().data("container",f);var l,p;if(this.supportXhr){var r=document.createElement("table");r.setAttribute("class","uploadProgressTable");var m=document.createElement("tbody");var o=document.createElement("tr");var i=document.createElement("td");i.setAttribute("class","uploadTd");var q=document.createElement("span");q.setAttribute("class","uploadSpan");l=document.createElement("div");l.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME);var k=document.createElement("div");k.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE);q.appendChild(l);q.appendChild(k);i.appendChild(q);o.appendChild(i);i=document.createElement("td");i.setAttribute("class","uploadTd");var s=document.createElement("div");var g=document.createElement("div");var j=document.createElement("div");j.setAttribute("class","pi");j.setAttribute("style","width:0%");g.setAttribute("class","po");g.appendChild(j);s.appendChild(g);i.appendChild(s);o.appendChild(i);i=document.createElement("td");i.setAttribute("class","uploadTd");p=document.createElement("div");p.setAttribute("class",InfoPlus.Controls.File.CLASS_CANCEL);p.setAttribute("title","取消");i.appendChild(p);o.appendChild(i);m.appendChild(o);r.appendChild(m);h.appendChild(r)}else{l=document.createElement("div");l.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME);var n=document.createElement("div");n.setAttribute("class","uploading");p=document.createElement("div");p.setAttribute("class",InfoPlus.Controls.File.CLASS_CANCEL);p.setAttribute("title","取消");h.appendChild(l);h.appendChild(n);h.appendChild(p)}f.appendChild(h);$(f).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV,$(h))},createUploadButtonDiv:function(f){var m=document.createElement("div");if(this.field.settings!=null){if(this.field.settings.displayText!==d){$(m).text(this.field.settings.displayText)}}$(m).addClass("uploadFileButton").data("container",f);$(m).css("display","inline-block").hide();var i={request:{endpoint:InfoPlus.Settings.FILE_HANDLER+"?step="+$$.params.formStepId+"&instance="+$$.params.formInstanceId+"&field="+this.field.name},button:m,multiple:false,debug:false,callbacks:this.uploadCallbacks};var j=this.field.settings;var l=function(){if(j.fileSizeMax!==d&&$IU.isNumber(j.fileSizeMax)){return parseInt(j.fileSizeMax,10)}if(j.maxLength!==d&&$IU.isNumber(j.maxLength)){return parseInt(j.maxLength,10)}return null};var g={};if(j!==d&&j!==null){if(j.fileTypes!==d){g.allowedExtensions=j.fileTypes.split(",")}var h=l();if(h!=null){g.sizeLimit=h}}if(g.allowedExtensions!==d||g.sizeLimit!==d){i.validation=g}var k=new qq.FineUploaderBasic(i);f.appendChild(m);$(f).data(InfoPlus.Controls.File.UPLOAD_DIV,$(m)).data("uploader",k)},createElement:function(){var f=document.createElement("div");this.createHiddenElement(f);if(this.isReadable()){this.createDisplayDiv(f)}if(this.isWritable()){this.createUploadProgressDiv(f);this.createUploadButtonDiv(f)}return f},shouldFireChangeEvent:function(f){if(this.synced===true){this.synced=false;return false}if(this.onFieldChange||this.onFieldRefer||this.onFieldSync){if(this.fileInfo==null){return f!=null}else{if(f==null){return true}else{return f.id!=this.fileInfo.id}}}return false},setValue:function(j,h,l){var v;if($IU.isString(j)){try{v=$.parseJSON(j)}catch(x){v=null}}else{v=j}var w=!(!!l)&&this.shouldFireChangeEvent(v);this.fileInfo=v;var t=$(this.element),u=t.data($Control.DATA_ORIGIN_INPUT);if(v!=null&&v.id!=null){u.value=v.id;var i=$(this.element).find(".display a")[0];if(i!=null){var p=$(i);i.setAttribute("href",v.uri||"");var z="";if(v.name!=null){z=v.name}if(v.createTime!=null){z+=" 创建于"+$IU.dateFormat(new Date(v.createTime*1000),"yyyy-MM-dd hh:mm:ss")}i.setAttribute("title",z);p.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).text(v.name||" ");var g=$IU.convertFileSize(v.size);p.children("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE).html("("+g.size+g.unit+")");if(v.uploadSuccess===true){var A=$(this.element).find(".display span.uploadSuccess")[0];$(A).css("display","")}var o=t.data(InfoPlus.Controls.File.DISPLAY_DIV).find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME),q=$(this.element).find(".display span.uploadSuccess"),n=q.length>0&&q[0].style.display!=="none";var r=this.element.style.width;if(r!=null&&r!==""){if(r.substring(r.length-1)!=="%"){var m=parseInt(r,10);o.css("max-width",(n?(m-160):(m-105))+"px")}else{if(t.width()!=parseInt(r,10)){m=parseInt(t.width(),10);o.css("max-width",(n?(m-160):(m-105))+"px")}else{o.css("max-width","0px");var f=function(){if(t.width()==parseInt(r,10)){setTimeout(function(){f()},100)}else{var B=parseInt(t.width(),10);o.css("max-width",(n?(B-160):(B-105))+"px")}};setTimeout(function(){f()},300)}}}else{o.css("max-width","0px");var k=function(){if(t.width()==0){setTimeout(function(){k()},100)}else{var B=parseInt(t.width(),10);o.css("max-width",(n?(B-160):(B-105))+"px")}};setTimeout(function(){k()},300)}var y=function(C){var B=C.lastIndexOf(".");if(B!==-1&&((B+1)<C.length)){return C.substring(B+1).toLowerCase()}return""};var s=y(v.name);if((($$.params.uriFilePreview||"")!="")&&$.inArray(s,a.OFFICE_FILE_SUFFIX)!=-1){p.addClass("office")}else{p.removeClass("office")}}else{$(i).children("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).html("&nbsp;")}t.data(InfoPlus.Controls.File.DISPLAY_DIV).show();if(t.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==d){t.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).hide()}if(t.data(InfoPlus.Controls.File.UPLOAD_DIV)!==d){t.data(InfoPlus.Controls.File.UPLOAD_DIV).hide();t.find(".uploadFileTip").hide()}}else{t.data($Control.DATA_ORIGIN_INPUT).value="";t.data(InfoPlus.Controls.File.DISPLAY_DIV).hide();if(t.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==d){t.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).hide()}if(t.data(InfoPlus.Controls.File.UPLOAD_DIV)!==d){t.data(InfoPlus.Controls.File.UPLOAD_DIV).css("display","inline-block");t.find(".uploadFileTip").show()}}if(w){setTimeout(function(){$(u).change()},0)}},getValue:function(){if(this.field==null||this.element==null||this.fileInfo==null){return""}var f=this.fileInfo;return $.toJSON({id:f.id,name:f.name,size:f.size,uri:f.uri,mime:f.mime,createTime:f.createTime})},getSortValue:function(){if(this.field==null||this.element==null||this.fileInfo==null){return""}return this.fileInfo.name},specialSetting:function(){var j=this.element;var l=$(j);var g=j.style.width;if(g!=null){if(g.substring(g.length-1)!=="%"){var k=parseInt(g,10);var h=this.supportXhr?k-230:k-70;if(l.data(InfoPlus.Controls.File.DISPLAY_DIV)!==d){var m=l.data(InfoPlus.Controls.File.DISPLAY_DIV).find("span.uploadSuccess");var n=m.length>0&&m[0].style.display!=="none";l.data(InfoPlus.Controls.File.DISPLAY_DIV).css("max-width",k+"px").find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).css("max-width",n?(k-160):(k-105)+"px")}var i=l.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV);if(i!==d){l.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).css("max-width",k+"px").find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).css("max-width",h+"px");if(!this.supportXhr){l.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).find(".uploadSpan").css("max-width"+(k-30)+"px");var f=l.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).find(".uploadProgressTable");if(f.length!=0){f[0].setAttribute("width",(k-14));f.find("td.uploadTd")[0].width=(k-30);f.find("td.uploadTd")[1].width=16}}}}else{}}},registerEvent:function(){this.events=InfoPlus.Controls.File.Events.events},setDynamicReadOnly:function(g){var f=this.element;if(g){$(f).addClass($Control.CLASSNAME_READONLY)}else{$(f).removeClass($Control.CLASSNAME_READONLY)}},setElementAttribute:function(){this.setHiddenAttribute("file")}});define("InfoPlus.Controls.File",a);var b={onCancel:function(){var i=$(this).parents("."+$Control.CLASSNAME_CONTROL);var g=i.data(InfoPlus.Controls.File.UPLOAD_FILE_ID);if(g!=null){var h=i.data("uploader");h.cancel(g);var f=i.data($Control.DATA_CONTROL_OBJECT);f.setValue(null)}},onDelete:function(){var f=$(this).parents("."+$Control.CLASSNAME_CONTROL).data($Control.DATA_CONTROL_OBJECT);$IU.confirmBox("您确定要删除该文件吗?","确认","确认",300,function(){f.setValue(null)})},onFocusIn:function(){if($(this).data(InfoPlus.Controls.File.DISPLAY_DIV)!==d){$(this).data(InfoPlus.Controls.File.DISPLAY_DIV).addClass("focus")}if($(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==d){$(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).addClass("focus")}},onFocusOut:function(){if($(this).data(InfoPlus.Controls.File.DISPLAY_DIV)!==d){$(this).data(InfoPlus.Controls.File.DISPLAY_DIV).removeClass("focus")}if($(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==d){$(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).removeClass("focus")}},onPreview:function(){if($$.params.uriFilePreview!=null&&$$.params.uriFilePreview!=""){var g=$$.params.uriFilePreview.replace("%s",encodeURIComponent($(this).parent().attr("href")));var f=$(this).parents("."+InfoPlus.Controls.File.prototype.elementClassName).data(InfoPlus.Controls.Control.DATA_CONTROL_OBJECT);if(f!=null){if(!$$.MOBILE){$IU.iframeBox(g,f.fileInfo.name,false)}else{var h=new InfoPlus.Render.Mobile.Page({title:f.fileInfo.name,uri:g});h.show()}}}return false}};b.events=[{selector:"."+InfoPlus.Controls.File.CLASS_CANCEL,type:"click",handler:b.onCancel},{selector:"."+InfoPlus.Controls.File.CLASS_DELETE,type:"click",handler:b.onDelete},{selector:"."+InfoPlus.Controls.File.CLASS_PREVIEW,type:"click",handler:b.onPreview},{type:"focusin",handler:b.onFocusIn},{type:"focusout",handler:b.onFocusOut}];define("InfoPlus.Controls.File.Events",b)})(window);
(function(b,d){var a=function(h,g,f,e){$Control.call(this,$Control.CONTROL_TYPE_HELP,h,g,f,e)};a.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],ignoreClass:true,ignoreValidation:true,allowFocus:false,autoTriggerFieldChangeEvent:false,elementClassName:"infoplus_helpControl",createElement:function(){var e=document.createElement("div");$(e).data("showTitle",false).tipsy({html:true,fade:true,gravity:$.fn.tipsy.autoWE,trigger:"manual",opacity:0.9});this.createHiddenElement(e);return e},setValue:function(i,h,j){if(i==null){i=""}var g=!(!!j)&&this.shouldFireChangeEvent(i);var e='<div class="tipsy-inner-infoplus">'+$IU.htmlEncode(i)+"</div>";this.element.setAttribute("original-title",e);var f=$(this.element).data($Control.DATA_ORIGIN_INPUT);f.value=i;if(g){setTimeout(function(){$(f).change()},0)}},getValue:function(){var e=$(this.element).data($Control.DATA_ORIGIN_INPUT);var f=this.convertEmptyValue(e.value);return f.replace(/\r\n/g,"\n")},setElementAttribute:function(){this.setHiddenAttribute("help")},registerEvent:function(){this.events=InfoPlus.Controls.Help.Events.events}});define("InfoPlus.Controls.Help",a);var c={onClick:function(){$(this).data("showTitle",true).tipsy("show")},onMouseEnter:function(){if(!$$.MOBILE){$(this).data("showTitle",true).tipsy("show")}},onMouseLeave:function(){if(!$$.MOBILE){$(this).data("showTitle",false).tipsy("hide")}},onTouchStart:function(){if($(this).data("showTitle")===true){$(this).data("showTitle",false).tipsy("hide")}else{$(this).data("showTitle",true).tipsy("show")}return false}};c.events=[{type:"mouseenter",handler:c.onMouseEnter},{type:"mouseleave",handler:c.onMouseLeave},{type:"click",handler:c.onClick},{type:"touchstart",handler:c.onTouchStart}];define("InfoPlus.Controls.Help.Events",c)})(window);
(function(a,c){var b=function(g,f,e,d){$Control.call(this,$Control.CONTROL_TYPE_IMAGE,g,f,e,d)};b.DATA_IMG="img";b.DATA_IMG_LOADFAIL_COUNT="failCount";b.MAX_IMG_LOADFAIL_COUNT=10;b.CLASS_IMAGE="infoplus_imageControl_image";b.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_FILE],ignoreClass:true,ignoreValidation:true,allowFocus:false,imageInfo:null,elementClassName:"infoplus_imageControl",createElement:function(){var e=document.createElement("div");var f=document.createElement("a");f.setAttribute("data-lightbox",$$.guid());var d=document.createElement("img");d.setAttribute("class",b.CLASS_IMAGE);f.appendChild(d);e.appendChild(f);$(e).data(InfoPlus.Controls.Image.DATA_IMG,d);this.createHiddenElement(e);return e},setValue:function(i){var d;if($IU.isString(i)){if($IU.isUrl(i)){d={uri:i}}else{try{d=$.parseJSON(i)}catch(j){d=null}}}else{d=i}this.imageInfo=d;var f=$(this.element),g=f.data($Control.DATA_ORIGIN_INPUT),h=f.data(InfoPlus.Controls.Image.DATA_IMG);if(d!=null){if($IU.isUrl(i)){g.value=i}else{g.value=$.toJSON({id:d.id,name:d.name,size:d.size,uri:d.uri,mime:d.mime})}$(h).attr("src",d.uri).data(InfoPlus.Controls.Image.DATA_IMG_LOADFAIL_COUNT,0);$(h).parent().attr("href",d.uri)}else{g.value="";$(h).removeAttr("src").hide();$(h).parent().attr("href","")}},getValue:function(){var d=$(this.element).data($Control.DATA_ORIGIN_INPUT),e=this.convertEmptyValue(d.value);switch(this.field.type){case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri(e);default:return e}},getAttributes:function(){if(this.field.type==$Control.DATA_TYPE_ANYURI){var d=this.getValue();return $IU.getParamFromUrl(d.value)}return null},getSortValue:function(){if(this.field==null||this.element==null||this.imgageInfo==null){return""}return this.imageInfo.name},setElementAttribute:function(){var d=$(this.element);this.setHiddenAttribute("image");var e=$(d.data(InfoPlus.Controls.Image.DATA_IMG));e.css("width",d.css("width"));e.css("height",d.css("height"));e.css("cursor","pointer");d.attr("style","float:left;margin:0; padding:0;")},specialSetting:function(){var d=$($(this.element).data(InfoPlus.Controls.Image.DATA_IMG));d.on("load",function(){$(this).fadeIn().data(InfoPlus.Controls.DATA_IMG_LOADFAIL_COUNT,0)}).on("error",function(){var f=$(this).data(InfoPlus.Controls.Image.DATA_IMG_LOADFAIL_COUNT)+1;if(f<InfoPlus.Controls.Image.MAX_IMG_LOADFAIL_COUNT){$(this).data(InfoPlus.Controls.Image.DATA_IMG_LOADFAIL_COUNT,f);var g=$(this).parent().attr("href"),e=this;setTimeout(function(){$(e).attr("src",g)},1000+f*200)}})}});define("InfoPlus.Controls.Image",b)})(window);
(function(b,d){var c=function(h,g,f,e){$Control.call(this,$Control.CONTROL_TYPE_PICTURE,h,g,f,e)};c.UPLOAD_PICTURE_ID="uploadingPictureId";c.DISPLAY_DIV="displayDiv";c.DISPLAY_IMG="displayImg";c.PREVIEW_IMG="previewImg";c.UPLOAD_DIV="uploadDiv";c.MASK_DIV="maskDiv";c.UPLOAD_FILE_ID="uploadingFileId";c.CLASS_DELETE_PICTURE="infoplus_pictureControl_delete";c.DISPLAY_DIV_MAX_WIDTH="maxW";c.DISPLAY_DIV_MAX_HEIGHT="maxH";c.IMG_LOAD_LOCAL="ll";c.DATA_IMG_LOADFAIL_COUNT="failCount";c.DATA_URL="url";c.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_FILE],ignoreClass:true,autoTriggerFieldChangeEvent:false,validatorPromptPosition:"topLeft",elementClassName:"infoplus_pictureControl",pictureInfo:null,uploadCallbacks:{onCancel:function(f,e){},onError:function(g,f,e){},onSubmit:function(o,v,k){var q=$($(this._options.button).data("container")),g=q.data(InfoPlus.Controls.Picture.DISPLAY_DIV),p=q.data(InfoPlus.Controls.Picture.UPLOAD_DIV),h=g.data(InfoPlus.Controls.Picture.PREVIEW_IMG),n=$(g.data(InfoPlus.Controls.Picture.DISPLAY_IMG)),s=$(h),m=$($(h).parent()[0]),u=this._button._input;var t=this,r=q.data($Control.DATA_CONTROL_OBJECT);if(u.files&&u.files[0]){s.data(InfoPlus.Controls.Picture.IMG_LOAD_LOCAL,true);s.css("margin-top",(r.getMaxHeight()+1)+"px");s.css("margin-left",(r.getMaxWidth()+1)+"px").show();var e=new FileReader();e.onload=function(w){h.src=w.target.result;m.attr("href",h.src)};e.readAsDataURL(u.files[0])}else{if(h.filters&&k){n.hide();s.css("margin-top",(r.getMaxHeight()+1)+"px");s.css("margin-left",(r.getMaxWidth()+1)+"px").show();g.show();p.hide();if($.browser.msie&&$.browser.version.substr(0,1)=="9"){var j=h.offsetWidth,i=h.offsetHeight;h.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=k;var l=setInterval(function(){if(h.offsetWidth!=j||h.offsetHeight!=i){var w=$IU.clacImgZoomParam(r.getMaxWidth(),r.getMaxHeight(),h.offsetWidth,h.offsetHeight);r.setDisplayDivSize(w.width,w.height);g.css("filter",'progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="'+k+'"');s.hide();clearTimeout(l)}},500)}else{h.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=k;var f=$IU.clacImgZoomParam(r.getMaxWidth(),r.getMaxHeight(),h.offsetWidth,h.offsetHeight);r.setDisplayDivSize(f.width,f.height);g.css("filter",'progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="'+k+'"');$(h).hide()}}}q.data(InfoPlus.Controls.Picture.UPLOAD_FILE_ID,o);setTimeout(function(){t.uploadStoredFiles()},0)},onUpload:function(g,j){var r=$($(this._options.button).data("container")),k=r.data(InfoPlus.Controls.Picture.DISPLAY_DIV),m=k.data(InfoPlus.Controls.Picture.MASK_DIV),n=r.data($Control.DATA_CONTROL_OBJECT);m.css("top","0%");m[0].style.width=k[0].style.width;m[0].style.height=k[0].style.height;m.show();var p=n.getMaxWidth(),q=n.getMaxHeight(),t=q<p?q:p,s=10+parseInt(t/25,10),l=5+parseInt(t/10,10),f=4+parseInt(t/100,10),h=4+parseInt(t/80,10);var e={lines:s,length:h,width:f,radius:l,corners:1,rotate:0,direction:1,color:"#ffffff",speed:1,trail:60,shadow:false,hwaccel:true,className:"spinner",zIndex:2000000000,top:"50%",left:"50%"};var o=new Spinner(e).spin(k[0]);var i=document.createElement("div");$(i).css("font-size","12px").css("white-space","nowrap").css("word-wrap","normal").css("top","50%").css("left","50%").css("margin-left","-25px").css("margin-top","-6px").css("color",e.color).text("正在上传");o.el.appendChild(i);k.data("spin",o)},onProgress:function(l,k,f,i){var j=$($(this._options.button).data("container")),g=j.data(InfoPlus.Controls.Picture.DISPLAY_DIV),e=g.data(InfoPlus.Controls.Picture.MASK_DIV);var h=(f<i)?Math.round(f/i*100):100;e.css("top",h+"%")},onComplete:function(f,h,g){var m=$($(this._options.button).data("container")),i=m.data(InfoPlus.Controls.Picture.DISPLAY_DIV),j=i.data(InfoPlus.Controls.Picture.MASK_DIV),k=m.data($Control.DATA_CONTROL_OBJECT);var l=i.data("spin");if(l!=null){l.stop()}j.css("top","100%").hide();m.data(InfoPlus.Controls.Picture.UPLOAD_FILE_ID,null);if(g.success&&g.infoPlusFile!=null){var e=g.infoPlusFile;k.setValue({uploadSuccess:true,id:e.id,name:e.name,size:e.size,uri:e.uri,mime:e.mime})}else{alert("上传文件失败,请重新选择文件上传");k.setValue(null)}},onValidate:function(e){var o=this._options.validation;if(o===d||o===null){return true}var h=function(t){var i=t.lastIndexOf(".");if(i!==-1&&((i+1)<t.length)){return t.substring(i+1).toLowerCase()}return""};var n=e.length;for(var m=0;m<n;m++){var l=e[m];if(l.name!==d){if(o.allowedExtensions!==d&&o.allowedExtensions.length>0){var q=h(l.name);var f=o.allowedExtensions;var k=o.allowedExtensions.length;var j=false;var r="";for(var p=0;p<k;p++){r=r+f[p]+((p!=k-1)?",":"");if(q===f[p]){j=true}}if(!j){alert("请上传后缀为"+r+"的文件");return false}}}if(l.size!==d){var g=o.sizeLimit;if(g!==null&&!isNaN(g)&&g!==0){if(l.size>g){var s=$IU.convertFileSize(g);alert("选择的图片超出上传图片大小限制("+s.size+s.unit+")");return false}}}}return true}},createUploader:function(e,l){var h={request:{endpoint:InfoPlus.Settings.FILE_HANDLER+"?step="+b.formStepId+"&instance="+b.instanceId+"&field="+this.field.name},button:l,multiple:false,debug:false,autoUpload:false,callbacks:this.uploadCallbacks};var i=this.field.settings;var k=function(){if(i.fileSizeMax!==d&&$IU.isNumber(i.fileSizeMax)){return parseInt(i.fileSizeMax,10)}if(i.maxLength!==d&&$IU.isNumber(i.maxLength)){return parseInt(i.maxLength,10)}return null};var f={allowedExtensions:["jpg","jpeg","gif","png"]};if(i!==d&&i!==null){var g=k();if(g!=null){f.sizeLimit=g}}h.validation=f;var j=new qq.FineUploaderBasic(h);$(e).data("uploader",j)},createUploadDiv:function(e){var f=document.createElement("div");$(f).attr("title","点击上传图片").addClass("uploadDiv").data("container",e).hide();e.appendChild(f);this.createUploader(e,f);$(e).data(InfoPlus.Controls.File.UPLOAD_DIV,$(f))},getMaxWidth:function(){var g=$(this.element),e=g.data(InfoPlus.Controls.Picture.DISPLAY_DIV),f=e.data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_WIDTH);if(f.substr(f.length-1)=="%"){f=g.outerWidth()*parseInt(f,10)/100}else{f=parseFloat(f)}return f},getMaxHeight:function(){var g=$(this.element),e=g.data(InfoPlus.Controls.Picture.DISPLAY_DIV),f=e.data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_HEIGHT);if(f.substr(f.length-1)=="%"){f=g.outerHeight()*parseInt(f,10)/100}else{f=parseFloat(f)}return f},createDisplayDiv:function(e){var m=this,l=document.createElement("div"),k=document.createElement("a"),i=$(l),n=$(e);k.setAttribute("data-lightbox",$$.guid());var o=document.createElement("img");$(o).attr("border","0").addClass("preview").data(InfoPlus.Controls.Picture.IMG_LOAD_LOCAL,false).data(InfoPlus.Controls.Picture.DISPLAY_DIV,$(l));$(o).load(function(){var s=n.data(InfoPlus.Controls.Picture.UPLOAD_DIV),r=m.getMaxWidth(),q=m.getMaxHeight();i.addClass("uploading");s.hide();i.show();var p=$IU.clacImgZoomParam(r,q,this.width,this.height);this.width=p.width;this.height=p.height;$(this).css("margin-left","0px").css("margin-top","0px");m.setDisplayDivSize(p.width,p.height);$(this).data(InfoPlus.Controls.Picture.IMG_LOAD_LOCAL,false)});k.appendChild(o);var g=document.createElement("img");$(g).attr("border","0").data(InfoPlus.Controls.Picture.DISPLAY_DIV,$(l));$(g).load(function(){var s=this,p=$(s),t=n.data(InfoPlus.Controls.Picture.UPLOAD_DIV),w=m.getMaxWidth(),x=m.getMaxHeight();p.css("margin-top",(x+1)+"px").css("margin-left",(w+1)+"px").show();var q=function(y){if(y.naturalWidth!=null){return y.naturalWidth}else{return y.width}};var r=function(y){if(y.naturalHeight!=null){return y.naturalHeight}else{return y.height}};var u=function(){var y=q(s),z=r(s);p.data("naturalWidth",y).data("naturalHeight",z);var A=$IU.clacImgZoomParam(w,x,y,z);s.width=A.width;s.height=A.height;$(s).css("margin-left","0px").css("margin-top","0px");if($(l).css("filter")!=null){$(l).css("filter","")}m.setDisplayDivSize(A.width,A.height);i.show();$(o).hide();$(s).show();if(t!=null){t.hide()}$(s).parent().attr("href",s.src)};if(q(s)==0||r(s)==0){var v=setInterval(function(){if(q(s)!=0&&r(s)!=0){u();clearTimeout(v)}},100)}else{u()}}).error(function(){var r=$(this).data(InfoPlus.Controls.Picture.DATA_URL),p=this;if(r!=""){var q=$(this).data(InfoPlus.Controls.Picture.DATA_IMG_LOADFAIL_COUNT)+1;$(this).data(InfoPlus.Controls.Picture.DATA_IMG_LOADFAIL_COUNT,q);setTimeout(function(){$(p).attr("src",r)},1000+q*500)}});k.appendChild(g);l.appendChild(k);var f=document.createElement("div"),j=$(f);j.addClass(InfoPlus.Controls.Picture.MASK_DIV).hide();l.appendChild(f);if(this.isWritable()){var h=document.createElement("div");$(h).attr("title","删除").addClass(c.CLASS_DELETE_PICTURE);l.appendChild(h)}e.appendChild(l);$(l).addClass(InfoPlus.Controls.Picture.DISPLAY_DIV).data("container",e).data(InfoPlus.Controls.Picture.PREVIEW_IMG,o).data(InfoPlus.Controls.Picture.DISPLAY_IMG,g).data(InfoPlus.Controls.Picture.MASK_DIV,j);$(e).data(InfoPlus.Controls.Picture.DISPLAY_DIV,$(l))},createElement:function(){var e=document.createElement("div");this.createHiddenElement(e);if(this.isReadable()){this.createDisplayDiv(e)}if(this.isWritable()){this.createUploadDiv(e)}return e},shouldFireChangeEvent:function(e){if(this.synced===true){this.synced=false;return false}if(this.onFieldChange||this.onFieldRefer||this.onFieldSync){if(this.pictureInfo==null){return e!=null}else{if(e==null){return true}else{return e.id!=this.pictureInfo.id}}}return false},setValue:function(g,s,m){var f;var i=function(e,t){if(t!==""){$(e).hide();$(e).parents(".displayDiv").removeClass("uploading");e.src=t;$(e).data(InfoPlus.Controls.Picture.DATA_IMG_LOADFAIL_COUNT,0)}else{$(e).removeAttr("src").removeAttr("width").removeAttr("height").removeAttr("style");$(e).parent().removeAttr("href")}$(e).data(InfoPlus.Controls.Picture.DATA_URL,t)};if($IU.isString(g)){try{f=$.parseJSON(g)}catch(p){f=null}}else{f=g}var h=!(!!m)&&this.shouldFireChangeEvent(f);this.pictureInfo=f;var r=$(this.element),k=r.data($Control.DATA_ORIGIN_INPUT),n=r.data(InfoPlus.Controls.Picture.DISPLAY_DIV),o=r.data(InfoPlus.Controls.Picture.UPLOAD_DIV),j=n.data(InfoPlus.Controls.Picture.DISPLAY_IMG),q=n.data(InfoPlus.Controls.Picture.PREVIEW_IMG);if(f!=null&&f.id!=null){k.value=f.id;i(j,f.uri)}else{k.value="";n.hide();if(o!=null){var l=o.children("input")[0];l.style.height=o[0].style.height;o.show()}i(j,"");$(q).removeAttr("width").removeAttr("height").removeAttr("style").removeAttr("src")}if(h){setTimeout(function(){$(k).change()},0)}},getValue:function(){if(this.field==null||this.element==null||this.pictureInfo==null){return""}var h=$(this.element),f=h.data(InfoPlus.Controls.Picture.DISPLAY_DIV),g=$(f.data(InfoPlus.Controls.Picture.DISPLAY_IMG));var e=this.pictureInfo;return $.toJSON({id:e.id,name:e.name,size:e.size,uri:e.uri,mime:e.mime,width:g.data("naturalWidth"),height:g.data("naturalHeight")})},getSortValue:function(){if(this.field==null||this.element==null||this.pictureInfo==null){return""}return this.pictureInfo.name},setDisplayDivSize:function(h,e){var i=$(this.element),g=i.data(InfoPlus.Controls.Picture.DISPLAY_DIV),f=g.data(InfoPlus.Controls.Picture.MASK_DIV);g.css("width",h);g.css("height",e);f.css("width",h);f.css("height",e)},specialSetting:function(){var k=$(this.element),g=k.data(InfoPlus.Controls.Picture.DISPLAY_DIV),j=k.data(InfoPlus.Controls.Picture.UPLOAD_DIV);var e=k[0].style.width,f=k[0].style.height;if(e.substr(e.length-1)=="%"){$IU.debugTip("请勿设置图片控件("+this.field.name+")宽度为百分比宽度，请设置为固定像素宽度","warning")}g.data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_WIDTH,e);g.data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_HEIGHT,f);this.setDisplayDivSize(e,f);if(j!=null){j.css("width",e);j.css("height",f);var i=j.children("input")[0];i.style.height=f}k.css("width","");k.css("height","")},setElementAttribute:function(){this.setHiddenAttribute("file")},registerEvent:function(){this.events=InfoPlus.Controls.Picture.Events.events},setDynamicReadOnly:function(f){var e=this.element;if(f){$(e).addClass($Control.CLASSNAME_READONLY)}else{$(e).removeClass($Control.CLASSNAME_READONLY)}}});define("InfoPlus.Controls.Picture",c);var a={onImgLoad:function(){},onCancel:function(){var h=$(this).parents("."+$Control.CLASSNAME_CONTROL);var g=h.data(InfoPlus.Controls.Picture.UPLOAD_PICTURE_ID);if(g!=null){var f=h.data("uploader");f.cancel(g);var e=h.data($Control.DATA_CONTROL_OBJECT);e.setValue(null)}},onDelete:function(){var e=$(this).parents("."+$Control.CLASSNAME_CONTROL).data($Control.DATA_CONTROL_OBJECT);$IU.confirmBox("您确定要删除该图片吗?","确认","确认",300,function(){e.setValue(null)})}};a.events=[{selector:"."+InfoPlus.Controls.Picture.CLASS_DELETE_PICTURE,type:"click",handler:a.onDelete}];define("InfoPlus.Controls.Picture.Events",a)})(window);
(function(b,c){var a=function(g,f,e,d){$Control.call(this,$Control.CONTROL_TYPE_PASSWORD,g,f,e,d,null)};a.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],elementClassName:"infoplus_passwordControl",createElement:function(){var d=document.createElement("input");d.type="password";return d},setValue:function(d){if(d==null){d=""}$(this.element).val(d)},getValue:function(){if(this.field==null||this.element==null){return""}return this.convertEmptyValue(this.element.value)}});define("InfoPlus.Controls.Password",a)})(window);
(function(c,d){var b=function(i,h,g,f){if(!InfoPlus.Controls.Iframe.initialized){var j=document.createElement("div");j.setAttribute("id",a);$(j).addClass("round-corner");b.flyoutDiv=j;$(document.body).append(j);InfoPlus.Controls.Iframe.initialized=true}$Control.call(this,$Control.CONTROL_TYPE_IFRAME,i,h,g,f)};b.eventRegistered=false;b.initialized=false;var a="infoplus_iframe_flyout_div";var e=/^.+:\/\/[^/]+/;b.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_ANYURI],ignoreValidation:true,allowFocus:false,autoTriggerFieldChangeEvent:false,elementClassName:"infoplus_iframeControl",flyoutIframe:null,flyoutIframeId:null,innerId:null,flyoutInnerId:null,flyoutPage:null,createElement:function(){var f=document.createElement("div");var g=document.createElement("iframe");g.setAttribute("scrolling","auto");this.createHiddenElement(g,f);f.appendChild(g);this.controlContainer=f;$(f).addClass("infoplus_iframeControlContainer");return g},sendMessage:function(g){var h=this.element;var f=h.src.match(e)[0];h.contentWindow.postMessage($.toJSON(g),f)},flyoutWindowSendMessage:function(h){if(this.flyoutIframeId!=null){var g=$("#"+this.flyoutIframeId);if(g.length>0){var f=g[0].src.match(e)[0];g[0].contentWindow.postMessage($.toJSON(h),f)}}},closeFlyout:function(f){if(this.flyoutIframeId!=null){$(b.flyoutDiv).empty().detach().removeData("iframeControl");$(document.body).append(b.flyoutDiv);this.flyoutIframe=null;this.flyoutIframeId=null}if(this.flyoutPage!=null){if(!(f===true)){this.flyoutPage.close()}this.flyoutPage=null}},registerEvent:function(){if(InfoPlus.Controls.Iframe.eventRegistered){return}var h="iframe."+this.elementClassName;var k=function(p,o,q){if(p.cid==null||p.pid==null){return}$(h).each(function(){var s=$(this).data($Control.DATA_CONTROL_OBJECT);if((!q&&s.innerId==null)||(q&&s.flyoutIframeId!=null)){var r=(!q)?s.element.src.match(e)[0]:s.flyoutIframe.src.match(e)[0];if(r!=o){return}if(p.pid==this.id){if(!q){s.innerId=p.cid}else{s.flyoutInnerId=p.cid}}}})};var g=function(p,o,q){if(p.cid==null){return}$(h).each(function(){var s=$(this).data($Control.DATA_CONTROL_OBJECT);if((!q&&s.innerId==null)||(q&&s.flyoutIframeId!=null)){var r=(!q)?s.element.src.match(e)[0]:s.flyoutIframe.src.match(e)[0];if(r!=o){return}if(!q){s.sendMessage({command:"query",cid:p.cid,pid:this.id})}else{s.flyoutWindowSendMessage({command:"queryFlyout",cid:p.cid,pid:this.id})}}})};var i=function(o){if(o.cid==null){return}$(h).each(function(){var q=$(this).data($Control.DATA_CONTROL_OBJECT);if(o.cid==q.innerId){var r=o.url||"";var t=q.shouldFireChangeEvent(r);var p=$(q.element);var s=p.data($Control.DATA_ORIGIN_INPUT);s.value=r;if(t){setTimeout(function(){$(s).change()},0)}}})};var n=function(){var o=$(InfoPlus.Controls.Iframe.flyoutDiv).data("iframeControl");if(o!=null){o.closeFlyout()}};var f=300,l=100;var j=function(q){var o=function(s){var r="flyout_"+$$.guid(),t=document.createElement("iframe");t.setAttribute("id",r);t.setAttribute("frameborder","0");t.setAttribute("class","infoplus_iframeControl_flyout");$(b.flyoutDiv).append(t).data("iframeControl",s);s.flyoutIframeId=r;s.flyoutIframe=t};var p=function(t,s){var v=t.flyoutIframe;v.setAttribute("scrolling","auto");if(v.getAttribute("src")!=s.src){v.setAttribute("src",s.src)}if(!$$.MOBILE){var r=s.height!=null?parseInt(s.height,10):l;v.setAttribute("height",r+"");var u=s.width!=null?parseInt(s.width,10):f;v.setAttribute("width",u+"");r+=14;if(($(t.element).offset().top-$(c).scrollTop()+$(t.element).height()+r<=$(c).height())||($(t.element).offset().top-$(c).scrollTop()<r)){$(b.flyoutDiv).css("top",$(t.element).outerHeight())}else{$(b.flyoutDiv).css("top","-"+r+"px")}if(!(s.shadow===false)){$(b.flyoutDiv).addClass("z-depth-1")}else{$(b.flyoutDiv).removeClass("z-depth-1")}}};if(q.cid==null){return}$(h).each(function(){var t=$(this).data($Control.DATA_CONTROL_OBJECT);if(q.cid==t.innerId){var s=q.options;if(!$$.MOBILE){if(t.flyoutIframe==null){n();o(t);t.controlContainer.appendChild(b.flyoutDiv)}p(t,s)}else{if(t.flyoutIframe==null){o(t)}p(t,s);var r={content:$(b.flyoutDiv),buttons:[{name:"关闭",callOnClose:true,defaultButton:true,callback:function(){t.closeFlyout(true)}}]};var u=new InfoPlus.Render.Mobile.Page(r);t.flyoutPage=u;u.show()}}})};var m=function(o){if(o.cid==null){return}$(h).each(function(){var p=$(this).data($Control.DATA_CONTROL_OBJECT);if(o.cid==p.flyoutInnerId){p.sendMessage({command:"closeFlyout",data:o.data,pid:this.id});p.closeFlyout()}if(o.cid==p.innerId){p.closeFlyout()}})};$(c).on("message",function(p){var o;try{o=$.parseJSON(p.originalEvent.data)}catch(p){}if(o==null||o.command==null){return}switch(o.command){case"change":i(o);break;case"create":g(o,p.originalEvent.origin,false);break;case"createFlyout":g(o,p.originalEvent.origin,true);break;case"openFlyout":j(o);break;case"closeFlyout":m(o);break;case"confirm":k(o,p.originalEvent.origin,false);break;case"confirmFlyout":k(o,p.originalEvent.origin,true);break}});if(!$$.MOBILE){$(document).mousedown(function(o){if(o.target.id!=a){n()}})}InfoPlus.Controls.Iframe.eventRegistered=true},getAttributes:function(){var f=this.getValue();return $IU.getParamFromUrl(f.value)},setValue:function(j,i,k){if(j==null){j=""}var h=!(!!k)&&this.shouldFireChangeEvent(j);var f=$(this.element);var g=f.data($Control.DATA_ORIGIN_INPUT);g.value=j;switch(this.field.type){case $Control.DATA_TYPE_ANYURI:f.attr("src",j);break}if(h){setTimeout(function(){$(g).change()},0)}},getValue:function(){if(this.field==null||this.element==null){return""}var f=$(this.element),g=f.data($Control.DATA_ORIGIN_INPUT);return new $Controls.Data.Uri(g.value)},setElementAttribute:function(){this.setHiddenAttribute("iframe")}});define("InfoPlus.Controls.Iframe",b)})(window);
(function(c,d){var b=function(i,h,g,f,j,e){$Control.call(this,$Control.CONTROL_TYPE_THING,i,h,g,f,j);if(this.element!=null&&e!=null){$(this.element).data($Control.DATA_ATTRIBUTES,e)}};b.BARCODE_LENGTH=13;b.HAS_VALUE="infoplus_thingControl_has_value";b.NO_VALUE="infoplus_thingControl_no_value";b.CLASS_INPUT_NAME_DIV="infoplus_thingControl_inputNameDiv";b.CLASS_INPUT_BARCODE_DIV="infoplus_thingControl_inputBarcodeDiv";b.CLASS_NAME_DIV="infoplus_thingControl_nameDiv";b.CLASS_PRINT_DIV="infoplus_thingControl_printDiv";b.CLASS_DELETE_DIV="infoplus_thingControl_deleteDiv";b.DEFAULT_PRINT_PARAM_TEXT=1;b.DEFAULT_PRINT_PARAM_WIDTH=300;b.CODE_REG=/^\d{13}$/;b.IMG_HOLDER="INFOPLUS_THING_IMG_HOLDER";b.prototype=$.extend(new $Controls.Control(),{autoTriggerFieldChangeEvent:false,compatibleFieldTypes:[$Control.DATA_TYPE_THING],allowFocus:false,elementClassName:"infoplus_thingControl",processPrintUrl:function(){var e=$$.params.uriBarcode;if(e==null){return null}var h=this.getValue();if(h==null||h.value==""){return null}var j=e.split("?");if(j.length>1){var l=j[1].split("&");e=j[0]+"?";var k=false,f=false;for(var m=0,n=l.length;m<n;m++){var g=l[m].split("=");if(g.length>1){if(g[0].toLocaleLowerCase()=="width"){k=true}if(g[0]=="isTextDrawn"){f=true}}e+=(m==0)?l[m]:"&"+l[m]}if(!k){e+="&width="+b.DEFAULT_PRINT_PARAM_WIDTH}if(!f){e+="&isTextDrawn="+b.DEFAULT_PRINT_PARAM_TEXT}}else{e=e+"?isTextDrawn="+b.DEFAULT_PRINT_PARAM_TEXT+"&width="+b.DEFAULT_PRINT_PARAM_WIDTH}return e.replace("%s",h.value)},getCheckCode:function(e){var h=0,g=0;for(var f=0;f<=11;f++){f%2==0?h+=parseInt(e[f]):g+=parseInt(e[f])}return((10-(h+g*3)%10)%10).toString()},getNewBarCode:function(){var f=""+(690+Math.round(Math.random()*(695-690)));for(var e=0;e<9;e++){f+=(""+Math.ceil(Math.random()*9))}f+=this.getCheckCode(f);return f},getPrintContent:function(k,f){var h=this.processPrintUrl();if(h==null){return null}var o=this;var i=document.createElement("div"),q=$(i);var r=function(){$$.dynamics.cache.build();var u=o.dynamicProcessor.getControlContext(o,d,true);var t=new InfoPlus.QuickSortArray();for(var s in u){if(u.hasOwnProperty(s)){t.push({name:s,obj:u[s]})}}t.sort(function(y,x){var w=y.name.length,v=x.name.length;if(w>v){return -1}else{if(w==v){return 0}else{return 1}}});return t};var m=function(){var s=k.length;k[s]=false;var v=document.createElement("div");var t=document.createElement("img");t.src=h;v.appendChild(t);v.setAttribute("style","margin:5px 0 5px -5px");var u=function(){if(t.height===0){setTimeout(u,300)}else{k[s]=true;f()}};setTimeout(u,300);q.append(v)};var p=function(u,t,v,s){if(s!=null){if(t[s]!=null){u=u.replace(new RegExp("\\$"+v+"\\."+s,"gm"),t[s]);return u.replace(new RegExp("\\${"+v+"\\."+s+"}","gm"),t[s])}}else{u=u.replace(new RegExp("\\$"+v,"gm"),t);return u.replace(new RegExp("\\${"+v+"}","gm"),t)}return u};var g=function(s,t){s=s.replace(new RegExp("\\$"+t+"\\.value","gm"),b.IMG_HOLDER);s=s.replace(new RegExp("\\${"+t+"\\.value}","gm"),b.IMG_HOLDER);s=s.replace(new RegExp("\\$"+t,"gm"),b.IMG_HOLDER);s=s.replace(new RegExp("\\${"+t+"}","gm"),b.IMG_HOLDER);return s};var l=function(v){var u=r();for(var t=0,s=u.length;t<s;t++){var w=u[t];var x=w.name;v=p(v,w.obj,x,"displayValue");v=p(v,w.obj,x,"name");if(w.name!=o.field.name){v=p(v,w.obj,x,"value");v=p(v,w.obj,x)}else{v=g(v,x)}}return v.split("\n")};var j=function(x){var w=l(x);for(var u=0,s=w.length;u<s;u++){var t=w[u];if(t.indexOf(b.IMG_HOLDER)!=-1){m()}else{var v=document.createElement("div");$(v).text(t);q.append(v)}}};var e=function(){var u=document.createElement("div");$(u).text($$.params.instanceName);q.append(u);if(($$.params.instanceTags||"")!=""){var t=document.createElement("div");$(t).text($$.params.instanceTags);q.append(t)}m();var s=document.createElement("div");$(s).text("名称："+o.getValue().name);q.append(s)};var n=this.field.format||"";if(n!=""){j(n)}else{e()}q.attr("style","text-align:left");return i},print:function(){var g=[],i=false;var e=c.open();var f=function(){if(!i){return}for(var n=0,m=g.length;n<m;n++){if(!g[n]){return}}e.focus();e.print();e.close()};var l=$("#div_invoice");l.empty();var j=this.getPrintContent(g,f);if(j!=null){l.append(j);var h=l.html();e.document.write("<style>body {text-align:center}</style>"+h);e.document.close();var k=function(){if(!i){i=true;f()}};$(e).load(k);$(e.document).ready(k)}},createElement:function(){var j=document.createElement("div");this.createHiddenElement(j);var k=document.createElement("div");k.setAttribute("class",b.CLASS_INPUT_NAME_DIV);j.appendChild(k);var f=document.createElement("div");f.setAttribute("class",b.CLASS_NAME_DIV);j.appendChild(f);var g=document.createElement("div");g.setAttribute("class",b.CLASS_DELETE_DIV);g.setAttribute("title","删除");j.appendChild(g);var e=document.createElement("div");e.setAttribute("class",b.CLASS_PRINT_DIV);var h=document.createElement("i");h.setAttribute("class","i-icon-print");e.appendChild(h);j.appendChild(e);return j},getAttributes:function(){return $(this.element).data($Control.DATA_ATTRIBUTES)},setValue:function(e,n,k,j){if(e==null){e="";n="";j=null}var i=$(this.element),h=i.data($Control.DATA_ORIGIN_INPUT),g=!(!!k)&&this.shouldFireChangeEvent(e);h.value=e;i.children("."+InfoPlus.Controls.Thing.CLASS_NAME_DIV).text(n);if(n===""){i.removeClass(InfoPlus.Controls.Thing.HAS_VALUE).addClass(InfoPlus.Controls.Thing.NO_VALUE)}else{i.removeClass(InfoPlus.Controls.Thing.NO_VALUE).addClass(InfoPlus.Controls.Thing.HAS_VALUE);var f=this.element.style.width;if(f!=null&&f!==""){var m=i.find("."+b.CLASS_PRINT_DIV).width()+i.find("."+b.CLASS_DELETE_DIV).width();if(f.substring(f.length-1)!=="%"){var l=parseInt(f,10);if(m==0){m=$$.MOBILE?48:32;i.find("."+b.CLASS_NAME_DIV).css("max-width",(l-m-24)+"px")}else{i.find("."+b.CLASS_NAME_DIV).css("max-width",(l-m-24)+"px")}}else{if(i.width()!=parseInt(f,10)){l=parseInt(i.width(),10);i.find("."+b.CLASS_NAME_DIV).css("max-width",(l-m-24)+"px")}else{setTimeout(function(){l=parseInt(i.width(),10);m=i.find("."+b.CLASS_PRINT_DIV).width()+i.find("."+b.CLASS_DELETE_DIV).width();i.find("."+b.CLASS_NAME_DIV).css("max-width",(l-m-24)+"px")},500)}}}}i.data($Control.DATA_ATTRIBUTES,j);i.data($Control.DATA_DISPLAY_VALUE,n);if(g){setTimeout(function(){$(h).change()},0)}},setName:function(h){if(h==null){h=""}var e=$(this.element),g=e.data($Control.DATA_ORIGIN_INPUT),f=this.shouldFireChangeEvent(h);e.children("."+InfoPlus.Controls.Thing.CLASS_NAME_DIV).text(h);if(h===""){e.removeClass(InfoPlus.Controls.Thing.HAS_VALUE).addClass(InfoPlus.Controls.Thing.NO_VALUE)}else{e.removeClass(InfoPlus.Controls.Thing.NO_VALUE).addClass(InfoPlus.Controls.Thing.HAS_VALUE)}e.data($Control.DATA_DISPLAY_VALUE,h);if(f){setTimeout(function(){$(g).change()},0)}},getValue:function(){var e=$(this.element),g=e.data($Control.DATA_ORIGIN_INPUT),h=this.convertEmptyValue(g.value),f=e.data($Control.DATA_DISPLAY_VALUE);return new $Controls.Data.Thing(h,f)},setPlaceHolder:function(){if(this.field!=null&&this.field.placeHolder!=null&&this.field.placeHolder!=""){var e=this.element;var g=document.createElement("div");var f=document.createElement("a");f.setAttribute("href","#");$(f).text(this.field.placeHolder);g.appendChild(f);$(g).addClass("thingTip");$(e).find("."+b.CLASS_INPUT_NAME_DIV).after(g);$(g).click(function(){$IU.fireClick($(this).siblings("."+b.CLASS_INPUT_NAME_DIV)[0]);return false})}},showThingDialog:function(p){var q=this.getValue();if(q.value==""){q.value=this.getNewBarCode()}var j=this.element,r=this,n=document.createElement("div"),e=$(n),g=document.createElement("input"),f=$(g),l=document.createElement("input"),h=$(l),o="请输入物品名称",i=document.createElement("div");e.attr("id","form_thing_id").css("display","inline-block").css("position","relative");f.attr("id","form_thing_id_input").attr("type","text").attr("maxlength",b.BARCODE_LENGTH).val(q.value);h.attr("id","form_thing_name").attr("type","text");if(j.readOnly===true){g.readOnly=true;f.addClass($Control.CLASSNAME_READONLY);f.hide();l.readOnly=true;h.addClass($Control.CLASSNAME_READONLY)}e.text(q.value).css("margin-left","10px");if(!p){f.hide()}else{e.hide();f.css("display","inline-block")}f.css("margin-left","10px").css("width","200px");h.val(q.displayValue).css("margin-left","10px").css("width","200px");$(i).append("<span>编号</span>").append(n).append(g).append("<br>").append("<span>名称</span>").append(l);$(i).css("line-height","30px");f.keyup(function(s){if(f.val().length==b.BARCODE_LENGTH){if(f.data("requesting")!==true){f.data("requesting",true);$$.ajax({type:"GET",url:$$.params.formRender.thingService+"/"+f.val(),data:{formStepId:$$.params.formStepId,instanceId:$$.params.formInstanceId},needParse:false,showParseErrMsg:false,showAjaxErrMsg:false}).done(function(u){if(u.entities.length==0){$IU.messageBox(null,"未找到物品相关信息，请手工输入",null,300)}else{var t=u.entities[0];h.val(t.name);f.data("attr",t.attributes)}}).fail(function(t){if(t.errno==50001){$IU.messageBox(null,"未找到物品相关信息，请手工输入",null,300)}else{$IU.messageBox(null,t.msg,null)}}).always(function(){setTimeout(function(){f.removeData("requesting")},300)})}}if(s.keyCode==13){$(l).focus()}});var m;if(j.readOnly===true){m=[]}else{m=[{name:"保存",defaultButton:true,callOnClose:false,preventDefault:true,callback:function(){if(f.is(":visible")){if(f.val()==""){$IU.messageBox(null,"请输入条码编号",null,200);return false}var s=f.val();if(s.length!=13||r.getCheckCode(s.substr(0,12))!=s.substr(12)){$IU.messageBox(null,"条码编号错误，请重新输入",null,240);return false}}else{if(h.val()==""){$IU.messageBox(null,"请输入名称",null,200);return false}}if(h.val()==""){$IU.messageBox(null,"请输入名称",null,200);return false}r.setValue(f.val(),h.val(),false,f.data("attr"))}},{name:"取消"},{name:"扫码",preventDefault:true,callback:function(){e.hide();f.val("").css("display","inline-block").focus();return false}}]}var k=new InfoPlus.Render.Dialog({title:o,content:i,maxWidth:310,buttons:m});k.show();return false},registerEvent:function(){this.events=InfoPlus.Controls.Thing.Events.events},setElementAttribute:function(){this.setHiddenAttribute("thing")},specialSetting:function(){var e=$(this.element);e.css("height","");e.children("."+InfoPlus.Controls.Thing.CLASS_INPUT_NAME_DIV).attr("title","点击输入物品名称");e.children("."+InfoPlus.Controls.Thing.CLASS_NAME_DIV).attr("title","点击输入物品名称");e.children("."+InfoPlus.Controls.Thing.CLASS_PRINT_DIV).attr("title","打印物品")}});define("InfoPlus.Controls.Thing",b);var a={inputNameClick:function(){var e=$(this).parent().data($Control.DATA_CONTROL_OBJECT);if(e==null){return false}e.showThingDialog(false);return false},nameClick:function(){var e=$(this).parent().data($Control.DATA_CONTROL_OBJECT);if(e==null){return false}e.showThingDialog();return false},printClick:function(){var e=$(this).parent().data($Control.DATA_CONTROL_OBJECT);if(e==null){return false}e.print();return false},deleteClick:function(){var e=$(this).parent().data($Control.DATA_CONTROL_OBJECT);if(e==null){return false}$IU.confirmBox("您确定要删除该物品吗?","确认","确认",300,function(){e.setValue("","",false,null)});return false}};a.events=[{selector:"."+InfoPlus.Controls.Thing.CLASS_INPUT_NAME_DIV,type:"click",handler:a.inputNameClick},{selector:"."+InfoPlus.Controls.Thing.CLASS_NAME_DIV,type:"click",handler:a.nameClick},{selector:"."+InfoPlus.Controls.Thing.CLASS_PRINT_DIV,type:"click",handler:a.printClick},{selector:"."+InfoPlus.Controls.Thing.CLASS_DELETE_DIV,type:"click",handler:a.deleteClick}];define("InfoPlus.Controls.Thing.Events",a)})(window);
(function(l,i){var f=["index","input","toolbar","navMenu","end"];var t=function(){$(".help_block").remove()};var j=function(v,z,y,w){if(z===1){return(v===0?0:(v===1?y.left:y.left+y.width))}else{return(v===0?0:(v===1?w.left:w.left+w.width))}};var p=function(z,x,w,v){if(x===1){return(z===0?0:(z===1?w.top:w.top+w.height))}else{return(z===0?v.top:v.top+v.height)}};var a=function(v,z,y,w){if(z===1){return(v===0?y.left:(v===1?y.width:(screen.width>$(document).width()?screen.width:$(document).width())-y.left-y.width))}else{return(v===0?w.left:(v===1?w.width:(screen.width>$(document).width()?screen.width:$(document).width())-w.left-w.width))}};var d=function(z,x,w,v){if(x===1){return(z===0?w.top:(z===1?w.height:v.top-w.top-w.height))}else{return(z===0?v.height:(screen.height>$(document).height()?screen.height:$(document).height()-v.top-v.height))}};var q=function(v,y,w){return(v===0?0:(v===1?y:y+w))+"px"};var c=function(x,w,v){return(x===0?0:(x===1?w:w+v))+"px"};var e=function(v,y,w){return(v===0?y:(v===1?w:(screen.width>$(document).width()?screen.width:$(document).width())-y-w))+"px"};var m=function(x,w,v){return(x===0?w:(x===1?v:(screen.height>$(document).height()?screen.height:$(document).height())-w-v))+"px"};var h=function(z,w,B){t();$(document.body).css("overflow","hidden");for(var v=0;v<3;v++){for(var D=0;D<3;D++){var C=document.createElement("div");var A=$(C);A.attr("id","help_block_1_"+v+"_"+D).addClass("help_block");if(v===1&&D===1){A.addClass("help_highlight")}else{A.addClass("help_background")}A.css("left",j(v,1,z,w)+"px").css("top",p(D,1,z,w)+"px").css("width",a(v,1,z,w)+"px").css("height",d(D,1,z,w)+"px");A.data("step",B);document.body.appendChild(C)}}for(v=0;v<3;v++){for(D=0;D<2;D++){C=document.createElement("div");A=$(C);A.attr("id","help_block_2_"+v+"_"+D).addClass("help_block");if(v===1&&D===0){A.addClass("help_highlight")}else{A.addClass("help_background")}A.css("left",j(v,2,z,w)+"px").css("top",p(D,2,z,w)+"px").css("width",a(v,2,z,w)+"px").css("height",d(D,2,z,w)+"px");A.data("step",B);document.body.appendChild(C)}}$(".help_block").unbind().click(function(){o(B+1)})};var r=function(A,D,w,F,z){t();$(document.body).css("overflow","hidden");for(var E=0;E<3;E++){for(var C=0;C<3;C++){var B=document.createElement("div");var v=$(B);v.attr("id","help_block_"+E+"_"+C).addClass("help_block");if(E===1&&C===1){v.addClass("help_highlight")}else{v.addClass("help_background")}v.css("left",q(E,A,w)).css("top",c(C,D,F)).css("width",e(E,A,w)).css("height",m(C,D,F));v.data("step",z);document.body.appendChild(B)}}$(".help_block").unbind().click(function(){o(z+1)})};var k=function(B,A,z,w){for(var v=0;v<3;v++){for(var C=0;C<3;C++){$("#help_block_"+v+"_"+C).css("left",q(v,B,z)).css("top",c(C,A,w)).css("width",e(v,B,z)).css("height",m(C,A,w))}}};var n=function(z,w){for(var v=0;v<3;v++){for(var A=0;A<3;A++){$("#help_block_1_"+v+"_"+A).css("left",j(v,1,z,w)+"px").css("top",p(A,1,z,w)+"px").css("width",a(v,1,z,w)+"px").css("height",d(A,1,z,w)+"px")}}for(v=0;v<3;v++){for(A=0;A<2;A++){$("#help_block_2_"+v+"_"+A).css("left",j(v,2,z,w)+"px").css("top",p(A,2,z,w)+"px").css("width",a(v,2,z,w)+"px").css("height",d(A,2,z,w)+"px")}}};var b=function(y,w,x,v){var z=$("#help_content");if(y!==i){z.css("left",y+"px")}if(w!==i){z.css("right",w+"px")}if(x!==i){z.css("top",x+"px")}if(v!==i){z.css("bottom",v+"px")}};var g=function(y,A,x,z,v){var B=$("#help_content"),w=f[y];B.attr("class","").css("left","").css("top","").css("right","").css("bottom","").hide();b(A,x,z,v);B.addClass("help_"+w).data("step",y).fadeIn(1500);B.unbind().click(function(){o(y+1)});B.show()};var s=function(){};var o=function(B){$(l).off("resize",s);var y=f[B],z=$("#nav_menu"),x=$("#form_holder"),v=$("#title_description");if(!v.is(":visible")){v=$("#title_description_short")}var w=function(){var I=$("#form_command_bar");switch(y){case"input":return[{left:v.offset().left,top:v.offset().top,width:v.width(),height:v.height(),helpContentLeft:x.offset().left,helpContentTop:0},{left:x.offset().left,top:x.offset().top,width:x.width(),height:x.height()}];break;case"toolbar":return{left:I.offset().left,top:I.offset().top,width:I.width(),height:I.height(),helpContentLeft:I.offset().left,helpContentTop:I.offset().top+I.height()};break;case"inputArea":return{left:x.offset().left,top:x.offset().top,width:x.width(),height:x.height(),helpContentLeft:x.offset().left,helpContentTop:0};break;case"numberArea":return{left:v.offset().left,top:v.offset().top,width:v.width(),height:v.height(),helpContentRight:20,helpContentTop:v.offset().top+v.height()};break;case"command":var F=I.find("li.command_button").filter(":visible"),G=0,E=0;if(F.length>0){G=$(F[0]).offset().left;E=$(F[F.length-1]).offset().left-G+$(F[F.length-1]).width()}else{var C=I.find("#command_menu");G=C.offset().left;E=C.width()}var J=I.offset().top,K=I.height();return{left:G,top:J,width:E,height:K,helpContentLeft:G,helpContentTop:J+K+5};break;case"save":F=I.find("li.tool_button");G=$(F[F.length-1]).offset().left;E=$(F[0]).offset().left-$(F[F.length-1]).offset().left+$(F[F.length-1]).width();K=I.height();J=I.offset().top;return{left:G,top:J,width:E,height:K,helpContentRight:20,helpContentTop:J+K+5};break;case"navMenu":var H=$("#title_icon");return{left:H.offset().left,top:H.offset().top,width:H.width(),height:H.height(),helpContentLeft:0,helpContentTop:H.offset().top+H.height()+5};break;case"navContent":return{left:0,top:z.offset().top,width:z.width(),height:z.height(),helpContentLeft:0,helpContentTop:z.offset().top};break;case"remark":var D=$("#form_remark_holder");return{left:D.offset().left,top:D.offset().top,width:D.outerWidth(),height:D.outerHeight(),helpContentLeft:D.offset().left,helpContentTop:D.offset().top-$(document).scrollTop()-100};break}};if(y==="end"){$("#help_content").hide();$(".help_block").remove();$(document).scrollTop(0);$(document.body).css("overflow","");$(document).off("keypress",u)}else{if(y==="navContent"){z.show()}if(y==="remark"){z.hide();if($(document.body).height()-$(l).height()>0){$(document).scrollTop($(document.body).height()-$(l).height())}else{$(document).scrollTop(0)}}var A=w();if(Object.prototype.toString.call(A)!=="[object Array]"){r(A.left,A.top,A.width,A.height,B);g(B,A.helpContentLeft,A.helpContentRight,A.helpContentTop,A.helpContentBottom)}else{h(A[0],A[1],B);g(B,A[0].helpContentLeft,A[0].helpContentRight,A[0].helpContentTop,A[0].helpContentBottom)}s=function(){var C=w();if(Object.prototype.toString.call(A)!=="[object Array]"){k(C.left,C.top,C.width,C.height);b(C.helpContentLeft,C.helpContentRight,C.helpContentTop,C.helpContentBottom)}else{n(C[0],C[1]);b(C[0].helpContentLeft,C[0].helpContentRight,C[0].helpContentTop,C[0].helpContentBottom)}};$(l).resize(s)}};var u=function(){return false};l.loadHelp=function(){$(document).keypress(u);$("html, body").scrollTop(0).scrollLeft(0);r(0,0,0,0,0);g(0)}})(window);
